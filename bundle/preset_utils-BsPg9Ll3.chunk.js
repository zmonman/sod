import{a7 as e,S as t,v as s,am as i,T as a,g as n,h as o,C as l,j as r,u as d,ao as c,ay as h,bd as m,be as u,bf as p,q as g,y as f,x as I,Y as w,N as v,aq as b,O as x,bg as S,G as E,bh as y,ak as P,aa as k,bi as C,bj as L,aH as T,bk as N,bl as _,bm as A,bn as R,ap as D,bo as M,_ as V,bp as U,bq as W,P as F,c as O,br as H,bs as q,bt as B,bu as z,bv as j,aC as $,bw as G,l as K,bx as J,by as Z,bz as Y,bA as Q,bB as X,bC as ee,bD as te,Z as se,w as ie,D as ae,bE as ne,i as oe,bF as le,bG as re,bH as de,e as ce,bI as he,E as me,aj as ue,an as pe,o as ge,U as fe,f as Ie,a6 as we,bJ as ve,bK as be,bL as xe,bM as Se,bN as Ee,bO as ye,bP as Pe,bQ as ke,bR as Ce,bS as Le,bT as Te,bU as Ne,F as _e,bV as Ae,bW as Re,bX as De,bY as Me,bZ as Ve,b_ as Ue,b$ as We,a$ as Fe,c0 as Oe,c1 as He,c2 as qe,c3 as Be,al as ze,af as je,c4 as $e,aB as Ge,ac as Ke,aY as Je,ad as Ze,ae as Ye,aO as Qe,b6 as Xe,aP as et,as as tt,ax as st,au as it,ai as at,c5 as nt,ab as ot,ah as lt,at as rt,aT as dt,b2 as ct,ag as ht,c6 as mt,c7 as ut,c8 as pt,c9 as gt,aU as ft,ca as It,cb as wt,cc as vt,cd as bt,ce as xt,cf as St,cg as Et,ch as yt,ci as Pt,cj as kt,ck as Ct,cl as Lt,R as Tt,cm as Nt,k as _t,I as At,cn as Rt,co as Dt,cp as Mt,a1 as Vt,cq as Ut,cr as Wt,cs as Ft,ct as Ot,cu as Ht,cv as qt,cw as Bt,cx as zt,cy as jt,cz as $t,cA as Gt,cB as Kt,cC as Jt,s as Zt,p as Yt,cD as Qt,cE as Xt,cF as es,cG as ts,cH as ss,cI as is,cJ as as,cK as ns,cL as os,cM as ls,cN as rs,cO as ds,cP as cs,cQ as hs,cR as ms,cS as us,cT as ps,a8 as gs,cU as fs,cV as Is,cW as ws,cX as vs,cY as bs,cZ as xs,b as Ss,c_ as Es,c$ as ys,d0 as Ps,d1 as ks,d2 as Cs,d3 as Ls,d4 as Ts,d5 as Ns,d6 as _s,d7 as As,d8 as Rs,d9 as Ds,da as Ms,db as Vs,dc as Us,dd as Ws,de as Fs,df as Os,dg as Hs,dh as qs,di as Bs,dj as zs,dk as js,dl as $s,dm as Gs,dn as Ks,dp as Js,dq as Zs,dr as Ys,ds as Qs,dt as Xs,du as ei,dv as ti,dw as si,dx as ii,dy as ai,dz as ni,dA as oi,dB as li,dC as ri,dD as di,dE as ci,dF as hi,dG as mi,dH as ui,dI as pi,dJ as gi,dK as fi,dL as Ii,dM as wi,dN as vi,dO as bi,dP as xi,dQ as Si,dR as Ei,dS as yi,dT as Pi,dU as ki,dV as Ci,dW as Li,dX as Ti,dY as Ni,dZ as _i,d_ as Ai,d$ as Ri,e0 as Di,e1 as Mi,e2 as Vi,e3 as Ui,e4 as Wi,e5 as Fi,e6 as Oi,e7 as Hi,e8 as qi,z as Bi,e9 as zi,ea as ji,eb as $i,ec as Gi,ed as Ki,ee as Ji,ef as Zi,eg as Yi,eh as Qi,ei as Xi,ej as ea,ek as ta,el as sa,em as ia,en as aa,eo as na,ep as oa,eq as la,er as ra,es as da,et as ca,eu as ha,ev as ma,ew as ua,ex as pa,ey as ga,ez as fa,eA as Ia,eB as wa,eC as va,eD as ba,eE as xa,eF as Sa,eG as Ea,r as ya,eH as Pa,eI as ka,eJ as Ca,a3 as La,eK as Ta,eL as Na,eM as _a,eN as Aa,eO as Ra,eP as Da,eQ as Ma,eR as Va,eS as Ua,eT as Wa,a0 as Fa,Q as Oa,eU as Ha,eV as qa,eW as Ba,eX as za,eY as ja,eZ as $a,e_ as Ga,e$ as Ka,a4 as Ja,a5 as Za,f0 as Ya,f1 as Qa}from"./detailed_results-DzdytCXS.chunk.js";import{t as Xa,M as en,T as tn,i as sn}from"./index-CuUCtUeR.chunk.js";var an=(e=>(e[e.Unlaunched=0]="Unlaunched",e[e.Alpha=1]="Alpha",e[e.Beta=2]="Beta",e[e.Launched=3]="Launched",e))(an||{});const nn={phase:e.Phase1,status:0},on={[t.SpecBalanceDruid]:{phase:e.Phase4,status:1},[t.SpecFeralDruid]:{phase:e.Phase4,status:1},[t.SpecFeralTankDruid]:{phase:e.Phase1,status:0},[t.SpecRestorationDruid]:{phase:e.Phase1,status:0},[t.SpecElementalShaman]:{phase:e.Phase4,status:1},[t.SpecEnhancementShaman]:{phase:e.Phase4,status:1},[t.SpecRestorationShaman]:{phase:e.Phase1,status:0},[t.SpecWardenShaman]:{phase:e.Phase4,status:1},[t.SpecHunter]:{phase:e.Phase4,status:1},[t.SpecMage]:{phase:e.Phase4,status:1},[t.SpecRogue]:{phase:e.Phase4,status:1},[t.SpecTankRogue]:{phase:e.Phase4,status:1},[t.SpecHolyPaladin]:{phase:e.Phase1,status:0},[t.SpecProtectionPaladin]:{phase:e.Phase1,status:0},[t.SpecRetributionPaladin]:{phase:e.Phase4,status:1},[t.SpecHealingPriest]:{phase:e.Phase1,status:0},[t.SpecShadowPriest]:{phase:e.Phase4,status:1},[t.SpecWarlock]:{phase:e.Phase4,status:1},[t.SpecTankWarlock]:{phase:e.Phase4,status:1},[t.SpecWarrior]:{phase:e.Phase4,status:1},[t.SpecTankWarrior]:{phase:e.Phase4,status:1}};function ln(e){return Object.keys(s).map((e=>parseInt(e))).filter((t=>s[t]==e&&on[t].status>0))}const rn=5;class dn{constructor(e,t){this.buffs=i.create(),this.compChangeEmitter=new a,this.buffsChangeEmitter=new a,this.sim=t,this.raid=e,this.players=[...Array(5).keys()].map((e=>null)),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=a.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((e=>null!=e)).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,i.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,s){if(t<0||t>=5)throw new Error("Invalid player index: "+t);s!=this.players[t]&&a.freezeAllAndDo((()=>{const i=this.players[t];if(null!=i&&(i.changeEmitter.off(this.playerChangeListener),i.setParty(null)),null!=s){const i=s.getParty();i&&i.setPlayer(e,s.getPartyIndex(),null),this.players[t]=s,s.changeEmitter.on(this.playerChangeListener),s.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)}))}getBuffs(){return i.clone(this.buffs)}setBuffs(e,t){i.equals(this.buffs,t)||(this.buffs=i.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return n.create({players:this.players.map((s=>null==s?o.create():s.toProto(e,t))),buffs:this.buffs})}fromProto(e,t){a.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||i.create());for(let s=0;s<5;s++){if(!t.players[s]||t.players[s].class==l.ClassUnknown){this.setPlayer(e,s,null);continue}const i=t.players[s],a=r(i),n=this.players[s];if(n&&a==n.spec)n.fromProto(e,i);else{const t=new Vn(a,this.sim);t.fromProto(e,i),this.setPlayer(e,s,t)}}}))}}const cn=d(c).length,hn=d(h).length;class mn{constructor(e,t){this.stat=e,this.pseudoStat=t}isStat(){return null!=this.stat}isPseudoStat(){return null!=this.pseudoStat}getStat(){if(!this.isStat())throw new Error("Not a stat!");return this.stat}getPseudoStat(){if(!this.isPseudoStat())throw new Error("Not a pseudo stat!");return this.pseudoStat}equals(e){return this.stat==e.stat&&this.pseudoStat==e.pseudoStat}getName(e){return this.isStat()?m(this.stat,e):u.get(this.pseudoStat)}getProtoValue(e){return this.isStat()?e.stats[this.stat]:e.pseudoStats[this.pseudoStat]}setProtoValue(e,t){this.isStat()?e.stats[this.stat]=t:e.pseudoStats[this.pseudoStat]=t}static fromStat(e){return new mn(e,null)}static fromPseudoStat(e){return new mn(null,e)}static getAll(){const e=d(c).filter((e=>![c.StatEnergy,c.StatRage].includes(e))),t=d(h);return[e.map((e=>mn.fromStat(e))),t.map((e=>mn.fromPseudoStat(e)))].flat()}}class un{constructor(e,t){this.stats=un.initStatsArray(cn,e),this.pseudoStats=un.initStatsArray(hn,t)}static initStatsArray(e,t){let s=t?.slice(0,e)||[];s.length<e&&(s=s.concat(new Array(e-(t?.length||0)).fill(0)));for(let i=0;i<e;i++)null==s[i]&&(s[i]=0);return s}equals(e){return this.stats.every(((t,s)=>t==e.getStat(s)))&&this.pseudoStats.every(((t,s)=>t==e.getPseudoStat(s)))}getStat(e){return this.stats[e]}getPseudoStat(e){return this.pseudoStats[e]}getUnitStat(e){return e.isStat()?this.stats[e.getStat()]:this.pseudoStats[e.getPseudoStat()]}withStat(e,t){const s=this.stats.slice();return s[e]=t,new un(s,this.pseudoStats)}withPseudoStat(e,t){const s=this.pseudoStats.slice();return s[e]=t,new un(this.stats,s)}withUnitStat(e,t){return e.isStat()?this.withStat(e.getStat(),t):this.withPseudoStat(e.getPseudoStat(),t)}addStat(e,t){return this.withStat(e,this.getStat(e)+t)}addPseudoStat(e,t){return this.withPseudoStat(e,this.getPseudoStat(e)+t)}add(e){return new un(this.stats.map(((t,s)=>t+e.stats[s])),this.pseudoStats.map(((t,s)=>t+e.pseudoStats[s])))}subtract(e){return new un(this.stats.map(((t,s)=>t-e.stats[s])),this.pseudoStats.map(((t,s)=>t-e.pseudoStats[s])))}scale(e){return new un(this.stats.map(((t,s)=>t*e)),this.pseudoStats.map(((t,s)=>t*e)))}computeEP(e){let t=0;return this.stats.forEach(((s,i)=>{t+=s*e.stats[i]})),this.pseudoStats.forEach(((s,i)=>{t+=s*e.pseudoStats[i]})),t}belowCaps(e){for(const[t,s]of this.stats.entries())if(e.stats[t]>0&&s>e.stats[t])return!1;return!0}asArray(){return this.stats.slice()}toJson(){return p.toJson(this.toProto())}toProto(){return p.create({stats:this.stats.slice(),pseudoStats:this.pseudoStats.slice()})}static fromJson(e){return un.fromProto(p.fromJson(e))}static fromMap(e,t){const s=new Array(cn).fill(0);Object.entries(e).forEach((e=>{const[t,i]=e;s[Number(t)]=i}));const i=new Array(hn).fill(0);return t&&Object.entries(t).forEach((e=>{const[t,s]=e;i[Number(t)]=s})),new un(s,i)}static fromProto(e){return e?new un(e.stats,e.pseudoStats):new un}}class pn extends g{constructor(e,t){const s=I();super(e,"copy-button",f("button",{className:`btn ${t.extraCssClasses?.join(" ")??""}`,ref:s},f("i",{className:"fas fa-copy me-1"}),t.text??"Copy to Clipboard")),this.config=t;const i=s.value;let a=!1;i.addEventListener("click",(()=>{if(a)return;const e=this.config.getContent();if(null==navigator.clipboard)alert(e);else{a=!0,navigator.clipboard.writeText(e);const t=i.innerHTML;i.innerHTML='<i class="fas fa-check me-1"></i>Copied',setTimeout((()=>{i.innerHTML=t,a=!1}),1500)}})),t.tooltip&&Xa(i,{content:t.tooltip})}}class gn extends w{constructor(e,t,s){super(e,"talents-picker-root",t,s),this.config=s,this.pointsPerRow=s.pointsPerRow,this.numRows=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.rowIdx)).flat())).flat())+1,this.numCols=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.colIdx)).flat())).flat())+1;const i=()=>t.getLevel()-9;this.maxPoints=i();const n=()=>this.maxPoints-t.getTalentTreePoints().reduce(((e,t)=>e+t),0),o=I(),l=I(),r=I(),d=I(),c=I();this.rootElem.appendChild(f("div",{className:"talents-picker-inner"},f("div",{className:"talents-picker-header"},f("div",{className:"d-flex"},f("label",null,"Points Remaining:",f("span",{ref:o},n()))),f("div",{className:"talents-picker-actions",ref:l})),f("div",{id:"talents-carousel",className:"carousel slide"},f("div",{className:"carousel-inner",ref:r}),f("button",{className:"carousel-control-prev",type:"button",ref:d},f("span",{className:"carousel-control-prev-icon",attributes:{"aria-hidden":!0}}),f("span",{className:"visually-hidden"},"Previous")),f("button",{className:"carousel-control-next",type:"button",ref:c},f("span",{className:"carousel-control-next-icon",attributes:{"aria-hidden":!0}}),f("span",{className:"visually-hidden"},"Next")))));const h=r.value,m=d.value,u=c.value;a.onAny([t.levelChangeEmitter,t.talentsChangeEmitter]).on((()=>{this.setMaxPoints(i()),o.value.textContent=`${n()}`})),new pn(l.value,{extraCssClasses:["btn-sm","btn-outline-primary","copy-talents"],getContent:()=>t.getTalentsString(),text:"Copy",tooltip:"Copy talent string"}),this.trees=s.trees.map(((e,t)=>{const i=document.createElement("div");return h.appendChild(i),i.classList.add("carousel-item"),1===t&&i.classList.add("active"),new fn(i,e,this,s.klass,t)})),this.trees.forEach((e=>e.talents.forEach((e=>e.setPoints(0,!1)))));let p=0;m.addEventListener("click",(()=>{p>=1||(p+=1,h.style.transform=`translateX(${33.3*p}%)`,h.children[Math.abs(p-2)%3].classList.remove("active"),h.children[Math.abs(p-1)%3].classList.add("active"))})),u.addEventListener("click",(()=>{p<=-1||(p-=1,h.style.transform=`translateX(${33.3*p}%)`,h.children[Math.abs(p)%3].classList.remove("active"),h.children[Math.abs(p)+1].classList.add("active"))})),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.trees.map((e=>e.getTalentsString())).join("-").replace(/-+$/g,"")}setInputValue(e){const t=e.split("-");this.trees.forEach(((e,s)=>e.setTalentsString(t[s]||""))),this.updateTrees()}updateTrees(){this.isFull()?this.rootElem.classList.add("talents-full"):this.rootElem.classList.remove("talents-full"),this.trees.forEach((e=>e.update()))}get numPoints(){return v(this.trees.map((e=>e.numPoints)))}isFull(){return this.numPoints>=this.maxPoints}setMaxPoints(e){e!=this.maxPoints&&(this.maxPoints=e,this.updateTrees())}}class fn extends g{constructor(e,t,s,i,n){super(e,"talent-tree-picker-root"),this.config=t,this.numPoints=0,this.picker=s,this.rootElem.appendChild(f(x,null,f("div",{className:"talent-tree-header"},f("img",{src:b(i,n),className:"talent-tree-icon"}),f("span",{className:"talent-tree-title"}),f("label",{className:"talent-tree-points"}),f("button",{className:"talent-tree-reset btn link-danger"},f("i",{className:"fa fa-times"}))),f("div",{className:"talent-tree-background"}),f("div",{className:"talent-tree-main"}))),this.title=this.rootElem.getElementsByClassName("talent-tree-title")[0],this.pointsElem=this.rootElem.querySelector(".talent-tree-points");this.rootElem.querySelector(".talent-tree-background").style.backgroundImage=`url('${t.backgroundUrl}')`;const o=this.rootElem.querySelector(".talent-tree-main");o.style.gridTemplateRows=`repeat(${this.picker.numRows}, 1fr)`,o.style.gridTemplateColumns=`repeat(${this.picker.numCols}, 1fr)`;const l="3.5rem";o.style.height=`calc(${l} * ${this.picker.numRows})`,o.style.maxWidth=`calc(${l} * ${this.picker.numCols})`,this.rootElem.style.maxWidth=`calc(${l} * ${this.picker.numCols+2})`,this.talents=t.talents.map((e=>new wn(o,e,this))),this.talents.forEach((e=>{e.config.prereqLocation&&this.getTalent(e.config.prereqLocation).config.childLocations.push(e.config.location)}));const r=(e,t)=>{e.initChildReqs(),e.zIndex=t;for(const s of e.config.childLocations){const i=this.getTalent(s);i.parentReq=e.getChildReqArrow(s),r(i,t-2)}};for(const a of this.talents)0!=a.config.childLocations.length&&void 0===a.config.prereqLocation&&r(a,20);const d=this.rootElem.querySelector(".talent-tree-reset");Xa(d,{content:"Reset talent points"}),d.addEventListener("click",(e=>{this.talents.forEach((e=>e.setPoints(0,!1))),this.picker.inputChanged(a.nextEventID())}))}update(){this.title.innerHTML=this.config.name,this.pointsElem.textContent=`${this.numPoints} / ${this.getMaxSpendablePoints()}`,this.talents.forEach((e=>e.update()))}getTalent(e){const t=this.talents.find((t=>t.getRow()==e.rowIdx&&t.getCol()==e.colIdx));if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return this.talents.map((e=>String(e.getPoints()))).join("").replace(/0+$/g,"")}setTalentsString(e){this.talents.forEach(((t,s)=>t.setPoints(Number(e.charAt(s)),!1)))}getMaxSpendablePoints(){return this.picker.maxPoints}}class In extends g{constructor(e,t,s){super(e,"talent-picker-req-arrow",document.createElement("div")),this.zIdx=0,this.parentLoc=t,this.childLoc=s,this.rootElem.style.gridRow=String(t.rowIdx+1),this.rootElem.style.gridColumn=String(t.colIdx+1);let i=Math.max(t.rowIdx,s.rowIdx)+1,a=Math.max(t.colIdx,s.colIdx)+1;t.rowIdx==s.rowIdx?(this.dir=t.colIdx<s.colIdx?"right":"left",this.rootElem.dataset.reqArrowColSize=String(Math.abs(t.colIdx-s.colIdx)),a="left"==this.dir?a+1:a-1):t.colIdx==s.colIdx?(this.dir="down",this.rootElem.dataset.reqArrowRowSize=String(Math.abs(t.rowIdx-s.rowIdx)),i+=1):(this.dir=t.colIdx<s.colIdx?"rightdown":"leftdown",this.rootElem.dataset.reqArrowColSize=String(Math.abs(t.colIdx-s.colIdx)),this.rootElem.dataset.reqArrowRowSize=String(Math.abs(t.rowIdx-s.rowIdx)),i+=1,a="rightdown"==this.dir?a+1:a-1,this.rootElem.appendChild(f("div",null))),this.rootElem.style.gridRowEnd=String(i),this.rootElem.style.gridColumnEnd=String(a),this.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`)}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(e)}setReqFufilled(e){e?this.rootElem.dataset.reqActive="true":delete this.rootElem.dataset.reqActive}}class wn extends g{constructor(e,t,s){super(e,"talent-picker-root",document.createElement("a")),this.config=t,this.tree=s,this.childReqs=[],this.parentReq=null,this.zIdx=0,this.rootElem.style.gridRow=String(this.config.location.rowIdx+1),this.rootElem.style.gridColumn=String(this.config.location.colIdx+1),this.rootElem.dataset.maxPoints=String(this.config.maxPoints),this.rootElem.dataset.whtticon="false",this.pointsDisplay=document.createElement("span"),this.pointsDisplay.classList.add("talent-picker-points"),this.rootElem.appendChild(this.pointsDisplay),this.rootElem.addEventListener("click",(e=>{e.preventDefault()})),this.rootElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootElem.addEventListener("touchmove",(e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setPoints(0,!0),this.tree.picker.inputChanged(a.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(e=>{if(e.preventDefault(),null==this.longTouchTimer)return;clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0;let t=this.getPoints()+1;this.config.maxPoints<t&&(t=0),this.setPoints(t,!0),this.tree.picker.inputChanged(a.nextEventID())})),this.rootElem.addEventListener("mousedown",(e=>{S(e)?this.setPoints(this.getPoints()-1,!0):this.setPoints(this.getPoints()+1,!0),this.tree.picker.inputChanged(a.nextEventID())}))}initChildReqs(){if(0!=this.config.childLocations.length)for(const e of this.config.childLocations)this.childReqs.push(new In(this.rootElem.parentElement,this.config.location,e))}getChildReqArrow(e){for(const t of this.childReqs)if(t.childLoc===e)return t;throw Error("missing child prereq?")}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx);for(const t of this.childReqs)t.zIndex=this.zIdx-1}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}getPoints(){const e=Number(this.rootElem.dataset.points);return isNaN(e)?0:e}isFull(){return this.getPoints()>=this.config.maxPoints}canSetPoints(e){const t=this.getPoints();if(e>t){const s=e-t;if(this.tree.picker.numPoints+s>this.tree.picker.maxPoints)return!1;if(this.tree.numPoints<this.getRow()*this.tree.picker.pointsPerRow)return!1;if(this.config.prereqLocation&&!this.tree.getTalent(this.config.prereqLocation).isFull())return!1}else{const s=t-e,i=[...Array(this.tree.picker.numRows).keys()].map((e=>this.tree.talents.filter((t=>t.getRow()==e)))).map((e=>v(e.map((e=>e.getPoints())))));i[this.getRow()]-=s;const a=i.map(((e,t)=>v(i.slice(0,t+1))));if(!this.tree.talents.every((e=>0==e.getPoints()||0==e.getRow()||a[e.getRow()-1]>=e.getRow()*this.tree.picker.pointsPerRow)))return!1;for(const e of this.config.childLocations)if(this.tree.getTalent(e).getPoints()>0)return!1}return!0}setPoints(e,t){const s=this.getPoints();if(e=Math.max(0,e),e=Math.min(this.config.maxPoints,e),t&&!this.canSetPoints(e))return;this.tree.numPoints+=e-s,this.rootElem.dataset.points=String(e),this.pointsDisplay.textContent=e+"/"+this.config.maxPoints,this.isFull()?this.rootElem.classList.add("talent-full"):this.rootElem.classList.remove("talent-full");const i=this.getSpellIdForPoints(e);E.fromSpellId(i).fill().then((e=>{e.setWowheadHref(this.rootElem),this.rootElem.style.backgroundImage=`url('${e.iconUrl}')`}))}getSpellIdForPoints(e){const t=Math.max(0,e-1);if(this.config.spellIds[t])return this.config.spellIds[t];throw new Error(`No rank ${e} for talent ${String(this.config.fieldName)}`)}update(){const e=this.canSetPoints(this.getPoints()+1);e?this.rootElem.classList.add("talent-picker-can-add"):this.rootElem.classList.remove("talent-picker-can-add"),this.parentReq&&this.parentReq.setReqFufilled(e||this.isFull())}}function vn(e){return e.forEach((e=>{e.talents.forEach(((t,s)=>{if(t.childLocations=[],0!=s){const i=e.talents[s-1];if(t.location.rowIdx<i.location.rowIdx||t.location.rowIdx==i.location.rowIdx&&t.location.colIdx<=i.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fieldName)}`)}if(t.spellIds.length<t.maxPoints){let e=t.spellIds[t.spellIds.length-1];for(let s=t.spellIds.length;s<t.maxPoints;s++)e++,t.spellIds.push(e)}}))})),e}const bn=vn([{name:"Balance",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/283.jpg",talents:[{fieldName:"improvedWrath",location:{rowIdx:0,colIdx:0},spellIds:[16814,16815,16816,16817,16818],maxPoints:5},{fieldName:"naturesGrasp",location:{rowIdx:0,colIdx:1},spellIds:[16689],maxPoints:1},{fieldName:"improvedNaturesGrasp",location:{rowIdx:0,colIdx:2},spellIds:[17245,17247,17248,17249],maxPoints:4,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedEntanglingRoots",location:{rowIdx:1,colIdx:0},spellIds:[16918,16919,16920],maxPoints:3},{fieldName:"improvedMoonfire",location:{rowIdx:1,colIdx:1},spellIds:[16821,16822,16823,16824,16825],maxPoints:5},{fieldName:"naturalWeapons",location:{rowIdx:1,colIdx:2},spellIds:[16902,16903,16904,16905,16906],maxPoints:5},{fieldName:"naturalShapeshifter",location:{rowIdx:1,colIdx:3},spellIds:[16833,16834,16835],maxPoints:3},{fieldName:"improvedThorns",location:{rowIdx:2,colIdx:0},spellIds:[16836,16839,16840],maxPoints:3},{fieldName:"omenOfClarity",location:{rowIdx:2,colIdx:2},spellIds:[16864],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"naturesReach",location:{rowIdx:2,colIdx:3},spellIds:[16819,16820],maxPoints:2},{fieldName:"vengeance",location:{rowIdx:3,colIdx:1},spellIds:[16909,16910,16911,16912,16913],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedStarfire",location:{rowIdx:3,colIdx:2},spellIds:[16850,16923,16924,16925,16926],maxPoints:5},{fieldName:"naturesGrace",location:{rowIdx:4,colIdx:1},spellIds:[16880],maxPoints:1},{fieldName:"moonglow",location:{rowIdx:4,colIdx:2},spellIds:[16845,16846,16847],maxPoints:3},{fieldName:"moonfury",location:{rowIdx:5,colIdx:1},spellIds:[16896,16897,16899,16900,16901],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"moonkinForm",location:{rowIdx:6,colIdx:1},spellIds:[24858],maxPoints:1}]},{name:"Feral Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/281.jpg",talents:[{fieldName:"ferocity",location:{rowIdx:0,colIdx:1},spellIds:[16934,16935,16936,16937,16938],maxPoints:5},{fieldName:"feralAggression",location:{rowIdx:0,colIdx:2},spellIds:[16858,16859,16860,16861,16862],maxPoints:5},{fieldName:"feralInstinct",location:{rowIdx:1,colIdx:0},spellIds:[16947,16948,16949,16950,16951],maxPoints:5},{fieldName:"brutalImpact",location:{rowIdx:1,colIdx:1},spellIds:[16940,16941],maxPoints:2},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[16929,16930,16931,16932,16933],maxPoints:5},{fieldName:"felineSwiftness",location:{rowIdx:2,colIdx:0},spellIds:[17002,24866],maxPoints:2},{fieldName:"feralCharge",location:{rowIdx:2,colIdx:1},spellIds:[16979],maxPoints:1},{fieldName:"sharpenedClaws",location:{rowIdx:2,colIdx:2},spellIds:[16942,16943,16944],maxPoints:3},{fieldName:"improvedShred",location:{rowIdx:3,colIdx:0},spellIds:[16966,16968],maxPoints:2},{fieldName:"predatoryStrikes",location:{rowIdx:3,colIdx:1},spellIds:[16972,16974,16975],maxPoints:3},{fieldName:"bloodFrenzy",location:{rowIdx:3,colIdx:2},spellIds:[16952,16954],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"primalFury",location:{rowIdx:3,colIdx:3},spellIds:[16958,16961],maxPoints:2},{fieldName:"savageFury",location:{rowIdx:4,colIdx:0},spellIds:[16998,16999],maxPoints:2},{fieldName:"faerieFireFeral",location:{rowIdx:4,colIdx:2},spellIds:[16857],maxPoints:1},{fieldName:"heartOfTheWild",location:{rowIdx:5,colIdx:1},spellIds:[17003,17004,17005,17006,24894],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"leaderOfThePack",location:{rowIdx:6,colIdx:1},spellIds:[17007],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/282.jpg",talents:[{fieldName:"improvedMarkOfTheWild",location:{rowIdx:0,colIdx:1},spellIds:[17050,17051,17053,17054,17055],maxPoints:5},{fieldName:"furor",location:{rowIdx:0,colIdx:2},spellIds:[17056,17058,17059,17060,17061],maxPoints:5},{fieldName:"improvedHealingTouch",location:{rowIdx:1,colIdx:0},spellIds:[17069,17070,17071,17072,17073],maxPoints:5},{fieldName:"naturesFocus",location:{rowIdx:1,colIdx:1},spellIds:[17063,17065,17066,17067,17068],maxPoints:5},{fieldName:"improvedEnrage",location:{rowIdx:1,colIdx:2},spellIds:[17079,17082],maxPoints:2},{fieldName:"reflection",location:{rowIdx:2,colIdx:1},spellIds:[17106,17107,17108],maxPoints:3},{fieldName:"insectSwarm",location:{rowIdx:2,colIdx:2},spellIds:[5570],maxPoints:1},{fieldName:"subtlety",location:{rowIdx:2,colIdx:3},spellIds:[17118,17119,17120,17121,17122],maxPoints:5},{fieldName:"tranquilSpirit",location:{rowIdx:3,colIdx:1},spellIds:[24968,24969,24970,24971,24972],maxPoints:5},{fieldName:"improvedRejuvenation",location:{rowIdx:3,colIdx:3},spellIds:[17111,17112,17113],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:0},spellIds:[17116],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"giftOfNature",location:{rowIdx:4,colIdx:2},spellIds:[17104,24943,24944,24945,24946],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedTranquility",location:{rowIdx:4,colIdx:3},spellIds:[17123,17124],maxPoints:2},{fieldName:"improvedRegrowth",location:{rowIdx:5,colIdx:2},spellIds:[17074,17075,17076,17077,17078],maxPoints:5},{fieldName:"swiftmend",location:{rowIdx:6,colIdx:1},spellIds:[18562],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),xn=vn([{name:"Beast Mastery",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/361.jpg",talents:[{fieldName:"improvedAspectOfTheHawk",location:{rowIdx:0,colIdx:1},spellIds:[19552,19553,19554,19555,19556],maxPoints:5},{fieldName:"enduranceTraining",location:{rowIdx:0,colIdx:2},spellIds:[19583,19584,19585,19586,19587],maxPoints:5},{fieldName:"improvedEyesOfTheBeast",location:{rowIdx:1,colIdx:0},spellIds:[19557,19558],maxPoints:2},{fieldName:"improvedAspectOfTheMonkey",location:{rowIdx:1,colIdx:1},spellIds:[19549,19550,19551,24386,24387],maxPoints:5},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[19609,19610,19612],maxPoints:3},{fieldName:"improvedRevivePet",location:{rowIdx:1,colIdx:3},spellIds:[24443,19575],maxPoints:2},{fieldName:"pathfinding",location:{rowIdx:2,colIdx:0},spellIds:[19559,19560],maxPoints:2},{fieldName:"bestialSwiftness",location:{rowIdx:2,colIdx:1},spellIds:[19596],maxPoints:1},{fieldName:"unleashedFury",location:{rowIdx:2,colIdx:2},spellIds:[19616,19617,19618,19619,19620],maxPoints:5},{fieldName:"improvedMendPet",location:{rowIdx:3,colIdx:1},spellIds:[19572,19573],maxPoints:2},{fieldName:"ferocity",location:{rowIdx:3,colIdx:2},spellIds:[19598,19599,19600,19601,19602],maxPoints:5},{fieldName:"spiritBond",location:{rowIdx:4,colIdx:0},spellIds:[19578,20895],maxPoints:2},{fieldName:"intimidation",location:{rowIdx:4,colIdx:1},spellIds:[19577],maxPoints:1},{fieldName:"bestialDiscipline",location:{rowIdx:4,colIdx:3},spellIds:[19590,19592],maxPoints:2},{fieldName:"frenzy",location:{rowIdx:5,colIdx:2},spellIds:[19621,19622,19623,19624,19625],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bestialWrath",location:{rowIdx:6,colIdx:1},spellIds:[19574],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Marksmanship",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/363.jpg",talents:[{fieldName:"improvedConcussiveShot",location:{rowIdx:0,colIdx:1},spellIds:[19407,19412,19413,19414,19415],maxPoints:5},{fieldName:"efficiency",location:{rowIdx:0,colIdx:2},spellIds:[19416,19417,19418,19419,19420],maxPoints:5},{fieldName:"improvedHuntersMark",location:{rowIdx:1,colIdx:1},spellIds:[19421,19422,19423,19424,19425],maxPoints:5},{fieldName:"lethalShots",location:{rowIdx:1,colIdx:2},spellIds:[19426,19427,19429,19430,19431],maxPoints:5},{fieldName:"aimedShot",location:{rowIdx:2,colIdx:0},spellIds:[19434],maxPoints:1},{fieldName:"improvedArcaneShot",location:{rowIdx:2,colIdx:1},spellIds:[19454,19455,19456,19457,19458],maxPoints:5},{fieldName:"hawkEye",location:{rowIdx:2,colIdx:3},spellIds:[19498,19499,19500],maxPoints:3},{fieldName:"improvedSerpentSting",location:{rowIdx:3,colIdx:1},spellIds:[19464,19465,19466,19467,19468],maxPoints:5},{fieldName:"mortalShots",location:{rowIdx:3,colIdx:2},spellIds:[19485,19487,19488,19489,19490],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"scatterShot",location:{rowIdx:4,colIdx:0},spellIds:[19503],maxPoints:1},{fieldName:"barrage",location:{rowIdx:4,colIdx:1},spellIds:[19461,19462,24691],maxPoints:3},{fieldName:"improvedScorpidSting",location:{rowIdx:4,colIdx:2},spellIds:[19491,19493,19494],maxPoints:3},{fieldName:"rangedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[19507,19508,19509,19510,19511],maxPoints:5},{fieldName:"trueshotAura",location:{rowIdx:6,colIdx:1},spellIds:[19506],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Survival",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/362.jpg",talents:[{fieldName:"monsterSlaying",location:{rowIdx:0,colIdx:0},spellIds:[24293,24294,24295],maxPoints:3},{fieldName:"humanoidSlaying",location:{rowIdx:0,colIdx:1},spellIds:[19151,19152,19153],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:2},spellIds:[19295,19297,19298,19300,19301],maxPoints:5},{fieldName:"entrapment",location:{rowIdx:1,colIdx:0},spellIds:[19184,19387,19388,19389,19390],maxPoints:5},{fieldName:"savageStrikes",location:{rowIdx:1,colIdx:1},spellIds:[19159,19160],maxPoints:2},{fieldName:"improvedWingClip",location:{rowIdx:1,colIdx:2},spellIds:[19228,19232,19233,19234,19235],maxPoints:5},{fieldName:"cleverTraps",location:{rowIdx:2,colIdx:0},spellIds:[19239,19245],maxPoints:2},{fieldName:"survivalist",location:{rowIdx:2,colIdx:1},spellIds:[19255,19256,19257,19258,19259],maxPoints:5},{fieldName:"deterrence",location:{rowIdx:2,colIdx:2},spellIds:[19263],maxPoints:1},{fieldName:"trapMastery",location:{rowIdx:3,colIdx:0},spellIds:[19376,19377],maxPoints:2},{fieldName:"surefooted",location:{rowIdx:3,colIdx:1},spellIds:[19290,19294,24283],maxPoints:3},{fieldName:"improvedFeignDeath",location:{rowIdx:3,colIdx:3},spellIds:[19286,19287],maxPoints:2},{fieldName:"killerInstinct",location:{rowIdx:4,colIdx:1},spellIds:[19370,19371,19373],maxPoints:3},{fieldName:"counterattack",location:{rowIdx:4,colIdx:2},spellIds:[19306],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"lightningReflexes",location:{rowIdx:5,colIdx:2},spellIds:[19168,19180,19181,24296,24297],maxPoints:5},{fieldName:"wyvernSting",location:{rowIdx:6,colIdx:1},spellIds:[19386],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Sn=vn([{name:"Arcane",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/81.jpg",talents:[{fieldName:"arcaneSubtlety",location:{rowIdx:0,colIdx:0},spellIds:[11210,12592],maxPoints:2},{fieldName:"arcaneFocus",location:{rowIdx:0,colIdx:1},spellIds:[11222,12839,12840,12841,12842],maxPoints:5},{fieldName:"improvedArcaneMissiles",location:{rowIdx:0,colIdx:2},spellIds:[11237,12463,12464,16769,16770],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:1,colIdx:0},spellIds:[6057,6085],maxPoints:2},{fieldName:"magicAbsorption",location:{rowIdx:1,colIdx:1},spellIds:[29441,29444,29445,29446,29447],maxPoints:5},{fieldName:"arcaneConcentration",location:{rowIdx:1,colIdx:2},spellIds:[11213,12574,12575,12576,12577],maxPoints:5},{fieldName:"magicAttunement",location:{rowIdx:2,colIdx:0},spellIds:[11247,12606],maxPoints:2},{fieldName:"improvedArcaneExplosion",location:{rowIdx:2,colIdx:1},spellIds:[11242,12467,12469],maxPoints:3},{fieldName:"arcaneResilience",location:{rowIdx:2,colIdx:2},spellIds:[28574],maxPoints:1},{fieldName:"improvedManaShield",location:{rowIdx:3,colIdx:0},spellIds:[11252,12605],maxPoints:2},{fieldName:"improvedCounterspell",location:{rowIdx:3,colIdx:1},spellIds:[11255,12598],maxPoints:2},{fieldName:"arcaneMeditation",location:{rowIdx:3,colIdx:3},spellIds:[18462,18463,18464],maxPoints:3},{fieldName:"presenceOfMind",location:{rowIdx:4,colIdx:1},spellIds:[12043],maxPoints:1},{fieldName:"arcaneMind",location:{rowIdx:4,colIdx:2},spellIds:[11232,12500,12501,12502,12503],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"arcaneInstability",location:{rowIdx:5,colIdx:1},spellIds:[15058,15059,15060],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"arcanePower",location:{rowIdx:6,colIdx:1},spellIds:[12042],maxPoints:1,prereqLocation:{rowIdx:5,colIdx:1}}]},{name:"Fire",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/41.jpg",talents:[{fieldName:"improvedFireball",location:{rowIdx:0,colIdx:1},spellIds:[11069,12338,12339,12340,12341],maxPoints:5},{fieldName:"impact",location:{rowIdx:0,colIdx:2},spellIds:[11103,12357,12358,12359,12360],maxPoints:5},{fieldName:"ignite",location:{rowIdx:1,colIdx:0},spellIds:[11119,11120,12846,12847,12848],maxPoints:5},{fieldName:"flameThrowing",location:{rowIdx:1,colIdx:1},spellIds:[11100,12353],maxPoints:2},{fieldName:"improvedFireBlast",location:{rowIdx:1,colIdx:2},spellIds:[11078,11080,12342],maxPoints:3},{fieldName:"incinerate",location:{rowIdx:2,colIdx:0},spellIds:[18459,18460],maxPoints:2},{fieldName:"improvedFlamestrike",location:{rowIdx:2,colIdx:1},spellIds:[11108,12349,12350],maxPoints:3},{fieldName:"pyroblast",location:{rowIdx:2,colIdx:2},spellIds:[11366],maxPoints:1},{fieldName:"burningSoul",location:{rowIdx:2,colIdx:3},spellIds:[11083,12351],maxPoints:2},{fieldName:"improvedScorch",location:{rowIdx:3,colIdx:0},spellIds:[11095,12872,12873],maxPoints:3},{fieldName:"improvedFireWard",location:{rowIdx:3,colIdx:1},spellIds:[11094,13043],maxPoints:2},{fieldName:"masterOfElements",location:{rowIdx:3,colIdx:3},spellIds:[29074,29075,29076],maxPoints:3},{fieldName:"criticalMass",location:{rowIdx:4,colIdx:1},spellIds:[11115,11367,11368],maxPoints:3},{fieldName:"blastWave",location:{rowIdx:4,colIdx:2},spellIds:[11113],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"firePower",location:{rowIdx:5,colIdx:2},spellIds:[11124,12378,12398,12399,12400],maxPoints:5},{fieldName:"combustion",location:{rowIdx:6,colIdx:1},spellIds:[11129],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/61.jpg",talents:[{fieldName:"frostWarding",location:{rowIdx:0,colIdx:0},spellIds:[11189,28332],maxPoints:2},{fieldName:"improvedFrostbolt",location:{rowIdx:0,colIdx:1},spellIds:[11070,12473,16763,16765,16766],maxPoints:5},{fieldName:"elementalPrecision",location:{rowIdx:0,colIdx:2},spellIds:[29438,29439,29440],maxPoints:3},{fieldName:"iceShards",location:{rowIdx:1,colIdx:0},spellIds:[11207,12672,15047,15052,15053],maxPoints:5},{fieldName:"frostbite",location:{rowIdx:1,colIdx:1},spellIds:[11071,12496,12497],maxPoints:3},{fieldName:"improvedFrostNova",location:{rowIdx:1,colIdx:2},spellIds:[11165,12475],maxPoints:2},{fieldName:"permafrost",location:{rowIdx:1,colIdx:3},spellIds:[11175,12569,12571],maxPoints:3},{fieldName:"piercingIce",location:{rowIdx:2,colIdx:0},spellIds:[11151,12952,12953],maxPoints:3},{fieldName:"coldSnap",location:{rowIdx:2,colIdx:1},spellIds:[12472],maxPoints:1},{fieldName:"improvedBlizzard",location:{rowIdx:2,colIdx:3},spellIds:[11185,12487,12488],maxPoints:3},{fieldName:"arcticReach",location:{rowIdx:3,colIdx:0},spellIds:[16757,16758],maxPoints:2},{fieldName:"frostChanneling",location:{rowIdx:3,colIdx:1},spellIds:[11160,12518,12519],maxPoints:3},{fieldName:"shatter",location:{rowIdx:3,colIdx:2},spellIds:[11170,12982,12983,12984,12985],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"iceBlock",location:{rowIdx:4,colIdx:1},spellIds:[11958],maxPoints:1},{fieldName:"improvedConeOfCold",location:{rowIdx:4,colIdx:2},spellIds:[11190,12489,12490],maxPoints:3},{fieldName:"wintersChill",location:{rowIdx:5,colIdx:2},spellIds:[11180,28592,28593,28594,28595],maxPoints:5},{fieldName:"iceBarrier",location:{rowIdx:6,colIdx:1},spellIds:[11426],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),En=vn([{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/382.jpg",talents:[{fieldName:"divineStrength",location:{rowIdx:0,colIdx:1},spellIds:[20262,20263,20264,20265,20266],maxPoints:5},{fieldName:"divineIntellect",location:{rowIdx:0,colIdx:2},spellIds:[20257,20258,20259,20260,20261],maxPoints:5},{fieldName:"spiritualFocus",location:{rowIdx:1,colIdx:1},spellIds:[20205,20206,20207,20208,20209],maxPoints:5},{fieldName:"improvedSealOfRighteousness",location:{rowIdx:1,colIdx:2},spellIds:[20224,20225,20330,20331,20332],maxPoints:5},{fieldName:"healingLight",location:{rowIdx:2,colIdx:0},spellIds:[20237,20238,20239],maxPoints:3},{fieldName:"consecration",location:{rowIdx:2,colIdx:1},spellIds:[26573],maxPoints:1},{fieldName:"improvedLayOnHands",location:{rowIdx:2,colIdx:2},spellIds:[20234,20235],maxPoints:2},{fieldName:"unyieldingFaith",location:{rowIdx:2,colIdx:3},spellIds:[9453,25836],maxPoints:2},{fieldName:"illumination",location:{rowIdx:3,colIdx:1},spellIds:[20210,20212,20213,20214,20215],maxPoints:5},{fieldName:"improvedBlessingOfWisdom",location:{rowIdx:3,colIdx:2},spellIds:[20244,20245],maxPoints:2},{fieldName:"divineFavor",location:{rowIdx:4,colIdx:1},spellIds:[20216],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"lastingJudgement",location:{rowIdx:4,colIdx:2},spellIds:[20359,20360,20361],maxPoints:3},{fieldName:"holyPower",location:{rowIdx:5,colIdx:2},spellIds:[5923,5924,5925,5926,25829],maxPoints:5},{fieldName:"holyShock",location:{rowIdx:6,colIdx:1},spellIds:[20473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/383.jpg",talents:[{fieldName:"improvedDevotionAura",location:{rowIdx:0,colIdx:1},spellIds:[20138,20139,20140,20141,20142],maxPoints:5},{fieldName:"redoubt",location:{rowIdx:0,colIdx:2},spellIds:[20127,20130,20135,20136,20137],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:0},spellIds:[20189,20192,20193],maxPoints:3},{fieldName:"guardiansFavor",location:{rowIdx:1,colIdx:1},spellIds:[20174,20175],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:3},spellIds:[20143,20144,20145,20146,20147],maxPoints:5},{fieldName:"blessingOfKings",location:{rowIdx:2,colIdx:0},spellIds:[20217],maxPoints:1},{fieldName:"improvedRighteousFury",location:{rowIdx:2,colIdx:1},spellIds:[20468,20469,20470],maxPoints:3},{fieldName:"shieldSpecialization",location:{rowIdx:2,colIdx:2},spellIds:[20148,20149,20150],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[20096,20097,20098,20099,20100],maxPoints:5},{fieldName:"improvedHammerOfJustice",location:{rowIdx:3,colIdx:1},spellIds:[20487,20488,20489],maxPoints:3},{fieldName:"improvedConcentrationAura",location:{rowIdx:3,colIdx:2},spellIds:[20254,20255,20256],maxPoints:3},{fieldName:"blessingOfSanctuary",location:{rowIdx:4,colIdx:1},spellIds:[20911],maxPoints:1},{fieldName:"reckoning",location:{rowIdx:4,colIdx:2},spellIds:[20177,20179,20180,20181,20182],maxPoints:5},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[20196,20197,20198,20199,20200],maxPoints:5},{fieldName:"holyShield",location:{rowIdx:6,colIdx:1},spellIds:[20925],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Retribution",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/381.jpg",talents:[{fieldName:"improvedBlessingOfMight",location:{rowIdx:0,colIdx:1},spellIds:[20042,20045,20046,20047,20048],maxPoints:5},{fieldName:"benediction",location:{rowIdx:0,colIdx:2},spellIds:[20101,20102,20103,20104,20105],maxPoints:5},{fieldName:"improvedJudgement",location:{rowIdx:1,colIdx:0},spellIds:[25956,25957],maxPoints:2},{fieldName:"improvedSealOfTheCrusader",location:{rowIdx:1,colIdx:1},spellIds:[20335,20336,20337],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:2},spellIds:[20060,20061,20062,20063,20064],maxPoints:5},{fieldName:"vindication",location:{rowIdx:2,colIdx:0},spellIds:[9452,26016,26021],maxPoints:3},{fieldName:"conviction",location:{rowIdx:2,colIdx:1},spellIds:[20117,20118,20119,20120,20121],maxPoints:5},{fieldName:"sealOfCommand",location:{rowIdx:2,colIdx:2},spellIds:[20375],maxPoints:1},{fieldName:"pursuitOfJustice",location:{rowIdx:2,colIdx:3},spellIds:[26022,26023],maxPoints:2},{fieldName:"eyeForAnEye",location:{rowIdx:3,colIdx:0},spellIds:[9799,25988],maxPoints:2},{fieldName:"improvedRetributionAura",location:{rowIdx:3,colIdx:2},spellIds:[20091,20092],maxPoints:2},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[20111,20112,20113],maxPoints:3},{fieldName:"sanctityAura",location:{rowIdx:4,colIdx:2},spellIds:[20218],maxPoints:1},{fieldName:"vengeance",location:{rowIdx:5,colIdx:1},spellIds:[20049,20056,20057,20058,20059],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"repentance",location:{rowIdx:6,colIdx:1},spellIds:[20066],maxPoints:1}]}]),yn=vn([{name:"Discipline",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/201.jpg",talents:[{fieldName:"unbreakableWill",location:{rowIdx:0,colIdx:1},spellIds:[14522,14788,14789,14790,14791],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14524,14525,14526,14527,14528],maxPoints:5},{fieldName:"silentResolve",location:{rowIdx:1,colIdx:0},spellIds:[14523,14784,14785,14786,14787],maxPoints:5},{fieldName:"improvedPowerWordFortitude",location:{rowIdx:1,colIdx:1},spellIds:[14749,14767],maxPoints:2},{fieldName:"improvedPowerWordShield",location:{rowIdx:1,colIdx:2},spellIds:[14748,14768,14769],maxPoints:3},{fieldName:"martyrdom",location:{rowIdx:1,colIdx:3},spellIds:[14531,14774],maxPoints:2},{fieldName:"innerFocus",location:{rowIdx:2,colIdx:1},spellIds:[14751],maxPoints:1},{fieldName:"meditation",location:{rowIdx:2,colIdx:2},spellIds:[14521,14776,14777],maxPoints:3},{fieldName:"improvedInnerFire",location:{rowIdx:3,colIdx:0},spellIds:[14747,14770,14771],maxPoints:3},{fieldName:"mentalAgility",location:{rowIdx:3,colIdx:1},spellIds:[14520,14780,14781,14782,14783],maxPoints:5},{fieldName:"improvedManaBurn",location:{rowIdx:3,colIdx:3},spellIds:[14750,14772],maxPoints:2},{fieldName:"mentalStrength",location:{rowIdx:4,colIdx:1},spellIds:[18551,18552,18553,18554,18555],maxPoints:5},{fieldName:"divineSpirit",location:{rowIdx:4,colIdx:2},spellIds:[14752],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"forceOfWill",location:{rowIdx:5,colIdx:2},spellIds:[18544,18547,18548,18549,18550],maxPoints:5},{fieldName:"powerInfusion",location:{rowIdx:6,colIdx:1},spellIds:[10060],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/202.jpg",talents:[{fieldName:"healingFocus",location:{rowIdx:0,colIdx:0},spellIds:[14913,15012],maxPoints:2},{fieldName:"improvedRenew",location:{rowIdx:0,colIdx:1},spellIds:[14908,15020,17191],maxPoints:3},{fieldName:"holySpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14889,15008,15009,15010,15011],maxPoints:5},{fieldName:"spellWarding",location:{rowIdx:1,colIdx:1},spellIds:[27900,27901,27902,27903,27904],maxPoints:5},{fieldName:"divineFury",location:{rowIdx:1,colIdx:2},spellIds:[18530,18531,18533,18534,18535],maxPoints:5},{fieldName:"holyNova",location:{rowIdx:2,colIdx:0},spellIds:[15237],maxPoints:1},{fieldName:"blessedRecovery",location:{rowIdx:2,colIdx:1},spellIds:[27811,27815,27816],maxPoints:3},{fieldName:"inspiration",location:{rowIdx:2,colIdx:3},spellIds:[14892,15362,15363],maxPoints:3},{fieldName:"holyReach",location:{rowIdx:3,colIdx:0},spellIds:[27789,27790],maxPoints:2},{fieldName:"improvedHealing",location:{rowIdx:3,colIdx:1},spellIds:[14912,15013,15014],maxPoints:3},{fieldName:"searingLight",location:{rowIdx:3,colIdx:2},spellIds:[14909,15017],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"improvedPrayerOfHealing",location:{rowIdx:4,colIdx:0},spellIds:[14911,15018],maxPoints:2},{fieldName:"spiritOfRedemption",location:{rowIdx:4,colIdx:1},spellIds:[20711],maxPoints:1},{fieldName:"spiritualGuidance",location:{rowIdx:4,colIdx:2},spellIds:[14901,15028,15029,15030,15031],maxPoints:5},{fieldName:"spiritualHealing",location:{rowIdx:5,colIdx:2},spellIds:[14898,15349,15354,15355,15356],maxPoints:5},{fieldName:"lightwell",location:{rowIdx:6,colIdx:1},spellIds:[724],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Shadow",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/203.jpg",talents:[{fieldName:"spiritTap",location:{rowIdx:0,colIdx:1},spellIds:[15270,15335,15336,15337,15338],maxPoints:5},{fieldName:"blackout",location:{rowIdx:0,colIdx:2},spellIds:[15268,15323,15324,15325,15326],maxPoints:5},{fieldName:"shadowAffinity",location:{rowIdx:1,colIdx:0},spellIds:[15318,15272,15320],maxPoints:3},{fieldName:"improvedShadowWordPain",location:{rowIdx:1,colIdx:1},spellIds:[15275,15317],maxPoints:2},{fieldName:"shadowFocus",location:{rowIdx:1,colIdx:2},spellIds:[15260,15327,15328],maxPoints:5},{fieldName:"improvedPsychicScream",location:{rowIdx:2,colIdx:0},spellIds:[15392,15448],maxPoints:2},{fieldName:"improvedMindBlast",location:{rowIdx:2,colIdx:1},spellIds:[15273,15312,15313,15314,15316],maxPoints:5},{fieldName:"mindFlay",location:{rowIdx:2,colIdx:2},spellIds:[15407],maxPoints:1},{fieldName:"improvedFade",location:{rowIdx:3,colIdx:1},spellIds:[15274,15311],maxPoints:2},{fieldName:"shadowReach",location:{rowIdx:3,colIdx:2},spellIds:[17322,17323,17325],maxPoints:3},{fieldName:"shadowWeaving",location:{rowIdx:3,colIdx:3},spellIds:[15257,15331,15332,15333,15334],maxPoints:5},{fieldName:"silence",location:{rowIdx:4,colIdx:0},spellIds:[15487],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"vampiricEmbrace",location:{rowIdx:4,colIdx:1},spellIds:[15286],maxPoints:1},{fieldName:"improvedVampiricEmbrace",location:{rowIdx:4,colIdx:2},spellIds:[27839,27840],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkness",location:{rowIdx:5,colIdx:2},spellIds:[15259,15307,15308,15309,15310],maxPoints:5},{fieldName:"shadowform",location:{rowIdx:6,colIdx:1},spellIds:[15473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Pn=vn([{name:"Assassination",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/182.jpg",talents:[{fieldName:"improvedEviscerate",location:{rowIdx:0,colIdx:0},spellIds:[14162,14163,14164],maxPoints:3},{fieldName:"remorselessAttacks",location:{rowIdx:0,colIdx:1},spellIds:[14144,14148],maxPoints:2},{fieldName:"malice",location:{rowIdx:0,colIdx:2},spellIds:[14138,14139,14140,14141,14142],maxPoints:5},{fieldName:"ruthlessness",location:{rowIdx:1,colIdx:0},spellIds:[14156,14160,14161],maxPoints:3},{fieldName:"murder",location:{rowIdx:1,colIdx:1},spellIds:[14158,14159],maxPoints:2},{fieldName:"improvedSliceAndDice",location:{rowIdx:1,colIdx:3},spellIds:[14165,14166,14167],maxPoints:3},{fieldName:"relentlessStrikes",location:{rowIdx:2,colIdx:0},spellIds:[14179],maxPoints:1},{fieldName:"improvedExposeArmor",location:{rowIdx:2,colIdx:1},spellIds:[14168,14169],maxPoints:2},{fieldName:"lethality",location:{rowIdx:2,colIdx:2},spellIds:[14128,14132,14135,14136,14137],maxPoints:5,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"vilePoisons",location:{rowIdx:3,colIdx:1},spellIds:[16513,16514,16515,16719,16720],maxPoints:5},{fieldName:"improvedPoisons",location:{rowIdx:3,colIdx:2},spellIds:[14113,14114,14115,14116,14117],maxPoints:5},{fieldName:"coldBlood",location:{rowIdx:4,colIdx:1},spellIds:[14177],maxPoints:1},{fieldName:"improvedKidneyShot",location:{rowIdx:4,colIdx:2},spellIds:[14174,14175,14176],maxPoints:3},{fieldName:"sealFate",location:{rowIdx:5,colIdx:1},spellIds:[14186,14190,14193,14194,14195],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"vigor",location:{rowIdx:6,colIdx:1},spellIds:[14983],maxPoints:1}]},{name:"Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/181.jpg",talents:[{fieldName:"improvedGouge",location:{rowIdx:0,colIdx:0},spellIds:[13741,13792,13793],maxPoints:3},{fieldName:"improvedSinisterStrike",location:{rowIdx:0,colIdx:1},spellIds:[13732,13863],maxPoints:2},{fieldName:"lightningReflexes",location:{rowIdx:0,colIdx:2},spellIds:[13712,13788,13789,13790,13791],maxPoints:5},{fieldName:"improvedBackstab",location:{rowIdx:1,colIdx:0},spellIds:[13733,13865,13866],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:1},spellIds:[13713,13853,13854,13855,13856],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:2},spellIds:[13705,13832,13843,13844,13845],maxPoints:5},{fieldName:"endurance",location:{rowIdx:2,colIdx:0},spellIds:[13742,13872],maxPoints:2},{fieldName:"riposte",location:{rowIdx:2,colIdx:1},spellIds:[14251],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedSprint",location:{rowIdx:2,colIdx:3},spellIds:[13743,13875],maxPoints:2},{fieldName:"improvedKick",location:{rowIdx:3,colIdx:0},spellIds:[13754,13867],maxPoints:2},{fieldName:"daggerSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[13706,13804,13805,13806,13807],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:2},spellIds:[13715,13848,13849,13851,13852],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[13709,13800,13801,13802,13803],maxPoints:5},{fieldName:"bladeFlurry",location:{rowIdx:4,colIdx:1},spellIds:[13877],maxPoints:1},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[13960,13961,13962,13963,13964],maxPoints:5},{fieldName:"fistWeaponSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[13707,13966,13967,13968,13969],maxPoints:5},{fieldName:"weaponExpertise",location:{rowIdx:5,colIdx:1},spellIds:[30919,30920],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"aggression",location:{rowIdx:5,colIdx:2},spellIds:[18427,18428,18429],maxPoints:3},{fieldName:"adrenalineRush",location:{rowIdx:6,colIdx:1},spellIds:[13750],maxPoints:1}]},{name:"Subtlety",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/183.jpg",talents:[{fieldName:"masterOfDeception",location:{rowIdx:0,colIdx:1},spellIds:[13958,13970,13971,13972,13973],maxPoints:5},{fieldName:"opportunity",location:{rowIdx:0,colIdx:2},spellIds:[14057,14072,14073,14074,14075],maxPoints:5},{fieldName:"sleightOfHand",location:{rowIdx:1,colIdx:0},spellIds:[30892,30893],maxPoints:2},{fieldName:"elusiveness",location:{rowIdx:1,colIdx:1},spellIds:[13981,14066],maxPoints:2},{fieldName:"camouflage",location:{rowIdx:1,colIdx:2},spellIds:[13975,14062,14063,14064,14065],maxPoints:5},{fieldName:"initiative",location:{rowIdx:2,colIdx:0},spellIds:[13976,13979,13980],maxPoints:3},{fieldName:"ghostlyStrike",location:{rowIdx:2,colIdx:1},spellIds:[14278],maxPoints:1},{fieldName:"improvedAmbush",location:{rowIdx:2,colIdx:2},spellIds:[14079,14080,14081],maxPoints:3},{fieldName:"setup",location:{rowIdx:3,colIdx:0},spellIds:[13983,14070,14071],maxPoints:3},{fieldName:"improvedSap",location:{rowIdx:3,colIdx:1},spellIds:[14076,14094,14095],maxPoints:3},{fieldName:"serratedBlades",location:{rowIdx:3,colIdx:2},spellIds:[14171,14172,14173],maxPoints:3},{fieldName:"heightenedSenses",location:{rowIdx:4,colIdx:0},spellIds:[30894,30895],maxPoints:2},{fieldName:"preparation",location:{rowIdx:4,colIdx:1},spellIds:[14185],maxPoints:1},{fieldName:"dirtyDeeds",location:{rowIdx:4,colIdx:2},spellIds:[14082,14083],maxPoints:2},{fieldName:"hemorrhage",location:{rowIdx:4,colIdx:3},spellIds:[16511],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"deadliness",location:{rowIdx:5,colIdx:2},spellIds:[30902,30903,30904,30905,30906],maxPoints:5},{fieldName:"premeditation",location:{rowIdx:6,colIdx:1},spellIds:[14183],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),kn=vn([{name:"Elemental",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/261.jpg",talents:[{fieldName:"convection",location:{rowIdx:0,colIdx:1},spellIds:[16039,16109,16110,16111,16112],maxPoints:5},{fieldName:"concussion",location:{rowIdx:0,colIdx:2},spellIds:[16035,16105,16106,16107,16108],maxPoints:5},{fieldName:"earthsGrasp",location:{rowIdx:1,colIdx:0},spellIds:[16043,16130],maxPoints:2},{fieldName:"elementalWarding",location:{rowIdx:1,colIdx:1},spellIds:[28996,28997,28998],maxPoints:3},{fieldName:"callOfFlame",location:{rowIdx:1,colIdx:2},spellIds:[16038,16160,16161],maxPoints:3},{fieldName:"elementalFocus",location:{rowIdx:2,colIdx:0},spellIds:[16164],maxPoints:1},{fieldName:"reverberation",location:{rowIdx:2,colIdx:1},spellIds:[16040,16113,16114,16115,16116],maxPoints:5},{fieldName:"callOfThunder",location:{rowIdx:2,colIdx:2},spellIds:[16041,16117,16118,16119,16120],maxPoints:5},{fieldName:"improvedFireTotems",location:{rowIdx:3,colIdx:0},spellIds:[16086,16544],maxPoints:2},{fieldName:"eyeOfTheStorm",location:{rowIdx:3,colIdx:1},spellIds:[29062,29064,29065],maxPoints:3},{fieldName:"elementalDevastation",location:{rowIdx:3,colIdx:3},spellIds:[30160,29179,29180],maxPoints:3},{fieldName:"stormReach",location:{rowIdx:4,colIdx:0},spellIds:[28999,29e3],maxPoints:2},{fieldName:"elementalFury",location:{rowIdx:4,colIdx:1},spellIds:[16089],maxPoints:1},{fieldName:"lightningMastery",location:{rowIdx:5,colIdx:2},spellIds:[16578,16579,16580,16581,16582],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"elementalMastery",location:{rowIdx:6,colIdx:1},spellIds:[16166],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Enhancement",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/263.jpg",talents:[{fieldName:"ancestralKnowledge",location:{rowIdx:0,colIdx:1},spellIds:[17485,17486,17487,17488,17489],maxPoints:5},{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[16253,16298],maxPoints:5},{fieldName:"guardianTotems",location:{rowIdx:1,colIdx:0},spellIds:[16258,16293],maxPoints:2},{fieldName:"thunderingStrikes",location:{rowIdx:1,colIdx:1},spellIds:[16255,16302,16303,16304,16305],maxPoints:5},{fieldName:"improvedGhostWolf",location:{rowIdx:1,colIdx:2},spellIds:[16262,16287],maxPoints:2},{fieldName:"improvedLightningShield",location:{rowIdx:1,colIdx:3},spellIds:[16261,16290],maxPoints:3},{fieldName:"enhancingTotems",location:{rowIdx:2,colIdx:0},spellIds:[16259,16295],maxPoints:2},{fieldName:"twoHandedAxesAndMaces",location:{rowIdx:2,colIdx:2},spellIds:[16269],maxPoints:1},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[16254,16271,16272,16273,16274],maxPoints:5},{fieldName:"flurry",location:{rowIdx:3,colIdx:1},spellIds:[16256,16281,16282,16283,16284],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"toughness",location:{rowIdx:3,colIdx:2},spellIds:[16252,16306,16307,16308,16309],maxPoints:5},{fieldName:"improvedWeaponTotems",location:{rowIdx:4,colIdx:0},spellIds:[29192,29193],maxPoints:2},{fieldName:"elementalWeapons",location:{rowIdx:4,colIdx:1},spellIds:[16266,29079,29080],maxPoints:3},{fieldName:"parry",location:{rowIdx:4,colIdx:2},spellIds:[16268],maxPoints:1},{fieldName:"weaponMastery",location:{rowIdx:5,colIdx:2},spellIds:[29082,29084,29086,29087,29088],maxPoints:5},{fieldName:"stormstrike",location:{rowIdx:6,colIdx:1},spellIds:[17364],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/262.jpg",talents:[{fieldName:"improvedHealingWave",location:{rowIdx:0,colIdx:1},spellIds:[16182,16226,16227,16228,16229],maxPoints:5},{fieldName:"tidalFocus",location:{rowIdx:0,colIdx:2},spellIds:[16179,16214,16215,16216,16217],maxPoints:5},{fieldName:"improvedReincarnation",location:{rowIdx:1,colIdx:0},spellIds:[16184,16209],maxPoints:2},{fieldName:"ancestralHealing",location:{rowIdx:1,colIdx:1},spellIds:[16176,16235,16240],maxPoints:3},{fieldName:"totemicFocus",location:{rowIdx:1,colIdx:2},spellIds:[16173,16222,16223,16224,16225],maxPoints:5},{fieldName:"naturesGuidance",location:{rowIdx:2,colIdx:0},spellIds:[16180,16196,16198],maxPoints:3},{fieldName:"healingFocus",location:{rowIdx:2,colIdx:1},spellIds:[16181,16230,16232,16233,16234],maxPoints:5},{fieldName:"totemicMastery",location:{rowIdx:2,colIdx:2},spellIds:[16189],maxPoints:1},{fieldName:"healingGrace",location:{rowIdx:2,colIdx:3},spellIds:[29187,29189,29191],maxPoints:3},{fieldName:"restorativeTotems",location:{rowIdx:3,colIdx:1},spellIds:[16187,16205,16206,16207,16208],maxPoints:5},{fieldName:"tidalMastery",location:{rowIdx:3,colIdx:2},spellIds:[16194,16218,16219,16220,16221],maxPoints:5},{fieldName:"healingWay",location:{rowIdx:4,colIdx:0},spellIds:[29206,29202,29205],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:2},spellIds:[16188],maxPoints:1},{fieldName:"purification",location:{rowIdx:5,colIdx:2},spellIds:[16178,16210,16211,16212,16213],maxPoints:5},{fieldName:"manaTideTotem",location:{rowIdx:6,colIdx:1},spellIds:[16190],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),Cn=vn([{name:"Affliction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/302.jpg",talents:[{fieldName:"suppression",location:{rowIdx:0,colIdx:1},spellIds:[18174,18175,18176,18177,18178],maxPoints:5},{fieldName:"improvedCorruption",location:{rowIdx:0,colIdx:2},spellIds:[17810,17811,17812,17813,17814],maxPoints:5},{fieldName:"improvedCurseOfWeakness",location:{rowIdx:1,colIdx:0},spellIds:[18179,18180,18181],maxPoints:3},{fieldName:"improvedDrainSoul",location:{rowIdx:1,colIdx:1},spellIds:[18213,18372],maxPoints:2},{fieldName:"improvedLifeTap",location:{rowIdx:1,colIdx:2},spellIds:[18182,18183],maxPoints:2},{fieldName:"improvedDrainLife",location:{rowIdx:1,colIdx:3},spellIds:[17804,17805,17806,17807,17808],maxPoints:5},{fieldName:"improvedCurseOfAgony",location:{rowIdx:2,colIdx:0},spellIds:[18827,18829,18830],maxPoints:3},{fieldName:"felConcentration",location:{rowIdx:2,colIdx:1},spellIds:[17783,17784,17785,17786,17787],maxPoints:5},{fieldName:"amplifyCurse",location:{rowIdx:2,colIdx:2},spellIds:[18288],maxPoints:1},{fieldName:"grimReach",location:{rowIdx:3,colIdx:0},spellIds:[18218,18219],maxPoints:2},{fieldName:"nightfall",location:{rowIdx:3,colIdx:1},spellIds:[18094,18095],maxPoints:2},{fieldName:"improvedDrainMana",location:{rowIdx:3,colIdx:3},spellIds:[17864,18393],maxPoints:2},{fieldName:"siphonLife",location:{rowIdx:4,colIdx:1},spellIds:[18265],maxPoints:1},{fieldName:"curseOfExhaustion",location:{rowIdx:4,colIdx:2},spellIds:[18223],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedCurseOfExhaustion",location:{rowIdx:4,colIdx:3},spellIds:[18310,18311,18312,18313],maxPoints:4,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"shadowMastery",location:{rowIdx:5,colIdx:1},spellIds:[18271,18272,18273,18274,18275],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkPact",location:{rowIdx:6,colIdx:1},spellIds:[18220],maxPoints:1}]},{name:"Demonology",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/303.jpg",talents:[{fieldName:"improvedHealthstone",location:{rowIdx:0,colIdx:0},spellIds:[18692,18693],maxPoints:2},{fieldName:"improvedImp",location:{rowIdx:0,colIdx:1},spellIds:[18694,18695,18696],maxPoints:3},{fieldName:"demonicEmbrace",location:{rowIdx:0,colIdx:2},spellIds:[18697,18698,18699,18700,18701],maxPoints:5},{fieldName:"improvedHealthFunnel",location:{rowIdx:1,colIdx:0},spellIds:[18703,18704],maxPoints:2},{fieldName:"improvedVoidwalker",location:{rowIdx:1,colIdx:1},spellIds:[18705,18706,18707],maxPoints:3},{fieldName:"felIntellect",location:{rowIdx:1,colIdx:2},spellIds:[18731,18743,18744,18745,18746],maxPoints:5},{fieldName:"improvedSayaad",location:{rowIdx:2,colIdx:0},spellIds:[18754,18755,18756],maxPoints:3},{fieldName:"felDomination",location:{rowIdx:2,colIdx:1},spellIds:[18708],maxPoints:1},{fieldName:"felStamina",location:{rowIdx:2,colIdx:2},spellIds:[18748],maxPoints:5},{fieldName:"masterSummoner",location:{rowIdx:3,colIdx:1},spellIds:[18709,18710],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"unholyPower",location:{rowIdx:3,colIdx:2},spellIds:[18769,18770,18771,18772,18773],maxPoints:5},{fieldName:"improvedSubjugateDemon",location:{rowIdx:4,colIdx:0},spellIds:[18821,18823,18824,18825],maxPoints:5},{fieldName:"demonicSacrifice",location:{rowIdx:4,colIdx:1},spellIds:[18788],maxPoints:1},{fieldName:"improvedFirestone",location:{rowIdx:4,colIdx:3},spellIds:[18767,18768],maxPoints:2},{fieldName:"masterDemonologist",location:{rowIdx:5,colIdx:2},spellIds:[23785,23822,23823,23824,23825],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"soulLink",location:{rowIdx:6,colIdx:1},spellIds:[19028],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"improvedSpellstone",location:{rowIdx:6,colIdx:2},spellIds:[18774,18775],maxPoints:2}]},{name:"Destruction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/301.jpg",talents:[{fieldName:"improvedShadowBolt",location:{rowIdx:0,colIdx:1},spellIds:[17793,17796,17801,17802,17803],maxPoints:5},{fieldName:"cataclysm",location:{rowIdx:0,colIdx:2},spellIds:[17778,17779,17780,17781,17782],maxPoints:5},{fieldName:"bane",location:{rowIdx:1,colIdx:1},spellIds:[17788,17789,17790,17791,17792],maxPoints:5},{fieldName:"aftermath",location:{rowIdx:1,colIdx:2},spellIds:[18119,18120,18121,18122,18123],maxPoints:5},{fieldName:"improvedFirebolt",location:{rowIdx:2,colIdx:0},spellIds:[18126,18127],maxPoints:2},{fieldName:"improvedLashOfPain",location:{rowIdx:2,colIdx:1},spellIds:[18128],maxPoints:2},{fieldName:"devastation",location:{rowIdx:2,colIdx:2},spellIds:[18130,18131,18132,18133,18134],maxPoints:5},{fieldName:"shadowburn",location:{rowIdx:2,colIdx:3},spellIds:[17877],maxPoints:1},{fieldName:"intensity",location:{rowIdx:3,colIdx:0},spellIds:[18135,18136],maxPoints:2},{fieldName:"destructiveReach",location:{rowIdx:3,colIdx:1},spellIds:[17917,17918],maxPoints:2},{fieldName:"improvedSearingPain",location:{rowIdx:3,colIdx:3},spellIds:[17927,17929,17930,17931,17932],maxPoints:5},{fieldName:"pyroclasm",location:{rowIdx:4,colIdx:0},spellIds:[18096,18073],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:0}},{fieldName:"improvedImmolate",location:{rowIdx:4,colIdx:1},spellIds:[17815,17833,17834,17835,17836],maxPoints:5},{fieldName:"ruin",location:{rowIdx:4,colIdx:2},spellIds:[17959],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"emberstorm",location:{rowIdx:5,colIdx:2},spellIds:[17954,17955,17956,17957,17958],maxPoints:5},{fieldName:"conflagrate",location:{rowIdx:6,colIdx:1},spellIds:[17962],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Ln=vn([{name:"Arms",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/161.jpg",talents:[{fieldName:"improvedHeroicStrike",location:{rowIdx:0,colIdx:0},spellIds:[12282,12663,12664],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:1},spellIds:[16462,16463,16464,16465,16466],maxPoints:5},{fieldName:"improvedRend",location:{rowIdx:0,colIdx:2},spellIds:[12286,12658,12659],maxPoints:3},{fieldName:"improvedCharge",location:{rowIdx:1,colIdx:0},spellIds:[12285,12697],maxPoints:2},{fieldName:"tacticalMastery",location:{rowIdx:1,colIdx:1},spellIds:[12295,12676,12677,12678,12679],maxPoints:5},{fieldName:"improvedThunderClap",location:{rowIdx:1,colIdx:3},spellIds:[12287,12665,12666],maxPoints:3},{fieldName:"improvedOverpower",location:{rowIdx:2,colIdx:0},spellIds:[12290,12963],maxPoints:2},{fieldName:"angerManagement",location:{rowIdx:2,colIdx:1},spellIds:[12296],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"deepWounds",location:{rowIdx:2,colIdx:2},spellIds:[12834,12849,12867],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[12163,12711,12712,12713,12714],maxPoints:5},{fieldName:"impale",location:{rowIdx:3,colIdx:2},spellIds:[16493,16494],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"axeSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[12700,12781,12783,12784,12785],maxPoints:5},{fieldName:"sweepingStrikes",location:{rowIdx:4,colIdx:1},spellIds:[12292],maxPoints:1},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[12284,12701,12702,12703,12704],maxPoints:5},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[12281,12812,12813,12814,12815],maxPoints:5},{fieldName:"polearmSpecialization",location:{rowIdx:5,colIdx:0},spellIds:[12165,12830,12831,12832,12833],maxPoints:5},{fieldName:"improvedHamstring",location:{rowIdx:5,colIdx:2},spellIds:[12289,12668,23695],maxPoints:3},{fieldName:"mortalStrike",location:{rowIdx:6,colIdx:1},spellIds:[12294],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fury",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/164.jpg",talents:[{fieldName:"boomingVoice",location:{rowIdx:0,colIdx:1},spellIds:[12321,12835,12836,12837,12838],maxPoints:5},{fieldName:"cruelty",location:{rowIdx:0,colIdx:2},spellIds:[12320,12852,12853,12855,12856],maxPoints:5},{fieldName:"improvedDemoralizingShout",location:{rowIdx:1,colIdx:1},spellIds:[12324,12876,12877,12878,12879],maxPoints:5},{fieldName:"unbridledWrath",location:{rowIdx:1,colIdx:2},spellIds:[12322,12999,13e3,13001,13002],maxPoints:5},{fieldName:"improvedCleave",location:{rowIdx:2,colIdx:0},spellIds:[12329,12950,20496],maxPoints:3},{fieldName:"piercingHowl",location:{rowIdx:2,colIdx:1},spellIds:[12323],maxPoints:1},{fieldName:"bloodCraze",location:{rowIdx:2,colIdx:2},spellIds:[16487,16489,16492],maxPoints:3},{fieldName:"improvedBattleShout",location:{rowIdx:2,colIdx:3},spellIds:[12318,12857,12858,12860,12861],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:0},spellIds:[23584,23585,23586,23587,23588],maxPoints:5},{fieldName:"improvedExecute",location:{rowIdx:3,colIdx:1},spellIds:[20502,20503],maxPoints:2},{fieldName:"enrage",location:{rowIdx:3,colIdx:2},spellIds:[12317,13045,13046,13047,13048],maxPoints:5},{fieldName:"improvedSlam",location:{rowIdx:4,colIdx:0},spellIds:[12862,12330,20497,20498,20499],maxPoints:5},{fieldName:"deathWish",location:{rowIdx:4,colIdx:1},spellIds:[12328],maxPoints:1},{fieldName:"improvedIntercept",location:{rowIdx:4,colIdx:3},spellIds:[20504,20505],maxPoints:2},{fieldName:"improvedBerserkerRage",location:{rowIdx:5,colIdx:0},spellIds:[20500,20501],maxPoints:2},{fieldName:"flurry",location:{rowIdx:5,colIdx:2},spellIds:[12319,12971,12972,12973,12974],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bloodthirst",location:{rowIdx:6,colIdx:1},spellIds:[23881],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/163.jpg",talents:[{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:1},spellIds:[12298,12724,12725,12726,12727],maxPoints:5},{fieldName:"anticipation",location:{rowIdx:0,colIdx:2},spellIds:[12297,12750,12751,12752,12753],maxPoints:5},{fieldName:"improvedBloodrage",location:{rowIdx:1,colIdx:0},spellIds:[12301,12818],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:2},spellIds:[12299,12761,12762,12763,12764],maxPoints:5},{fieldName:"ironWill",location:{rowIdx:1,colIdx:3},spellIds:[12300,12959,12960,12961,12962],maxPoints:5},{fieldName:"lastStand",location:{rowIdx:2,colIdx:0},spellIds:[12975],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"improvedShieldBlock",location:{rowIdx:2,colIdx:1},spellIds:[12945,12307,12944],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedRevenge",location:{rowIdx:2,colIdx:2},spellIds:[12797,12799,12800],maxPoints:3},{fieldName:"defiance",location:{rowIdx:2,colIdx:3},spellIds:[12303,12788,12789,12791,12792],maxPoints:5},{fieldName:"improvedSunderArmor",location:{rowIdx:3,colIdx:0},spellIds:[12308,12810,12811],maxPoints:3},{fieldName:"improvedDisarm",location:{rowIdx:3,colIdx:1},spellIds:[12313,12804,12807],maxPoints:3},{fieldName:"improvedTaunt",location:{rowIdx:3,colIdx:2},spellIds:[12302,12765],maxPoints:2},{fieldName:"improvedShieldWall",location:{rowIdx:4,colIdx:0},spellIds:[12312,12803],maxPoints:2},{fieldName:"concussionBlow",location:{rowIdx:4,colIdx:1},spellIds:[12809],maxPoints:1},{fieldName:"improvedShieldBash",location:{rowIdx:4,colIdx:2},spellIds:[12311,12958],maxPoints:2},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[16538,16539,16540,16541,16542],maxPoints:5},{fieldName:"shieldSlam",location:{rowIdx:6,colIdx:1},spellIds:[23922],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Tn={[l.ClassUnknown]:[],[l.ClassDruid]:bn,[l.ClassShaman]:kn,[l.ClassHunter]:xn,[l.ClassMage]:Sn,[l.ClassRogue]:Pn,[l.ClassPaladin]:En,[l.ClassPriest]:yn,[l.ClassWarlock]:Cn,[l.ClassWarrior]:Ln};function Nn(e,t){return function(e,t,s){return t.split("-").forEach(((t,i)=>{const a=s[i];[...t].forEach(((t,s)=>{const i=a.talents[s],n=parseInt(t);i.fieldName&&(1==i.maxPoints?e[i.fieldName]=1==n:e[i.fieldName]=n)}))})),e}(y[e].talentsCreate(),t,Tn[s[e]])}class _n{constructor(){this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map((e=>({data:e,id:E.fromProto(e.id)}))),s=e.auras.map((e=>({data:e,id:E.fromProto(e.id)})));await Promise.all([...t,...s].map((e=>e.id.fill().then((t=>e.id=t))))),t=t.sort(((e,t)=>le(e.id.name,t.id.name))),s=s.sort(((e,t)=>le(e.id.name,t.id.name)));let i=!1;return e.name!=this.name&&(this.name=e.name,i=!0),(t.length!=this.spells.length||t.some(((e,t)=>!e.id.equals(this.spells[t].id))))&&(this.spells=t,i=!0),(s.length!=this.auras.length||s.some(((e,t)=>!e.id.equals(this.auras[t].id))))&&(this.auras=s,i=!0),i}}class An{constructor(){this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let i=t;i<e.length;i++)this.metadatas.push(new _n);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const s=await Promise.all(e.map(((e,t)=>this.metadatas[t].update(e))));return t!=this.metadatas.length||s.some((e=>e))}asList(){return this.metadatas.slice()}}const Rn={};function Dn(e){const t=Rn[e];if(!t)throw new Error("No config registered for Spec: "+e);return t}const Mn=class e{constructor(t,s){this.name="",this.buffs=P.create(),this.consumes=k.create(),this.bonusStats=new un,this.gear=new C({}),this.enableItemSwap=!1,this.itemSwapGear=new L({}),this.profession1=0,this.profession2=0,this.aplRotation=T.create(),this.talentsString="",this.reactionTime=0,this.channelClipDelay=0,this.inFrontOfTarget=!1,this.distanceFromTarget=0,this.healingModel=N.create(),this.healingEnabled=!1,this.isbUsingShadowflame=!0,this.isbSbFrequency=3,this.isbCrit=25,this.isbWarlocks=1,this.isbSpriests=0,this.autoRotationGenerator=null,this.simpleRotationGenerator=null,this.itemEPCache=new Array,this.randomSuffixEPCache=new Map,this.enchantEPCache=new Map,this.talents=null,this.epRatios=new Array(e.numEpRatios).fill(0),this.epWeights=new un,this.currentStats=_.create(),this.metadata=new _n,this.petMetadatas=new An,this.nameChangeEmitter=new a("PlayerName"),this.buffsChangeEmitter=new a("PlayerBuffs"),this.consumesChangeEmitter=new a("PlayerConsumes"),this.bonusStatsChangeEmitter=new a("PlayerBonusStats"),this.gearChangeEmitter=new a("PlayerGear"),this.itemSwapChangeEmitter=new a("PlayerItemSwap"),this.professionChangeEmitter=new a("PlayerProfession"),this.raceChangeEmitter=new a("PlayerRace"),this.levelChangeEmitter=new a("PlayerLevel"),this.rotationChangeEmitter=new a("PlayerRotation"),this.talentsChangeEmitter=new a("PlayerTalents"),this.specOptionsChangeEmitter=new a("PlayerSpecOptions"),this.inFrontOfTargetChangeEmitter=new a("PlayerInFrontOfTarget"),this.distanceFromTargetChangeEmitter=new a("PlayerDistanceFromTarget"),this.healingModelChangeEmitter=new a("PlayerHealingModel"),this.epWeightsChangeEmitter=new a("PlayerEpWeights"),this.miscOptionsChangeEmitter=new a("PlayerMiscOptions"),this.currentStatsEmitter=new a("PlayerCurrentStats"),this.epRatiosChangeEmitter=new a("PlayerEpRatios"),this.epRefStatChangeEmitter=new a("PlayerEpRefStat"),this.sim=s,this.party=null,this.raid=null,this.spec=t,this.race=A[this.spec][0],this.level=R[on[this.spec].phase],this.specTypeFunctions=y[this.spec],this.specOptions=this.specTypeFunctions.optionsCreate();const i=Rn[this.spec];if(!i)throw new Error("Could not find spec config for spec: "+this.spec);this.autoRotationGenerator=i.autoRotation,i.simpleRotation?this.simpleRotationGenerator=i.simpleRotation:this.simpleRotationGenerator=null;for(let e=0;e<D.ItemSlotRanged+1;++e)this.itemEPCache[e]=new Map;this.changeEmitter=a.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.itemSwapChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.levelChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter],"PlayerChange")}getSpecIcon(){return M(this.spec,this.getTalentsString())}getClass(){return s[this.spec]}getClassColor(){return V[this.getClass()]}isSpec(e){return this.spec==e}isClass(e){return this.getClass()==e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null==this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null==this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null==e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null==this.party?[]:this.party.getPlayers().filter((e=>null!=e&&e!=this))}getItems(e){return this.sim.db.getItems(e).filter((t=>U(this,t,e)))}getRandomSuffixes(e){return e.randomSuffixOptions.map((e=>this.sim.db.getRandomSuffixById(e))).filter((e=>this.computeRandomSuffixEP(e)>0))}getEnchants(e){return this.sim.db.getEnchants(e).filter((e=>W(e,this.spec)))}getRunes(e){return this.sim.db.getRunes(e,this.getClass())}hasRune(e,t){return this.getEquippedItem(e)?.rune?.id===t}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map;for(let s=0;s<D.ItemSlotRanged+1;++s)this.itemEPCache[s]=new Map}getDefaultEpRatios(t,s){const i=new Array(e.numEpRatios).fill(0);return s?i[1]=1:t?(i[2]=1,i[3]=1):i[0]=1,i}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,s,i,a){return await this.sim.statWeights(this,t,s,i,a)}getCurrentStats(){return _.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map((e=>e.metadata))),s=await e,i=await t;return s||i}getName(){return this.name}setName(e,t){t!=this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!=this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getLevel(){return this.level}setLevel(e,t){t!=this.level&&(this.level=t,this.levelChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!=this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!=this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter((e=>e!=F.ProfessionUnknown))}setProfessions(e,t){a.freezeAllAndDo((()=>{this.setProfession1(e,t[0]||F.ProfessionUnknown),this.setProfession2(e,t[1]||F.ProfessionUnknown)}))}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(F.Blacksmithing)}getFaction(){return O[this.getRace()]}getBuffs(){return P.clone(this.buffs)}setBuffs(e,t){P.equals(this.buffs,t)||(this.buffs=P.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return k.clone(this.consumes)}setConsumes(e,t){k.equals(this.consumes,t)||(this.consumes=k.clone(t),this.consumesChangeEmitter.emit(e))}canDualWield2H(){return!1}equipItem(e,t,s){this.setGear(e,this.gear.withEquippedItem(t,s,this.canDualWield2H()))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.gearChangeEmitter.emit(e))}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!=this.enableItemSwap&&(this.enableItemSwap=t,this.itemSwapChangeEmitter.emit(e))}equipItemSwapitem(e,t,s){this.setItemSwapGear(e,this.itemSwapGear.withEquippedItem(t,s,this.canDualWield2H()))}getItemSwapItem(e){return this.itemSwapGear.getEquippedItem(e)}getItemSwapGear(){return this.itemSwapGear}setItemSwapGear(e,t){t.equals(this.itemSwapGear)||(this.itemSwapGear=t,this.itemSwapChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(){const e=(this.currentStats.finalStats?.stats[c.StatMeleeCrit]||0)/H,s=(this.currentStats.finalStats?.stats[c.StatMeleeHit]||0)/q,i=(this.currentStats.finalStats?.stats[c.StatExpertise]||0)/B/4,a=void 0!==this.getGear().getEquippedItem(D.ItemSlotOffHand)?.item.weaponSpeed,n=a&&this.spec!=t.SpecWarrior?27:8,o=this.getInFrontOfTarget()?14:0,l=6.5+o,r=Math.max(n-s,0),d=Math.max(6.5-i,0)+Math.max(o-i,0);let h=0;if(this.spec===t.SpecEnhancementShaman){h=3*this.getTalents().elementalDevastation}this.sim.raid.getDebuffs();const m=64.8-r-d-h;return{meleeCrit:e,meleeHit:s,expertise:i,suppression:4.8,glancing:40,debuffCrit:0,hasOffhandWeapon:a,meleeHitCap:n,expertiseCap:l,remainingMeleeHitCap:r,remainingExpertiseCap:d,baseCritCap:m,specSpecificOffset:h,playerCritCapDelta:e-m+0}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=z.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return j.clone(this.aplRotation.simple?.cooldowns||j.create())}setSimpleCooldowns(e,t){j.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=z.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}setAplRotation(e,t){T.equals(t,this.aplRotation)||(this.aplRotation=T.clone(t),this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type==$.TypeUnknown?$.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!=this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e==$.TypeAuto&&this.autoRotationGenerator){const e=T.clone(this.autoRotationGenerator(this));return e.type=$.TypeAuto,e}if(e==$.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=T.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=$.TypeSimple,t}return this.aplRotation}getTalents(){return null==this.talents&&(this.talents=Nn(this.spec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!=this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTree(){return G(this.getTalentsString())}getTalentTreePoints(){return K(this.getTalentsString())}getTalentTreeIcon(){return M(this.spec,this.getTalentsString())}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!=this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!=this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!=this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!=this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){const t=this.sim.encounter.primaryTarget,s=t.dualWield;0==e.cadenceSeconds&&(e.cadenceSeconds=1.5*t.swingSpeed,s&&(e.cadenceSeconds/=2)),0==e.hps&&(e.hps=.175*t.minBaseDamage/t.swingSpeed,s&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;const e=this.getHealingModel();0!=e.cadenceSeconds&&0!=e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return N.clone(this.healingModel)}setHealingModel(e,t){N.equals(this.healingModel,t)||(this.healingModel=N.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}getIsbUsingShadowflame(){return this.isbUsingShadowflame}setIsbUsingShadowflame(e,t){t!=this.isbUsingShadowflame&&(this.isbUsingShadowflame=t,this.changeEmitter.emit(e))}getIsbSbFrequency(){return this.isbSbFrequency}setIsbSbFrequency(e,t){t!=this.isbSbFrequency&&(this.isbSbFrequency=t,this.changeEmitter.emit(e))}getIsbCrit(){return this.isbCrit}setIsbCrit(e,t){t!=this.isbCrit&&(this.isbCrit=t,this.changeEmitter.emit(e))}getIsbWarlocks(){return this.isbWarlocks}setIsbWarlocks(e,t){t!=this.isbWarlocks&&(this.isbWarlocks=t,this.changeEmitter.emit(e))}getIsbSpriests(){return this.isbSpriests}setIsbSpriests(e,t){t!=this.isbSpriests&&(this.isbSpriests=t,this.changeEmitter.emit(e))}computeStatsEP(e){return null==e?0:e.computeEP(this.epWeights)}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);const t=this.computeStatsEP(new un(e.stats));return this.enchantEPCache.set(e.effectId,t),t}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);const t=this.computeStatsEP(new un(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeItemEP(e,t){if(null==e)return 0;const s=this.itemEPCache[t].get(e.id);if(void 0!==s)return s;let i=new un(e.stats);if(e.weaponSpeed>0){const s=J(e);t==D.ItemSlotMainHand?i=i.withPseudoStat(h.PseudoStatMainHandDps,s):t==D.ItemSlotOffHand?i=i.withPseudoStat(h.PseudoStatOffHandDps,s):t==D.ItemSlotRanged&&(i=i.withPseudoStat(h.PseudoStatRangedDps,s))}let a=0;if(e.randomSuffixOptions.length>0){const t=e.randomSuffixOptions.map((e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e))));a=Math.max(...t)}let n=i.computeEP(this.epWeights)+a;return e.unique&&(n-=.01),this.itemEPCache[t].set(e.id,n),n}setWowheadData(e,t){const s=[],i=de(),a=i?i+".":"";s.push(`domain=${a}classic`),null!=e.enchant&&s.push("ench="+e.enchant.effectId),s.push("pcs="+this.gear.asArray().filter((e=>null!=e)).map((e=>e.item.id)).join(":")),t.dataset.wowhead=s.join("&"),t.dataset.whtticon="false"}filterItemData(t,s,i){const a=this.sim.getFilters(),n=(e,t)=>e.filter((e=>t(s(e))));if(0!=a.minIlvl&&(t=n(t,(e=>e.ilvl>=a.minIlvl))),0!=a.maxIlvl&&(t=n(t,(e=>e.ilvl<=a.maxIlvl))),a.factionRestriction!=Z.UNSPECIFIED&&(t=n(t,(e=>e.factionRestriction==a.factionRestriction||e.factionRestriction==Z.UNSPECIFIED))),a.sources.includes(Y.SourceCrafting)||(t=n(t,(e=>!e.sources.some((e=>"crafted"==e.source.oneofKind))))),a.sources.includes(Y.SourceQuest)||(t=n(t,(e=>!e.sources.some((e=>"quest"==e.source.oneofKind))))),a.sources.includes(Y.SourceReputation)||(t=n(t,(e=>!e.sources.some((e=>"rep"==e.source.oneofKind))))),!a.sources.includes(Y.SourceDungeon))for(const e in Q){const s=Q[e];"number"==typeof s&&(t=n(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==s)))))}if(!a.sources.includes(Y.SourceRaid)){const e=[];for(const t in X){const s=X[t];"number"==typeof s&&0!=s&&e.push(s)}t=n(t,(t=>!t.sources.some((t=>"drop"==t.source.oneofKind&&e.includes(t.source.drop.zoneId)))))}for(const e in ee){const s=ee[e];"number"==typeof s&&0!=s&&(t=n(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==s)))))}if(!a.sources.includes(Y.SourceWorldBOE))for(const e in X){"number"==typeof X[e]&&(t=n(t,(e=>0==e.randomSuffixOptions.length)))}return e.ARMOR_SLOTS.includes(i)?t=n(t,(e=>!!a.armorTypes.includes(e.armorType))):e.WEAPON_SLOTS.includes(i)?t=n(t,(e=>{if(!a.weaponTypes.includes(e.weaponType))return!1;if(!a.oneHandedWeapons&&e.handType!=re.HandTypeTwoHand)return!1;if(!a.twoHandedWeapons&&e.handType==re.HandTypeTwoHand)return!1;const t=i==D.ItemSlotMainHand?a.minMhWeaponSpeed:a.minOhWeaponSpeed,s=i==D.ItemSlotMainHand?a.maxMhWeaponSpeed:a.maxOhWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(s>0&&e.weaponSpeed>s)})):i==D.ItemSlotRanged&&(t=n(t,(e=>{if(!a.rangedWeaponTypes.includes(e.rangedWeaponType))return!1;const t=a.minRangedWeaponSpeed,s=a.maxRangedWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(s>0&&e.weaponSpeed>s)}))),t}filterEnchantData(e,t,s,i){return i?e.filter((e=>{const s=t(e);return!!te(s,i.item)})):e}makeUnitReference(){return null==this.party?se():ie(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(),t=this.getItemSwapGear().toDatabase();return ae.mergeSimDatabases(e,t)}toProto(e,t,s){const i=e=>!s||0==s.length||s.includes(e),a=this.getGear(),n=t?this.getResolvedAplRotation():this.aplRotation;let l=o.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return i(zn.Gear)&&o.mergePartial(l,{equipment:a.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.getEnableItemSwap(),itemSwap:this.getItemSwapGear().toProto()}),i(zn.Talents)&&o.mergePartial(l,{talentsString:this.getTalentsString()}),i(zn.Rotation)&&o.mergePartial(l,{cooldowns:j.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:n}),i(zn.Consumes)&&o.mergePartial(l,{consumes:this.getConsumes()}),i(zn.Miscellaneous)&&(o.mergePartial(l,{name:this.getName(),race:this.getRace(),level:this.getLevel(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel(),isbUsingShadowflame:this.getIsbUsingShadowflame(),isbSbFrequency:this.getIsbSbFrequency(),isbCrit:this.getIsbCrit(),isbWarlocks:this.getIsbWarlocks(),isbSpriests:this.getIsbSpriests()}),l=ne(this.spec,l,this.getSpecOptions())),i(zn.External)&&o.mergePartial(l,{buffs:this.getBuffs()}),l}fromProto(e,t,s){const i=e=>!s||0==s.length||s.includes(e);t.rotation?.type==$.TypeLegacy&&(t.rotation.type=$.TypeAuto),a.freezeAllAndDo((()=>{i(zn.Gear)&&(this.setGear(e,t.equipment?this.sim.db.lookupEquipmentSpec(t.equipment):new C({})),this.setEnableItemSwap(e,t.enableItemSwap),this.setItemSwapGear(e,t.itemSwap?this.sim.db.lookupItemSwap(t.itemSwap):new L({})),this.setBonusStats(e,un.fromProto(t.bonusStats||p.create()))),i(zn.Talents)&&this.setTalentsString(e,t.talentsString),i(zn.Rotation)&&(t.rotation?.type!=$.TypeUnknown&&t.rotation?.type!=$.TypeLegacy||(t.rotation||(t.rotation=T.create()),t.rotation.type=$.TypeAuto),this.setAplRotation(e,t.rotation||T.create())),i(zn.Consumes)&&this.setConsumes(e,t.consumes||k.create()),i(zn.Miscellaneous)&&(this.setSpecOptions(e,this.specTypeFunctions.optionsFromPlayer(t)),this.setName(e,t.name),this.setLevel(e,t.level),this.setRace(e,t.race),this.setProfession1(e,t.profession1),this.setProfession2(e,t.profession2),this.setReactionTime(e,t.reactionTimeMs),this.setChannelClipDelay(e,t.channelClipDelayMs),this.setInFrontOfTarget(e,t.inFrontOfTarget),this.setDistanceFromTarget(e,t.distanceFromTarget),this.setHealingModel(e,t.healingModel||N.create()),this.setIsbSbFrequency(e,t.isbSbFrequency),this.setIsbCrit(e,t.isbCrit),this.setIsbWarlocks(e,t.isbWarlocks),this.setIsbSpriests(e,t.isbSpriests)),i(zn.External)&&this.setBuffs(e,t.buffs||P.create())}))}clone(t){const s=new e(this.spec,this.sim);return s.fromProto(t,this.toProto()),s}applySharedDefaults(e){a.freezeAllAndDo((()=>{this.setEnableItemSwap(e,!1),this.setItemSwapGear(e,new L({})),this.setReactionTime(e,200),this.setInFrontOfTarget(e,oe(this.spec)),this.setHealingModel(e,N.create({burstWindow:oe(this.spec)?6:0})),this.setSimpleCooldowns(e,j.create({hpPercentForDefensives:oe(this.spec)?.35:0})),this.setBonusStats(e,new un),this.setAplRotation(e,T.create({type:$.TypeAuto}))}))}getMatchingSpellActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?E.fromSpellId(t.id):null}getMatchingItemActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?E.fromItemId(t.id):null}};Mn.numEpRatios=6,Mn.ARMOR_SLOTS=[D.ItemSlotHead,D.ItemSlotShoulder,D.ItemSlotChest,D.ItemSlotWrist,D.ItemSlotHands,D.ItemSlotLegs,D.ItemSlotWaist,D.ItemSlotFeet],Mn.WEAPON_SLOTS=[D.ItemSlotMainHand,D.ItemSlotOffHand];let Vn=Mn;class Un{constructor(e){this.duration=120,this.durationVariation=15,this.executeProportion20=.2,this.executeProportion25=.25,this.executeProportion35=.35,this.useHealth=!1,this.targetsChangeEmitter=new a,this.durationChangeEmitter=new a,this.executeProportionChangeEmitter=new a,this.changeEmitter=new a,this.sim=e,this.targetsMetadata=new An,e.waitForInit().then((()=>{const t=e.raid.getPlayer(0)?.getLevel()??ce,s=Un.getPresetTargetForLevel(t,e);this.targets=[s.target],[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e)))))}))}get primaryTarget(){return he.clone(this.targets[0])}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every(((t,s)=>he.equals(t,e.targets[s].target)))}applyPreset(e,t){this.targets=t.targets.map((e=>e.target||he.create())),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,s){this.targets[s]=t.target||he.create(),this.targetsChangeEmitter.emit(e)}toProto(){return me.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,useHealth:this.useHealth,targets:this.targets})}fromProto(e,t){a.freezeAllAndDo((()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)}))}applyDefaults(e){const t=this.sim.raid.getPlayer(0)?.getLevel()??ce,s=Un.getPresetTargetForLevel(t,this.sim);this.fromProto(e,me.create({duration:120,durationVariation:15,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,targets:[s.target]}))}static getPresetTargetForLevel(e,t){const s=t.db.getAllPresetTargets();return s.find((t=>t?.target?.level&&t?.target?.level>e))??s[0]}}const Wn=8;class Fn{constructor(e){this.buffs=ue.create(),this.debuffs=pe.create(),this.tanks=[],this.targetDummies=0,this.numActiveParties=5,this.compChangeEmitter=new a,this.buffsChangeEmitter=new a,this.debuffsChangeEmitter=new a,this.tanksChangeEmitter=new a,this.targetDummiesChangeEmitter=new a,this.numActivePartiesChangeEmitter=new a,this.sim=e,this.parties=[...Array(8).keys()].map((t=>{const s=new dn(this,e);return s.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),s.changeEmitter.on((e=>this.changeEmitter.emit(e))),s})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),this.changeEmitter=a.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return v(this.parties.map((e=>e.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map((e=>e.getPlayers())).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=ge.Unknown?e.type==ge.Player?this.getPlayer(e.index):e.type==ge.Self&&t||null:null}setPlayer(e,t,s){this.parties[Math.floor(t/5)].setPlayer(e,t%5,s)}getClassCount(e){return this.getPlayers().filter((t=>null!=t&&t.getClass()==e)).length}getBuffs(){return ue.clone(this.buffs)}setBuffs(e,t){ue.equals(this.buffs,t)||(this.buffs=ue.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return pe.clone(this.debuffs)}setDebuffs(e,t){pe.equals(this.debuffs,t)||(this.debuffs=pe.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map((e=>fe.clone(e)))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every(((e,s)=>fe.equals(e,t[s])))||(this.tanks=t.map((e=>fe.clone(e))),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter(((e,t)=>t<this.numActiveParties));this.activePlayers=e.map((e=>e.getPlayers())).flat().filter((e=>null!=e))}return this.activePlayers}toProto(e,t){return Ie.create({parties:this.parties.map((s=>s.toProto(e,t))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){t.debuffs?.curseOfElements&&t.debuffs.curseOfElementsNew==we.TristateEffectMissing&&(t.debuffs.curseOfElementsNew=we.TristateEffectRegular,t.debuffs.curseOfElements=!1),t.debuffs?.curseOfShadow&&t.debuffs.curseOfShadowNew==we.TristateEffectMissing&&(t.debuffs.curseOfShadowNew=we.TristateEffectRegular,t.debuffs.curseOfShadow=!1),a.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||ue.create()),this.setDebuffs(e,t.debuffs||pe.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let s=0;s<8;s++)t.parties[s]?this.parties[s].fromProto(e,t.parties[s]):this.parties[s].clear(e)}))}clear(e){a.freezeAllAndDo((()=>{for(let t=0;t<8;t++)this.parties[t].clear(e)}))}}var On=(e=>(e.bulkSimAsync="bulkSimAsync",e.computeStats="computeStats",e.computeStatsJson="computeStatsJson",e.raidSim="raidSim",e.raidSimJson="raidSimJson",e.raidSimAsync="raidSimAsync",e.statWeights="statWeights",e.statWeightsAsync="statWeightsAsync",e))(On||{});const Hn=`/${Te}/sim_worker.js`;class qn{constructor(e){this.workers=[];for(let t=0;t<e;t++)this.workers.push(new Bn)}getLeastBusyWorker(){return this.workers.reduce(((e,t)=>e.numTasksRunning<t.numTasksRunning?e:t))}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,"")}async computeStats(e){const t=await this.makeApiCall(On.computeStats,ve.toBinary(e));return be.fromBinary(t)}getProgressName(e){return`${e}progress`}async statWeightsAsync(e,t){console.log("Stat weights request: "+xe.toJsonString(e));const s=this.getLeastBusyWorker(),i=s.makeTaskId();s.addPromiseFunc(this.getProgressName(i),this.newProgressHandler(i,s,t),Se);const a=await s.doApiCall(On.statWeightsAsync,xe.toBinary(e),i),n=Ee.fromBinary(a);return console.log("Stat weights result: "+ye.toJsonString(n.finalWeightResult)),n.finalWeightResult}async bulkSimAsync(e,t){console.log("bulk sim request: "+Pe.toJsonString(e,{enumAsInteger:!0}));const s=this.getLeastBusyWorker(),i=s.makeTaskId();s.addPromiseFunc(this.getProgressName(i),this.newProgressHandler(i,s,t),Se);const a=await s.doApiCall(On.bulkSimAsync,Pe.toBinary(e),i),n=Ee.fromBinary(a),o=ke.toJson(n.finalBulkResult);return console.log("bulk sim result: "+JSON.stringify(o)),n.finalBulkResult}async raidSimAsync(e,t){console.log("Raid sim request: "+Ce.toJsonString(e));const s=this.getLeastBusyWorker(),i=s.makeTaskId();s.addPromiseFunc(this.getProgressName(i),this.newProgressHandler(i,s,t),Se);const a=await s.doApiCall(On.raidSimAsync,Ce.toBinary(e),i),n=Ee.fromBinary(a),o=Le.toJson(n.finalRaidResult);return delete o.logs,console.log("Raid sim result: "+JSON.stringify(o)),n.finalRaidResult}newProgressHandler(e,t,s){return i=>{const a=Ee.fromBinary(i);s(a),null==a.finalRaidResult&&null==a.finalWeightResult&&t.addPromiseFunc(this.getProgressName(e),this.newProgressHandler(e,t,s),Se)}}}class Bn{constructor(){this.numTasksRunning=0,this.taskIdsToPromiseFuncs={},this.worker=new window.Worker(Hn);let e=null;this.onReady=new Promise(((t,s)=>{e=t})),this.worker.addEventListener("message",(({data:t})=>{const{id:s,msg:i,outputData:a}=t;switch(i){case"ready":this.postMessage({msg:"setID",id:"1"}),e();break;case"idConfirm":break;default:if(!this.taskIdsToPromiseFuncs[s])return void console.warn("Unrecognized result id: ",s);const t=this.taskIdsToPromiseFuncs[s];delete this.taskIdsToPromiseFuncs[s],this.numTasksRunning--,t[0](a)}}))}addPromiseFunc(e,t,s){this.taskIdsToPromiseFuncs[e]=[t,s]}makeTaskId(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<16;s++)e+=t.charAt(Math.floor(62*Math.random()));return e}async doApiCall(e,t,s){this.numTasksRunning++,await this.onReady;const i=new Promise(((i,a)=>{s||(s=this.makeTaskId()),this.taskIdsToPromiseFuncs[s]=[i,a],this.postMessage({msg:e,id:s,inputData:t})}));return await i}postMessage(e){this.worker.postMessage(e)}}var zn=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(zn||{});const jn=class e{constructor(){this.iterations=3e3,this.phase=Ne,this.faction=_e.Alliance,this.fixedRngSeed=0,this.filters=e.defaultFilters(),this.showDamageMetrics=!0,this.showThreatMetrics=!1,this.showHealingMetrics=!1,this.showExperimental=!1,this.showEPValues=!1,this.language="",this.db_=null,this.iterationsChangeEmitter=new a,this.phaseChangeEmitter=new a,this.factionChangeEmitter=new a,this.fixedRngSeedChangeEmitter=new a,this.lastUsedRngSeedChangeEmitter=new a,this.filtersChangeEmitter=new a,this.showDamageMetricsChangeEmitter=new a,this.showThreatMetricsChangeEmitter=new a,this.showHealingMetricsChangeEmitter=new a,this.showExperimentalChangeEmitter=new a,this.showEPValuesChangeEmitter=new a,this.languageChangeEmitter=new a,this.crashEmitter=new a,this.unitMetadataEmitter=new a("UnitMetadata"),this.simResultEmitter=new a,this.bulkSimStartEmitter=new a,this.bulkSimResultEmitter=new a,this.lastUsedRngSeed=0,this.modifyRaidProto=()=>{},this.workerPool=new qn(1),this._initPromise=ae.get().then((e=>{this.db_=e})),this.raid=new Fn(this),this.encounter=new Un(this),this.settingsChangeEmitter=a.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.showEPValuesChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=a.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),a.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((e=>this.updateCharacterStats(e)))}waitForInit(){return this._initPromise}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach((e=>{e.players.forEach((e=>{e.equipment&&this.db.lookupEquipmentSpec(e.equipment)}))})),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),s=this.encounter.toProto();return Ce.create({raid:t,encounter:s,simOptions:Ae.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,s){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=Pe.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=i.baseSettings&&null!=i.baseSettings.simOptions&&(i.baseSettings.simOptions.debugFirstIteration=!1),!i.baseSettings?.raid||0==i.baseSettings?.raid?.parties.length||0==i.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const n=i.baseSettings.raid.parties[0].players[0].database;n?.items.push(...t.items),n?.enchants.push(...t.enchants),this.bulkSimStartEmitter.emit(a.nextEventID(),i);const o=await this.workerPool.bulkSimAsync(i,s);if(""!=o.errorResult)throw new Gn(o.errorResult);return this.bulkSimResultEmitter.emit(a.nextEventID(),o),o}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const s=this.makeRaidSimRequest(!1),i=await this.workerPool.raidSimAsync(s,t);if(""!=i.errorResult)throw new Gn(i.errorResult);const a=await Re.makeNew(s,i);return this.simResultEmitter.emit(e,a),a}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const t=this.makeRaidSimRequest(!0),s=await this.workerPool.raidSimAsync(t,(()=>{}));if(""!=s.errorResult)throw new Gn(s.errorResult);const i=await Re.makeNew(t,s);return this.simResultEmitter.emit(e,i),i}async updateCharacterStats(e){if(0==e)return;e=a.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),s=ve.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),i=await this.workerPool.computeStats(s);""==i.errorResult?a.freezeAllAndDo((async()=>{const s=i.raidStats.parties.map(((s,i)=>s.players.map(((s,a)=>{const n=t[5*i+a];return n?(n.setCurrentStats(e,s),n.updateMetadata()):null})))).flat().filter((e=>null!=e)),a=this.encounter.targetsMetadata.update(i.encounterStats.targets.map((e=>e.metadata)));(await Promise.all(s.concat([a]))).some((e=>e))&&this.unitMetadataEmitter.emit(e)})):this.crashEmitter.emit(e,new Gn(i.errorResult))}async statWeights(e,t,s,i,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),ye.create();{const n=this.raid.getTanks().map((e=>e.index)).includes(e.getRaidIndex())?[fe.create({type:ge.Player,index:0})]:[],o=xe.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:Ae.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:n,statsToWeigh:t,pseudoStatsToWeigh:s,epReferenceStat:i});return await this.workerPool.statWeightsAsync(o,a)}}getUnitMetadata(e,t,s){if(!e||e.type==ge.Unknown)return this.getUnitMetadata(s,t,s);if(e.type==ge.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==ge.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==ge.Pet){const s=this.raid.getPlayerFromUnitReference(e.owner,t);return s?s.getPetMetadatas().asList()[e.index]:void 0}return e.type==ge.Self?t?.getMetadata():e.type==ge.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&t>0&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*e.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(a.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return De.clone(this.filters)}setFilters(e,t){De.equals(t,this.filters)||(this.filters=De.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||Me())!=this.language&&(this.language=t,Ve(this.language),this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const t=this.getFilters();return t.armorTypes.length==e.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==e.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==e.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==e.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==e.ALL_RAIDS.length&&(t.raids=[]),Ue.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showEpValues:this.getShowEPValues(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,s){a.freezeAllAndDo((()=>{this.setIterations(t,s.iterations||3e3),this.setPhase(t,s.phase||Ne),this.setFixedRngSeed(t,Number(s.fixedRngSeed)),this.setShowDamageMetrics(t,s.showDamageMetrics),this.setShowThreatMetrics(t,s.showThreatMetrics),this.setShowHealingMetrics(t,s.showHealingMetrics),this.setShowExperimental(t,s.showExperimental),this.setShowEPValues(t,s.showEpValues),this.setLanguage(t,s.language),this.setFaction(t,s.faction||_e.Alliance);const i=s.filters||e.defaultFilters();0==i.armorTypes.length&&(i.armorTypes=e.ALL_ARMOR_TYPES.slice()),0==i.weaponTypes.length&&(i.weaponTypes=e.ALL_WEAPON_TYPES.slice()),0==i.rangedWeaponTypes.length&&(i.rangedWeaponTypes=e.ALL_RANGED_WEAPON_TYPES.slice()),0==i.sources.length&&(i.sources=e.ALL_SOURCES.slice()),0==i.raids.length&&(i.raids=e.ALL_RAIDS.slice()),this.setFilters(t,i)}))}applyDefaults(t,s,i){this.fromProto(t,Ue.create({iterations:3e3,phase:Ne,faction:_e.Alliance,showDamageMetrics:!i,showThreatMetrics:s,showHealingMetrics:i,language:this.getLanguage(),filters:e.defaultFilters(),showEpValues:!1}))}static defaultFilters(){return De.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};jn.MAX_RNG_SEED=Math.pow(2,32)-1,jn.ALL_ARMOR_TYPES=d(We).filter((e=>0!=e)),jn.ALL_WEAPON_TYPES=d(Fe).filter((e=>0!=e)),jn.ALL_RANGED_WEAPON_TYPES=d(Oe).filter((e=>0!=e)),jn.ALL_SOURCES=d(Y).filter((e=>0!=e)),jn.ALL_RAIDS=d(X).filter((e=>0!=e));let $n=jn;class Gn extends Error{constructor(e){super(e),this.errorStr=e}}var Kn=(e=>(e.Vertical="vertical",e.Horizontal="Horizontal",e))(Kn||{});class Jn extends w{constructor(e,t,s){super(e,"icon-picker-root",t,s),this.incrementValue=()=>{0==this.config.states||this.currentValue+this.step<this.config.states*this.step?(this.currentValue+=this.step,this.inputChanged(a.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(a.nextEventID()))},this.decrementValue=()=>{this.currentValue>0?this.currentValue-=this.step:0===this.config.states?this.currentValue=this.step:this.currentValue=(this.config.states-1)*this.step,this.inputChanged(a.nextEventID())},this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=s,this.currentValue=0,this.step=s.step??1,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const i=Boolean(this.config.improvedId);i&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!i&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");const n=I(),o=I(),l=I();this.rootAnchor.appendChild(f("div",{className:"icon-input-level-container"},f("a",{ref:n,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),f("a",{ref:o,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),f("span",{ref:l,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=n.value,this.improvedAnchor2=o.value,this.counterElem=l.value,this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0),this.init();const r=()=>{this.config.actionId(this.modObject)?.fillAndSet(this.rootAnchor,!0,!0),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))};r(),this.config.changedEvent(this.modObject).on(r);const d=s.reverse?this.decrementValue:this.incrementValue,c=s.reverse?this.incrementValue:this.decrementValue;this.rootAnchor.addEventListener("click",(e=>{e.preventDefault(),d()})),this.rootAnchor.addEventListener("mousedown",(e=>{S(e)&&(e.preventDefault(),c())})),this.rootAnchor.addEventListener("contextmenu",(e=>e.preventDefault()))}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId(this.modObject):2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId(this.modObject)}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(a.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(a.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId(this.modObject)&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}class Zn extends w{constructor(e,t,s){if(super(e,"icon-enum-picker-root",t,s),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??Kn.Vertical)?"dropdown":"dropend"),this.config=s,this.currentValue=this.config.zeroValue,s.tooltip){const e=Xa(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}this.rootElem.appendChild(f(x,null,f("a",{href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),f("ul",{className:"dropdown-menu"}),f("label",{className:"form-label"}))),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.buttonText=this.rootElem.querySelector("label"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.numColumns&&(this.dropdownMenu.style.gridTemplateColumns=`repeat(${this.config.numColumns}, 1fr)`),this.config.direction==Kn.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.config.values.forEach(((e,t)=>{const s=document.createElement("li");s.classList.add("icon-dropdown-option","dropdown-option"),this.dropdownMenu.appendChild(s);const i=document.createElement("a");i.classList.add("icon-picker-button"),i.dataset.whtticon="false",i.dataset.disableWowheadTouchTooltip="true",s.appendChild(i);const n=()=>{this.setImage(i,e),this.showValueWhen(e)?s.classList.remove("hide"):(s.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(a.nextEventID())))};if(this.config.changedEvent(this.modObject).on(n),n(),i.addEventListener("click",(t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(a.nextEventID())})),e.tooltip){const t=Xa(i,{content:e.tooltip});this.addOnDisposeCallback((()=>t.destroy()))}})),this.init();const i=()=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))};i(),this.config.changedEvent(this.modObject).on(i)}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(a.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(a.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const s=t.actionId?.(this.modObject);s?(this.setActionImage(e,s),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.href="",e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find((e=>this.config.equals(e.value,this.currentValue)));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find((e=>e.actionId&&null!=e.actionId(this.modObject)&&(!e.showWhen||e.showWhen(this.modObject))))}showValueWhen(e){return(!e.actionId||null!=e.actionId?.(this.modObject))&&(!e.showWhen||e.showWhen(this.modObject))}}function Yn(e){return{direction:e.direction,values:e.values,label:e.label,tooltip:e.tooltip,showWhen:t=>e.values.filter((e=>!e.showWhen||e.showWhen(t))).length>0}}function Qn(e){const t=e.getModObject;return{id:e.id,type:"boolean",label:e.label,labelTooltip:e.labelTooltip,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0,extraCssClasses:e.extraCssClasses}}function Xn(e){return Qn({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSpecOptions();a[e.fieldName]=i,s.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function eo(e){return Qn({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSimpleRotation();a[e.fieldName]=i,s.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function to(e){const t=e.getModObject;return{id:e.id,type:"number",label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,defaultValue:e.defaultValue,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0,extraCssClasses:e.extraCssClasses}}function so(e){const t={id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSpecOptions();a[e.fieldName]=i,s.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const s=t.setValue;t.setValue=(e,t,i)=>s(e,t,i/100)}return to(t)}function io(e){const t={id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSimpleRotation();a[e.fieldName]=i,s.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const s=t.setValue;t.setValue=(e,t,i)=>s(e,t,i/100)}return to(t)}function ao(e){const t=e.getModObject;return{id:e.id,type:"enum",label:e.label,labelTooltip:e.labelTooltip,values:e.values,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0}}function no(e){return ao({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSpecOptions();a[e.fieldName]=i,s.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function oo(e){return ao({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSimpleRotation();a[e.fieldName]=i,s.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function lo(e){const t=e.getModObject;return{type:"icon",actionId:s=>e.actionId(t(s)),states:e.states,showWhen:e.showWhen,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),extraCssClasses:e.extraCssClasses}}function ro(e,t,s,i){return lo({getModObject:e.getModObject,actionId:t,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>i?e.getValue(t)[s]==i:e.getValue(t)[s]),setValue:e.setFieldValue||((t,a,n)=>{const o=e.getValue(a);i?n?o[s]=i:o[s]==i&&(o[s]=0):o[s]=n,e.setValue(t,a,o)}),extraCssClasses:e.extraCssClasses})}function co(e){return ro({getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,s)=>t.setSpecOptions(e,s),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue},e.actionId,e.fieldName,e.value)}function ho(e,t,s){return lo({getModObject:e.getModObject,actionId:t,states:0,step:1,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:t=>e.getValue(t)[s],setValue:(t,i,a)=>{const n=e.getValue(i);a<0&&(a=0),n[s]=a,e.setValue(t,i,n)}})}function mo(e,t,s,i){const a=ho(e,t,i);return a.states=3,a.improvedId=s,a}function uo(e,t,s,i,a,n){const o=ho(e,t,i);return o.states=s,o.step=a,o.reverse=n,o}function po(e,t,s,i,a,n){return function(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,direction:e.direction,tooltip:e.tooltip,values:e.values.map((e=>{if(e.showWhen){const s=e.showWhen;e.showWhen=e=>s(t(e))}return e})),equals:e.equals,showWhen:s=>!e.showWhen||e.showWhen(t(s)),zeroValue:e.zeroValue,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),extraCssClasses:e.extraCssClasses}}({values:s,zeroValue:0,numColumns:i,direction:a||Kn.Vertical,tooltip:n,equals:(e,t)=>e==t,getModObject:e.getModObject,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:s=>e.getValue(s)[t],setValue:(s,i,a)=>{const n=e.getValue(i);n[t]=a,e.setValue(s,i,n)}})}function go(e){return po({showWhen:e.showWhen,getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,s)=>t.setSpecOptions(e,s),getFieldValue:e.getValue,setFieldValue:e.setValue,changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses},e.fieldName,e.values,e.numColumns,e.direction,e.tooltip)}const fo=(e,t,s)=>"icon"==s.type?new Jn(e,t,s):new Zn(e,t,s);function Io(e,t){return e.label=t,e}function wo(e){return ro({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function vo(e){return ro({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function bo(e){return ro({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes(),setValue:(e,t,s)=>t.setConsumes(e,s),changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}function xo(e){return ro({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes().miscConsumes??qe.create(),setValue:(e,t,s)=>{const i=t.getConsumes();i.miscConsumes=s,t.setConsumes(e,i)},changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}function So(e){return ro({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,s)=>t.getRaid().setDebuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function Eo(e){return mo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function yo(e){return mo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function Po(e){return mo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,s)=>t.getRaid().setDebuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter])},e.actionId,e.impId,e.fieldName)}function ko(e){return uo({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function Co(e){return uo({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function Lo(e){return uo({getModObject:e=>e.getRaid(),getValue:e=>e.getDebuffs(),setValue:(e,t,s)=>t.setDebuffs(e,s),changeEmitter:e=>e.debuffsChangeEmitter},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function To(e){return po({getModObject:e=>e,getValue:e=>e.getConsumes(),setValue:(e,t,s)=>t.setConsumes(e,s),changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter])},e.fieldName,e.values,e.numColumns,e.direction||Kn.Vertical)}class No extends g{constructor(e,t,s,i){if(super(e,"multi-icon-picker-root"),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??Kn.Horizontal)?"dropdown":"dropend"),this.simUI=i,this.config=s,this.currentValue=null,this.rootElem.innerHTML='\n\t\t\t<a\n\t\t\t\tclass="icon-picker-button"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\taria-expanded="false"\n\t\t\t\tdata-disable-wowhead-touch-tooltip="true"\n\t\t\t\tdata-whtticon="false"\n\t\t\t></a>\n\t\t\t<ul class="dropdown-menu"></ul>\n\t\t\t<label class="multi-icon-picker-label form-label"></label>\n\t  ',s.tooltip){const e=Xa(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}const a=this.rootElem.querySelector(".multi-icon-picker-label");s.label?a.textContent=s.label:a.remove(),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.direction==Kn.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.buttonElem.addEventListener("hide.bs.dropdown",(e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()})),this.buttonElem.addEventListener("contextmenu",(e=>e.preventDefault())),this.buttonElem.addEventListener("mousedown",(e=>{S(e)&&this.clearPicker()})),this.buildBlankOption(),this.pickers=this.config.values.map(((e,s)=>{const i=document.createElement("li");return i.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(i),new Jn(i,t,e)})),i.sim.waitForInit().then((()=>this.updateButtonImage())),i.changeEmitter.on((()=>{this.updateButtonImage(),this.showWhen()?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}))}showWhen(){return!this.config.showWhen||this.config.showWhen(this.simUI.sim.raid.getPlayer(0))&&!!this.pickers.find((e=>e.showWhen()))}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t),t.addEventListener("click",(()=>this.clearPicker()))}clearPicker(){a.freezeAllAndDo((()=>{this.pickers.forEach((e=>{e.setInputValue(null),e.inputChanged(a.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.currentValue.fillAndSet(this.buttonElem,!1,!0)):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.filter((e=>e.showWhen())).map((e=>e.getActionId())).filter((e=>null!=e))[0]||null}}const _o=Io(Eo({actionId:e=>e.getMatchingSpellActionId([{id:1126,maxLevel:9},{id:5232,minLevel:10,maxLevel:19},{id:6756,minLevel:20,maxLevel:29},{id:5234,minLevel:30,maxLevel:39},{id:8907,minLevel:40,maxLevel:49},{id:9884,minLevel:50,maxLevel:59},{id:9885,minLevel:60}]),impId:E.fromSpellId(17055),fieldName:"giftOfTheWild"}),"Mark of the Wild"),Ao=Yn({values:[vo({actionId:()=>E.fromSpellId(20217),fieldName:"blessingOfKings",showWhen:e=>e.getFaction()===_e.Alliance}),wo({actionId:()=>E.fromSpellId(409580),fieldName:"aspectOfTheLion"})],label:"Stats %"}),Ro=Io(Eo({actionId:e=>e.getMatchingSpellActionId([{id:465,maxLevel:9},{id:10290,minLevel:10,maxLevel:19},{id:643,minLevel:20,maxLevel:29},{id:10291,minLevel:30,maxLevel:39},{id:1032,minLevel:40,maxLevel:49},{id:10292,minLevel:50,maxLevel:59},{id:10293,minLevel:60}]),impId:E.fromSpellId(20142),showWhen:e=>e.getFaction()===_e.Alliance,fieldName:"devotionAura"}),"Armor"),Do=Io(Eo({actionId:e=>e.getMatchingSpellActionId([{id:8071,minLevel:4,maxLevel:13},{id:8154,minLevel:14,maxLevel:23},{id:8155,minLevel:24,maxLevel:33},{id:10406,minLevel:34,maxLevel:43},{id:10407,minLevel:44,maxLevel:53},{id:10408,minLevel:54}]),impId:E.fromSpellId(16293),showWhen:e=>e.getFaction()===_e.Horde,fieldName:"stoneskinTotem"}),"Stoneskin"),Mo=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:20911,minLevel:30,maxLevel:39},{id:20912,minLevel:40,maxLevel:49},{id:20913,minLevel:50,maxLevel:59},{id:20914,minLevel:60}]),showWhen:e=>e.getFaction()===_e.Alliance,fieldName:"blessingOfSanctuary"}),"Blessing of Sanctuary"),Vo=Yn({values:[wo({actionId:e=>e.getMatchingSpellActionId([{id:976,minLevel:30,maxLevel:41},{id:10957,minLevel:42,maxLevel:55},{id:10958,minLevel:56}]),fieldName:"shadowProtection"}),wo({actionId:e=>e.getMatchingSpellActionId([{id:19876,minLevel:28,maxLevel:39},{id:19895,minLevel:40,maxLevel:51},{id:19896,minLevel:52}]),fieldName:"shadowResistanceAura"}),wo({actionId:e=>e.getMatchingSpellActionId([{id:10595,minLevel:30,maxLevel:43},{id:10600,minLevel:44,maxLevel:59},{id:10601,minLevel:60}]),fieldName:"natureResistanceTotem",showWhen:e=>e.getFaction()===_e.Horde}),wo({actionId:e=>e.getMatchingSpellActionId([{id:20043,minLevel:46,maxLevel:55},{id:20190,minLevel:56}]),fieldName:"aspectOfTheWild"}),wo({actionId:e=>e.getMatchingSpellActionId([{id:19891,minLevel:36,maxLevel:47},{id:19899,minLevel:48,maxLevel:59},{id:19900,minLevel:60}]),fieldName:"fireResistanceAura",showWhen:e=>e.getFaction()===_e.Alliance}),wo({actionId:e=>e.getMatchingSpellActionId([{id:8184,minLevel:28,maxLevel:41},{id:10537,minLevel:42,maxLevel:57},{id:10538,minLevel:58}]),fieldName:"fireResistanceTotem",showWhen:e=>e.getFaction()===_e.Horde}),wo({actionId:e=>e.getMatchingSpellActionId([{id:19888,minLevel:32,maxLevel:43},{id:19897,minLevel:44,maxLevel:55},{id:19898,minLevel:56}]),fieldName:"frostResistanceAura",showWhen:e=>e.getFaction()===_e.Alliance}),wo({actionId:e=>e.getMatchingSpellActionId([{id:8181,minLevel:24,maxLevel:37},{id:10478,minLevel:38,maxLevel:53},{id:10479,minLevel:54}]),fieldName:"frostResistanceTotem",showWhen:e=>e.getFaction()===_e.Horde})],label:"Resistances"}),Uo=Yn({values:[Eo({actionId:e=>e.getMatchingSpellActionId([{id:1243,maxLevel:11},{id:1244,minLevel:12,maxLevel:23},{id:1245,minLevel:24,maxLevel:35},{id:2791,minLevel:36,maxLevel:47},{id:10937,minLevel:48,maxLevel:60},{id:10938,minLevel:60}]),impId:E.fromSpellId(14767),fieldName:"powerWordFortitude"}),wo({actionId:e=>e.getMatchingItemActionId([{id:1180,minLevel:5,maxLevel:19},{id:1711,minLevel:20,maxLevel:34},{id:4422,minLevel:35,maxLevel:49},{id:10307,minLevel:50}]),fieldName:"scrollOfStamina"})],label:"Stamina"}),Wo=Yn({values:[Eo({actionId:e=>e.getMatchingSpellActionId([{id:6307,minLevel:4,maxLevel:13},{id:7804,minLevel:14,maxLevel:25},{id:7805,minLevel:26,maxLevel:37},{id:11766,minLevel:38,maxLevel:49},{id:11767,minLevel:50}]),impId:E.fromSpellId(18696),fieldName:"bloodPact"}),wo({actionId:()=>E.fromSpellId(403215),fieldName:"commandingShout"})],label:"Blood Pact"}),Fo=Io(yo({actionId:e=>e.getMatchingSpellActionId([{id:19740,minLevel:4,maxLevel:11},{id:19834,minLevel:12,maxLevel:21},{id:19835,minLevel:22,maxLevel:31},{id:19836,minLevel:32,maxLevel:41},{id:19837,minLevel:42,maxLevel:51},{id:19838,minLevel:52}]),impId:E.fromSpellId(20048),fieldName:"blessingOfMight",showWhen:e=>e.getFaction()===_e.Alliance}),"Blessing of Might"),Oo=Io(Eo({actionId:e=>e.getMatchingSpellActionId([{id:8075,minLevel:10,maxLevel:23},{id:8160,minLevel:24,maxLevel:37},{id:8161,minLevel:38,maxLevel:51},{id:10442,minLevel:52}]),impId:E.fromSpellId(16295),fieldName:"strengthOfEarthTotem",showWhen:e=>e.getFaction()===_e.Horde}),"Strength"),Ho=Io(Eo({actionId:e=>e.getMatchingSpellActionId([{id:8835,minLevel:42,maxLevel:55},{id:10627,minLevel:56}]),impId:E.fromSpellId(16295),fieldName:"graceOfAirTotem",showWhen:e=>e.getFaction()===_e.Horde}),"Agility"),qo=Yn({values:[wo({actionId:e=>e.getMatchingSpellActionId([{id:1459,maxLevel:13},{id:1460,minLevel:14,maxLevel:27},{id:1461,minLevel:28,maxLevel:41},{id:10156,minLevel:42,maxLevel:55},{id:10157,minLevel:56}]),fieldName:"arcaneBrilliance"}),wo({actionId:e=>e.getMatchingItemActionId([{id:955,minLevel:5,maxLevel:19},{id:2290,minLevel:20,maxLevel:34},{id:4419,minLevel:35,maxLevel:49},{id:10308,minLevel:50}]),fieldName:"scrollOfIntellect"})],label:"Intellect"}),Bo=Yn({values:[wo({actionId:e=>e.getMatchingSpellActionId([{id:14752,minLevel:30,maxLevel:39},{id:14818,minLevel:40,maxLevel:49},{id:14819,minLevel:50,maxLevel:59},{id:27841,minLevel:60}]),fieldName:"divineSpirit"}),wo({actionId:e=>e.getMatchingItemActionId([{id:1181,maxLevel:14},{id:1712,minLevel:15,maxLevel:29},{id:4424,minLevel:30,maxLevel:44},{id:10306,minLevel:45}]),fieldName:"scrollOfSpirit"})],label:"Spirit"}),zo=Io(Eo({actionId:e=>e.getMatchingSpellActionId([{id:6673,maxLevel:11},{id:5242,minLevel:12,maxLevel:21},{id:6192,minLevel:22,maxLevel:31},{id:11549,minLevel:32,maxLevel:41},{id:11550,minLevel:42,maxLevel:51},{id:11551,minLevel:52}]),impId:E.fromSpellId(12861),fieldName:"battleShout"}),"Battle Shout"),jo=Io(wo({actionId:e=>e.getMatchingSpellActionId([{id:19506,minLevel:40,maxLevel:49},{id:20905,minLevel:50,maxLevel:59},{id:20906,minLevel:60}]),fieldName:"trueshotAura"}),"Trueshot Aura"),$o=Io(yo({actionId:e=>e.getMatchingSpellActionId([{id:19742,minLevel:14,maxLevel:23},{id:19850,minLevel:24,maxLevel:33},{id:19852,minLevel:34,maxLevel:43},{id:19853,minLevel:44,maxLevel:53},{id:19854,minLevel:54}]),impId:E.fromSpellId(20245),fieldName:"blessingOfWisdom",showWhen:e=>e.getFaction()===_e.Alliance}),"Blessing of Wisdom"),Go=Io(Eo({actionId:e=>e.getMatchingSpellActionId([{id:5675,minLevel:26,maxLevel:35},{id:10495,minLevel:36,maxLevel:45},{id:10496,minLevel:46,maxLevel:55},{id:10497,minLevel:56}]),impId:E.fromSpellId(16208),fieldName:"manaSpringTotem",showWhen:e=>e.getFaction()===_e.Horde}),"Mana Spring Totem"),Ko=Io(ko({actionId:()=>E.fromSpellId(402668),numStates:21,fieldName:"vampiricTouch",multiplier:20}),"Vampiric Touch MP5"),Jo=Io(wo({actionId:e=>e.getMatchingSpellActionId([{id:24932,minLevel:40}]),fieldName:"leaderOfThePack"}),"Leader of the Pack"),Zo=Io(wo({actionId:e=>e.getMatchingSpellActionId([{id:24907,minLevel:40}]),fieldName:"moonkinAura"}),"Moonkin Aura"),Yo=Io(ko({actionId:()=>E.fromSpellId(425464),numStates:21,fieldName:"demonicPact",multiplier:10}),"Demonic Pact"),Qo=wo({actionId:e=>e.getMatchingSpellActionId([{id:457544,minLevel:60}]),fieldName:"improvedStoneskinWindwall"}),Xo=Eo({actionId:e=>e.getMatchingSpellActionId([{id:7294,minLevel:16,maxLevel:25},{id:10298,minLevel:26,maxLevel:35},{id:10299,minLevel:36,maxLevel:45},{id:10300,minLevel:46,maxLevel:55},{id:10301,minLevel:56}]),impId:E.fromSpellId(20092),fieldName:"retributionAura",showWhen:e=>e.getFaction()===_e.Alliance}),el=wo({actionId:e=>e.getMatchingSpellActionId([{id:20218,minLevel:30}]),fieldName:"sanctityAura",showWhen:e=>e.getFaction()===_e.Alliance}),tl=Eo({actionId:e=>e.getMatchingSpellActionId([{id:467,minLevel:6,maxLevel:13},{id:782,minLevel:14,maxLevel:23},{id:1075,minLevel:24,maxLevel:33},{id:8914,minLevel:34,maxLevel:43},{id:9756,minLevel:44,maxLevel:53},{id:9910,minLevel:54}]),impId:E.fromSpellId(16840),fieldName:"thorns"}),sl=Co({actionId:e=>e.getMatchingSpellActionId([{id:29166,minLevel:40}]),numStates:11,fieldName:"innervates"}),il=Co({actionId:e=>e.getMatchingSpellActionId([{id:10060,minLevel:40}]),numStates:11,fieldName:"powerInfusions"}),al=ko({actionId:e=>e.getMatchingSpellActionId([{id:23060,minLevel:40}]),numStates:6,fieldName:"battleSquawk"}),nl=Yn({values:[vo({actionId:()=>E.fromSpellId(22888),fieldName:"rallyingCryOfTheDragonslayer"}),vo({actionId:()=>E.fromSpellId(461475),fieldName:"valorOfAzeroth"})],label:"Dragonslayer Buff"}),ol=Io(vo({actionId:()=>E.fromSpellId(24425),fieldName:"spiritOfZandalar"}),"Spirit of Zandalar"),ll=Io(vo({actionId:()=>E.fromSpellId(15366),fieldName:"songflowerSerenade"}),"Songflower Serenade"),rl=Io(vo({actionId:()=>E.fromSpellId(16609),fieldName:"warchiefsBlessing",showWhen:e=>e.getFaction()===_e.Horde}),"Warchief's Blessing"),dl=Io(vo({actionId:()=>E.fromSpellId(460940),fieldName:"mightOfStormwind",showWhen:e=>e.getFaction()===_e.Alliance}),"Might Of Stormwind"),cl=e=>{return po({getModObject:e=>e,showWhen:e=>!t.showWhen||t.showWhen(e),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},(t={direction:Kn.Horizontal,values:[{iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_02.jpg",value:ze.SaygesUnknown,text:"Sayge's Dark Fortune"},...e.map((e=>e.config))],fieldName:"saygesFortune"}).fieldName,t.values,t.numColumns,t.direction||Kn.Vertical);var t},hl={actionId:()=>E.fromSpellId(23768),value:ze.SaygesDamage,text:"Sayge's Damage"},ml={actionId:()=>E.fromSpellId(23736),value:ze.SaygesAgility,text:"Sayge's Agility"},ul={actionId:()=>E.fromSpellId(23766),value:ze.SaygesIntellect,text:"Sayge's Intellect"},pl={actionId:()=>E.fromSpellId(23738),value:ze.SaygesSpirit,text:"Sayge's Spirit"},gl={actionId:()=>E.fromSpellId(23737),value:ze.SaygesStamina,text:"Sayge's Stamina"},fl=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:22817,minLevel:51}]),fieldName:"fengusFerocity"}),"Fengus' Ferocity"),Il=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:22818,minLevel:51}]),fieldName:"moldarsMoxie"}),"Moldar's Moxie"),wl=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:22820,minLevel:51}]),fieldName:"slipkiksSavvy"}),"Slip'kik's Savvy"),vl=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:430947,maxLevel:39}]),fieldName:"boonOfBlackfathom"}),"Boon of Blackfathom"),bl=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:430352,maxLevel:39}]),fieldName:"ashenvalePvpBuff"}),"Ashenvale PvP Buff"),xl=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:438536,maxLevel:49}]),fieldName:"sparkOfInspiration"}),"Spark of Inspiration"),Sl=Io(vo({actionId:e=>e.getMatchingSpellActionId([{id:446695,maxLevel:59}]),fieldName:"fervorOfTheTempleExplorer"}),"Fervor Of The Temple Explorer"),El=Yn({values:[So({actionId:e=>e.getMatchingSpellActionId([{id:7386,minLevel:10,maxLevel:21},{id:7405,minLevel:22,maxLevel:33},{id:8380,minLevel:34,maxLevel:45},{id:11596,minLevel:46,maxLevel:57},{id:11597,minLevel:58}]),fieldName:"sunderArmor"}),Po({actionId:e=>e.getMatchingSpellActionId([{id:8647,minLevel:14,maxLevel:25},{id:8649,minLevel:26,maxLevel:35},{id:8650,minLevel:36,maxLevel:45},{id:11197,minLevel:46,maxLevel:55},{id:11198,minLevel:56}]),impId:E.fromSpellId(14169),fieldName:"exposeArmor"}),Po({actionId:e=>e.getMatchingSpellActionId([{id:439500,minLevel:60}]),impId:E.fromSpellId(14169),fieldName:"sebaciousPoison"}),Lo({actionId:()=>E.fromSpellId(402818),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"})],label:"Major Armor Penetration"}),yl=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:704,minLevel:14,maxLevel:27},{id:7658,minLevel:28,maxLevel:41},{id:7659,minLevel:42,maxLevel:55},{id:11717,minLevel:56}]),fieldName:"curseOfRecklessness"}),"Curse of Recklessness"),Pl=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:770,minLevel:18,maxLevel:29},{id:778,minLevel:30,maxLevel:41},{id:9749,minLevel:42,maxLevel:53},{id:9907,minLevel:54}]),fieldName:"faerieFire"}),"Faerie Fire"),kl=Io(Po({actionId:e=>e.getMatchingSpellActionId([{id:702,minLevel:4,maxLevel:11},{id:1108,minLevel:12,maxLevel:21},{id:6205,minLevel:22,maxLevel:31},{id:7646,minLevel:32,maxLevel:41},{id:11707,minLevel:42,maxLevel:51},{id:11708,minLevel:52}]),impId:E.fromSpellId(18181),fieldName:"curseOfWeakness"}),"Curse of Weakness"),Cl=Yn({values:[Po({actionId:e=>e.getMatchingSpellActionId([{id:1160,minLevel:14,maxLevel:23},{id:6190,minLevel:24,maxLevel:33},{id:11554,minLevel:34,maxLevel:43},{id:11555,minLevel:44,maxLevel:53},{id:11556,minLevel:54}]),impId:E.fromSpellId(12879),fieldName:"demoralizingShout"}),Po({actionId:e=>e.getMatchingSpellActionId([{id:99,minLevel:10,maxLevel:19},{id:1735,minLevel:20,maxLevel:31},{id:9490,minLevel:32,maxLevel:41},{id:9747,minLevel:42,maxLevel:51},{id:9898,minLevel:52}]),impId:E.fromSpellId(16862),fieldName:"demoralizingRoar"}),Lo({actionId:()=>E.fromSpellId(402811),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"})],label:"Attack Power"}),Ll=Io(So({actionId:()=>E.fromSpellId(409828),fieldName:"mangle"}),"Bleed"),Tl=Yn({values:[Po({actionId:()=>E.fromSpellId(6343),impId:E.fromSpellId(12666),fieldName:"thunderClap"}),Lo({actionId:()=>E.fromSpellId(402808),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"}),So({actionId:()=>E.fromSpellId(408699),fieldName:"waylay"})],label:"Attack Speed"}),Nl=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:5570,minLevel:20,maxLevel:29},{id:24974,minLevel:30,maxLevel:39},{id:24975,minLevel:40,maxLevel:49},{id:24976,minLevel:50,maxLevel:59},{id:24977,minLevel:60}]),fieldName:"insectSwarm"}),"Insect Swarm"),_l=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:17803,minLevel:10}]),fieldName:"improvedShadowBolt"}),"Improved Shadow Bolt"),Al=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:12873,minLevel:40}]),fieldName:"improvedScorch"}),"Fire Damage"),Rl=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:28595,minLevel:40}]),fieldName:"wintersChill"}),"Frost Damage"),Dl=Yn({values:[So({actionId:e=>e.getMatchingSpellActionId([{id:17364,minLevel:40}]),fieldName:"stormstrike"}),So({actionId:()=>E.fromSpellId(408258),fieldName:"dreamstate"})],label:"Nature Damage"}),Ml=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:15334,minLevel:40}]),fieldName:"shadowWeaving"}),"Shadow Weaving"),Vl=Yn({values:[So({actionId:e=>e.getMatchingSpellActionId([{id:461615}]),fieldName:"markOfChaos"}),So({actionId:e=>e.getMatchingSpellActionId([{id:1490,minLevel:32,maxLevel:45},{id:11721,minLevel:46,maxLevel:59},{id:11722,minLevel:60}]),fieldName:"curseOfElements"}),So({actionId:e=>e.getMatchingSpellActionId([{id:17862,minLevel:44,maxLevel:59},{id:17937,minLevel:60}]),fieldName:"curseOfShadow"})],label:"Warlock Curses"}),Ul=Io(So({actionId:e=>e.getMatchingItemActionId([{id:226374,minLevel:54}]),fieldName:"occultPoison"}),"Occult Poison"),Wl=Io(Po({actionId:e=>e.getMatchingSpellActionId([{id:1130,minLevel:6,maxLevel:21},{id:14323,minLevel:22,maxLevel:39},{id:14324,minLevel:40,maxLevel:57},{id:14325,minLevel:58}]),impId:E.fromSpellId(19425),fieldName:"huntersMark"}),"Hunter's Mark"),Fl=Io(So({actionId:e=>e.getMatchingSpellActionId([{id:20186,minLevel:38,maxLevel:57},{id:20355,minLevel:58}]),fieldName:"judgementOfWisdom",showWhen:e=>e.getFaction()===_e.Alliance}),"Judgement of Wisdom"),Ol=Io(Po({actionId:e=>e.getMatchingSpellActionId([{id:20300,minLevel:22,maxLevel:31},{id:20301,minLevel:32,maxLevel:41},{id:20302,minLevel:42,maxLevel:51},{id:20303,minLevel:52}]),impId:E.fromSpellId(20337),fieldName:"judgementOfTheCrusader",showWhen:e=>e.getFaction()===_e.Alliance}),"Judgement of the Crusader"),Hl=So({actionId:e=>e.getMatchingSpellActionId([{id:455864,minLevel:60}]),fieldName:"improvedFaerieFire"}),ql=So({actionId:e=>e.getMatchingItemActionId([{id:213409,minLevel:40,maxLevel:45}]),fieldName:"mekkatorqueFistDebuff"}),Bl=So({actionId:e=>e.getMatchingItemActionId([{id:220589,minLevel:50,maxLevel:55}]),fieldName:"serpentsStrikerFistDebuff"}),zl=So({actionId:e=>e.getMatchingSpellActionId([{id:20185,minLevel:30,maxLevel:39},{id:20344,minLevel:40,maxLevel:49},{id:20345,minLevel:50,maxLevel:59},{id:20346,minLevel:60}]),fieldName:"judgementOfLight",showWhen:e=>e.getFaction()===_e.Alliance}),jl=So({actionId:e=>e.getMatchingSpellActionId([{id:427143,minLevel:25}]),fieldName:"curseOfVulnerability"}),$l=So({actionId:e=>e.getMatchingSpellActionId([{id:11374,minLevel:41}]),fieldName:"giftOfArthas"}),Gl=So({actionId:e=>e.getMatchingSpellActionId([{id:15235,minLevel:47}]),fieldName:"crystalYield"}),Kl=Lo({actionId:()=>E.fromItemId(209562),numStates:11,multiplier:10,reverse:!0,fieldName:"ancientCorrosivePoison"}),Jl=[{config:_o,picker:Jn,stats:[]},{config:Ao,picker:No,stats:[]},{config:Uo,picker:No,stats:[c.StatStamina]},{config:Wo,picker:No,stats:[c.StatStamina]},{config:qo,picker:No,stats:[c.StatIntellect]},{config:Bo,picker:No,stats:[c.StatSpirit]},{config:Ro,picker:Jn,stats:[c.StatArmor]},{config:Do,picker:Jn,stats:[c.StatArmor]},{config:Mo,picker:Jn,stats:[c.StatArmor]},{config:Vo,picker:No,stats:[c.StatNatureResistance,c.StatShadowResistance,c.StatFireResistance,c.StatFrostResistance]},{config:Fo,picker:Jn,stats:[c.StatStrength,c.StatAgility,c.StatAttackPower]},{config:Oo,picker:Jn,stats:[c.StatStrength]},{config:zo,picker:Jn,stats:[c.StatAttackPower]},{config:Ho,picker:Jn,stats:[c.StatAgility]},{config:jo,picker:Jn,stats:[c.StatRangedAttackPower]},{config:Jo,picker:Jn,stats:[c.StatMeleeCrit]},{config:Yo,picker:Jn,stats:[c.StatSpellPower]},{config:Zo,picker:Jn,stats:[c.StatSpellCrit]},{config:$o,picker:Jn,stats:[c.StatMP5]},{config:Go,picker:Jn,stats:[c.StatMP5]},{config:Ko,picker:Jn,stats:[c.StatMP5]}],Zl=[{config:Qo,picker:Jn,stats:[c.StatArmor]},{config:tl,picker:Jn,stats:[c.StatArmor]},{config:Xo,picker:Jn,stats:[c.StatArmor]},{config:el,picker:Jn,stats:[c.StatHolyPower]},{config:sl,picker:Jn,stats:[c.StatMP5]},{config:il,picker:Jn,stats:[c.StatMP5,c.StatSpellPower]},{config:al,picker:Jn,stats:[c.StatMeleeHit]}],Yl=[{config:nl,picker:No,stats:[]},{config:ll,picker:Jn,stats:[]},{config:ol,picker:Jn,stats:[]},{config:rl,picker:Jn,stats:[]},{config:dl,picker:Jn,stats:[]},{config:Sl,picker:Jn,stats:[]},{config:xl,picker:Jn,stats:[]},{config:vl,picker:Jn,stats:[c.StatMeleeCrit,c.StatSpellCrit,c.StatAttackPower]},{config:bl,picker:Jn,stats:[c.StatAttackPower,c.StatSpellPower]},{config:fl,picker:Jn,stats:[c.StatAttackPower]},{config:Il,picker:Jn,stats:[c.StatStamina]},{config:wl,picker:Jn,stats:[c.StatSpellCrit]}],Ql=[{config:hl,stats:[]},{config:ml,stats:[c.StatAgility]},{config:ul,stats:[c.StatIntellect]},{config:pl,stats:[c.StatSpirit,c.StatMP5]},{config:gl,stats:[c.StatStamina]}],Xl=[{config:El,stats:[c.StatAttackPower],picker:No},{config:yl,picker:Jn,stats:[c.StatAttackPower]},{config:Pl,picker:Jn,stats:[c.StatAttackPower]},{config:Ll,picker:Jn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Ol,picker:Jn,stats:[c.StatHolyPower]},{config:_l,picker:Jn,stats:[c.StatShadowPower]},{config:Al,picker:Jn,stats:[c.StatFirePower]},{config:Rl,picker:Jn,stats:[c.StatFrostPower]},{config:Dl,picker:No,stats:[c.StatNaturePower]},{config:Ml,picker:Jn,stats:[c.StatShadowPower]},{config:Vl,picker:No,stats:[c.StatSpellPower]},{config:Ul,picker:Jn,stats:[c.StatSpellPower]},{config:Cl,picker:No,stats:[c.StatArmor]},{config:Tl,picker:No,stats:[c.StatArmor]},{config:kl,picker:Jn,stats:[c.StatArmor]},{config:Nl,picker:Jn,stats:[c.StatDodge]},{config:Wl,picker:Jn,stats:[c.StatRangedAttackPower]},{config:Fl,picker:Jn,stats:[c.StatMP5,c.StatIntellect]}],er=[{config:Hl,picker:Jn,stats:[]},{config:ql,picker:Jn,stats:[c.StatSpellPower]},{config:Bl,picker:Jn,stats:[c.StatNaturePower,c.StatHolyPower]},{config:jl,picker:Jn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:$l,picker:Jn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Gl,picker:Jn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Kl,picker:Jn,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:zl,picker:Jn,stats:[c.StatStamina]}],tr={actionId:e=>e.getMatchingItemActionId([{id:6947,minLevel:20,maxLevel:27},{id:6949,minLevel:28,maxLevel:35},{id:6950,minLevel:36,maxLevel:43},{id:8926,minLevel:44,maxLevel:51},{id:8927,minLevel:52,maxLevel:59},{id:8928,minLevel:60,maxLevel:60}]),value:je.InstantPoison,showWhen:e=>e.getClass()==l.ClassRogue},sr={actionId:e=>e.getMatchingItemActionId([{id:2892,minLevel:30,maxLevel:37},{id:2893,minLevel:38,maxLevel:45},{id:8984,minLevel:46,maxLevel:53},{id:8985,minLevel:54}]),value:je.DeadlyPoison,showWhen:e=>e.getClass()==l.ClassRogue},ir={actionId:e=>e.getMatchingItemActionId([{id:10918,minLevel:32,maxLevel:39},{id:10920,minLevel:40,maxLevel:47},{id:10921,minLevel:48,maxLevel:55},{id:10922,minLevel:56,maxLevel:60}]),value:je.WoundPoison,showWhen:e=>e.getClass()==l.ClassRogue};je.OccultPoison,je.SebaciousPoison;const ar=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8017,minLevel:1,maxLevel:7},{id:8018,minLevel:8,maxLevel:15},{id:8019,minLevel:16,maxLevel:23},{id:10399,minLevel:24,maxLevel:33},{id:16314,minLevel:34,maxLevel:43},{id:16315,minLevel:44,maxLevel:53},{id:16316,minLevel:54}]),value:je.RockbiterWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),nr=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8024,minLevel:10,maxLevel:17},{id:8027,minLevel:18,maxLevel:25},{id:8030,minLevel:26,maxLevel:35},{id:16339,minLevel:36,maxLevel:45},{id:16341,minLevel:46,maxLevel:55},{id:16342,minLevel:56}]),value:je.FlametongueWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),or=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8033,minLevel:20,maxLevel:27},{id:8038,minLevel:28,maxLevel:37},{id:10456,minLevel:38,maxLevel:47},{id:16355,minLevel:48,maxLevel:57},{id:16356,minLevel:58}]),value:je.FrostbrandWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),lr=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8232,minLevel:30,maxLevel:39},{id:8235,minLevel:40,maxLevel:49},{id:10486,minLevel:50,maxLevel:59},{id:16362,minLevel:60}]),value:je.WindfuryWeapon,showWhen:t=>t.isClass(l.ClassShaman)&&$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)});function rr(e){return(t,s)=>({type:"iconEnum",tooltip:s,numColumns:t.length>11?4:t.length>8?3:t.length>5?2:1,values:[{value:0}].concat(t.map((e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>!e.config.showWhen||e.config.showWhen(t)})))),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter]),showWhen:t=>!e.showWhen||e.showWhen(t),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,s,i)=>{const n=s.getConsumes();n[e.consumesFieldName]!==i&&(n[e.consumesFieldName]=i,a.freezeAllAndDo((()=>{s.setConsumes(t,n),e.onSet&&e.onSet(t,s,i)})))}})}const dr=e=>(t,s,i,a)=>{const n={...e,values:a.map((e=>e.config))};return new No(t,s,n,i)},cr={actionId:e=>e.getMatchingItemActionId([{id:5509,minLevel:24}]),value:Ge.ConjuredHealthstone},hr={actionId:e=>e.getMatchingItemActionId([{id:5510,minLevel:36}]),value:Ge.ConjuredGreaterHealthstone},mr={actionId:e=>e.getMatchingItemActionId([{id:9421,minLevel:48}]),value:Ge.ConjuredMajorHealthstone},ur={actionId:()=>E.fromItemId(4381),value:Ge.ConjuredMinorRecombobulator,showWhen:e=>e.getGear().hasTrinket(4381)},pr={actionId:e=>e.getMatchingItemActionId([{id:12662,minLevel:40}]),value:Ge.ConjuredDemonicRune},gr={actionId:e=>e.getMatchingItemActionId([{id:7676,minLevel:25}]),value:Ge.ConjuredRogueThistleTea,showWhen:e=>e.getClass()==l.ClassRogue},fr=[{config:mr,stats:[c.StatArmor]},{config:hr,stats:[c.StatArmor]},{config:cr,stats:[c.StatArmor]},{config:pr,stats:[c.StatIntellect]},{config:ur,stats:[c.StatIntellect]},{config:gr,stats:[]}],Ir=rr({consumesFieldName:"defaultConjured"}),wr={actionId:e=>e.getMatchingItemActionId([{id:217308,minLevel:40}]),value:Ke.InnovationSigil,showWhen:e=>e.hasProfession(F.Enchanting)},vr={actionId:e=>e.getMatchingItemActionId([{id:221028,minLevel:50}]),value:Ke.LivingDreamsSigil,showWhen:e=>e.hasProfession(F.Enchanting)},br=[{config:{actionId:e=>e.getMatchingItemActionId([{id:228978,minLevel:50}]),value:Ke.FlowingWatersSigil},stats:[]},{config:vr,stats:[]},{config:wr,stats:[]}],xr=rr({consumesFieldName:"enchantedSigil"}),Sr={actionId:e=>e.getMatchingItemActionId([{id:10507,minLevel:40}]),showWhen:e=>e.hasProfession(F.Engineering),value:Je.ExplosiveSolidDynamite},Er={actionId:e=>e.getMatchingItemActionId([{id:4395,minLevel:40}]),showWhen:e=>e.hasProfession(F.Engineering),value:Je.ExplosiveGoblinLandMine},yr={actionId:e=>e.getMatchingItemActionId([{id:18641,minLevel:50}]),showWhen:e=>e.hasProfession(F.Engineering),value:Je.ExplosiveDenseDynamite},Pr={actionId:e=>e.getMatchingItemActionId([{id:15993,minLevel:50}]),showWhen:e=>e.hasProfession(F.Engineering),value:Je.ExplosiveThoriumGrenade},kr=[{config:{actionId:e=>e.getMatchingItemActionId([{id:215168,minLevel:40}]),value:Je.ExplosiveEzThroRadiationBomb},stats:[]},{config:{actionId:e=>e.getMatchingItemActionId([{id:215127,minLevel:40}]),showWhen:e=>e.hasProfession(F.Engineering),value:Je.ExplosiveHighYieldRadiationBomb},stats:[]},{config:Sr,stats:[]},{config:yr,stats:[]},{config:Pr,stats:[]},{config:Er,stats:[]}],Cr=rr({consumesFieldName:"fillerExplosive"}),Lr=bo({actionId:e=>e.getMatchingItemActionId([{id:10646,minLevel:50}]),fieldName:"sapper",showWhen:e=>e.hasProfession(F.Engineering)}),Tr={actionId:e=>e.getMatchingItemActionId([{id:13510,minLevel:51}]),value:Ze.FlaskOfTheTitans},Nr={actionId:e=>e.getMatchingItemActionId([{id:13511,minLevel:51}]),value:Ze.FlaskOfDistilledWisdom},_r={actionId:e=>e.getMatchingItemActionId([{id:13512,minLevel:51}]),value:Ze.FlaskOfSupremePower},Ar={actionId:e=>e.getMatchingItemActionId([{id:13513,minLevel:51}]),value:Ze.FlaskOfChromaticResistance},Rr={actionId:e=>e.getMatchingItemActionId([{id:222952,minLevel:50,maxLevel:59}]),value:Ze.FlaskOfRestlessDreams,showWhen:e=>e.hasProfession(F.Alchemy)},Dr={actionId:e=>e.getMatchingItemActionId([{id:221024,minLevel:50,maxLevel:59}]),value:Ze.FlaskOfEverlastingNightmares,showWhen:e=>e.hasProfession(F.Alchemy)},Mr=[{config:Tr,stats:[c.StatStamina]},{config:Nr,stats:[c.StatIntellect]},{config:_r,stats:[c.StatMP5,c.StatSpellPower]},{config:Ar,stats:[]},{config:Rr,stats:[c.StatSpellPower]},{config:Dr,stats:[c.StatAttackPower]}],Vr=rr({consumesFieldName:"flask"}),Ur={actionId:e=>e.getMatchingItemActionId([{id:21023,minLevel:55}]),value:Ye.FoodDirgesKickChimaerokChops},Wr={actionId:e=>e.getMatchingItemActionId([{id:13928,minLevel:50}]),value:Ye.FoodGrilledSquid},Fr={actionId:e=>e.getMatchingItemActionId([{id:20452,minLevel:51}]),value:Ye.FoodSmokedDesertDumpling},Or={actionId:e=>e.getMatchingItemActionId([{id:18254,minLevel:51}]),value:Ye.FoodRunnTumTuberSurprise},Hr={actionId:e=>e.getMatchingItemActionId([{id:13810,minLevel:45}]),value:Ye.FoodBlessSunfruit},qr={actionId:e=>e.getMatchingItemActionId([{id:13813,minLevel:45}]),value:Ye.FoodBlessedSunfruitJuice},Br={actionId:e=>e.getMatchingItemActionId([{id:13931,minLevel:35}]),value:Ye.FoodNightfinSoup},zr={actionId:e=>e.getMatchingItemActionId([{id:18045,minLevel:40}]),value:Ye.FoodTenderWolfSteak},jr={actionId:e=>e.getMatchingItemActionId([{id:21217,minLevel:30}]),value:Ye.FoodSagefishDelight},$r={actionId:e=>e.getMatchingItemActionId([{id:13851,minLevel:25}]),value:Ye.FoodHotWolfRibs},Gr={actionId:e=>e.getMatchingItemActionId([{id:21072,minLevel:10}]),value:Ye.FoodSmokedSagefish},Kr=[{config:Ur,stats:[c.StatStamina]},{config:Wr,stats:[c.StatAgility]},{config:Fr,stats:[c.StatStrength]},{config:Or,stats:[c.StatIntellect]},{config:Hr,stats:[c.StatStrength]},{config:qr,stats:[c.StatSpirit]},{config:Br,stats:[c.StatMP5]},{config:zr,stats:[c.StatStamina,c.StatSpirit]},{config:jr,stats:[c.StatMP5]},{config:$r,stats:[c.StatSpirit]},{config:Gr,stats:[c.StatMP5]}],Jr=rr({consumesFieldName:"food"}),Zr=bo({actionId:e=>e.getMatchingItemActionId([{id:12217,minLevel:35}]),fieldName:"dragonBreathChili"}),Yr={actionId:e=>e.getMatchingItemActionId([{id:21151,minLevel:1}]),value:Qe.AlcoholRumseyRumBlackLabel},Qr={actionId:e=>e.getMatchingItemActionId([{id:18269,minLevel:56}]),value:Qe.AlcoholGordokGreenGrog},Xr={actionId:e=>e.getMatchingItemActionId([{id:21114,minLevel:1}]),value:Qe.AlcoholRumseyRumDark},ed={actionId:e=>e.getMatchingItemActionId([{id:20709,minLevel:1}]),value:Qe.AlcoholRumseyRumLight},td={actionId:e=>e.getMatchingItemActionId([{id:18284,minLevel:56}]),value:Qe.AlcoholKreegsStoutBeatdown},sd=[{config:Yr,stats:[c.StatStamina]},{config:Qr,stats:[c.StatStamina]},{config:Xr,stats:[c.StatStamina]},{config:ed,stats:[c.StatStamina]},{config:td,stats:[c.StatSpirit]}],id=rr({consumesFieldName:"alcohol"}),ad={actionId:e=>e.getMatchingItemActionId([{id:13445,minLevel:43}]),value:Xe.ElixirOfSuperiorDefense},nd={actionId:e=>e.getMatchingItemActionId([{id:8951,minLevel:29}]),value:Xe.ElixirOfGreaterDefense},od={actionId:e=>e.getMatchingItemActionId([{id:3389,minLevel:16}]),value:Xe.ElixirOfDefense},ld={actionId:e=>e.getMatchingItemActionId([{id:5997,minLevel:1}]),value:Xe.ElixirOfMinorDefense},rd={actionId:e=>e.getMatchingItemActionId([{id:3013,minLevel:1,maxLevel:14},{id:1478,minLevel:15,maxLevel:29},{id:4421,minLevel:30,maxLevel:44},{id:10305,minLevel:45}]),value:Xe.ScrollOfProtection},dd=[{config:ad,stats:[c.StatArmor]},{config:nd,stats:[c.StatArmor]},{config:od,stats:[c.StatArmor]},{config:ld,stats:[c.StatArmor]},{config:rd,stats:[c.StatArmor]}],cd=rr({consumesFieldName:"armorElixir"}),hd={actionId:e=>e.getMatchingItemActionId([{id:3825,minLevel:25}]),value:et.ElixirOfFortitude},md={actionId:e=>e.getMatchingItemActionId([{id:2458,minLevel:2}]),value:et.ElixirOfMinorFortitude},ud=[{config:hd,stats:[c.StatStamina]},{config:md,stats:[c.StatStamina]}],pd=rr({consumesFieldName:"healthElixir"}),gd={actionId:e=>e.getMatchingItemActionId([{id:12460,minLevel:55}]),value:tt.JujuMight},fd={actionId:e=>e.getMatchingItemActionId([{id:12820,minLevel:45}]),value:tt.WinterfallFirewater},Id=[{config:gd,stats:[c.StatAttackPower]},{config:fd,stats:[c.StatAttackPower]}],wd=rr({consumesFieldName:"attackPowerBuff"}),vd={actionId:e=>e.getMatchingItemActionId([{id:13452,minLevel:46}]),value:st.ElixirOfTheMongoose},bd={actionId:e=>e.getMatchingItemActionId([{id:9187,minLevel:38}]),value:st.ElixirOfGreaterAgility},xd={actionId:e=>e.getMatchingItemActionId([{id:8949,minLevel:27}]),value:st.ElixirOfAgility},Sd={actionId:e=>e.getMatchingItemActionId([{id:3390,minLevel:18}]),value:st.ElixirOfLesserAgility},Ed={actionId:e=>e.getMatchingItemActionId([{id:3012,minLevel:10,maxLevel:24},{id:1477,minLevel:25,maxLevel:39},{id:4425,minLevel:40,maxLevel:54},{id:10309,minLevel:55}]),value:st.ScrollOfAgility},yd=[{config:vd,stats:[c.StatAgility,c.StatMeleeCrit]},{config:bd,stats:[c.StatAgility]},{config:xd,stats:[c.StatAgility]},{config:Sd,stats:[c.StatAgility]},{config:Ed,stats:[c.StatAgility]}],Pd=rr({consumesFieldName:"agilityElixir"}),kd={actionId:e=>e.getMatchingItemActionId([{id:12451,minLevel:55}]),value:it.JujuPower},Cd={actionId:e=>e.getMatchingItemActionId([{id:9206,minLevel:46}]),value:it.ElixirOfGiants},Ld={actionId:e=>e.getMatchingItemActionId([{id:3391,minLevel:20}]),value:it.ElixirOfOgresStrength},Td={actionId:e=>e.getMatchingItemActionId([{id:954,minLevel:10,maxLevel:24},{id:2289,minLevel:25,maxLevel:39},{id:4426,minLevel:40,maxLevel:54},{id:10310,minLevel:55}]),value:it.ScrollOfStrength},Nd=[{config:kd,stats:[c.StatStrength]},{config:Cd,stats:[c.StatStrength]},{config:Ld,stats:[c.StatStrength]},{config:Td,stats:[c.StatStrength]}],_d=rr({consumesFieldName:"strengthBuff"}),Ad={actionId:e=>e.getMatchingItemActionId([{id:8410,minLevel:45}]),value:at.ROIDS},Rd={actionId:e=>e.getMatchingItemActionId([{id:8412,minLevel:45}]),value:at.GroundScorpokAssay},Dd={actionId:e=>e.getMatchingItemActionId([{id:8411,minLevel:45}]),value:at.LungJuiceCocktail},Md={actionId:e=>e.getMatchingItemActionId([{id:8423,minLevel:45}]),value:at.CerebralCortexCompound},Vd={actionId:e=>e.getMatchingItemActionId([{id:8424,minLevel:45}]),value:at.GizzardGum},Ud={actionId:e=>e.getMatchingItemActionId([{id:20079,minLevel:55}]),value:at.SpiritOfZanza},Wd={actionId:()=>E.fromItemId(221196),value:at.AtalaiMojoOfWar,showWhen:e=>50==e.getLevel()},Fd={actionId:()=>E.fromItemId(221030),value:at.AtalaiMojoOfForbiddenMagic,showWhen:e=>50==e.getLevel()},Od={actionId:()=>E.fromItemId(221311),value:at.AtalaiMojoOfLife,showWhen:e=>50==e.getLevel()},Hd=[{config:Ud,stats:[c.StatStamina,c.StatSpirit]},{config:Ad,stats:[c.StatStrength]},{config:Rd,stats:[c.StatAgility]},{config:Dd,stats:[c.StatStamina]},{config:Md,stats:[c.StatIntellect]},{config:Vd,stats:[c.StatSpirit]},{config:Wd,stats:[c.StatAttackPower]},{config:Fd,stats:[c.StatSpellPower]},{config:Od,stats:[c.StatHealingPower]}],qd=rr({consumesFieldName:"zanzaBuff"}),Bd=xo({actionId:e=>e.getMatchingItemActionId([{id:213407,minLevel:20}]),fieldName:"catnip",showWhen:e=>e.getClass()===l.ClassDruid}),zd=xo({actionId:()=>E.fromItemId(12450),fieldName:"jujuFlurry",showWhen:e=>e.getLevel()>=55}),jd=xo({actionId:()=>E.fromItemId(210708),fieldName:"elixirOfCoalescedRegret"}),$d=xo({actionId:()=>E.fromItemId(5206),fieldName:"boglingRoot"}),Gd=[{config:Bd,picker:Jn,stats:[]},{config:zd,picker:Jn,stats:[c.StatAttackPower]},{config:jd,picker:Jn,stats:[]},{config:$d,picker:Jn,stats:[c.StatAttackPower]}],Kd=dr({direction:Kn.Vertical,tooltip:"Misc Offensive"}),Jd=xo({actionId:()=>E.fromItemId(12455),fieldName:"jujuEmber",showWhen:e=>e.getLevel()>=55}),Zd=xo({actionId:()=>E.fromItemId(12457),fieldName:"jujuChill",showWhen:e=>e.getLevel()>=55}),Yd=xo({actionId:()=>E.fromItemId(12459),fieldName:"jujuEscape",showWhen:e=>e.getLevel()>=55}),Qd=[{config:Jd,picker:Jn,stats:[]},{config:Zd,picker:Jn,stats:[]},{config:Yd,picker:Jn,stats:[c.StatDodge]}],Xd=dr({direction:Kn.Vertical,tooltip:"Misc Defensive"}),ec=[{config:{actionId:()=>E.fromItemId(211953),value:nt.MageScrollArcaneRecovery,showWhen:e=>e.isClass(l.ClassMage)},stats:[]},{config:{actionId:()=>E.fromItemId(211954),value:nt.MageScrollArcaneAccuracy,showWhen:e=>e.isClass(l.ClassMage)},stats:[]},{config:{actionId:()=>E.fromItemId(211957),value:nt.MageScrollArcanePower,showWhen:e=>e.isClass(l.ClassMage)},stats:[]},{config:{actionId:()=>E.fromItemId(211955),value:nt.MageScrollFireProtection,showWhen:e=>e.isClass(l.ClassMage)},stats:[]},{config:{actionId:()=>E.fromItemId(211956),value:nt.MageScrollFrostProtection,showWhen:e=>e.isClass(l.ClassMage)},stats:[]}],tc=rr({consumesFieldName:"mageScroll"}),sc=To({direction:Kn.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>E.fromItemId(12460),value:1,showWhen:e=>e.getLevel()>=55}],fieldName:"petAttackPowerConsumable"}),ic=To({direction:Kn.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>E.fromItemId(10309),value:1,showWhen:e=>e.getLevel()>=55},{actionId:()=>E.fromItemId(4425),value:2,showWhen:e=>e.getLevel()>=40},{actionId:()=>E.fromItemId(1477),value:3,showWhen:e=>e.getLevel()>=25},{actionId:()=>E.fromItemId(3012),value:4,showWhen:e=>e.getLevel()>=10}],fieldName:"petAgilityConsumable"}),ac=To({direction:Kn.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>E.fromItemId(12451),value:1,showWhen:e=>e.getLevel()>=55},{actionId:()=>E.fromItemId(10310),value:2,showWhen:e=>e.getLevel()>=55},{actionId:()=>E.fromItemId(4426),value:3,showWhen:e=>e.getLevel()>=40},{actionId:()=>E.fromItemId(2289),value:4,showWhen:e=>e.getLevel()>=25},{actionId:()=>E.fromItemId(954),value:5,showWhen:e=>e.getLevel()>=10}],fieldName:"petStrengthConsumable"});var nc;const oc=[{config:ro({getModObject:e=>e,showWhen:e=>!nc.showWhen||nc.showWhen(e),getValue:e=>e.getConsumes().petMiscConsumes??Be.create(),setValue:(e,t,s)=>{const i=t.getConsumes();i.petMiscConsumes=s,t.setConsumes(e,i)},changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},(nc={actionId:()=>E.fromItemId(12450),fieldName:"jujuFlurry",showWhen:e=>e.getLevel()>=55}).actionId,nc.fieldName,nc.value),picker:Jn,stats:[]}];dr({direction:Kn.Vertical,tooltip:"Misc Pet Consumes"});const lc={actionId:e=>e.getMatchingItemActionId([{id:1710,minLevel:21}]),value:ot.GreaterHealingPotion},rc={actionId:e=>e.getMatchingItemActionId([{id:3928,minLevel:35}]),value:ot.SuperiorHealingPotion},dc={actionId:e=>e.getMatchingItemActionId([{id:13446,minLevel:45}]),value:ot.MajorHealingPotion},cc={actionId:e=>e.getMatchingItemActionId([{id:3827,minLevel:22}]),value:ot.ManaPotion},hc={actionId:e=>e.getMatchingItemActionId([{id:6149,minLevel:31}]),value:ot.GreaterManaPotion},mc={actionId:e=>e.getMatchingItemActionId([{id:13443,minLevel:41}]),value:ot.SuperiorManaPotion},uc={actionId:e=>e.getMatchingItemActionId([{id:13444,minLevel:49}]),value:ot.MajorManaPotion},pc={actionId:e=>e.getMatchingItemActionId([{id:13442,minLevel:46}]),value:ot.MightyRagePotion,showWhen:e=>e.getClass()==l.ClassWarrior},gc={actionId:e=>e.getMatchingItemActionId([{id:5633,minLevel:25}]),value:ot.GreatRagePotion,showWhen:e=>e.getClass()==l.ClassWarrior},fc={actionId:e=>e.getMatchingItemActionId([{id:5631,minLevel:4}]),value:ot.RagePotion,showWhen:e=>e.getClass()==l.ClassWarrior};ot.MagicResistancePotion;const Ic={actionId:e=>e.getMatchingItemActionId([{id:13455,minLevel:46}]),value:ot.GreaterStoneshieldPotion},wc={actionId:e=>e.getMatchingItemActionId([{id:4623,minLevel:33}]),value:ot.LesserStoneshieldPotion},vc=[{config:dc,stats:[c.StatArmor]},{config:rc,stats:[c.StatArmor]},{config:lc,stats:[c.StatArmor]},{config:uc,stats:[c.StatIntellect]},{config:mc,stats:[c.StatIntellect]},{config:hc,stats:[c.StatIntellect]},{config:cc,stats:[c.StatIntellect]},{config:pc,stats:[]},{config:gc,stats:[]},{config:fc,stats:[]},{config:Ic,stats:[c.StatArmor]},{config:wc,stats:[c.StatArmor]}],bc=rr({consumesFieldName:"defaultPotion"}),xc=bo({actionId:e=>e.getMatchingItemActionId([{id:215162,minLevel:35}]),fieldName:"mildlyIrradiatedRejuvPot",showWhen:e=>e.hasProfession(F.Alchemy)}),Sc={actionId:e=>e.getMatchingItemActionId([{id:13454,minLevel:46}]),value:lt.GreaterArcaneElixir},Ec={actionId:e=>e.getMatchingItemActionId([{id:9155,minLevel:37}]),value:lt.ArcaneElixir},yc={actionId:e=>e.getMatchingItemActionId([{id:217398,minLevel:28}]),value:lt.LesserArcaneElixir},Pc=[{config:Sc,stats:[c.StatSpellPower]},{config:Ec,stats:[c.StatSpellPower]},{config:yc,stats:[c.StatSpellPower]}],kc=rr({consumesFieldName:"spellPowerBuff"}),Cc={actionId:e=>e.getMatchingItemActionId([{id:21546,minLevel:51}]),value:rt.ElixirOfGreaterFirepower},Lc={actionId:e=>e.getMatchingItemActionId([{id:6373,minLevel:18}]),value:rt.ElixirOfFirepower},Tc=[{config:Cc,stats:[c.StatFirePower]},{config:Lc,stats:[c.StatFirePower]}],Nc=rr({consumesFieldName:"firePowerBuff"}),_c=[{config:{actionId:e=>e.getMatchingItemActionId([{id:17708,minLevel:40}]),value:dt.ElixirOfFrostPower},stats:[c.StatFrostPower]}],Ac=rr({consumesFieldName:"frostPowerBuff"}),Rc=[{config:{actionId:e=>e.getMatchingItemActionId([{id:9264,minLevel:40}]),value:ct.ElixirOfShadowPower},stats:[c.StatShadowPower]}],Dc=rr({consumesFieldName:"shadowPowerBuff"}),Mc=[{config:{actionId:e=>e.getMatchingItemActionId([{id:20007,minLevel:61}]),value:ht.MagebloodPotion},stats:[c.StatMP5]}],Vc=rr({consumesFieldName:"manaRegenElixir"}),Uc={actionId:e=>e.getMatchingSpellActionId([{id:8512,minLevel:32,maxLevel:41},{id:10613,minLevel:42,maxLevel:51},{id:10614,minLevel:52}]),value:je.Windfury},Wc={actionId:()=>E.fromSpellId(407975),value:je.WildStrikes},Fc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20750,minLevel:40}]),value:je.WizardOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Oc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20746,minLevel:30}]),value:je.LesserWizardOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Hc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20744,minLevel:5}]),value:je.MinorWizardOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),qc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20747,minLevel:40}]),value:je.LesserManaOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Bc=e=>({actionId:e=>e.getMatchingItemActionId([{id:20745,minLevel:20}]),value:je.MinorManaOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),zc=e=>({actionId:e=>e.getMatchingItemActionId([{id:211848,minLevel:25}]),value:je.BlackfathomManaOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),jc=e=>({actionId:e=>e.getMatchingItemActionId([{id:18262,minLevel:50}]),value:je.ElementalSharpeningStone,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),$c=e=>({actionId:e=>e.getMatchingItemActionId([{id:12404,minLevel:35}]),value:je.DenseSharpeningStone,showWhen:t=>mt(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),Gc=e=>({actionId:e=>e.getMatchingItemActionId([{id:7964,minLevel:35}]),value:je.SolidSharpeningStone,showWhen:t=>mt(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),Kc=e=>({actionId:()=>E.fromItemId(211845),value:je.BlackfathomSharpeningStone,showWhen:t=>mt(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),Jc=e=>({actionId:e=>e.getMatchingItemActionId([{id:12643,minLevel:35}]),value:je.DenseWeightstone,showWhen:t=>ut(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),Zc=e=>({actionId:e=>e.getMatchingItemActionId([{id:7965,minLevel:35}]),value:je.SolidWeightstone,showWhen:t=>ut(t.getEquippedItem(e)?.item.weaponType??Fe.WeaponTypeUnknown)}),Yc=e=>({actionId:e=>e.getMatchingItemActionId([{id:3824,minLevel:25}]),value:je.ShadowOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Qc=e=>({actionId:e=>e.getMatchingItemActionId([{id:3829,minLevel:40}]),value:je.FrostOil,showWhen:t=>$e(t.getEquippedItem(e)?._item?.weaponType??Fe.WeaponTypeUnknown)}),Xc=e=>({actionId:e=>e.getMatchingItemActionId([{id:228980,minLevel:40}]),value:je.ConductiveShieldCoating,showWhen:t=>e===D.ItemSlotOffHand&&t.getEquippedItem(D.ItemSlotOffHand)?._item?.weaponType===Fe.WeaponTypeShield}),eh=e=>[{config:ar(e),stats:[]},{config:nr(e),stats:[]},{config:or(e),stats:[]},{config:lr(e),stats:[]}],th=[{config:tr,stats:[]},{config:sr,stats:[]},{config:ir,stats:[]}],sh=e=>[{config:Xc(e),stats:[c.StatSpellPower]},{config:Fc(e),stats:[c.StatSpellPower]},{config:Oc(e),stats:[c.StatSpellPower]},{config:Hc(e),stats:[c.StatSpellPower]},{config:qc(e),stats:[c.StatHealingPower,c.StatSpellPower]},{config:Bc(e),stats:[c.StatHealingPower,c.StatSpellPower]},{config:zc(e),stats:[c.StatSpellPower,c.StatMP5]},{config:jc(e),stats:[c.StatAttackPower]},{config:$c(e),stats:[c.StatAttackPower]},{config:Gc(e),stats:[c.StatAttackPower]},{config:Kc(e),stats:[c.StatMeleeHit]},{config:Jc(e),stats:[c.StatAttackPower]},{config:Zc(e),stats:[c.StatAttackPower]},{config:Yc(e),stats:[c.StatAttackPower]},{config:Qc(e),stats:[c.StatAttackPower]}],ih=[...th,...eh(D.ItemSlotOffHand),...sh(D.ItemSlotOffHand)],ah=[...th,...eh(D.ItemSlotMainHand),{config:Uc,stats:[c.StatMeleeHit]},{config:Wc,stats:[c.StatMeleeHit]},...sh(D.ItemSlotMainHand)],nh=rr({consumesFieldName:"mainHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(D.ItemSlotMainHand)}),oh=rr({consumesFieldName:"offHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(D.ItemSlotOffHand)});class lh extends w{constructor(e,t,s){super(e,"enum-picker-root",t,s),this.selectElem=document.createElement("select"),this.selectElem.id=s.id,this.selectElem.classList.add("enum-picker-selector","form-select"),s.values.forEach((e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal})}getInputElem(){return this.selectElem}getInputValue(){return parseInt(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}const rh={id:"reaction-time",type:"number",label:"Reaction Time",labelTooltip:"Reaction time of the player, in milliseconds. Used with certain APL values (such as 'Aura Is Active With Reaction Time').",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,s)=>{t.setReactionTime(e,s)}},dh={id:"channel-clip-delay",type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,s)=>{t.setChannelClipDelay(e,s)}},ch={id:"in-front-of-target",type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,s)=>{t.setInFrontOfTarget(e,s)}},hh={id:"distance-from-target",type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,s)=>{t.setDistanceFromTarget(e,s)}},mh={tooltip:"Improved Shadow Bolt debuff configuration",inputs:[{id:"isb-using-shadowflame",type:"boolean",label:"Has Shadowflame Rune",labelTooltip:"Whether or not the Warlock is using the Shadowflame rune (4 stacks of ISB vs. 10)",float:!0,defaultValue:!0,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbUsingShadowflame(),setValue:(e,t,s)=>{t.setIsbUsingShadowflame(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-frequency",type:"number",label:"SB Frequency",labelTooltip:"How often a Shadow Bolt is cast by the external warlock.",float:!0,defaultValue:3,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSbFrequency(),setValue:(e,t,s)=>{t.setIsbSbFrequency(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-crit",type:"number",label:"SB Crit",labelTooltip:"How often a Shadow Bolt from external warlock is a crit.",float:!0,defaultValue:25,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbCrit(),setValue:(e,t,s)=>{t.setIsbCrit(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-warlock",type:"number",label:"SB Warlocks",labelTooltip:"Number of ISB warlocks.",defaultValue:1,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbWarlocks(),setValue:(e,t,s)=>{t.setIsbWarlocks(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-priests",type:"number",label:"Shadow Priests",labelTooltip:"Number of other shadow priests.",inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSpriests(),setValue:(e,t,s)=>{t.setIsbSpriests(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt||e?.getTalents().improvedShadowBolt>0}]},uh={id:"tank-assignment",type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex((t=>fe.equals(t,e.makeUnitReference()))),setValue:(e,t,s)=>{const i=[];if(-1!=s){for(let e=0;e<s;e++)i.push(se());i.push(t.makeUnitReference())}t.getRaid().setTanks(e,i)}},ph={id:"incoming-hps",type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p class=\"mb-0>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,s)=>{const i=t.getHealingModel();i.hps=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},gh={id:"healing-cadence",type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p class=\"mb-0\">If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,s)=>{const i=t.getHealingModel();i.cadenceSeconds=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},fh={id:"healing-cadence-variation",type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p class=\"mb-0\">The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,s)=>{const i=t.getHealingModel();i.cadenceVariation=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},Ih={id:"burst-window",type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,s)=>{const i=t.getHealingModel();i.burstWindow=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>fe.equals(t,e.makeUnitReference())))},wh={id:"hp-percent-for-defensives",type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:'\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p class="mb-0">If set to 0, this restriction is disabled.</p>\n\t',changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,s)=>{const i=t.getSimpleCooldowns();i.hpPercentForDefensives=s/100,t.setSimpleCooldowns(e,i)}},vh={id:"inspiration-uptime",type:"number",float:!0,label:"Inspiration % Uptime",labelTooltip:'\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p class="mb-0">If set to 0, the buff isn\'t applied.</p>\n\t',changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().inspirationUptime,setValue:(e,t,s)=>{const i=t.getHealingModel();i.inspirationUptime=s/100,t.setHealingModel(e,i)}};class bh extends w{constructor(e,t,s){super(e,"number-picker-root",t,s),this.float=s.float??!1,this.positive=s.positive??!1,this.showZeroes=s.showZeroes??!0,this.inputElem=document.createElement("input"),this.inputElem.id=s.id,this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&this.inputElem.addEventListener("change",(()=>{this.float?this.inputElem.value=Math.abs(parseFloat(this.inputElem.value)).toFixed(2):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),{signal:this.signal}),this.inputElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.init(),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?parseFloat(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){(0!=e||this.showZeroes)&&(this.float?this.inputElem.value=e.toFixed(2):this.inputElem.value=String(e))}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}class xh extends g{constructor(e,t,s,i){super(e,"character-stats-root"),this.stats=gt.filter((e=>s.includes(e))),this.player=t,this.modifyDisplayStats=i;const n=I();this.player.levelChangeEmitter.on((()=>n.value.textContent=`Level ${t.getLevel()}`)),this.rootElem.appendChild(f("label",{className:"character-stats-label"},f("span",null,"Stats"),f("span",{ref:n,className:"ms-auto"},"Level ",t.getLevel())));const o=f("table",{className:"character-stats-table"});if(this.rootElem.appendChild(o),this.valueElems=[],this.stats.forEach((e=>{const s=m(e,t.getClass()),i=f("tr",{className:"character-stats-table-row"},f("td",{className:"character-stats-table-label"},s),f("td",{className:"character-stats-table-value"},this.bonusStatsLink(e)));o.appendChild(i);const a=i.getElementsByClassName("character-stats-table-value")[0];this.valueElems.push(a)})),this.shouldShowMeleeCritCap(t)){const e=f("tr",{className:"character-stats-table-row"},f("td",{className:"character-stats-table-label"},"Melee Crit Cap"),f("td",{className:"character-stats-table-value"}));o.appendChild(e),this.meleeCritCapValueElem=e.getElementsByClassName("character-stats-table-value")[0]}this.updateStats(t),a.onAny([t.currentStatsEmitter,t.sim.changeEmitter,t.talentsChangeEmitter]).on((()=>{this.updateStats(t)}))}updateStats(e){const s=e.getCurrentStats(),i=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{};i.talents||(i.talents=new un),i.buffs||(i.buffs=new un);const a=un.fromProto(s.baseStats),n=un.fromProto(s.gearStats),o=un.fromProto(s.talentsStats),l=un.fromProto(s.buffsStats),r=un.fromProto(s.consumesStats),d=this.getDebuffStats(),m=e.getBonusStats(),u=a,p=n.subtract(a).subtract(m),g=o.subtract(n).add(i.talents),w=l.subtract(o).add(i.buffs),v=r.subtract(l),b=un.fromProto(s.finalStats).add(i.talents).add(i.buffs).add(d);if(this.stats.forEach(((s,i)=>{const x=m.getStat(s);let S;S=0===x?"text-white":x>0?"text-success":"text-danger";const E=I(),y=f("div",{className:"stat-value-link-container"},f("a",{href:"javascript:void(0)",className:`stat-value-link ${S}`,attributes:{role:"button"},ref:E},`${this.statDisplayString(e,b,b,s)} `)),P=E.value;this.valueElems[i].querySelector(".stat-value-link-container")?.remove(),this.valueElems[i].prepend(y);const k=f("div",{className:"d-flex"},f("div",null,f("div",{className:"character-stats-tooltip-row"},f("span",null,"Base:"),f("span",null,this.statDisplayString(e,a,u,s))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Gear:"),f("span",null,this.statDisplayString(e,n,p,s))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Talents:"),f("span",null,this.statDisplayString(e,o,g,s))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Buffs:"),f("span",null,this.statDisplayString(e,l,w,s))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Consumes:"),f("span",null,this.statDisplayString(e,r,v,s))),0!=d.getStat(s)&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Debuffs:"),f("span",null,this.statDisplayString(e,d,d,s))),0!=x&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Bonus:"),f("span",null,this.statDisplayString(e,m,m,s))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Total:"),f("span",null,this.statDisplayString(e,b,b,s)))));s===c.StatMeleeHit?k.appendChild(f("div",{className:"ps-2"},f("div",{className:"character-stats-tooltip-row"},f("span",null,"Axes"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatAxesSkill)," /"," ",this.weaponSkillDisplayString(n,h.PseudoStatTwoHandedAxesSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Daggers"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatDaggersSkill))),e.spec===t.SpecFeralDruid&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Feral Combat"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatFeralCombatSkill)," / ")),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Maces"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatMacesSkill)," /"," ",this.weaponSkillDisplayString(n,h.PseudoStatTwoHandedMacesSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Polearms"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatPolearmsSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Staves"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatStavesSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Swords"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatSwordsSkill)," /"," ",this.weaponSkillDisplayString(n,h.PseudoStatTwoHandedSwordsSkill))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Unarmed"),f("span",null,this.weaponSkillDisplayString(n,h.PseudoStatUnarmedSkill))))):s===c.StatSpellHit&&k.appendChild(f("div",{className:"ps-2"},f("div",{className:"character-stats-tooltip-row"},f("span",null,"Arcane"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitArcane))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Fire"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitFire))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Frost"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitFrost))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Holy"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitHoly))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Nature"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitNature))),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Shadow"),f("span",null,this.spellSchoolHitDisplayString(b,h.PseudoStatSchoolHitShadow))))),Xa(P,{content:k})})),this.meleeCritCapValueElem){const t=e.getMeleeCritCapInfo(),s=f("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"}},`${this.meleeCritCapDisplayString(e,b)} `),i=t.playerCritCapDelta;0===i?s.classList.add("text-white"):i>0?s.classList.add("text-danger"):i<0&&s.classList.add("text-success"),this.meleeCritCapValueElem.querySelector(".stat-value-link")?.remove(),this.meleeCritCapValueElem.prepend(s);const a=f("div",null,f("div",{className:"character-stats-tooltip-row"},f("span",null,"Glancing:"),f("span",null,`${t.glancing.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Suppression:"),f("span",null,`${t.suppression.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"To Hit Cap:"),f("span",null,`${t.remainingMeleeHitCap.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"To Exp Cap:"),f("span",null,`${t.remainingExpertiseCap.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Debuffs:"),f("span",null,`${t.debuffCrit.toFixed(2)}%`)),0!=t.specSpecificOffset&&f("div",{className:"character-stats-tooltip-row"},f("span",null,"Spec Offsets:"),f("span",null,`${t.specSpecificOffset.toFixed(2)}%`)),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Final Crit Cap:"),f("span",null,`${t.baseCritCap.toFixed(2)}%`)),f("hr",null),f("div",{className:"character-stats-tooltip-row"},f("span",null,"Can Raise By:"),f("span",null,`${(t.remainingExpertiseCap+t.remainingMeleeHitCap).toFixed(2)}%`)));Xa(s,{content:a})}}statDisplayString(e,t,s,i){let a=s.getStat(i);i===c.StatBlockValue&&(a*=t.getPseudoStat(h.PseudoStatBlockValueMultiplier)||1);let n=String(Math.round(a));if(i===c.StatMeleeHit)n=`${(a/q).toFixed(2)}%`;else if(i===c.StatSpellHit)n=`${(a/ft).toFixed(2)}%`;else if(i===c.StatSpellDamage){const e=Math.round(a);n=Math.round(s.getStat(c.StatSpellPower))+e+` (+${e})`}else if(i===c.StatArcanePower||i===c.StatFirePower||i===c.StatFrostPower||i===c.StatHolyPower||i===c.StatNaturePower||i===c.StatShadowPower){const e=Math.round(a);n=Math.round(s.getStat(c.StatSpellPower)+s.getStat(c.StatSpellDamage))+e+` (+${e})`}else i===c.StatMeleeCrit||i===c.StatSpellCrit?n=`${(a/It).toFixed(2)}%`:i===c.StatMeleeHaste?n=`${(100*s.getPseudoStat(h.PseudoStatMeleeSpeedMultiplier)).toFixed(2)}%`:i===c.StatSpellHaste?n=`${(a/wt).toFixed(2)}%`:i===c.StatArmorPenetration?n+=` (${(a/vt).toFixed(2)}%)`:i===c.StatExpertise?n+=` (${(a/B/4).toFixed(2)}%)`:i===c.StatDefense?n=`${(5*e.getLevel()+Math.floor(a/bt)).toFixed(0)}`:i===c.StatBlock?n=`${(a/xt).toFixed(2)}%`:i===c.StatDodge?n=`${(a/St).toFixed(2)}%`:i===c.StatParry?n=`${(a/Et).toFixed(2)}%`:i===c.StatResilience&&(n+=` (${(a/yt).toFixed(2)}%)`);return n}weaponSkillDisplayString(e,t){return`${300+e.getPseudoStat(t)}`}spellSchoolHitDisplayString(e,t){return`${(e.getPseudoStat(t)+e.getStat(c.StatSpellHit)).toFixed(2)}%`}getDebuffStats(){return new un}bonusStatsLink(e){const t=m(e,this.player.getClass()),s=I(),i=I(),a=f("a",{ref:s,href:"javascript:void(0)",className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"},attributes:{role:"button"}},f("i",{ref:i,className:"fas fa-plus-minus"}));return Xa(i.value,{content:`Bonus ${t}`}),Xa(s.value,{interactive:!0,trigger:"click",theme:"bonus-stats-popover",placement:"right",onShow:s=>{const i=new bh(null,this.player,{id:`character-bonus-stat-${e}`,label:`Bonus ${t}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:t=>t.getBonusStats().getStat(e),setValue:(t,i,a)=>{const n=i.getBonusStats().withStat(e,a);i.setBonusStats(t,n),s?.hide()}});s.setContent(i.rootElem)}}),a}shouldShowMeleeCritCap(e){return!1}meleeCritCapDisplayString(e,t){const s=e.getMeleeCritCap();if(0===s)return"Exact";return`${s>0?"Over by ":"Under by "} ${Math.abs(s).toFixed(2)}%`}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Sh(e){let t=e.length;for(;--t>=0;)e[t]=0}const Eh=256,yh=286,Ph=30,kh=15,Ch=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Lh=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Th=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Nh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_h=new Array(576);Sh(_h);const Ah=new Array(60);Sh(Ah);const Rh=new Array(512);Sh(Rh);const Dh=new Array(256);Sh(Dh);const Mh=new Array(29);Sh(Mh);const Vh=new Array(Ph);function Uh(e,t,s,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}let Wh,Fh,Oh;function Hh(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Sh(Vh);const qh=e=>e<256?Rh[e]:Rh[256+(e>>>7)],Bh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},zh=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,Bh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},jh=(e,t,s)=>{zh(e,s[2*t],s[2*t+1])},$h=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},Gh=(e,t,s)=>{const i=new Array(16);let a,n,o=0;for(a=1;a<=kh;a++)o=o+s[a-1]<<1,i[a]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=$h(i[t]++,t))}},Kh=e=>{let t;for(t=0;t<yh;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Ph;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Jh=e=>{e.bi_valid>8?Bh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Zh=(e,t,s,i)=>{const a=2*t,n=2*s;return e[a]<e[n]||e[a]===e[n]&&i[t]<=i[s]},Yh=(e,t,s)=>{const i=e.heap[s];let a=s<<1;for(;a<=e.heap_len&&(a<e.heap_len&&Zh(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Zh(t,i,e.heap[a],e.depth));)e.heap[s]=e.heap[a],s=a,a<<=1;e.heap[s]=i},Qh=(e,t,s)=>{let i,a,n,o,l=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+l++],i+=(255&e.pending_buf[e.sym_buf+l++])<<8,a=e.pending_buf[e.sym_buf+l++],0===i?jh(e,a,t):(n=Dh[a],jh(e,n+Eh+1,t),o=Ch[n],0!==o&&(a-=Mh[n],zh(e,a,o)),i--,n=qh(i),jh(e,n,s),o=Lh[n],0!==o&&(i-=Vh[n],zh(e,i,o)))}while(l<e.sym_next);jh(e,256,t)},Xh=(e,t)=>{const s=t.dyn_tree,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,l,r,d=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==s[2*o]?(e.heap[++e.heap_len]=d=o,e.depth[o]=0):s[2*o+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=d<2?++d:0,s[2*r]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=i[2*r+1]);for(t.max_code=d,o=e.heap_len>>1;o>=1;o--)Yh(e,s,o);r=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Yh(e,s,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,s[2*r]=s[2*o]+s[2*l],e.depth[r]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,s[2*o+1]=s[2*l+1]=r,e.heap[1]=r++,Yh(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,i=t.max_code,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,r=t.stat_desc.max_length;let d,c,h,m,u,p,g=0;for(m=0;m<=kh;m++)e.bl_count[m]=0;for(s[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)c=e.heap[d],m=s[2*s[2*c+1]+1]+1,m>r&&(m=r,g++),s[2*c+1]=m,c>i||(e.bl_count[m]++,u=0,c>=l&&(u=o[c-l]),p=s[2*c],e.opt_len+=p*(m+u),n&&(e.static_len+=p*(a[2*c+1]+u)));if(0!==g){do{for(m=r-1;0===e.bl_count[m];)m--;e.bl_count[m]--,e.bl_count[m+1]+=2,e.bl_count[r]--,g-=2}while(g>0);for(m=r;0!==m;m--)for(c=e.bl_count[m];0!==c;)h=e.heap[--d],h>i||(s[2*h+1]!==m&&(e.opt_len+=(m-s[2*h+1])*s[2*h],s[2*h+1]=m),c--)}})(e,t),Gh(s,d,e.bl_count)},em=(e,t,s)=>{let i,a,n=-1,o=t[1],l=0,r=7,d=4;for(0===o&&(r=138,d=3),t[2*(s+1)+1]=65535,i=0;i<=s;i++)a=o,o=t[2*(i+1)+1],++l<r&&a===o||(l<d?e.bl_tree[2*a]+=l:0!==a?(a!==n&&e.bl_tree[2*a]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,n=a,0===o?(r=138,d=3):a===o?(r=6,d=3):(r=7,d=4))},tm=(e,t,s)=>{let i,a,n=-1,o=t[1],l=0,r=7,d=4;for(0===o&&(r=138,d=3),i=0;i<=s;i++)if(a=o,o=t[2*(i+1)+1],!(++l<r&&a===o)){if(l<d)do{jh(e,a,e.bl_tree)}while(0!=--l);else 0!==a?(a!==n&&(jh(e,a,e.bl_tree),l--),jh(e,16,e.bl_tree),zh(e,l-3,2)):l<=10?(jh(e,17,e.bl_tree),zh(e,l-3,3)):(jh(e,18,e.bl_tree),zh(e,l-11,7));l=0,n=a,0===o?(r=138,d=3):a===o?(r=6,d=3):(r=7,d=4)}};let sm=!1;const im=(e,t,s,i)=>{zh(e,0+(i?1:0),3),Jh(e),Bh(e,s),Bh(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var am={_tr_init:e=>{sm||((()=>{let e,t,s,i,a;const n=new Array(16);for(s=0,i=0;i<28;i++)for(Mh[i]=s,e=0;e<1<<Ch[i];e++)Dh[s++]=i;for(Dh[s-1]=i,a=0,i=0;i<16;i++)for(Vh[i]=a,e=0;e<1<<Lh[i];e++)Rh[a++]=i;for(a>>=7;i<Ph;i++)for(Vh[i]=a<<7,e=0;e<1<<Lh[i]-7;e++)Rh[256+a++]=i;for(t=0;t<=kh;t++)n[t]=0;for(e=0;e<=143;)_h[2*e+1]=8,e++,n[8]++;for(;e<=255;)_h[2*e+1]=9,e++,n[9]++;for(;e<=279;)_h[2*e+1]=7,e++,n[7]++;for(;e<=287;)_h[2*e+1]=8,e++,n[8]++;for(Gh(_h,287,n),e=0;e<Ph;e++)Ah[2*e+1]=5,Ah[2*e]=$h(e,5);Wh=new Uh(_h,Ch,257,yh,kh),Fh=new Uh(Ah,Lh,0,Ph,kh),Oh=new Uh(new Array(0),Th,0,19,7)})(),sm=!0),e.l_desc=new Hh(e.dyn_ltree,Wh),e.d_desc=new Hh(e.dyn_dtree,Fh),e.bl_desc=new Hh(e.bl_tree,Oh),e.bi_buf=0,e.bi_valid=0,Kh(e)},_tr_stored_block:im,_tr_flush_block:(e,t,s,i)=>{let a,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Eh;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Xh(e,e.l_desc),Xh(e,e.d_desc),o=(e=>{let t;for(em(e,e.dyn_ltree,e.l_desc.max_code),em(e,e.dyn_dtree,e.d_desc.max_code),Xh(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Nh[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=a&&(a=n)):a=n=s+5,s+4<=a&&-1!==t?im(e,t,s,i):4===e.strategy||n===a?(zh(e,2+(i?1:0),3),Qh(e,_h,Ah)):(zh(e,4+(i?1:0),3),((e,t,s,i)=>{let a;for(zh(e,t-257,5),zh(e,s-1,5),zh(e,i-4,4),a=0;a<i;a++)zh(e,e.bl_tree[2*Nh[a]+1],3);tm(e,e.dyn_ltree,t-1),tm(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Qh(e,e.dyn_ltree,e.dyn_dtree)),Kh(e),i&&Jh(e)},_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(Dh[s]+Eh+1)]++,e.dyn_dtree[2*qh(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{zh(e,2,3),jh(e,256,_h),(e=>{16===e.bi_valid?(Bh(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var nm=(e,t,s,i)=>{let a=65535&e,n=e>>>16&65535,o=0;for(;0!==s;){o=s>2e3?2e3:s,s-=o;do{a=a+t[i++]|0,n=n+a|0}while(--o);a%=65521,n%=65521}return a|n<<16};const om=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var lm=(e,t,s,i)=>{const a=om,n=i+s;e^=-1;for(let o=i;o<n;o++)e=e>>>8^a[255&(e^t[o])];return~e},rm={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},dm={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:cm,_tr_stored_block:hm,_tr_flush_block:mm,_tr_tally:um,_tr_align:pm}=am,{Z_NO_FLUSH:gm,Z_PARTIAL_FLUSH:fm,Z_FULL_FLUSH:Im,Z_FINISH:wm,Z_BLOCK:vm,Z_OK:bm,Z_STREAM_END:xm,Z_STREAM_ERROR:Sm,Z_DATA_ERROR:Em,Z_BUF_ERROR:ym,Z_DEFAULT_COMPRESSION:Pm,Z_FILTERED:km,Z_HUFFMAN_ONLY:Cm,Z_RLE:Lm,Z_FIXED:Tm,Z_DEFAULT_STRATEGY:Nm,Z_UNKNOWN:_m,Z_DEFLATED:Am}=dm,Rm=258,Dm=262,Mm=42,Vm=113,Um=666,Wm=(e,t)=>(e.msg=rm[t],t),Fm=e=>2*e-(e>4?9:0),Om=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Hm=e=>{let t,s,i,a=e.w_size;t=e.hash_size,i=t;do{s=e.head[--i],e.head[i]=s>=a?s-a:0}while(--t);t=a,i=t;do{s=e.prev[--i],e.prev[i]=s>=a?s-a:0}while(--t)};let qm=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const Bm=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},zm=(e,t)=>{mm(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Bm(e.strm)},jm=(e,t)=>{e.pending_buf[e.pending++]=t},$m=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Gm=(e,t,s,i)=>{let a=e.avail_in;return a>i&&(a=i),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),s),1===e.state.wrap?e.adler=nm(e.adler,t,a,s):2===e.state.wrap&&(e.adler=lm(e.adler,t,a,s)),e.next_in+=a,e.total_in+=a,a)},Km=(e,t)=>{let s,i,a=e.max_chain_length,n=e.strstart,o=e.prev_length,l=e.nice_match;const r=e.strstart>e.w_size-Dm?e.strstart-(e.w_size-Dm):0,d=e.window,c=e.w_mask,h=e.prev,m=e.strstart+Rm;let u=d[n+o-1],p=d[n+o];e.prev_length>=e.good_match&&(a>>=2),l>e.lookahead&&(l=e.lookahead);do{if(s=t,d[s+o]===p&&d[s+o-1]===u&&d[s]===d[n]&&d[++s]===d[n+1]){n+=2,s++;do{}while(d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&d[++n]===d[++s]&&n<m);if(i=Rm-(m-n),n=m-Rm,i>o){if(e.match_start=t,o=i,i>=l)break;u=d[n+o-1],p=d[n+o]}}}while((t=h[t&c])>r&&0!=--a);return o<=e.lookahead?o:e.lookahead},Jm=e=>{const t=e.w_size;let s,i,a;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Dm)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Hm(e),i+=t),0===e.strm.avail_in)break;if(s=Gm(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=qm(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=qm(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Dm&&0!==e.strm.avail_in)},Zm=(e,t)=>{let s,i,a,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,l=e.strm.avail_in;do{if(s=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,i=e.strstart-e.block_start,s>i+e.strm.avail_in&&(s=i+e.strm.avail_in),s>a&&(s=a),s<n&&(0===s&&t!==wm||t===gm||s!==i+e.strm.avail_in))break;o=t===wm&&s===i+e.strm.avail_in?1:0,hm(e,0,0,o),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Bm(e.strm),i&&(i>s&&(i=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,s-=i),s&&(Gm(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===o);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==gm&&t!==wm&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(Gm(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,n=a>e.w_size?e.w_size:a,i=e.strstart-e.block_start,(i>=n||(i||t===wm)&&t!==gm&&0===e.strm.avail_in&&i<=a)&&(s=i>a?a:i,o=t===wm&&0===e.strm.avail_in&&s===i?1:0,hm(e,e.block_start,s,o),e.block_start+=s,Bm(e.strm)),o?3:1)},Ym=(e,t)=>{let s,i;for(;;){if(e.lookahead<Dm){if(Jm(e),e.lookahead<Dm&&t===gm)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=qm(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-Dm&&(e.match_length=Km(e,s)),e.match_length>=3)if(i=um(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=qm(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=qm(e,e.ins_h,e.window[e.strstart+1]);else i=um(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(zm(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===wm?(zm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zm(e,!1),0===e.strm.avail_out)?1:2},Qm=(e,t)=>{let s,i,a;for(;;){if(e.lookahead<Dm){if(Jm(e),e.lookahead<Dm&&t===gm)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=qm(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Dm&&(e.match_length=Km(e,s),e.match_length<=5&&(e.strategy===km||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,i=um(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=qm(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(zm(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=um(e,0,e.window[e.strstart-1]),i&&zm(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=um(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===wm?(zm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zm(e,!1),0===e.strm.avail_out)?1:2};function Xm(e,t,s,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=i,this.func=a}const eu=[new Xm(0,0,0,0,Zm),new Xm(4,4,8,4,Ym),new Xm(4,5,16,8,Ym),new Xm(4,6,32,32,Ym),new Xm(4,4,16,16,Qm),new Xm(8,16,32,32,Qm),new Xm(8,16,128,128,Qm),new Xm(8,32,128,256,Qm),new Xm(32,128,258,1024,Qm),new Xm(32,258,258,4096,Qm)];function tu(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Am,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Om(this.dyn_ltree),Om(this.dyn_dtree),Om(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Om(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Om(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const su=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Mm&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Vm&&t.status!==Um?1:0},iu=e=>{if(su(e))return Wm(e,Sm);e.total_in=e.total_out=0,e.data_type=_m;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Mm:Vm,e.adler=2===t.wrap?0:1,t.last_flush=-2,cm(t),bm},au=e=>{const t=iu(e);var s;return t===bm&&((s=e.state).window_size=2*s.w_size,Om(s.head),s.max_lazy_match=eu[s.level].max_lazy,s.good_match=eu[s.level].good_length,s.nice_match=eu[s.level].nice_length,s.max_chain_length=eu[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},nu=(e,t,s,i,a,n)=>{if(!e)return Sm;let o=1;if(t===Pm&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>9||s!==Am||i<8||i>15||t<0||t>9||n<0||n>Tm||8===i&&1!==o)return Wm(e,Sm);8===i&&(i=9);const l=new tu;return e.state=l,l.strm=e,l.status=Mm,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=n,l.method=s,au(e)};var ou={deflateInit:(e,t)=>nu(e,t,Am,15,8,Nm),deflateInit2:nu,deflateReset:au,deflateResetKeep:iu,deflateSetHeader:(e,t)=>su(e)||2!==e.state.wrap?Sm:(e.state.gzhead=t,bm),deflate:(e,t)=>{if(su(e)||t>vm||t<0)return e?Wm(e,Sm):Sm;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===Um&&t!==wm)return Wm(e,0===e.avail_out?ym:Sm);const i=s.last_flush;if(s.last_flush=t,0!==s.pending){if(Bm(e),0===e.avail_out)return s.last_flush=-1,bm}else if(0===e.avail_in&&Fm(t)<=Fm(i)&&t!==wm)return Wm(e,ym);if(s.status===Um&&0!==e.avail_in)return Wm(e,ym);if(s.status===Mm&&0===s.wrap&&(s.status=Vm),s.status===Mm){let t=Am+(s.w_bits-8<<4)<<8,i=-1;if(i=s.strategy>=Cm||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=i<<6,0!==s.strstart&&(t|=32),t+=31-t%31,$m(s,t),0!==s.strstart&&($m(s,e.adler>>>16),$m(s,65535&e.adler)),e.adler=1,s.status=Vm,Bm(e),0!==s.pending)return s.last_flush=-1,bm}if(57===s.status)if(e.adler=0,jm(s,31),jm(s,139),jm(s,8),s.gzhead)jm(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),jm(s,255&s.gzhead.time),jm(s,s.gzhead.time>>8&255),jm(s,s.gzhead.time>>16&255),jm(s,s.gzhead.time>>24&255),jm(s,9===s.level?2:s.strategy>=Cm||s.level<2?4:0),jm(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(jm(s,255&s.gzhead.extra.length),jm(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=lm(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(jm(s,0),jm(s,0),jm(s,0),jm(s,0),jm(s,0),jm(s,9===s.level?2:s.strategy>=Cm||s.level<2?4:0),jm(s,3),s.status=Vm,Bm(e),0!==s.pending)return s.last_flush=-1,bm;if(69===s.status){if(s.gzhead.extra){let t=s.pending,i=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+i>s.pending_buf_size;){let a=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+a),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=lm(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=a,Bm(e),0!==s.pending)return s.last_flush=-1,bm;t=0,i-=a}let a=new Uint8Array(s.gzhead.extra);s.pending_buf.set(a.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending+=i,s.gzhead.hcrc&&s.pending>t&&(e.adler=lm(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=lm(e.adler,s.pending_buf,s.pending-i,i)),Bm(e),0!==s.pending)return s.last_flush=-1,bm;i=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,jm(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=lm(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=lm(e.adler,s.pending_buf,s.pending-i,i)),Bm(e),0!==s.pending)return s.last_flush=-1,bm;i=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,jm(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=lm(e.adler,s.pending_buf,s.pending-i,i))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Bm(e),0!==s.pending))return s.last_flush=-1,bm;jm(s,255&e.adler),jm(s,e.adler>>8&255),e.adler=0}if(s.status=Vm,Bm(e),0!==s.pending)return s.last_flush=-1,bm}if(0!==e.avail_in||0!==s.lookahead||t!==gm&&s.status!==Um){let i=0===s.level?Zm(s,t):s.strategy===Cm?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(Jm(e),0===e.lookahead)){if(t===gm)return 1;break}if(e.match_length=0,s=um(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(zm(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===wm?(zm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zm(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===Lm?((e,t)=>{let s,i,a,n;const o=e.window;for(;;){if(e.lookahead<=Rm){if(Jm(e),e.lookahead<=Rm&&t===gm)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,i=o[a],i===o[++a]&&i===o[++a]&&i===o[++a])){n=e.strstart+Rm;do{}while(i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&a<n);e.match_length=Rm-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=um(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=um(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(zm(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===wm?(zm(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(zm(e,!1),0===e.strm.avail_out)?1:2})(s,t):eu[s.level].func(s,t);if(3!==i&&4!==i||(s.status=Um),1===i||3===i)return 0===e.avail_out&&(s.last_flush=-1),bm;if(2===i&&(t===fm?pm(s):t!==vm&&(hm(s,0,0,!1),t===Im&&(Om(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),Bm(e),0===e.avail_out))return s.last_flush=-1,bm}return t!==wm?bm:s.wrap<=0?xm:(2===s.wrap?(jm(s,255&e.adler),jm(s,e.adler>>8&255),jm(s,e.adler>>16&255),jm(s,e.adler>>24&255),jm(s,255&e.total_in),jm(s,e.total_in>>8&255),jm(s,e.total_in>>16&255),jm(s,e.total_in>>24&255)):($m(s,e.adler>>>16),$m(s,65535&e.adler)),Bm(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?bm:xm)},deflateEnd:e=>{if(su(e))return Sm;const t=e.state.status;return e.state=null,t===Vm?Wm(e,Em):bm},deflateSetDictionary:(e,t)=>{let s=t.length;if(su(e))return Sm;const i=e.state,a=i.wrap;if(2===a||1===a&&i.status!==Mm||i.lookahead)return Sm;if(1===a&&(e.adler=nm(e.adler,t,s,0)),i.wrap=0,s>=i.w_size){0===a&&(Om(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(s-i.w_size,s),0),t=e,s=i.w_size}const n=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Jm(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=qm(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,Jm(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=l,e.avail_in=n,i.wrap=a,bm},deflateInfo:"pako deflate (from Nodeca project)"};const lu=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ru={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)lu(s,t)&&(e[t]=s[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,a=e.length;i<a;i++)t+=e[i].length;const s=new Uint8Array(t);for(let i=0,a=0,n=e.length;i<n;i++){let t=e[i];s.set(t,a),a+=t.length}return s}};let du=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Bf){du=!1}const cu=new Uint8Array(256);for(let zf=0;zf<256;zf++)cu[zf]=zf>=252?6:zf>=248?5:zf>=240?4:zf>=224?3:zf>=192?2:1;cu[254]=cu[254]=1;var hu={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,i,a,n,o=e.length,l=0;for(a=0;a<o;a++)s=e.charCodeAt(a),55296==(64512&s)&&a+1<o&&(i=e.charCodeAt(a+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),a++)),l+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(l),n=0,a=0;n<l;a++)s=e.charCodeAt(a),55296==(64512&s)&&a+1<o&&(i=e.charCodeAt(a+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),a++)),s<128?t[n++]=s:s<2048?(t[n++]=192|s>>>6,t[n++]=128|63&s):s<65536?(t[n++]=224|s>>>12,t[n++]=128|s>>>6&63,t[n++]=128|63&s):(t[n++]=240|s>>>18,t[n++]=128|s>>>12&63,t[n++]=128|s>>>6&63,t[n++]=128|63&s);return t},buf2string:(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,a;const n=new Array(2*s);for(a=0,i=0;i<s;){let t=e[i++];if(t<128){n[a++]=t;continue}let o=cu[t];if(o>4)n[a++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<s;)t=t<<6|63&e[i++],o--;o>1?n[a++]=65533:t<65536?n[a++]=t:(t-=65536,n[a++]=55296|t>>10&1023,n[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&du)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(e[i]);return s})(n,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+cu[e[s]]>t?s:t}};var mu=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const uu=Object.prototype.toString,{Z_NO_FLUSH:pu,Z_SYNC_FLUSH:gu,Z_FULL_FLUSH:fu,Z_FINISH:Iu,Z_OK:wu,Z_STREAM_END:vu,Z_DEFAULT_COMPRESSION:bu,Z_DEFAULT_STRATEGY:xu,Z_DEFLATED:Su}=dm;function Eu(e){this.options=ru.assign({level:bu,method:Su,chunkSize:16384,windowBits:15,memLevel:8,strategy:xu},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mu,this.strm.avail_out=0;let s=ou.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==wu)throw new Error(rm[s]);if(t.header&&ou.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?hu.string2buf(t.dictionary):"[object ArrayBuffer]"===uu.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=ou.deflateSetDictionary(this.strm,e),s!==wu)throw new Error(rm[s]);this._dict_set=!0}}function yu(e,t){const s=new Eu(t);if(s.push(e,!0),s.err)throw s.msg||rm[s.err];return s.result}Eu.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize;let a,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Iu:pu,"string"==typeof e?s.input=hu.string2buf(e):"[object ArrayBuffer]"===uu.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),(n===gu||n===fu)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(a=ou.deflate(s,n),a===vu)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),a=ou.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===wu;if(0!==s.avail_out){if(n>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},Eu.prototype.onData=function(e){this.chunks.push(e)},Eu.prototype.onEnd=function(e){e===wu&&(this.result=ru.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Pu={Deflate:Eu,deflate:yu,deflateRaw:function(e,t){return(t=t||{}).raw=!0,yu(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,yu(e,t)},constants:dm};const ku=16209;var Cu=function(e,t){let s,i,a,n,o,l,r,d,c,h,m,u,p,g,f,I,w,v,b,x,S,E,y,P;const k=e.state;s=e.next_in,y=e.input,i=s+(e.avail_in-5),a=e.next_out,P=e.output,n=a-(t-e.avail_out),o=a+(e.avail_out-257),l=k.dmax,r=k.wsize,d=k.whave,c=k.wnext,h=k.window,m=k.hold,u=k.bits,p=k.lencode,g=k.distcode,f=(1<<k.lenbits)-1,I=(1<<k.distbits)-1;e:do{u<15&&(m+=y[s++]<<u,u+=8,m+=y[s++]<<u,u+=8),w=p[m&f];t:for(;;){if(v=w>>>24,m>>>=v,u-=v,v=w>>>16&255,0===v)P[a++]=65535&w;else{if(!(16&v)){if(64&v){if(32&v){k.mode=16191;break e}e.msg="invalid literal/length code",k.mode=ku;break e}w=p[(65535&w)+(m&(1<<v)-1)];continue t}for(b=65535&w,v&=15,v&&(u<v&&(m+=y[s++]<<u,u+=8),b+=m&(1<<v)-1,m>>>=v,u-=v),u<15&&(m+=y[s++]<<u,u+=8,m+=y[s++]<<u,u+=8),w=g[m&I];;){if(v=w>>>24,m>>>=v,u-=v,v=w>>>16&255,16&v){if(x=65535&w,v&=15,u<v&&(m+=y[s++]<<u,u+=8,u<v&&(m+=y[s++]<<u,u+=8)),x+=m&(1<<v)-1,x>l){e.msg="invalid distance too far back",k.mode=ku;break e}if(m>>>=v,u-=v,v=a-n,x>v){if(v=x-v,v>d&&k.sane){e.msg="invalid distance too far back",k.mode=ku;break e}if(S=0,E=h,0===c){if(S+=r-v,v<b){b-=v;do{P[a++]=h[S++]}while(--v);S=a-x,E=P}}else if(c<v){if(S+=r+c-v,v-=c,v<b){b-=v;do{P[a++]=h[S++]}while(--v);if(S=0,c<b){v=c,b-=v;do{P[a++]=h[S++]}while(--v);S=a-x,E=P}}}else if(S+=c-v,v<b){b-=v;do{P[a++]=h[S++]}while(--v);S=a-x,E=P}for(;b>2;)P[a++]=E[S++],P[a++]=E[S++],P[a++]=E[S++],b-=3;b&&(P[a++]=E[S++],b>1&&(P[a++]=E[S++]))}else{S=a-x;do{P[a++]=P[S++],P[a++]=P[S++],P[a++]=P[S++],b-=3}while(b>2);b&&(P[a++]=P[S++],b>1&&(P[a++]=P[S++]))}break}if(64&v){e.msg="invalid distance code",k.mode=ku;break e}w=g[(65535&w)+(m&(1<<v)-1)]}}break}}while(s<i&&a<o);b=u>>3,s-=b,u-=b<<3,m&=(1<<u)-1,e.next_in=s,e.next_out=a,e.avail_in=s<i?i-s+5:5-(s-i),e.avail_out=a<o?o-a+257:257-(a-o),k.hold=m,k.bits=u};const Lu=15,Tu=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Nu=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_u=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Au=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ru=(e,t,s,i,a,n,o,l)=>{const r=l.bits;let d,c,h,m,u,p,g=0,f=0,I=0,w=0,v=0,b=0,x=0,S=0,E=0,y=0,P=null;const k=new Uint16Array(16),C=new Uint16Array(16);let L,T,N,_=null;for(g=0;g<=Lu;g++)k[g]=0;for(f=0;f<i;f++)k[t[s+f]]++;for(v=r,w=Lu;w>=1&&0===k[w];w--);if(v>w&&(v=w),0===w)return a[n++]=20971520,a[n++]=20971520,l.bits=1,0;for(I=1;I<w&&0===k[I];I++);for(v<I&&(v=I),S=1,g=1;g<=Lu;g++)if(S<<=1,S-=k[g],S<0)return-1;if(S>0&&(0===e||1!==w))return-1;for(C[1]=0,g=1;g<Lu;g++)C[g+1]=C[g]+k[g];for(f=0;f<i;f++)0!==t[s+f]&&(o[C[t[s+f]]++]=f);if(0===e?(P=_=o,p=20):1===e?(P=Tu,_=Nu,p=257):(P=_u,_=Au,p=0),y=0,f=0,g=I,u=n,b=v,x=0,h=-1,E=1<<v,m=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){L=g-x,o[f]+1<p?(T=0,N=o[f]):o[f]>=p?(T=_[o[f]-p],N=P[o[f]-p]):(T=96,N=0),d=1<<g-x,c=1<<b,I=c;do{c-=d,a[u+(y>>x)+c]=L<<24|T<<16|N}while(0!==c);for(d=1<<g-1;y&d;)d>>=1;if(0!==d?(y&=d-1,y+=d):y=0,f++,0==--k[g]){if(g===w)break;g=t[s+o[f]]}if(g>v&&(y&m)!==h){for(0===x&&(x=v),u+=I,b=g-x,S=1<<b;b+x<w&&(S-=k[b+x],!(S<=0));)b++,S<<=1;if(E+=1<<b,1===e&&E>852||2===e&&E>592)return 1;h=y&m,a[h]=v<<24|b<<16|u-n}}return 0!==y&&(a[u+y]=g-x<<24|64<<16),l.bits=v,0};const{Z_FINISH:Du,Z_BLOCK:Mu,Z_TREES:Vu,Z_OK:Uu,Z_STREAM_END:Wu,Z_NEED_DICT:Fu,Z_STREAM_ERROR:Ou,Z_DATA_ERROR:Hu,Z_MEM_ERROR:qu,Z_BUF_ERROR:Bu,Z_DEFLATED:zu}=dm,ju=16180,$u=16190,Gu=16191,Ku=16192,Ju=16194,Zu=16199,Yu=16200,Qu=16206,Xu=16209,ep=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function tp(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const sp=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<ju||t.mode>16211?1:0},ip=e=>{if(sp(e))return Ou;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ju,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Uu},ap=e=>{if(sp(e))return Ou;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ip(e)},np=(e,t)=>{let s;if(sp(e))return Ou;const i=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ou:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=s,i.wbits=t,ap(e))},op=(e,t)=>{if(!e)return Ou;const s=new tp;e.state=s,s.strm=e,s.window=null,s.mode=ju;const i=np(e,t);return i!==Uu&&(e.state=null),i};let lp,rp,dp=!0;const cp=e=>{if(dp){lp=new Int32Array(512),rp=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ru(1,e.lens,0,288,lp,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ru(2,e.lens,0,32,rp,0,e.work,{bits:5}),dp=!1}e.lencode=lp,e.lenbits=9,e.distcode=rp,e.distbits=5},hp=(e,t,s,i)=>{let a;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(t.subarray(s-n.wsize,s),0),n.wnext=0,n.whave=n.wsize):(a=n.wsize-n.wnext,a>i&&(a=i),n.window.set(t.subarray(s-i,s-i+a),n.wnext),(i-=a)?(n.window.set(t.subarray(s-i,s),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0};var mp={inflateReset:ap,inflateReset2:np,inflateResetKeep:ip,inflateInit:e=>op(e,15),inflateInit2:op,inflate:(e,t)=>{let s,i,a,n,o,l,r,d,c,h,m,u,p,g,f,I,w,v,b,x,S,E,y=0;const P=new Uint8Array(4);let k,C;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(sp(e)||!e.output||!e.input&&0!==e.avail_in)return Ou;s=e.state,s.mode===Gu&&(s.mode=Ku),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,d=s.hold,c=s.bits,h=l,m=r,E=Uu;e:for(;;)switch(s.mode){case ju:if(0===s.wrap){s.mode=Ku;break}for(;c<16;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(2&s.wrap&&35615===d){0===s.wbits&&(s.wbits=15),s.check=0,P[0]=255&d,P[1]=d>>>8&255,s.check=lm(s.check,P,2,0),d=0,c=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",s.mode=Xu;break}if((15&d)!==zu){e.msg="unknown compression method",s.mode=Xu;break}if(d>>>=4,c-=4,S=8+(15&d),0===s.wbits&&(s.wbits=S),S>15||S>s.wbits){e.msg="invalid window size",s.mode=Xu;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&d?16189:Gu,d=0,c=0;break;case 16181:for(;c<16;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(s.flags=d,(255&s.flags)!==zu){e.msg="unknown compression method",s.mode=Xu;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=Xu;break}s.head&&(s.head.text=d>>8&1),512&s.flags&&4&s.wrap&&(P[0]=255&d,P[1]=d>>>8&255,s.check=lm(s.check,P,2,0)),d=0,c=0,s.mode=16182;case 16182:for(;c<32;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}s.head&&(s.head.time=d),512&s.flags&&4&s.wrap&&(P[0]=255&d,P[1]=d>>>8&255,P[2]=d>>>16&255,P[3]=d>>>24&255,s.check=lm(s.check,P,4,0)),d=0,c=0,s.mode=16183;case 16183:for(;c<16;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}s.head&&(s.head.xflags=255&d,s.head.os=d>>8),512&s.flags&&4&s.wrap&&(P[0]=255&d,P[1]=d>>>8&255,s.check=lm(s.check,P,2,0)),d=0,c=0,s.mode=16184;case 16184:if(1024&s.flags){for(;c<16;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}s.length=d,s.head&&(s.head.extra_len=d),512&s.flags&&4&s.wrap&&(P[0]=255&d,P[1]=d>>>8&255,s.check=lm(s.check,P,2,0)),d=0,c=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(u=s.length,u>l&&(u=l),u&&(s.head&&(S=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(i.subarray(n,n+u),S)),512&s.flags&&4&s.wrap&&(s.check=lm(s.check,i,u,n)),l-=u,n+=u,s.length-=u),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===l)break e;u=0;do{S=i[n+u++],s.head&&S&&s.length<65536&&(s.head.name+=String.fromCharCode(S))}while(S&&u<l);if(512&s.flags&&4&s.wrap&&(s.check=lm(s.check,i,u,n)),l-=u,n+=u,S)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===l)break e;u=0;do{S=i[n+u++],s.head&&S&&s.length<65536&&(s.head.comment+=String.fromCharCode(S))}while(S&&u<l);if(512&s.flags&&4&s.wrap&&(s.check=lm(s.check,i,u,n)),l-=u,n+=u,S)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;c<16;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(4&s.wrap&&d!==(65535&s.check)){e.msg="header crc mismatch",s.mode=Xu;break}d=0,c=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=Gu;break;case 16189:for(;c<32;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}e.adler=s.check=ep(d),d=0,c=0,s.mode=$u;case $u:if(0===s.havedict)return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=d,s.bits=c,Fu;e.adler=s.check=1,s.mode=Gu;case Gu:if(t===Mu||t===Vu)break e;case Ku:if(s.last){d>>>=7&c,c-=7&c,s.mode=Qu;break}for(;c<3;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}switch(s.last=1&d,d>>>=1,c-=1,3&d){case 0:s.mode=16193;break;case 1:if(cp(s),s.mode=Zu,t===Vu){d>>>=2,c-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=Xu}d>>>=2,c-=2;break;case 16193:for(d>>>=7&c,c-=7&c;c<32;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",s.mode=Xu;break}if(s.length=65535&d,d=0,c=0,s.mode=Ju,t===Vu)break e;case Ju:s.mode=16195;case 16195:if(u=s.length,u){if(u>l&&(u=l),u>r&&(u=r),0===u)break e;a.set(i.subarray(n,n+u),o),l-=u,n+=u,r-=u,o+=u,s.length-=u;break}s.mode=Gu;break;case 16196:for(;c<14;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(s.nlen=257+(31&d),d>>>=5,c-=5,s.ndist=1+(31&d),d>>>=5,c-=5,s.ncode=4+(15&d),d>>>=4,c-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=Xu;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;c<3;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}s.lens[L[s.have++]]=7&d,d>>>=3,c-=3}for(;s.have<19;)s.lens[L[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,k={bits:s.lenbits},E=Ru(0,s.lens,0,19,s.lencode,0,s.work,k),s.lenbits=k.bits,E){e.msg="invalid code lengths set",s.mode=Xu;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;y=s.lencode[d&(1<<s.lenbits)-1],f=y>>>24,I=y>>>16&255,w=65535&y,!(f<=c);){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(w<16)d>>>=f,c-=f,s.lens[s.have++]=w;else{if(16===w){for(C=f+2;c<C;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(d>>>=f,c-=f,0===s.have){e.msg="invalid bit length repeat",s.mode=Xu;break}S=s.lens[s.have-1],u=3+(3&d),d>>>=2,c-=2}else if(17===w){for(C=f+3;c<C;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}d>>>=f,c-=f,S=0,u=3+(7&d),d>>>=3,c-=3}else{for(C=f+7;c<C;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}d>>>=f,c-=f,S=0,u=11+(127&d),d>>>=7,c-=7}if(s.have+u>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=Xu;break}for(;u--;)s.lens[s.have++]=S}}if(s.mode===Xu)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=Xu;break}if(s.lenbits=9,k={bits:s.lenbits},E=Ru(1,s.lens,0,s.nlen,s.lencode,0,s.work,k),s.lenbits=k.bits,E){e.msg="invalid literal/lengths set",s.mode=Xu;break}if(s.distbits=6,s.distcode=s.distdyn,k={bits:s.distbits},E=Ru(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,k),s.distbits=k.bits,E){e.msg="invalid distances set",s.mode=Xu;break}if(s.mode=Zu,t===Vu)break e;case Zu:s.mode=Yu;case Yu:if(l>=6&&r>=258){e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=d,s.bits=c,Cu(e,m),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,d=s.hold,c=s.bits,s.mode===Gu&&(s.back=-1);break}for(s.back=0;y=s.lencode[d&(1<<s.lenbits)-1],f=y>>>24,I=y>>>16&255,w=65535&y,!(f<=c);){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(I&&!(240&I)){for(v=f,b=I,x=w;y=s.lencode[x+((d&(1<<v+b)-1)>>v)],f=y>>>24,I=y>>>16&255,w=65535&y,!(v+f<=c);){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}d>>>=v,c-=v,s.back+=v}if(d>>>=f,c-=f,s.back+=f,s.length=w,0===I){s.mode=16205;break}if(32&I){s.back=-1,s.mode=Gu;break}if(64&I){e.msg="invalid literal/length code",s.mode=Xu;break}s.extra=15&I,s.mode=16201;case 16201:if(s.extra){for(C=s.extra;c<C;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}s.length+=d&(1<<s.extra)-1,d>>>=s.extra,c-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;y=s.distcode[d&(1<<s.distbits)-1],f=y>>>24,I=y>>>16&255,w=65535&y,!(f<=c);){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(!(240&I)){for(v=f,b=I,x=w;y=s.distcode[x+((d&(1<<v+b)-1)>>v)],f=y>>>24,I=y>>>16&255,w=65535&y,!(v+f<=c);){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}d>>>=v,c-=v,s.back+=v}if(d>>>=f,c-=f,s.back+=f,64&I){e.msg="invalid distance code",s.mode=Xu;break}s.offset=w,s.extra=15&I,s.mode=16203;case 16203:if(s.extra){for(C=s.extra;c<C;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}s.offset+=d&(1<<s.extra)-1,d>>>=s.extra,c-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=Xu;break}s.mode=16204;case 16204:if(0===r)break e;if(u=m-r,s.offset>u){if(u=s.offset-u,u>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=Xu;break}u>s.wnext?(u-=s.wnext,p=s.wsize-u):p=s.wnext-u,u>s.length&&(u=s.length),g=s.window}else g=a,p=o-s.offset,u=s.length;u>r&&(u=r),r-=u,s.length-=u;do{a[o++]=g[p++]}while(--u);0===s.length&&(s.mode=Yu);break;case 16205:if(0===r)break e;a[o++]=s.length,r--,s.mode=Yu;break;case Qu:if(s.wrap){for(;c<32;){if(0===l)break e;l--,d|=i[n++]<<c,c+=8}if(m-=r,e.total_out+=m,s.total+=m,4&s.wrap&&m&&(e.adler=s.check=s.flags?lm(s.check,a,m,o-m):nm(s.check,a,m,o-m)),m=r,4&s.wrap&&(s.flags?d:ep(d))!==s.check){e.msg="incorrect data check",s.mode=Xu;break}d=0,c=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;c<32;){if(0===l)break e;l--,d+=i[n++]<<c,c+=8}if(4&s.wrap&&d!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=Xu;break}d=0,c=0}s.mode=16208;case 16208:E=Wu;break e;case Xu:E=Hu;break e;case 16210:return qu;default:return Ou}return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=d,s.bits=c,(s.wsize||m!==e.avail_out&&s.mode<Xu&&(s.mode<Qu||t!==Du))&&hp(e,e.output,e.next_out,m-e.avail_out),h-=e.avail_in,m-=e.avail_out,e.total_in+=h,e.total_out+=m,s.total+=m,4&s.wrap&&m&&(e.adler=s.check=s.flags?lm(s.check,a,m,e.next_out-m):nm(s.check,a,m,e.next_out-m)),e.data_type=s.bits+(s.last?64:0)+(s.mode===Gu?128:0)+(s.mode===Zu||s.mode===Ju?256:0),(0===h&&0===m||t===Du)&&E===Uu&&(E=Bu),E},inflateEnd:e=>{if(sp(e))return Ou;let t=e.state;return t.window&&(t.window=null),e.state=null,Uu},inflateGetHeader:(e,t)=>{if(sp(e))return Ou;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,Uu):Ou},inflateSetDictionary:(e,t)=>{const s=t.length;let i,a,n;return sp(e)?Ou:(i=e.state,0!==i.wrap&&i.mode!==$u?Ou:i.mode===$u&&(a=1,a=nm(a,t,s,0),a!==i.check)?Hu:(n=hp(e,t,s,s),n?(i.mode=16210,qu):(i.havedict=1,Uu)))},inflateInfo:"pako inflate (from Nodeca project)"};var up=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const pp=Object.prototype.toString,{Z_NO_FLUSH:gp,Z_FINISH:fp,Z_OK:Ip,Z_STREAM_END:wp,Z_NEED_DICT:vp,Z_STREAM_ERROR:bp,Z_DATA_ERROR:xp,Z_MEM_ERROR:Sp}=dm;function Ep(e){this.options=ru.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mu,this.strm.avail_out=0;let s=mp.inflateInit2(this.strm,t.windowBits);if(s!==Ip)throw new Error(rm[s]);if(this.header=new up,mp.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=hu.string2buf(t.dictionary):"[object ArrayBuffer]"===pp.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=mp.inflateSetDictionary(this.strm,t.dictionary),s!==Ip)))throw new Error(rm[s])}function yp(e,t){const s=new Ep(t);if(s.push(e),s.err)throw s.msg||rm[s.err];return s.result}Ep.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize,a=this.options.dictionary;let n,o,l;if(this.ended)return!1;for(o=t===~~t?t:!0===t?fp:gp,"[object ArrayBuffer]"===pp.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),n=mp.inflate(s,o),n===vp&&a&&(n=mp.inflateSetDictionary(s,a),n===Ip?n=mp.inflate(s,o):n===xp&&(n=vp));s.avail_in>0&&n===wp&&s.state.wrap>0&&0!==e[s.next_in];)mp.inflateReset(s),n=mp.inflate(s,o);switch(n){case bp:case xp:case vp:case Sp:return this.onEnd(n),this.ended=!0,!1}if(l=s.avail_out,s.next_out&&(0===s.avail_out||n===wp))if("string"===this.options.to){let e=hu.utf8border(s.output,s.next_out),t=s.next_out-e,a=hu.buf2string(s.output,e);s.next_out=t,s.avail_out=i-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(a)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(n!==Ip||0!==l){if(n===wp)return n=mp.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Ep.prototype.onData=function(e){this.chunks.push(e)},Ep.prototype.onEnd=function(e){e===Ip&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ru.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Pp={Inflate:Ep,inflate:yp,inflateRaw:function(e,t){return(t=t||{}).raw=!0,yp(e,t)},ungzip:yp,constants:dm};const{Deflate:kp,deflate:Cp,deflateRaw:Lp,gzip:Tp}=Pu,{Inflate:Np,inflate:_p,inflateRaw:Ap,ungzip:Rp}=Pp;var Dp={Deflate:kp,deflate:Cp,deflateRaw:Lp,gzip:Tp,Inflate:Np,inflate:_p,inflateRaw:Ap,ungzip:Rp,constants:dm};const Mp={footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class Vp extends g{constructor(e,t,s={disposeOnClose:!0}){super(e,"modal"),this.isOpen=!1,this.onHideCallbacks=[],this.modalConfig={...Mp,...s};const i=I(),a=I(),n=I(),o=I(),l=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.appendChild(f("div",{className:`modal-dialog ${t} ${l} ${this.modalConfig.scrollContents?"modal-overflow-scroll":""}`,ref:i},f("div",{className:"modal-content"},f("div",{className:"modal-header "+(this.modalConfig.header||this.modalConfig.title?"":"p-0 border-0"),ref:a},this.modalConfig.title&&f("h5",{className:"modal-title"},this.modalConfig.title),f("button",{type:"button",className:"btn-close "+(this.modalConfig.closeButton?.fixed?"position-fixed":""),onclick:()=>this.close(),attributes:{"aria-label":"Close"}},f("i",{className:"fas fa-times fa-2xl"}))),f("div",{className:"modal-body",ref:n}),this.modalConfig.footer&&f("div",{className:"modal-footer",ref:o})))),this.dialog=i.value,this.header=a.value,this.body=n.value,this.footer=o.value,this.modal=new en(this.rootElem),this.modalConfig.disposeOnClose&&this.rootElem.addEventListener("hidden.bs.modal",(()=>{this.rootElem.remove(),this.dispose()}),{once:!0})}open(){const e=this.closeModalOnEscKey.bind(this),t=this.showBSFn.bind(this),s=this.hideBSFn.bind(this),i=this.hiddenBSFn.bind(this);document.addEventListener("keydown",e),this.rootElem.addEventListener("show.bs.modal",t),this.rootElem.addEventListener("hide.bs.modal",s),this.rootElem.addEventListener("hidden.bs.modal",i),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("show.bs.modal",t))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hide.bs.modal",s))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hidden.bs.modal",i))),this.modal.show(),this.isOpen=!0}close(){this.modal.hide(),this.isOpen=!1}addOnHideCallback(e){this.onHideCallbacks.push(e)}onShow(e){}onHide(e){this.onHideCallbacks.forEach((e=>e()))}async showBSFn(e){e.stopImmediatePropagation();const t=await new Promise((e=>{setTimeout((()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)}hideBSFn(e){e.stopImmediatePropagation(),this.onHide(e)}hiddenBSFn(e){e.stopPropagation()}closeModalOnEscKey(e){"Escape"==e.key&&this.close()}}class Up{constructor(e){const{title:t,variant:s,autoShow:i=!0,canClose:a=!0,body:n,additionalClasses:o,container:l,...r}=e||{};this.container=l||document.getElementById("toastContainer"),this.additionalClasses=o,this.title=t||"WoWSims",this.variant=s||"info",this.body=n,this.canClose=a,this.element=this.template(),this.container.appendChild(this.element),this.instance=tn.getOrCreateInstance(this.element,{delay:3e3,...r}),i&&this.instance.show(),this.element.addEventListener("hidden.bs.toast",(()=>{this.destroy()}))}destroy(){this.instance.dispose(),this.element.remove()}show(){this.instance.show()}hide(){this.instance.hide()}getVariantIcon(){switch(this.variant){case"info":return"fa-info-circle";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";case"warning":return"fa-triangle-exclamation"}}template(){return f("div",{className:Pt("toast position-relative bottom-0 end-0",`toast--${this.variant}`,this.additionalClasses),attributes:{role:"alert","aria-live":"assertive","aria-atomic":"true"}},f("div",{className:"toast-header"},f("i",{className:`d-block fas fa-2xl me-2 ${this.getVariantIcon()}`}),f("strong",{className:"me-auto"},this.title),this.canClose&&f("a",{href:"javascript:void(0);",className:"btn-close",attributes:{role:"button","aria-label":"Close"},dataset:{bsDismiss:"toast"},"aria-label":"Close"},f("i",{className:`fas fa-times fa-1xl ${this.getVariantIcon()}`}))),f("div",{className:"toast-body"},this.body))}}class Wp extends Vp{constructor(e,t,s,i){super(e,"importer",{title:s,footer:!0,disposeOnClose:!1}),this.includeFile=i;const a="upload-input-"+s.toLowerCase().replaceAll(" ","-"),n=I(),o=I(),l=I(),r=I();this.body.replaceChildren(f(x,null,f("div",{ref:n,className:"import-description"}),f("textarea",{ref:o,className:"importer-textarea form-control",attributes:{spellcheck:!1}}))),this.footer.appendChild(f(x,null,this.includeFile&&f(x,null,f("label",{htmlFor:a,className:"importer-button btn btn-primary upload-button me-2"},f("i",{className:"fas fa-file-arrow-up me-1"}),"Upload File"),f("input",{ref:r,type:"file",id:a,className:"importer-upload-input d-none",hidden:!0})),f("button",{ref:l,className:"importer-button btn btn-primary import-button"},f("i",{className:"fa fa-download me-1"}),"Import"))),this.descriptionElem=n.value,this.textElem=o.value,this.includeFile&&r.value&&r.value.addEventListener("change",(async e=>{this.textElem.textContent=await e.target.files[0].text()})),this.importButton=l.value,this.importButton.addEventListener("click",(async e=>{try{await this.onImport(this.textElem.value||"")}catch(t){new Up({variant:"error",body:`Import error: ${t?.message||t}`})}}))}async finishIndividualImport(e,t,s,i,n,o){const l=e.player.getClass();if(t!=l)throw new Error(`Wrong Class! Expected ${Rt.get(l)} but found ${Rt.get(t)}!`);await ae.loadLeftoversIfNecessary(i);const r=e.sim.db.lookupEquipmentSpec(i),d=i.items.map((e=>e.enchant)),c=r.asSpec().items.map((e=>e.enchant)),h=d.filter((e=>0!=e&&!c.includes(e))),m=i.items.map((e=>e.id)),u=r.asSpec().items.map((e=>e.id)),p=m.filter((e=>!u.includes(e))),g=a.nextEventID();a.freezeAllAndDo((()=>{e.player.setRace(g,s),e.player.setGear(g,r),n&&"--"!=n&&e.player.setTalentsString(g,n),o.length>0&&e.player.setProfessions(g,o)})),this.close(),0==p.length&&0==h.length?alert("Import successful!"):alert("Import successful, but the following IDs were not found in the sim database:"+(0==p.length?"":"\n\nItems: "+p.join(", "))+(0==h.length?"":"\n\nEnchants: "+h.join(", ")))}}const Fp=class e{static tryParseUrlLocation(t){let s=t.hash;if(s.length<=1)return null;s=s.substring(1);const i=atob(s),a=new Uint8Array(i.length);for(let e=0;e<a.length;e++)a[e]=i.charCodeAt(e);const n=Dp.inflate(a),o=kt.fromBinary(n);let l=e.DEFAULT_CATEGORIES;const r=new URLSearchParams(window.location.search);if(r.has(e.CATEGORY_PARAM)){l=r.get(e.CATEGORY_PARAM).split("").map((t=>[...e.CATEGORY_KEYS.entries()].find((e=>e[1]==t)))).filter((e=>e)).map((e=>e[0]))}return{settings:o,categories:l}}};Fp.DEFAULT_CATEGORIES=d(zn).filter((e=>e!=zn.UISettings)),Fp.CATEGORY_PARAM="i",Fp.CATEGORY_KEYS=(()=>{const e=new Map;return e.set(zn.Gear,"g"),e.set(zn.Talents,"t"),e.set(zn.Rotation,"r"),e.set(zn.Consumes,"c"),e.set(zn.Miscellaneous,"m"),e.set(zn.External,"x"),e.set(zn.Encounter,"e"),e.set(zn.UISettings,"u"),e})();let Op=Fp;class Hp extends Wp{constructor(e,t){super(e,t,"JSON Import",!0),this.simUI=t,this.descriptionElem.innerHTML="\n\t\t\t<p>Import settings from a JSON file, which can be created using the JSON Export feature.</p>\n\t\t\t<p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n\t\t"}async onImport(e){const t=kt.fromJsonString(e,{ignoreUnknownFields:!0});t.player?.equipment&&await ae.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(a.nextEventID(),t.player):this.simUI.fromProto(a.nextEventID(),t),this.close()}}class qp extends Wp{constructor(e,t){super(e,t,"Sixty Upgrades SoD Import",!0),this.simUI=t,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from <a href="https://sixtyupgrades.com/sod/" target="_blank">Sixty Upgrades Season of Discovery</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the site\'s export option below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}onImport(e){const t=JSON.parse(e),s=Ct(t?.character?.gameClass||"");if(s==l.ClassUnknown)throw new Error("Could not parse Class!");const i=Lt(t?.character?.race||"");if(i==Tt.RaceUnknown)throw new Error("Could not parse Race!");let a="";if(t?.talents?.length>0){a=function(e,t){return Tn[e].map((e=>e.talents.map((e=>{const s=e.spellIds.findIndex((e=>t.includes(e)));return-1==s?"0":String(s+1)})).join("").replace(/0+$/g,""))).join("-").replace(/-+$/g,"")}(s,t.talents.map((e=>e.spellId)))}const n=_t.create();t.items.forEach((e=>{const t=At.create();t.id=e.id,e.enchant?.id&&(t.enchant=e.enchant.id),n.items.push(t)})),this.simUI.sim.db.lookupEquipmentSpec(n),this.finishIndividualImport(this.simUI,s,i,n,a,[])}}const Bp=class e extends Wp{constructor(e,t){super(e,t,"Wowhead Import",!0),this.simUI=t,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from <a href="https://www.wowhead.com/classic/gear-planner" target="_blank">Wowhead Gear Planner</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the gear planner link below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}onImport(t){const s=t.match(/www\.wowhead\.com\/classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/);if(!s)throw new Error(`Invalid WCL URL ${t}, must look like "https://www.wowhead.com/classic/gear-planner/CLASS/RACE/XXXX"`);const i=Ct(s[1].replaceAll("-",""));if(i==l.ClassUnknown)throw new Error("Could not parse Class: "+s[1]);const a=Lt(s[2].replaceAll("-",""));if(a==Tt.RaceUnknown)throw new Error("Could not parse Race: "+s[2]);const n=s[3].replaceAll("_","/").replaceAll("-","+"),o=Uint8Array.from(atob(n),(e=>e.charCodeAt(0))),r=o[3],d=o.subarray(4,4+r),c=Nt(d).split("f").slice(0,3).join("-"),h=o.subarray(r),m=_t.create();let u=0;for(;u<h.length;){const t=At.create(),s=63&h[u],i=Boolean(128&h[u]);u++;const a=31&h[u];if(u++,t.id=(a<<16)+(h[u]<<8)+h[u+1],u+=2,i){const e=(h[u]<<16)+(h[u+1]<<8)+h[u+2];t.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(e),u+=3}null!=Object.entries(e.slotIDs).find((e=>e[1]==s))&&m.items.push(t)}this.simUI.sim.db.lookupEquipmentSpec(m),this.finishIndividualImport(this.simUI,i,a,m,c,[])}};Bp.slotIDs={[D.ItemSlotHead]:1,[D.ItemSlotNeck]:2,[D.ItemSlotShoulder]:3,[D.ItemSlotBack]:15,[D.ItemSlotChest]:5,[D.ItemSlotWrist]:9,[D.ItemSlotHands]:10,[D.ItemSlotWaist]:6,[D.ItemSlotLegs]:7,[D.ItemSlotFeet]:8,[D.ItemSlotFinger1]:11,[D.ItemSlotFinger2]:12,[D.ItemSlotTrinket1]:13,[D.ItemSlotTrinket2]:14,[D.ItemSlotMainHand]:16,[D.ItemSlotOffHand]:17,[D.ItemSlotRanged]:18};class zp extends Wp{constructor(e,t){super(e,t,"Addon Import",!0),this.simUI=t,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from the <a href="https://www.curseforge.com/wow/addons/wowsimsexporter" target="_blank">WoWSims Importer In-Game Addon</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, talents, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the addon below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}async onImport(e){const t=JSON.parse(e),s=Ct(t.class||"");if(s==l.ClassUnknown)throw new Error("Could not parse Class!");const i=Lt(t.race||"");if(i==Tt.RaceUnknown)throw new Error("Could not parse Race!");const a=t.professions.map((e=>Dt(e.name)));a.forEach(((e,s)=>{if(e==F.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[s]}'`)}));const n=t.talents||"",o=t.gear;delete o.version,o.items=o.items.filter((e=>null!=e));const r=_t.fromJson(o);this.finishIndividualImport(this.simUI,s,i,r,n,a)}}class jp extends Vp{constructor(e,t,s){if(super(e,"exporter",{title:s.title,header:!0,footer:!0}),this.changedEvent=new a,this.body.innerHTML='\n\t\t\t<textarea spellCheck="false" class="exporter-textarea form-control"></textarea>\n\t\t',this.textElem=this.rootElem.getElementsByClassName("exporter-textarea")[0],new pn(this.footer,{extraCssClasses:["btn-primary","me-2"],getContent:()=>this.textElem.innerHTML,text:"Copy",tooltip:"Copy to clipboard"}),s.allowDownload){const e=I();this.footer.appendChild(f("button",{className:"exporter-button btn btn-primary download-button",ref:e},f("i",{className:"fa fa-download me-1"}),"Download"));e.value.addEventListener("click",(e=>{const t=this.textElem.textContent;Ut(t,"wowsims.json")}))}}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const $p=class e extends jp{constructor(t,s){super(t,s,{title:"Sharable Link"}),this.simUI=s;const i={};d(zn).forEach((e=>i[e]=Op.DEFAULT_CATEGORIES.includes(e))),this.exportCategories=i;const a=document.createElement("div");a.classList.add("link-exporter-pickers"),this.body.prepend(a),e.exportPickerConfigs.forEach((e=>{const t=e.category;new pt(a,this,{id:`link-exporter-${t}`,label:e.label,labelTooltip:e.labelTooltip,inline:!0,getValue:()=>this.exportCategories[t],setValue:(e,s,i)=>{this.exportCategories[t]=i,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})}))}open(){super.open(),this.init()}getData(){return e.createLink(this.simUI,d(zn).filter((e=>this.exportCategories[e])))}static createLink(e,t){t||(t=Op.DEFAULT_CATEGORIES);const s=e.toProto(t),i=kt.toBinary(s),a=Dp.deflate(i,{to:"string"}),n=btoa(String.fromCharCode(...a)),o=new URL(window.location.href);if(o.hash=n,Mt(t,Op.DEFAULT_CATEGORIES))o.searchParams.delete(Op.CATEGORY_PARAM);else{const e=t.map((e=>Op.CATEGORY_KEYS.get(e))).join("");o.searchParams.set(Op.CATEGORY_PARAM,e)}return o.toString()}};$p.exportPickerConfigs=[{category:zn.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:zn.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:zn.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:zn.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:zn.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:zn.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:zn.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}];let Gp=$p;class Kp extends jp{constructor(e,t){super(e,t,{title:"JSON Export",allowDownload:!0}),this.simUI=t}open(){super.open(),this.init()}getData(){return Wt(kt.toJson(this.simUI.toProto()),2,((e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every(((e,s)=>t[s]==e))||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3))}}const Jp=class e extends jp{constructor(e,t){super(e,t,{title:"80Upgrades EP Export",allowDownload:!0}),this.simUI=t}open(){super.open(),this.init()}getData(){const t=this.simUI.player,s=t.getEpWeights(),i=mn.getAll(),a={};return i.forEach((t=>{const i=e.getName(t),n=s.getUnitStat(t);0!=n&&""!=i&&(a[i]?a[i]+=n:a[i]=n)})),`https://eightyupgrades.com/ep/import?name=${encodeURIComponent(`${Vt[t.spec]} WoWSims Weights`)}`+Object.keys(a).map((e=>`&${e}=${a[e].toFixed(3)}`)).join("")}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};Jp.statNames={[c.StatStrength]:"strength",[c.StatAgility]:"agility",[c.StatStamina]:"stamina",[c.StatIntellect]:"intellect",[c.StatSpirit]:"spirit",[c.StatSpellPower]:"spellPower",[c.StatSpellDamage]:"spellDamage",[c.StatArcanePower]:"arcaneDamage",[c.StatHolyPower]:"holyDamage",[c.StatFirePower]:"fireDamage",[c.StatFrostPower]:"frostDamage",[c.StatNaturePower]:"natureDamage",[c.StatShadowPower]:"shadowDamage",[c.StatMP5]:"mp5",[c.StatSpellHit]:"hitRating",[c.StatSpellCrit]:"critRating",[c.StatSpellHaste]:"hasteRating",[c.StatSpellPenetration]:"spellPen",[c.StatAttackPower]:"attackPower",[c.StatMeleeHit]:"hitRating",[c.StatMeleeCrit]:"critRating",[c.StatMeleeHaste]:"hasteRating",[c.StatArmorPenetration]:"armorPenRating",[c.StatExpertise]:"expertiseRating",[c.StatMana]:"mana",[c.StatEnergy]:"energy",[c.StatRage]:"rage",[c.StatArmor]:"armor",[c.StatRangedAttackPower]:"attackPower",[c.StatDefense]:"defenseRating",[c.StatBlock]:"blockRating",[c.StatBlockValue]:"blockValue",[c.StatDodge]:"dodgeRating",[c.StatParry]:"parryRating",[c.StatResilience]:"resilienceRating",[c.StatHealth]:"health",[c.StatArcaneResistance]:"arcaneResistance",[c.StatFireResistance]:"fireResistance",[c.StatFrostResistance]:"frostResistance",[c.StatNatureResistance]:"natureResistance",[c.StatShadowResistance]:"shadowResistance",[c.StatBonusArmor]:"armorBonus",[c.StatHealingPower]:"Healing",[c.StatFeralAttackPower]:"feralAttackPower"},Jp.pseudoStatNames={[h.PseudoStatMainHandDps]:"dps",[h.PseudoStatRangedDps]:"rangedDps"};let Zp=Jp;const Yp=class e extends jp{constructor(e,t){super(e,t,{title:"Pawn EP Export",allowDownload:!0}),this.simUI=t}open(){super.open(),this.init()}getData(){const t=this.simUI.player,s=t.getEpWeights(),i=mn.getAll(),a={};return i.forEach((t=>{const i=e.getName(t),n=s.getUnitStat(t);0!=n&&""!=i&&(a[i]?a[i]+=n:a[i]=n)})),`( Pawn: v1: "${Vt[t.spec]} WoWSims Weights": Class=${Rt.get(t.getClass())},`+Object.keys(a).map((e=>`${e}=${a[e].toFixed(3)}`)).join(",")+" )"}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};Yp.statNames={[c.StatStrength]:"Strength",[c.StatAgility]:"Agility",[c.StatStamina]:"Stamina",[c.StatIntellect]:"Intellect",[c.StatSpirit]:"Spirit",[c.StatSpellPower]:"SpellDamage",[c.StatSpellDamage]:"SpellDamage",[c.StatArcanePower]:"ArcaneSpellDamage",[c.StatFirePower]:"FireSpellDamage",[c.StatFrostPower]:"FrostSpellDamage",[c.StatHolyPower]:"HolySpellDamage",[c.StatNaturePower]:"NatureSpellDamage",[c.StatShadowPower]:"ShadowSpellDamage",[c.StatMP5]:"Mp5",[c.StatSpellHit]:"SpellHitRating",[c.StatSpellCrit]:"SpellCritRating",[c.StatSpellHaste]:"SpellHasteRating",[c.StatSpellPenetration]:"SpellPen",[c.StatAttackPower]:"Ap",[c.StatMeleeHit]:"HitRating",[c.StatMeleeCrit]:"CritRating",[c.StatMeleeHaste]:"HasteRating",[c.StatArmorPenetration]:"ArmorPenetration",[c.StatExpertise]:"ExpertiseRating",[c.StatMana]:"Mana",[c.StatEnergy]:"Energy",[c.StatRage]:"Rage",[c.StatArmor]:"Armor",[c.StatRangedAttackPower]:"Ap",[c.StatDefense]:"DefenseRating",[c.StatBlock]:"BlockRating",[c.StatBlockValue]:"BlockValue",[c.StatDodge]:"DodgeRating",[c.StatParry]:"ParryRating",[c.StatResilience]:"ResilienceRating",[c.StatHealth]:"Health",[c.StatArcaneResistance]:"ArcaneResistance",[c.StatFireResistance]:"FireResistance",[c.StatFrostResistance]:"FrostResistance",[c.StatNatureResistance]:"NatureResistance",[c.StatShadowResistance]:"ShadowResistance",[c.StatBonusArmor]:"Armor2",[c.StatHealingPower]:"Healing",[c.StatFeralAttackPower]:"FeralAttackPower"},Yp.pseudoStatNames={[h.PseudoStatMainHandDps]:"MeleeDps",[h.PseudoStatRangedDps]:"RangedDps"};let Qp=Yp;const Xp={[Ft.ItemQualityJunk]:"item-quality-junk",[Ft.ItemQualityCommon]:"item-quality-common",[Ft.ItemQualityUncommon]:"item-quality-uncommon",[Ft.ItemQualityRare]:"item-quality-rare",[Ft.ItemQualityEpic]:"item-quality-epic",[Ft.ItemQualityLegendary]:"item-quality-legendary",[Ft.ItemQualityArtifact]:"item-quality-artifact",[Ft.ItemQualityHeirloom]:"item-quality-heirloom"};function eg(e,t){Object.values(Xp).forEach((t=>e.classList.remove(t))),t&&e.classList.add(Xp[t])}class tg extends g{constructor(e,t,s){super(e,"content-block",s.rootElem),this.config=s,this.rootElem.classList.add(t),s.extraCssClasses&&this.rootElem.classList.add(...s.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),s.bodyClasses?.forEach((e=>{this.bodyElement.classList.add(e)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){const e=this.config.header.titleTag||"h6",t=I(),s=f("div",{className:"content-block-header"},f(e,{ref:t,className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&s.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&Xa(t.value,{content:this.config.header.tooltip}),this.rootElem.appendChild(s),s}return null}buildBody(){const e=f("div",{className:"content-block-body"});return this.rootElem.appendChild(e),e}}let sg=null;async function ig(e){return(await(null==sg&&(sg=fetch("/sod/assets/enchants/descriptions.json").then((e=>e.json())).then((e=>{const t={};for(let s in e)t[parseInt(s)]=e[s];return t}))),sg))[e.effectId]||e.name}function ag(e){return e.effectId+"-"+e.type}let ng={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function og(e,t){return window.getComputedStyle(t)[e]}class lg{constructor(e,t){this.last_cluster=0,this.scroll_debounce=0,this.pointer_events_set=!1,this.resize_debounce=0,this.cache={},this.options={rows_in_block:void 0!==t.rows_in_block?t.rows_in_block:ng.rows_in_block,blocks_in_cluster:void 0!==t.blocks_in_cluster?t.blocks_in_cluster:ng.blocks_in_cluster,show_no_data_row:void 0!==t.show_no_data_row?t.show_no_data_row:ng.show_no_data_row,no_data_class:void 0!==t.no_data_class?t.no_data_class:ng.no_data_class,no_data_text:void 0!==t.no_data_text?t.no_data_text:ng.no_data_text,keep_parity:void 0!==t.keep_parity?t.keep_parity:ng.keep_parity,tag:void 0!==t.tag?t.tag:ng.tag,callbacks:void 0!==t.callbacks?t.callbacks:ng.callbacks,cluster_height:0,item_height:void 0!==t.item_height?t.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=t.rows,this.scroll_elem=t.scroll_elem,this.content_elem=t.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let s=this.scroll_elem.scrollTop;this.getRowsHeight(t.rows),this.insertToDom(t.rows,this.cache),this.scroll_elem.scrollTop=s,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){let e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(let t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);let s=this.generate(),i=s.rows;this.displayedRows=s.rows;let a=this.checkChanges("data",i,t),n=this.checkChanges("top",s.top_offset,t),o=this.checkChanges("bottom",s.bottom_offset,t),l=this.options.callbacks,r=[];if(a||n){if(s.top_offset){if(this.options.keep_parity){let e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",s.top_offset))}r.push(...i),s.bottom_offset&&r.push(this.renderExtraTag("bottom-space",s.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",s.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(s.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=s.bottom_offset+"px")}exploreEnvironment(e,t){let s=this.options;s.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),s.tag||(s.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){let t=this.options,s=t.item_height;t.cluster_height=0;let i=this.content_elem.children;if(e.length&&i.length){let e=i[Math.floor(i.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=og("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(og("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){let s=parseInt(og("marginTop",e),10)||0,i=parseInt(og("marginBottom",e),10)||0;t.item_height+=Math.max(s,i)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,s!=t.item_height}generate(){let e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){let e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let s=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),i=s+e.rows_in_cluster,a=Math.max(s*e.item_height,0),n=Math.max((t-i)*e.item_height,0),o=[],l=s;return a<1&&l++,o=this.ds.generateRows(s,i),{top_offset:a,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){let e=this.options;if(!e.tag||!e.show_no_data_row)return[];let t,s=document.createElement(e.tag),i=document.createTextNode(e.no_data_text);return s.className=e.no_data_class,"tr"==e.tag&&(t=document.createElement("td"),t.colSpan=100,t.appendChild(i)),s.appendChild(t||i),[s]}getClusterNum(e){let t=this.options;t.scroll_top=this.scroll_elem.scrollTop;let s=Math.max(t.cluster_height-t.block_height,1),i=Math.floor(t.scroll_top/s),a=Math.floor(e*t.item_height/s);return Math.min(i,a)}renderExtraTag(e,t){let s=document.createElement(this.options.tag),i="clusterize-";return s.className=[i+"extra-row",i+e].join(" "),s.style.marginTop="0",s.style.marginBottom="0",t&&(s.style.height=t+"px"),s}checkChanges(e,t,s){var i=t!=s[e];return s[e]=t,i}}const rg={[Z.UNSPECIFIED]:"None",[Z.ALLIANCE_ONLY]:"Alliance only",[Z.HORDE_ONLY]:"Horde only"};class dg extends Vp{constructor(e,t,s){super(e,"filters-menu",{size:"md",title:"Filters"});const i=this.newSection("General"),a=f("div",{className:"ilvl-filters"});i.appendChild(a),new bh(a,t.sim,{id:"filters-min-ilvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minIlvl,setValue:(e,t,s)=>{const i=t.getFilters();i.minIlvl=s,t.setFilters(e,i)}}),a.appendChild(f("span",{className:"ilvl-filters-separator"},"-")),new bh(a,t.sim,{id:"filters-max-ilvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxIlvl,setValue:(e,t,s)=>{const i=t.getFilters();i.maxIlvl=s,t.setFilters(e,i)}}),new lh(i,t.sim,{id:"filters-faction-restriction",label:"Faction Restrictions",values:[Z.UNSPECIFIED,Z.ALLIANCE_ONLY,Z.HORDE_ONLY].map((e=>({name:rg[e],value:e}))),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,s)=>{const i=t.getFilters();i.factionRestriction=s,t.setFilters(e,i)}});const n=this.newSection("Source");n.classList.add("filters-menu-section-bool-list");if($n.ALL_SOURCES.filter((e=>e!=Y.SourceUnknown)).forEach((e=>{new pt(n,t.sim,{id:`filters-source-${e}`,label:Ot.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,s,i)=>{const a=s.getFilters();i?a.sources.push(e):a.sources=a.sources.filter((t=>t!=e)),s.setFilters(t,a)}})})),Vn.ARMOR_SLOTS.includes(s)){const e=Ht[t.getClass()];if(e>=We.ArmorTypeLeather){const s=this.newSection("Armor Type");s.classList.add("filters-menu-section-bool-list");d(We).filter((e=>e!=We.ArmorTypeUnknown)).filter((t=>t<=e)).forEach((e=>{new pt(s,t.sim,{id:`filters-armor-type-${e}`,label:qt.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,s,i)=>{const a=s.getFilters();i?a.armorTypes.push(e):a.armorTypes=a.armorTypes.filter((t=>t!=e)),s.setFilters(t,a)}})}))}}else if(Vn.WEAPON_SLOTS.includes(s)){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");Bt[t.getClass()].map((e=>e.weaponType)).forEach((s=>{new pt(e,t.sim,{id:`filters-weapon-type-${s}`,label:zt.get(s),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(s),setValue:(e,t,i)=>{const a=t.getFilters();i?a.weaponTypes.push(s):a.weaponTypes=a.weaponTypes.filter((e=>e!=s)),t.setFilters(e,a)}})}));const s=this.newSection("Weapon Speed");s.classList.add("filters-menu-section-number-list"),new bh(s,t.sim,{id:"filters-min-weapon-speed",label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.minMhWeaponSpeed=s,t.setFilters(e,i)}}),new bh(s,t.sim,{id:"filters-max-weapon-speed",label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.maxMhWeaponSpeed=s,t.setFilters(e,i)}}),jt(t)&&(new bh(s,t.sim,{id:"filters-min-oh-weapon-speed",label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.minOhWeaponSpeed=s,t.setFilters(e,i)}}),new bh(s,t.sim,{id:"filters-max-oh-weapon-speed",label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.maxOhWeaponSpeed=s,t.setFilters(e,i)}}))}else if(s==D.ItemSlotRanged){const e=$t[t.getClass()];if(e.length<=1)return;const s=this.newSection("Ranged Weapon Type");s.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new pt(s,t.sim,{id:`filter-ranged-weapon-type-${e}`,label:Gt.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,s,i)=>{const a=s.getFilters();i?a.rangedWeaponTypes.push(e):a.rangedWeaponTypes=a.rangedWeaponTypes.filter((t=>t!=e)),s.setFilters(t,a)}})}));const i=this.newSection("Ranged Weapon Speed");i.classList.add("filters-menu-section-number-list"),new bh(i,t.sim,{id:"filters-min-ranged-weapon-speed",label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.minRangedWeaponSpeed=s,t.setFilters(e,i)}}),new bh(i,t.sim,{id:"filters-max-ranged-weapon-speed",label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.maxRangedWeaponSpeed=s,t.setFilters(e,i)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section"),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}class cg{constructor(e,t,s,i,n,o,r,d,c,h,m,u,p){this.sortBy=1,this.sortDirection=Kt.DESC,this.id=e,this.label=r,this.simUI=s,this.player=o,this.itemData=c,this.computeEP=h,this.equippedToItemFn=m,this.onItemClick=p,this.slot=i,this.gearData=d,this.currentFilters=this.player.sim.getFilters();const g=r===n,w=I(),v=I(),b=I(),S=I(),E=I(),y=I(),P=I(),k=I(),C=I(),L=I();if(this.tabContent=f("div",{id:this.id,className:Pt("selector-modal-tab-pane tab-pane fade",g&&"active show")},f("div",{className:"selector-modal-filters"},f("input",{ref:w,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),r===ug.Items&&f("button",{ref:b,className:"selector-modal-filters-button btn btn-primary"},"Filters"),f("div",{ref:E,className:"selector-modal-phase-selector hide"}),f("div",{ref:y,className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons hide"}),f("div",{ref:P,className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons hide"}),f("div",{ref:S,className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),f("button",{ref:C,className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),f("div",{className:"selector-modal-list-labels"},f("span",{className:"item-label"},f("small",null,"Item")),r===ug.Items&&f(x,null,f("span",{className:"source-label"},f("small",null,"Source")),f("span",{className:"ilvl-label interactive",onclick:e=>{e.preventDefault(),this.sort(1)}},f("small",null,"ILvl"))),f("span",{className:"ep-label interactive",onclick:e=>{e.preventDefault(),this.sort(0)}},f("small",null,"EP"),f("i",{className:"fa-solid fa-plus-minus fa-2xs"}),f("button",{ref:v,className:"btn btn-link p-0 ms-1"},f("i",{className:"far fa-question-circle fa-lg"}))),f("span",{className:"favorite-label"}),f("span",{ref:L,className:"compare-label hide"})),f("ul",{ref:k,className:"selector-modal-list"})),t.appendChild(this.tabContent),this.label===ug.Items&&this.bindToggleCompare(L.value),Xa(v.value,{content:Jt}),r===ug.Items&&(i===D.ItemSlotMainHand||i===D.ItemSlotOffHand&&o.getClass()===l.ClassWarrior)&&(function(e,t){e.classList.remove("hide"),new pt(e,t,{id:"show-1h-weapons-selector",extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,s)=>{console.log("test");const i=t.getFilters();i.oneHandedWeapons=s,t.setFilters(e,i)}})}(y.value,o.sim),function(e,t){e.classList.remove("hide"),new pt(e,t,{id:"show-2h-weapons-selector",extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,s)=>{const i=t.getFilters();i.twoHandedWeapons=s,t.setFilters(e,i)}})}(P.value,o.sim)),this.label!==ug.Runes&&function(e,t){new pt(e,t,{id:"show-ep-values-selector",extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,s)=>{t.setShowEPValues(e,s)}})}(S.value,o.sim),r===ug.Items){const e=new dg(t,o,i);b.value?.addEventListener("click",(()=>e.open()))}this.listElem=this.tabContent.getElementsByClassName("selector-modal-list")[0],this.itemsToDisplay=[],this.scroller=new lg({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{const s=[];for(let i=e;i<t&&!(i>=this.itemsToDisplay.length);++i)s.push(this.createItemElem({idx:this.itemsToDisplay[i],data:this.itemData[this.itemsToDisplay[i]]}));return s}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const T=C.value;if(T)switch(T.addEventListener("click",(e=>{u(a.nextEventID())})),r){case ug.Enchants:T.textContent="Remove Enchant";break;case ug.Runes:T.textContent="Remove Rune"}this.updateSelected(),this.searchInput=this.tabContent.getElementsByClassName("selector-modal-search")[0],this.searchInput.addEventListener("input",(()=>this.applyFilters()))}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}getItemIdByItemType(e){if(!e)return null;switch(this.label){case ug.Enchants:return e.effectId;case ug.Items:case ug.RandomSuffixes:case ug.Runes:return e.id;default:return null}}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),s=this.getItemIdByItemType(t),i=t?this.computeEP(t):0;this.scroller.elementUpdate((e=>{const t=e.dataset.idx,a=this.itemData[parseFloat(t)];a.id===s?e.classList.add("active"):e.classList.remove("active");const n=e.querySelector(".selector-modal-list-item-ep-delta");if(n&&(n.textContent="",a.item)){const e=this.computeEP(a.item);i!==e&&Zt(n,i,e,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let s=0;s<this.itemData.length;++s)e[s]=s;const t=this.player.getEquippedItem(this.slot);this.label===ug.Items?e=this.player.filterItemData(e,(e=>this.itemData[e].item),this.slot):this.label===ug.Enchants&&(e=this.player.filterEnchantData(e,(e=>this.itemData[e].item),this.slot,t)),e=e.filter((e=>{const t=this.itemData[e];if(this.searchInput.value.length){const e=e=>e.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,""),s=e(this.searchInput.value).split(" "),i=e(t.name.toString());let a=!0;if(s.some((e=>{i.includes(e)||(a=!1)})),!a)return!1}return!0})),[D.ItemSlotTrinket1,D.ItemSlotTrinket2].includes(this.slot)||this.slot===D.ItemSlotRanged&&[l.ClassShaman,l.ClassPaladin,l.ClassDruid].includes(this.player.getClass())?this.sortBy=1:this.sortBy=0,e=this.sortIdxs(e),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}sort(e){this.sortBy===e?this.sortDirection=1-this.sortDirection:this.sortDirection=Kt.DESC,this.sortBy=e,this.itemsToDisplay=this.sortIdxs(this.itemsToDisplay),this.scroller.update()}sortIdxs(e){let t=(e,t)=>{const s=this.sortDirection===Kt.DESC?t:e,i=this.sortDirection===Kt.DESC?e:t,a=this.computeEP(s)-this.computeEP(i);return Math.abs(a)<.01?s.ilvl-i.ilvl:a};if(1===this.sortBy)t=(e,t)=>{const s=this.sortDirection===Kt.DESC?t:e,i=this.sortDirection===Kt.DESC?e:t;return s.ilvl-i.ilvl};return e.sort(((e,s)=>{const i=this.itemData[e],a=this.itemData[s];return this.isItemFavorited(i)&&!this.isItemFavorited(a)?-1:this.isItemFavorited(a)&&!this.isItemFavorited(i)?1:t(i.item,a.item)}))}hideOrShowEPValues(){const e=this.tabContent.getElementsByClassName("ep-label"),t=this.tabContent.getElementsByClassName("selector-modal-list"),s=this.label!=ug.Runes&&this.player.sim.getShowEPValues(),i=s?"":"none";for(const a of e)a.style.display=i;for(const a of t)s?a.classList.remove("hide-ep"):a.classList.add("hide-ep")}createItemElem(e){const t=e.data,s=this.computeEP(t.item),i=this.equippedToItemFn(this.gearData.getEquippedItem()),n=this.getItemIdByItemType(i),o=i?this.computeEP(i):0,l=I(),r=I(),d=I(),c=I(),h=I(),m=I(),u=I(),p=f("li",{className:Pt("selector-modal-list-item",n===t.id&&"active"),dataset:{idx:e.idx.toString()}},f("div",{className:"selector-modal-list-label-cell"},f("a",{className:"selector-modal-list-item-link",ref:r,dataset:{whtticon:"false"}},f("img",{className:"selector-modal-list-item-icon",ref:d}),f("label",{className:"selector-modal-list-item-name",ref:l},t.name))),this.label===ug.Items&&f(x,null,f("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(t.item,this.player.sim)),f("div",{className:"selector-modal-list-item-ilvl-container"},t.item.ilvl)),![D.ItemSlotTrinket1,D.ItemSlotTrinket2].includes(this.slot)&&f("div",{className:"selector-modal-list-item-ep"},f("span",{className:"selector-modal-list-item-ep-value"},s<9.95?s.toFixed(1).toString():Math.round(s).toString()),f("span",{className:"selector-modal-list-item-ep-delta",ref:e=>t.item&&o!==s&&Zt(e,o,s,0)})),f("div",{className:"selector-modal-list-item-favorite-container"},f("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:c},f("i",{ref:h,className:"far fa-star fa-xl"}))),f("div",{ref:m,className:"selector-modal-list-item-compare-container hide"},f("button",{className:"selector-modal-list-item-compare btn btn-link p-0",ref:u},f("i",{className:"fas fa-arrow-right-arrow-left fa-xl"})))),g=e=>{const s=this.player.sim.getFilters();let i,n;switch(this.label){case ug.Items:i="favoriteItems",n=t.id;break;case ug.Enchants:i="favoriteEnchants",n=ag(t.item);break;case ug.Runes:i="favoriteRunes",n=t.id;break;case ug.RandomSuffixes:i="favoriteRandomSuffixes",n=t.id;break;default:return}if(e)s[i].push(n);else{const e=s[i].indexOf(n);-1!==e&&s[i].splice(e,1)}c.value.classList.toggle("text-brand"),h.value.classList.toggle("fas"),h.value.classList.toggle("far"),p.dataset.fav=e.toString(),this.player.sim.setFilters(a.nextEventID(),s)};c.value.addEventListener("click",(()=>g("false"===p.dataset.fav)));this.isItemFavorited(t)?(c.value.classList.add("text-brand"),h.value?.classList.add("fas"),p.dataset.fav="true"):(h.value?.classList.add("far"),p.dataset.fav="false");const w=Xa(c.value);var v;if(v="true"===p.dataset.fav,w.setContent(v?"Remove from favorites":"Add to favorites"),this.label===ug.Items){const e=Xa(u.value);this.bindToggleCompare(m.value);const s=this.simUI instanceof Vf?this.simUI:null;if(s){const i=()=>s.bt.hasItem(At.create({id:t.id})),a=()=>{const t=i();e.setContent(t?"Remove from Batch sim":"Add to Batch sim"),u.value.classList[t?"add":"remove"]("text-brand")};a(),s.bt.itemsChangedEmitter.on((()=>{a()})),u.value.addEventListener("click",(()=>{const e=i();s.bt[e?"removeItem":"addItem"](At.create({id:t.id})),new Up({delay:1e3,variant:"success",body:f(x,null,f("strong",null,t.name)," was ",f(x,null,e?"removed from the batch":"added to the batch"),".")})}))}}return r.value.addEventListener("click",(e=>{if(e.preventDefault(),e.target===c.value)return!1;this.onItemClick(t)})),t.actionId.fill().then((e=>{e.setWowheadHref(r.value),d.value.src=e.iconUrl})),eg(l.value,t.quality),p}isItemFavorited(e){return this.label===ug.Items?this.currentFilters.favoriteItems.includes(e.id):this.label===ug.Enchants?this.currentFilters.favoriteEnchants.includes(ag(e.item)):this.label===ug.Runes?this.currentFilters.favoriteRunes.includes(e.id):this.label===ug.RandomSuffixes&&this.currentFilters.favoriteRandomSuffixes.includes(e.id)}getSourceInfo(e,t){const s=(e,t)=>f("a",{href:e,target:"_blank",dataset:{whtticon:"false"}},f("small",null,t));if(!e.sources||0==e.sources.length)return e.randomSuffixOptions.length?s(`${E.makeItemUrl(e.id)}#dropped-by`,f("div",{className:"d-flex align-items-center"},this.getDropSourceIcon(),f("span",null,"World Drop"))):f(x,null);let i=e.sources[0];if("crafted"==i.source.oneofKind){const t=i.source.crafted;return s(t.spellId?E.makeSpellUrl(t.spellId):E.makeItemUrl(e.id),f("div",{className:"d-flex"},this.getProfessionSourceIcon(),Yt.get(t.profession)??"Unknown"))}if("drop"==i.source.oneofKind){const a=i.source.drop,n=t.db.getZone(a.zoneId),o=t.db.getNpc(a.npcId);return o?s(E.makeNpcUrl(o.id),f("div",{className:"d-flex"},this.getDropSourceIcon(),f("span",null,n&&n.name,n&&f("br",null),o.name,a.category&&` - ${a.category}`))):n?s(E.makeItemUrl(e.id),f("div",{className:"d-flex"},this.getDropSourceIcon(),f("span",null,n.name,f("br",null),a.otherName?a.otherName:"Multiple Sources"))):s(`${E.makeItemUrl(e.id)}#dropped-by`,f("div",{className:"d-flex"},this.getDropSourceIcon(),f("span",null,"Multiple Sources")))}if("quest"==i.source.oneofKind&&i.source.quest.name){const t=i.source.quest;return s(E.makeQuestUrl(t.id),f("div",{className:"d-flex"},f("span",{className:"d-flex me-1"},this.getQuestSourceIcon(),e.factionRestriction==Z.ALLIANCE_ONLY&&this.getAllianceSourceIcon(),e.factionRestriction==Z.HORDE_ONLY&&this.getHordeSourceIcon()),f("span",null,t.name)))}if("rep"==(i=e.sources.find((e=>"rep"==e.source.oneofKind))??i).source.oneofKind){const a=e.sources.filter((e=>"rep"==e.source.oneofKind)).map((e=>t.db.getFaction(e.source.rep.repFactionId))).filter((e=>!!e)),n=i.source.rep;return s(E.makeItemUrl(e.id),f("div",{className:"d-flex"},f("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",width:"16",height:"16"}),f("div",{className:"d-flex flex-column"},a.map((t=>f("div",{className:"d-flex"},(e.factionRestriction==Z.ALLIANCE_ONLY||Qt(t.id))&&f("span",{className:"d-flex me-1"},this.getAllianceSourceIcon()),(e.factionRestriction==Z.HORDE_ONLY||Xt(t.id))&&f("span",{className:"d-flex me-1"},this.getHordeSourceIcon()),t.name," - ",es[n.repLevel]))))))}if("soldBy"==i.source.oneofKind){const t=i.source.soldBy;return t.npcId?s(E.makeNpcUrl(t.npcId),f("div",{className:"d-flex"},this.getVendorSourceIcon(),f("span",null,t.npcName))):s(`${E.makeItemUrl(e.id)}#sold-by`,f("div",{className:"d-flex"},this.getVendorSourceIcon(),f("span",null,"Vendor")))}return f(x,null)}bindToggleCompare(e){const t=()=>e.classList[this.player.sim.getShowExperimental()?"remove":"add"]("hide");t(),this.player.sim.showExperimentalChangeEmitter.on((()=>{t()}))}getDropSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/icons/boss.gif",className:"item-source-icon-drop me-1"})}getVendorSourceIcon(){return f("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",className:"item-source-icon-vendor me-1"})}getProfessionSourceIcon(){return f("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/6/63/Pointer_repair_off_32x32.png",className:"item-source-icon-profession me-1"})}getQuestSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/wow/icons/tiny/quest-start.gif",className:"item-source-icon-quest"})}getAllianceSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/icons/alliance.png",className:"item-source-icon-alliance"})}getHordeSourceIcon(){return f("img",{src:"https://wow.zamimg.com/images/icons/horde.png",className:"item-source-icon-horde"})}}const hg={[D.ItemSlotHead]:"/sod/assets/item_slots/head.jpg",[D.ItemSlotNeck]:"/sod/assets/item_slots/neck.jpg",[D.ItemSlotShoulder]:"/sod/assets/item_slots/shoulders.jpg",[D.ItemSlotBack]:"/sod/assets/item_slots/shirt.jpg",[D.ItemSlotChest]:"/sod/assets/item_slots/chest.jpg",[D.ItemSlotWrist]:"/sod/assets/item_slots/wrists.jpg",[D.ItemSlotHands]:"/sod/assets/item_slots/hands.jpg",[D.ItemSlotWaist]:"/sod/assets/item_slots/waist.jpg",[D.ItemSlotLegs]:"/sod/assets/item_slots/legs.jpg",[D.ItemSlotFeet]:"/sod/assets/item_slots/feet.jpg",[D.ItemSlotFinger1]:"/sod/assets/item_slots/finger.jpg",[D.ItemSlotFinger2]:"/sod/assets/item_slots/finger.jpg",[D.ItemSlotTrinket1]:"/sod/assets/item_slots/trinket.jpg",[D.ItemSlotTrinket2]:"/sod/assets/item_slots/trinket.jpg",[D.ItemSlotMainHand]:"/sod/assets/item_slots/mainhand.jpg",[D.ItemSlotOffHand]:"/sod/assets/item_slots/offhand.jpg",[D.ItemSlotRanged]:"/sod/assets/item_slots/ranged.jpg"};function mg(e){return hg[e]}var ug=(e=>(e.Enchants="Enchant",e.Items="Item",e.RandomSuffixes="Random Suffix",e.Runes="Rune",e))(ug||{});class pg extends Vp{constructor(e,t,s,i,a){super(e,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.ilists=[],this.itemSlotTabElems=[],this.currentSlot=D.ItemSlotHead,this.currentTab="Item",this.disabledTabs=[],this.simUI=t,this.player=s,this.gearPicker=i,this.options={id:He(),...a},this.disabledTabs=this.options.disabledTabs||[],this.addItemSlotTabs(),this.header.insertAdjacentElement("afterbegin",f("div",null,f("h6",{className:"selector-modal-title"}),f("ul",{className:"nav nav-tabs selector-modal-tabs"}))),this.body.appendChild(f("div",{className:"tab-content selector-modal-tab-content"})),this.titleElem=this.rootElem.querySelector(".selector-modal-title"),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.body.appendChild(f("div",{className:"d-flex align-items-center form-text mt-auto pt-3"},f("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),f("span",null,"If gear is missing, check the selected phase and your gear filters.",f("br",null),"If the problem persists, save any un-saved data, click the",f("i",{className:"fas fa-cog mx-1"}),'to open your sim options, then click the "Restore Defaults".')))}openTab(e,t,s){this.titleElem.textContent=ts.get(e)??"",this.setData(e,t,s),this.setActiveItemSlotTab(e),this.open()}onShow(){if(this.gearPicker){const e=this.switchToPreviousItemSlotTab.bind(this),t=this.switchToNextItemSlotTab.bind(this);document.addEventListener("keydown",e),document.addEventListener("keydown",t),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>document.removeEventListener("keydown",t)))}}setData(e,t,s){this.tabsElem.innerText="",this.contentElem.innerText="",this.ilists=[];const i=s.getEquippedItem(),a=this.player.getItems(e),n=this.player.getEnchants(e),o=this.player.getRunes(e);("Enchant"===t&&!n.length||"Rune"===t&&!o.length)&&(t="Item"),this.currentTab=t,this.currentSlot=e;!this.disabledTabs?.includes("Item")&&this.addTab({id:ss(`${this.options.id}-Item`),label:"Item",gearData:s,itemData:a.map((t=>({item:t,id:t.id,actionId:E.fromItem(t),name:t.name,quality:t.quality,phase:t.phase,baseEP:this.player.computeItemEP(t,e),ignoreEPFilter:!1,onEquip:(e,t)=>{const i=s.getEquippedItem();i?s.equipItem(e,i.withItem(t)):s.equipItem(e,new is({item:t}))}}))),computeEP:t=>this.player.computeItemEP(t,e),equippedToItemFn:e=>e?.item,onRemove:e=>{s.equipItem(e,null),this.removeTabs("Random Suffix")}});!this.disabledTabs?.includes("Enchant")&&this.addTab({id:ss(`${this.options.id}-Enchant`),label:"Enchant",gearData:s,itemData:n.map((e=>({item:e,id:e.effectId,actionId:e.itemId?E.fromItemId(e.itemId):E.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,baseEP:this.player.computeStatsEP(new un(e.stats)),ignoreEPFilter:!0,onEquip:(e,t)=>{const i=s.getEquippedItem();i&&s.equipItem(e,i.withEnchant(t))}}))),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.enchant,onRemove:e=>{const t=s.getEquippedItem();t&&s.equipItem(e,t.withEnchant(null))}});!this.disabledTabs?.includes("Rune")&&this.addTab({id:ss(`${this.options.id}-Rune`),label:"Rune",gearData:s,itemData:o.map((e=>({item:e,id:e.id,actionId:E.fromSpellId(e.id),name:e.name,quality:Ft.ItemQualityCommon,phase:1,baseEP:1,ignoreEPFilter:!0,onEquip:(e,t)=>{const i=s.getEquippedItem();i&&s.equipItem(e,i.withRune(t))}}))),computeEP:()=>1,equippedToItemFn:e=>e?.rune,onRemove:e=>{const t=s.getEquippedItem();t&&s.equipItem(e,t.withRune(null))}});!this.disabledTabs?.includes("Random Suffix")&&this.addRandomSuffixTab(i,s),this.ilists.find((e=>t===e.label))?.sizeRefresh()}addItemSlotTabs(){this.gearPicker&&this.dialog.prepend(f("div",{className:"gear-picker-modal-slots"},this.gearPicker.itemPickers.map((e=>{const t=I(),s=f("div",{className:"item-picker-icon-wrapper",dataset:{slot:e.slot}},f("a",{ref:t,className:"item-picker-icon",href:"javascript:void(0)",onclick:t=>{t.preventDefault(),e.slot!=this.currentSlot&&e.openSelectorModal(this.currentTab)},dataset:{whtticon:"false"}})),i=()=>{e.item?(this.player.setWowheadData(e.item,t.value),e.item.asActionId().fill().then((e=>{e.setBackgroundAndHref(t.value)}))):t.value.style.backgroundImage=`url('${mg(e.slot)}')`};return i(),e.onUpdate((()=>i())),Xa(t.value,{content:`Edit ${ts.get(e.slot)}`,placement:"left"}),this.itemSlotTabElems.push(s),s}))))}setActiveItemSlotTab(e){this.itemSlotTabElems.forEach((t=>{t.dataset.slot===e.toString()?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")}))}switchToPreviousItemSlotTab(e){if("ArrowUp"===e.key&&this.gearPicker){e.preventDefault();const t=as(this.currentSlot-1,Object.keys(D).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}switchToNextItemSlotTab(e){if("ArrowDown"===e.key&&this.gearPicker){e.preventDefault();const t=as(this.currentSlot+1,Object.keys(D).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}addRandomSuffixTab(e,t){if(!e||!e.item.randomSuffixOptions.length)return;const s=e.item;this.addTab({id:ss(`${this.options.id}-Random Suffix`),label:"Random Suffix",gearData:t,itemData:this.player.getRandomSuffixes(s).map((e=>({item:e,id:e.id,actionId:E.fromRandomSuffix(s,e),name:e.name,quality:s.quality,phase:s.phase,baseEP:this.player.computeRandomSuffixEP(e),ignoreEPFilter:!0,onEquip:(e,s)=>{const i=t.getEquippedItem();i&&t.equipItem(e,i.withItem(i.item).withRandomSuffix(s))}}))),computeEP:e=>this.player.computeRandomSuffixEP(e),equippedToItemFn:e=>e?.randomSuffix,onRemove:e=>{const s=t.getEquippedItem();s&&t.equipItem(e,s.withItem(s.item).withRandomSuffix(null))}})}addTab({id:e,label:t,gearData:s,itemData:i,computeEP:n,equippedToItemFn:o,onRemove:l,setTabContent:r}){if(!i.length)return;const d=t===this.currentTab,c=I();this.tabsElem.appendChild(f("li",{className:"nav-item"},f("button",{ref:c,className:Pt("nav-link selector-modal-item-tab",d&&"active"),dataset:{label:t,bsToggle:"tab",bsTarget:`#${e}`},attributes:{role:"tab","aria-selected":d}}))),r?r(c.value):c.value.textContent=t;const h=new cg(e,this.contentElem,this.simUI,this.currentSlot,this.currentTab,this.player,t,s,i,n,o,l,(e=>{const t=e;e.onEquip(a.nextEventID(),t.item);const i=ns.is(t.item),n=!!t.actionId.randomSuffixId;(i||n)&&(n||(this.removeTabs("Random Suffix"),this.addRandomSuffixTab(s.getEquippedItem(),s)))})),m=()=>{h.updateSelected()},u=()=>{h.applyFilters()},p=()=>{h.hideOrShowEPValues()};s.changeEvent.on(m),this.player.sim.phaseChangeEmitter.on(u),this.player.sim.filtersChangeEmitter.on(u),this.player.sim.showEPValuesChangeEmitter.on(p),this.addOnDisposeCallback((()=>{s.changeEvent.off(m),this.player.sim.phaseChangeEmitter.off(u),this.player.sim.filtersChangeEmitter.off(u),this.player.sim.showEPValuesChangeEmitter.off(p),h.dispose()})),c.value.addEventListener("click",(e=>{this.currentTab=t})),c.value.addEventListener("shown.bs.tab",(e=>{h.sizeRefresh()})),this.ilists.push(h)}removeTabs(e){const t=[...this.tabsElem.querySelectorAll(".selector-modal-item-tab")].filter((t=>t.dataset?.label?.includes(e))),s=t.map((e=>document.querySelector(e.dataset.bsTarget))).filter((e=>Boolean(e)));t.forEach((e=>e.parentElement?.remove())),s.forEach((e=>e.remove()))}}class gg extends Wp{constructor(e,t,s){super(e,t,"Bag Item Import",!0),this.simUI=t,this.bulkUI=s,this.descriptionElem.appendChild(f(x,null,f("p",null,"Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn."),f("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){try{const t=_t.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await ae.loadLeftoversIfNecessary(t),s=t.items.filter((t=>t.id>0&&e.lookupItemSpec(t)));s.length>0&&this.bulkUI.addItems(s)}this.close()}catch(t){console.warn(t),alert(t.toString())}}}const fg=f("ul",{className:"text-start ps-3 mb-0"});class Ig extends g{constructor(e){super(e,"results-viewer"),this.warnings=[],this.warningsTooltip=null;const t=I(),s=I(),i=I();this.rootElem.appendChild(f(x,null,f("div",{ref:t,className:"results-pending"},f("div",{className:"loader"})),f("div",{ref:s,className:"results-content"}),f("div",{ref:i,className:"warning-zone",style:"text-align: center"}))),this.pendingElem=t.value,this.contentElem=s.value,this.warningElem=i.value,this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink(e){const t=f("div",{className:"sim-toolbar-item"},f("a",{href:e.href?e.href:"javascript:void(0)",target:e.href?"_blank":"_self",className:e.classes},e.icon&&f("i",{className:e.icon}),e.text?e.text:""));return e.parent.appendChild(t),e.tooltip&&(this.warningsTooltip=Xa(t,{appendTo:"parent",content:e.tooltip,placement:"bottom",inlinePositioning:!0,plugins:[sn]})),t}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:fg,classes:"warning link-warning"})}addWarning(e){this.warnings.push(e),e.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const e=this.warnings.map((e=>e.getContent())).flat().filter((e=>""!==e)),t=this.warningsTooltip?.props.content?.cloneNode(!0)||f(x,null);t&&(t.innerHTML=""),t.appendChild(f(x,null,e?.map((e=>f("li",null,e))))),this.warningsLink.parentElement?.classList?.[e.length?"remove":"add"]("hide"),this.warningsTooltip?.setContent(t)}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){"string"==typeof e?this.contentElem.innerHTML=e:(this.contentElem.innerHTML="",this.contentElem.appendChild(e)),this.contentElem.style.display="block",this.pendingElem.style.display="none"}}class wg extends g{constructor(e,t,s){super(e,"sim-tab"),this.rootElem.classList.add(s.identifier),this.simUI=t,this.config=s,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<a\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\ttype="button"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</a>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){let s=document.createElement("div");return s.classList.add("tab-panel-col",`${t}-${e}`),s}}const vg="https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg";class bg extends g{constructor(e,t,s){super(e,"gear-picker-root");const i=document.createElement("div");i.classList.add("gear-picker-left","tab-panel-col"),this.rootElem.appendChild(i);const a=document.createElement("div");a.classList.add("gear-picker-right","tab-panel-col"),this.rootElem.appendChild(a);const n=[D.ItemSlotHead,D.ItemSlotNeck,D.ItemSlotShoulder,D.ItemSlotBack,D.ItemSlotChest,D.ItemSlotWrist,D.ItemSlotMainHand,D.ItemSlotOffHand,D.ItemSlotRanged].map((e=>new Sg(i,this,t,s,e))),o=[D.ItemSlotHands,D.ItemSlotWaist,D.ItemSlotLegs,D.ItemSlotFeet,D.ItemSlotFinger1,D.ItemSlotFinger2,D.ItemSlotTrinket1,D.ItemSlotTrinket2].map((e=>new Sg(a,this,t,s,e)));this.itemPickers=n.concat(o).sort(((e,t)=>e.slot-t.slot)),this.selectorModal=new pg(t.rootElem,t,s,this)}}class xg extends g{constructor(e,t,s){super(e,"item-picker-root",t),this.player=s;const i=I(),a=I(),n=I(),o=I(),l=I(),r=I();this.rootElem.appendChild(f(x,null,f("div",{className:"item-picker-icon-wrapper"},f("span",{className:"item-picker-ilvl",ref:o}),f("a",{ref:i,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),f("div",{className:"item-picker-rune-container"},f("img",{ref:a,className:"item-picker-rune-icon hide"}))),f("div",{className:"item-picker-labels-container"},f("a",{ref:n,className:"item-picker-name",href:"javascript:void(0)",attributes:{role:"button"}}),f("a",{ref:l,className:"item-picker-enchant hide",href:"javascript:void(0)",attributes:{role:"button"}}),f("a",{ref:r,className:"item-picker-rune hide",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=i.value,this.runeIconElem=a.value,this.nameElem=n.value,this.ilvlElem=o.value,this.enchantElem=l.value,this.runeElem=r.value}clear(){this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.enchantElem.classList.add("hide"),this.runeElem.removeAttribute("data-wowhead"),this.runeElem.removeAttribute("href"),this.runeElem.classList.add("hide"),this.iconElem.style.backgroundImage="",this.runeIconElem.src=vg,this.nameElem.innerText="",this.ilvlElem.innerText="",this.enchantElem.innerText="",this.runeElem.innerText=""}update(e){this.nameElem.textContent=e.item.name,this.ilvlElem.textContent=e.item.ilvl.toString(),e.randomSuffix&&(this.nameElem.textContent+=" "+e.randomSuffix.name),eg(this.nameElem,e.item.quality),this.player.setWowheadData(e,this.iconElem),this.player.setWowheadData(e,this.nameElem),e.asActionId().fill().then((e=>{e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem)})),e.enchant?(ig(e.enchant).then((e=>{this.enchantElem.textContent=e})),e.enchant.spellId?(this.enchantElem.href=E.makeSpellUrl(e.enchant.spellId),E.makeSpellTooltipData(e.enchant.spellId).then((e=>{this.enchantElem.dataset.wowhead=e}))):(this.enchantElem.href=E.makeItemUrl(e.enchant.itemId),E.makeItemTooltipData(e.enchant.itemId).then((e=>{this.enchantElem.dataset.wowhead=e}))),this.enchantElem.dataset.whtticon="false",this.enchantElem.classList.remove("hide")):this.enchantElem.classList.add("hide");const t=os[e._item.type]?.some((e=>this.player.sim.db.hasRuneBySlot(e,this.player.getClass())));t&&(this.runeIconElem.classList.remove("hide"),e.rune?(E.fromSpellId(e.rune.id).fill().then((e=>this.runeIconElem.src=e.iconUrl)),this.runeElem.classList.remove("hide"),this.runeElem.textContent=e.rune.name,this.runeElem.href=E.makeSpellUrl(e.rune.id),this.runeElem.dataset.wowhead=`domain=classic&spell=${e.rune.id}`,this.runeElem.dataset.whtticon="false"):this.runeIconElem.src=vg)}}class Sg extends g{constructor(e,t,s,i,a){super(e,"item-picker-root"),this.onUpdateCallbacks=[],this._equippedItem=null,this.gearPicker=t,this.simUI=s,this.player=i,this.slot=a,this.itemElem=new xg(e,this.rootElem,i),this.item=i.getEquippedItem(a),i.sim.waitForInit().then((()=>{const e=e=>{e.preventDefault(),this.openSelectorModal(ug.Items)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.enchantElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(ug.Enchants)})),this.itemElem.runeElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(ug.Runes)}))})),i.gearChangeEmitter.on((()=>{this.item=this.player.getEquippedItem(this.slot)})),i.professionChangeEmitter.on((()=>{this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}createGearData(){return{equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot),changeEvent:this.player.gearChangeEmitter}}get item(){return this._equippedItem}set item(e){this.itemElem.clear(),this.itemElem.nameElem.textContent=ts.get(this.slot)??"",eg(this.itemElem.nameElem,null),e?this.itemElem.update(e):this.itemElem.iconElem.style.backgroundImage=`url('${mg(this.slot)}')`,this._equippedItem=e,this.onUpdateCallbacks.forEach((e=>e()))}onUpdate(e){this.onUpdateCallbacks.push(e)}openSelectorModal(e){this.gearPicker.selectorModal.openTab(this.slot,e,this.createGearData())}}class Eg extends g{constructor(e,t,s,i,a){super(e,"bulk-item-picker"),this.simUI=t,this.bulkUI=s,this.index=a,this.item=i,this.itemElem=new xg(e,this.rootElem,t.player);const n=I();this.itemElem.rootElem.appendChild(f("button",{className:"remove-batch-item-btn",ref:n},f("i",{className:"fas fa-times"})));const o=()=>this.bulkUI.removeItemByIndex(this.index);n.value.addEventListener("click",o),this.addOnDisposeCallback((()=>n.value.removeEventListener("click",o))),this.simUI.sim.waitForInit().then((()=>{this.setItem(i);const e=ls(this.item.item)[0],t=this.simUI.sim.db.getEnchants(e),s=this.item.item.randomSuffixOptions,a=i=>{i.preventDefault(),t.length?this.bulkUI.selectorModal.openTab(e,ug.Enchants,this.createGearData()):s.length&&this.bulkUI.selectorModal.openTab(e,ug.RandomSuffixes,this.createGearData())};this.itemElem.iconElem.addEventListener("click",a),this.itemElem.nameElem.addEventListener("click",a),this.itemElem.enchantElem.addEventListener("click",a)}))}setItem(e){this.itemElem.clear(),e?(this.itemElem.update(e),this.item=e):(this.itemElem.rootElem.style.opacity="30%",this.itemElem.iconElem.style.backgroundImage="url('/cata/assets/item_slots/empty.jpg')",this.itemElem.nameElem.textContent="Add new item (not implemented)",this.itemElem.rootElem.style.alignItems="center")}createGearData(){const e=new a;return{equipItem:(t,s)=>{if(s){const t=this.bulkUI.getItems();t[this.index]=s.asSpec(),this.item=s,this.bulkUI.setItems(t),e.emit(a.nextEventID())}},getEquippedItem:()=>this.item,changeEvent:e}}}class yg extends g{constructor(e,t,s,i){super(e,".bulk-sim-results");const n=s.unitMetrics.dps.avg-i.unitMetrics.dps.avg,o=I(),l=I(),r=I();if(e.appendChild(f(x,null,f("div",{className:"results-sim"},f("div",{className:"bulk-result-body-dps bulk-items-text-line results-sim-dps damage-metrics"},f("span",{className:"topline-result-avg"},this.formatDps(s.unitMetrics.dps.avg)),f("span",{ref:l,className:Pt(n>=0?"bulk-result-header-positive":"bulk-result-header-negative")},this.formatDpsDelta(n)),f("p",{className:"talent-loadout-text"},s.talentLoadout&&"object"==typeof s.talentLoadout?"string"==typeof s.talentLoadout.name&&f(x,null,"Talent loadout used: ",s.talentLoadout.name):f(x,null,"Current talents")))),f("div",{ref:r,className:"bulk-gear-combo"}),!!s.itemsAdded?.length&&f("button",{ref:o,className:"btn btn-primary bulk-equipit"},"Equip"))),s.itemsAdded?.length){o.value?.addEventListener("click",(()=>{s.itemsAdded.forEach((e=>{const s=t.sim.db.lookupItemSpec(e.item);t.player.equipItem(a.nextEventID(),e.slot,s),t.simHeader.activateTab("gear-tab")}))}));const e=f(x,null);for(const i of s.itemsAdded){const s=f("div",{className:"bulk-result-item"}),a=t.sim.db.lookupItemSpec(i.item),n=new xg(e,s,t.player);n.update(a),n.nameElem.appendChild(f("a",{className:"bulk-result-item-slot"},this.itemSlotName(i))),e.appendChild(s)}r.value?.appendChild(e)}else s.talentLoadout&&"object"==typeof s.talentLoadout||(l.value?.classList.add("hide"),e.appendChild(f("p",null,"No changes - this is your currently equipped gear!")))}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}formatDpsDelta(e){return(e>=0?"+":"")+this.formatDps(e)}itemSlotName(e){return JSON.parse(rs.toJsonString(e,{emitDefaultValues:!0})).slot.replace("ItemSlot","")}}class Pg extends wg{constructor(e,t){super(e,t,{identifier:"bulk-tab",title:"Batch"}),this.itemsChangedEmitter=new a,this.column1=this.buildColumn(1,"raid-settings-col"),this.items=new Array,this.simUI=t,this.leftPanel=f("div",{className:"bulk-tab-left tab-panel-left"},this.column1),this.rightPanel=f("div",{className:"bulk-tab-right tab-panel-right"}),this.pendingDiv=f("div",{className:"results-pending-overlay d-flex hide"}),this.pendingResults=new Ig(this.pendingDiv),this.pendingResults.hideAll(),this.selectorModal=new pg(this.simUI.rootElem,this.simUI,this.simUI.player,void 0,{id:"bulk-selector-modal",disabledTabs:[ug.Items]}),this.contentContainer.appendChild(f(x,null,this.leftPanel,this.rightPanel,this.pendingDiv)),this.doCombos=!0,this.fastMode=!0,this.autoEnchant=!0,this.savedTalents=[],this.simTalents=!1,this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings()}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){const t=ds.fromJsonString(e,{ignoreUnknownFields:!0});this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant,this.savedTalents=t.talentsToSim,this.simTalents=t.simTalents}}storeSettings(){const e=this.createBulkSettings(),t=ds.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return ds.create({items:this.items,combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,simTalents:this.simTalents,talentsToSim:this.savedTalents,iterationsPerCombo:this.simUI.sim.getIterations()})}createBulkItemsDatabase(){const e=cs.create();for(const t of this.items){const s=this.simUI.sim.db.lookupItemSpec(t);if(!s)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(hs.fromJson(ns.toJson(s.item),{ignoreUnknownFields:!0})),s.enchant&&e.enchants.push(ms.fromJson(us.toJson(s.enchant),{ignoreUnknownFields:!0}))}return e}addItem(e){this.addItems([e])}addItems(e){this.items=[...this.items||[],...e],this.itemsChangedEmitter.emit(a.nextEventID())}setItems(e){this.items=e,this.itemsChangedEmitter.emit(a.nextEventID())}removeItem(e){const t=this.items.findIndex((t=>At.equals(t,e)));-1!==t&&(this.items.splice(t,1),this.itemsChangedEmitter.emit(a.nextEventID()))}removeItemByIndex(e){this.items.length<e?new Up({variant:"error",body:"Failed to remove item, please report this issue."}):(this.items.splice(e,1),this.itemsChangedEmitter.emit(a.nextEventID()))}clearItems(){this.items=new Array,this.itemsChangedEmitter.emit(a.nextEventID())}hasItem(e){return this.items.some((t=>At.equals(t,e)))}getItems(){const e=new Array;return this.items.forEach((t=>{e.push(At.clone(t))})),e}setCombinations(e){this.doCombos=e,this.itemsChangedEmitter.emit(a.nextEventID())}setFastMode(e){this.fastMode=e,this.itemsChangedEmitter.emit(a.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e)}catch(t){this.simUI.handleCrash(t)}}buildTabContent(){const e=new tg(this.column1,"bulk-items",{header:{title:"Items"}});e.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk");const t=f("div",{className:"bulk-items-text-line"},f("i",null,"Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.")),s=f("div",{className:"tab-panel-col bulk-gear-combo"});this.itemsChangedEmitter.on((()=>{const e=f(x,null);if(this.items.length){t.textContent="The following items will be simmed together with your equipped gear.";for(let t=0;t<this.items.length;++t){const s=this.items[t],i=this.simUI.sim.db.lookupItemSpec(s);new Eg(e,this.simUI,this,i,t)}}s.replaceChildren(e)})),e.bodyElement.appendChild(f(x,null,t,s)),this.clearItems();const i=new tg(this.column1,"bulk-results",{header:{title:"Results",extraCssClasses:["bulk-results-header"]}});i.rootElem.hidden=!0,i.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk","tab-panel-col"),this.simUI.sim.bulkSimStartEmitter.on((()=>{i.rootElem.hidden=!0})),this.simUI.sim.bulkSimResultEmitter.on(((e,t)=>{i.rootElem.hidden=0==t.results.length,i.bodyElement.replaceChildren();for(const s of t.results){const e=new tg(i.bodyElement,"bulk-result",{header:{title:""},bodyClasses:["bulk-results-body"]});new yg(e.bodyElement,this.simUI,s,t.equippedGearResult)}}));const a=new tg(this.rightPanel,"bulk-settings",{header:{title:"Setup"}}),n=f("button",{className:"btn btn-primary w-100 bulk-settings-button"},"Simulate Batch");n.addEventListener("click",(()=>{this.pendingDiv.classList.remove("hide"),this.leftPanel.classList.add("blurred"),this.rightPanel.classList.add("blurred");const e=ps(n);n.disabled=!0,n.classList.add("disabled"),n.replaceChildren(f(x,null,f("i",{className:"fa fa-spinner fa-spin"})," Running"));let t=(new Date).getTime(),s=0,i=0,a=0,o=0;this.runBulkSim((l=>{const r=(new Date).getTime()-t,d=l.completedIterations/(r/1e3);0===o&&(o=l.totalSims),this.fastMode&&(0===i&&l.totalSims>0&&(i=Math.ceil(Math.log(l.totalSims/20)/Math.log(2))+1,a=1),l.totalSims<s&&(a+=1,t=(new Date).getTime())),this.setSimProgress(l,d,a,i,o),s=l.totalSims,l.finalBulkResult&&(this.pendingDiv.classList.add("hide"),this.leftPanel.classList.remove("blurred"),this.rightPanel.classList.remove("blurred"),this.pendingResults.hideAll(),n.disabled=!1,n.classList.remove("disabled"),n.replaceChildren(...e))}))}));const o=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},f("i",{className:"fa fa-download"})," Import From Bags");o.addEventListener("click",(()=>new gg(this.simUI.rootElem,this.simUI,this).open()));const l=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},f("i",{className:"fa fa-download"})," Import Favorites");l.addEventListener("click",(()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map((e=>At.create({id:e})));this.addItems(e)}));const r=I(),d=I(),c=f("div",{className:"search-wrapper hide"},f("input",{ref:r,type:"text",placeholder:"Search...",className:"batch-search-input form-control hide"}),f("ul",{ref:d,className:"batch-search-results hide"}));let h=Array();r.value?.addEventListener("keyup",(e=>{if("Enter"==e.key){const e=Array();d.value?.childNodes.forEach((t=>{const s=t.getAttribute("data-item-id");null!=s&&e.push(At.create({id:Number.parseInt(s)}))})),this.addItems(e)}})),r.value?.addEventListener("input",(e=>{const t=r.value?.value||"";if(!t.length)return d.value?.replaceChildren(),void d.value?.classList.add("hide");const s=t.split(" "),i=f(x,null);h.forEach((e=>{let t=!0;const a=e.name.toLowerCase(),n=e.setName.toLowerCase();if(s.forEach((e=>{const s=e.toLowerCase();return!(!a.includes(s)&&!n.includes(s))||(t=!1,!1)})),t){const t=I(),s=I();i.appendChild(f("li",{ref:t,dataset:{itemId:e.id.toString()}},f("span",{ref:s},e.name),e.heroic&&f("span",{className:"item-quality-uncommon"},"[H]"),e.factionRestriction===Z.HORDE_ONLY&&f("span",{className:"faction-horde"},"(H)"),e.factionRestriction===Z.ALLIANCE_ONLY&&f("span",{className:"faction-alliance"},"(A)"))),eg(s.value,e.quality),t.value?.addEventListener("click",(()=>this.addItem(At.create({id:e.id}))))}})),d.value?.replaceChildren(i),d.value?.classList.remove("hide")}));const m=f(x,null,f("i",{className:"fa fa-search"})," Add Item"),u=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},m.cloneNode(!0));u.addEventListener("click",(()=>{r.value?.classList.contains("hide")?(c?.classList.remove("hide"),u.replaceChildren(f(x,null,"Close Search Results")),h=this.simUI.sim.db.getAllItems().filter((e=>U(this.simUI.player,e,void 0))),r.value?.classList.remove("hide"),r.value?.value&&d.value?.classList.remove("hide"),r.value?.focus()):(u.replaceChildren(m.cloneNode(!0)),c?.classList.add("hide"),r.value?.classList.add("hide"),d.value?.replaceChildren(),d.value?.classList.add("hide"))}));const p=f("button",{className:"btn btn-secondary w-100 bulk-settings-button"},"Clear all");p.addEventListener("click",(()=>{this.clearItems(),i.rootElem.hidden=!0,i.bodyElement.replaceChildren()}));const g=I(),w=f("div",{className:Pt("talents-picker-container",!this.simTalents&&"hide")},f("label",{className:"mb-2"},"Pick talents to sim (will increase time to sim)"),f("div",{ref:g,className:"talents-container"})),v=window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());let b;try{null!==v&&(b=JSON.parse(v))}catch(E){console.warn("Invalid json for local storage value: "+v)}const S=(e,t)=>{const s=e.querySelector(".saved-data-set-chip");if(this.savedTalents.some((e=>e.name===t.name))){const e=this.savedTalents.findIndex((e=>e.name===t.name));this.savedTalents.splice(e,1),s?.classList.remove("active")}else this.savedTalents.push(t),s?.classList.add("active")};for(const I in b)try{const e={talentsString:gs.fromJson(b[I]).talentsString,name:I},t=this.savedTalents.findIndex((t=>JSON.stringify(t)===JSON.stringify(e))),s=f("div",{className:Pt("saved-data-set-chip badge rounded-pill",-1!==t&&"active")},f("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},I));g.value.appendChild(s),s.addEventListener("click",(()=>S(s,e)))}catch(E){console.log(E),console.warn("Failed parsing saved data: "+b[I])}a.bodyElement.appendChild(f(x,null,n,o,l,u,c,p,w)),new pt(a.bodyElement,this,{id:"bulk-fast-mode",label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,s)=>{t.fastMode=s}}),new pt(a.bodyElement,this,{id:"bulk-combinations",label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,s)=>{t.doCombos=s}}),new pt(a.bodyElement,this,{id:"bulk-auto-enchant",label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,s)=>{t.autoEnchant=s}}),new pt(a.bodyElement,this,{id:"bulk-sim-talents",label:"Sim Talents",labelTooltip:"When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.simTalents,setValue:(e,t,s)=>{t.simTalents=s,w.classList[s?"remove":"add"]("hide")}})}setSimProgress(e,t,s,i,a){const n=((e.totalIterations-e.completedIterations)/t).toFixed();this.pendingResults.setContent(f("div",{className:"results-sim"},f("div",null,a," total combinations."),f("div",null,i>0&&f(x,null,s," / ",i," refining rounds")),f("div",null,e.completedSims," / ",e.totalSims,f("br",null),"simulations complete"),f("div",null,e.completedIterations," / ",e.totalIterations,f("br",null),"iterations complete"),f("div",null,n," seconds remaining.")))}}class kg extends g{constructor(e,t,s){super(e,"saved-data-manager-root"),this.modObject=t,this.config=s,this.userData=[],this.presets=[],this.frozen=!1;const i=new tg(this.rootElem,"saved-data",{header:s.header}),a=I(),n=I(),o=I();i.bodyElement.replaceChildren(f("div",{ref:a,className:"saved-data-container hide"},f("div",{ref:n,className:"saved-data-presets"}),f("div",{ref:o,className:"saved-data-custom"}))),this.savedDataDiv=a.value,this.presetDataDiv=n.value,this.customDataDiv=o.value,s.presetsOnly||i.bodyElement.appendChild(this.buildCreateContainer())}addSavedData(e){this.savedDataDiv.classList.remove("hide");const t=this.makeSavedData(e),s=e.isPreset?this.presets:this.userData,i=s.findIndex((t=>t.name==e.name));-1==i?(e.isPreset?this.presetDataDiv.appendChild(t.elem):this.customDataDiv.appendChild(t.elem),s.push(t)):(s[i].elem.replaceWith(t.elem),s[i]=t)}makeSavedData(e){const t=I(),s=f("div",{className:"saved-data-set-chip badge rounded-pill"},f("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},e.name),!e.isPreset&&f("a",{ref:t,href:"javascript:void(0)",className:"saved-data-set-delete",attributes:{role:"button"}},f("i",{className:"fa fa-times fa-lg"})));if(s.addEventListener("click",(()=>{this.config.setData(a.nextEventID(),this.modObject,e.data),this.saveInput&&(this.saveInput.value=e.name)})),!e.isPreset&&t.value){const s=Xa(t.value,{content:`Delete saved ${this.config.label}`});t.value.addEventListener("click",(t=>{t.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${e.name}'?`))return;s.destroy();const i=this.userData.findIndex((t=>t.name==e.name));this.userData[i].elem.remove(),this.userData.splice(i,1),this.saveUserData()}))}e.tooltip&&Xa(s,{content:e.tooltip,placement:"bottom"});const i=()=>{this.config.equals(e.data,this.config.getData(this.modObject))?s.classList.add("active"):s.classList.remove("active"),e.enableWhen&&!e.enableWhen(this.modObject)?s.classList.add("disabled"):s.classList.remove("disabled")};return i(),this.config.changeEmitters.forEach((e=>e.on(i))),{name:e.name,data:e.data,elem:s,enableWhen:e.enableWhen}}saveUserData(){const e={};this.userData.forEach((t=>{e[t.name]=this.config.toJson(t.data)})),0==this.userData.length&&0==this.presets.length&&this.savedDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(s){console.warn("Invalid json for local storage value: "+e)}for(const i in t)try{this.addSavedData({name:i,data:this.config.fromJson(t[i])})}catch(s){console.warn("Failed parsing saved data: "+t[i])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){const e=I(),t=I(),s=f("div",{className:"saved-data-create-container"},f("label",{className:"form-label"},this.config.label," Name"),f("input",{ref:t,className:"saved-data-save-input form-control",type:"text",placeholder:"Name"}),f("button",{ref:e,className:"saved-data-save-button btn btn-primary"},"Save ",this.config.label));return this.saveInput=t.value,e.value?.addEventListener("click",(()=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),s}}class Cg extends wg{constructor(e,t){super(e,t,{identifier:"gear-tab",title:"Gear"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildSavedGearsetPicker()}buildGearPickers(){new bg(this.leftPanel,this.simUI,this.simUI.player)}buildSavedGearsetPicker(){const e=new kg(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>fs.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,s)=>{a.freezeAllAndDo((()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(s.gear||_t.create())),t.setBonusStats(e,un.fromProto(s.bonusStatsStats||p.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>fs.equals(e,t),toJson:e=>fs.toJson(e),fromJson:e=>fs.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:fs.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new un).toProto()}),enableWhen:t.enableWhen})}))}))}}class Lg extends w{constructor(e,t,s){super(e,"adaptive-string-picker-root",t,s),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.id=s.id,this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const Tg={actions:{create:{useIcon:!1}}};let Ng=null;class _g extends w{constructor(e,t,s){if(s.isCompact&&(s.extraCssClasses=[...s.extraCssClasses||[],"list-picker-compact"]),super(e,"list-picker-root",t,s),this.config={...Tg,...s},this.itemPickerPairs=[],this.rootElem.appendChild(f(x,null,s.title&&f("label",{className:"list-picker-title form-label"},s.title),f("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){const e=Xa(this.rootElem.querySelector(".list-picker-title"),{content:this.config.titleTooltip});this.addOnDisposeCallback((()=>e?.destroy()))}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let e=null,t=null;this.config.actions?.create?.useIcon?(e=_g.makeActionElem("link-success","fa-plus"),t=Xa(e,{allowHTML:!1,content:`New ${s.itemLabel}`}),this.addOnDisposeCallback((()=>t?.destroy()))):e=f("button",{className:"btn btn-primary"},"New ",s.itemLabel),e.classList.add("list-picker-new-button"),e.addEventListener("click",(()=>{const e=this.config.newItem(),s=this.config.getValue(this.modObject).concat([e]);this.config.setValue(a.nextEventID(),this.modObject,s),t&&t.hide()}),{signal:this.signal}),this.rootElem.appendChild(e)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((e=>e.picker.getInputValue()))}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach((e=>e.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach(((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e)))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addNewPicker(){const e=this.itemPickerPairs.length,t=document.createElement("div");t.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&t.classList.add("inline"),this.itemsDiv.appendChild(t);const s=document.createElement("div");s.classList.add("list-picker-item");const i=document.createElement("div");if(i.classList.add("list-picker-item-header"),this.config.inlineMenuBar)t.appendChild(s),t.appendChild(i);else if(t.appendChild(i),t.appendChild(s),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,i.appendChild(e)}const n=this.config.newItemPicker(s,this,e,{changedEvent:this.config.changedEvent,getValue:()=>this.getSourceValue()[e],setValue:(t,s,i)=>{const a=this.getSourceValue();a[e]=i,this.config.setValue(t,s,a)}}),o={elem:t,picker:n,idx:e};if(this.actionEnabled("move")){const s=_g.makeActionElem("list-picker-item-move","fa-arrows-up-down");i.appendChild(s);const n=Xa(s,{allowHTML:!1,content:"Move (Drag+Drop)"});s.addEventListener("click",(()=>{n.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>{n?.destroy()})),s.draggable=!0,s.addEventListener("dragstart",(e=>{e.target==s&&(e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",t.classList.add("dragfrom"),Ng={listPicker:this,item:o})}),{signal:this.signal});let l=0;t.addEventListener("dragenter",(e=>{Ng&&Ng.listPicker==this&&(e.preventDefault(),l++,t.classList.add("dragto"))}),{signal:this.signal}),t.addEventListener("dragleave",(e=>{Ng&&Ng.listPicker==this&&(e.preventDefault(),l--,l<=0&&t.classList.remove("dragto"))}),{signal:this.signal}),t.addEventListener("dragover",(e=>{Ng&&Ng.listPicker==this&&e.preventDefault()}),{signal:this.signal}),t.addEventListener("drop",(s=>{if(!Ng||Ng.listPicker!=this)return;s.preventDefault(),l=0,t.classList.remove("dragto"),Ng.item.elem.classList.remove("dragfrom");const i=Ng.item.idx,n=e,o=this.config.getValue(this.modObject),r=o[i];o.splice(i,1),o.splice(n,0,r),this.config.setValue(a.nextEventID(),this.modObject,o),Ng=null}),{signal:this.signal})}if(this.actionEnabled("copy")){const t=_g.makeActionElem("list-picker-item-copy","fa-copy");i.appendChild(t);const s=Xa(t,{allowHTML:!1,content:`Copy to New ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject).slice();t.splice(e,0,this.config.copyItem(t[e])),this.config.setValue(a.nextEventID(),this.modObject,t),s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>s?.destroy()))}if(this.actionEnabled("delete")&&(!this.config.minimumItems||e+1>this.config.minimumItems)){const t=_g.makeActionElem("list-picker-item-delete","fa-times");t.classList.add("link-danger"),i.appendChild(t);const s=Xa(t,{allowHTML:!1,content:`Delete ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject);t.splice(e,1),this.config.setValue(a.nextEventID(),this.modObject,t),s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>s?.destroy()))}this.itemPickerPairs.push(o)}static makeActionElem(e,t){return f("a",{href:"javascript:void(0)",className:Pt("list-picker-item-action",e),attributes:{role:"button"}},f("i",{className:Pt("fa","fa-xl",t)}))}static getItemHeaderElem(e){const t=e.rootElem.parentElement,s=t.nextElementSibling||t.previousElementSibling;if(!s?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return s}}const Ag={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.maxStacks>0)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasIcd)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasExclusiveEffect)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter((e=>e.data.isCastable)),{spells:s,cooldowns:i}=Ss(t,(e=>e.data.isMajorCooldown?"cooldowns":"spells")),a=[[Es.OtherActionPotion,"Uses the potion selected in consumables settings."],[Es.OtherActionOffensiveEquip,"Use any offensive on-use equipment."],[Es.OtherActionDefensiveEquip,"Use any defensive on-use equipment."]];return[[{value:E.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(s||[]).map((e=>{const t=e.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${t.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),a=s.filter((e=>!!e.id.name.match(i))).length>1;return{value:e.id,submenu:a?["Spells",t]:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:E.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(i||[]).map((e=>{const t=e.id.name.replace(/ \([\w\s%]+\)/g,""),s=new RegExp(`${t} \\(Rank [0-9]+\\)`),a=i.filter((e=>!!e.id.name.match(s))).length>1;return{value:e.id,submenu:a?["Cooldowns",t]:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:E.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],a.map((([e,t])=>({value:E.fromOtherId(e),submenu:["Placeholders"],tooltip:t})))].flat()}},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isChanneled)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasDot)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasShield)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))}};class Rg extends ws{constructor(e,t,s){const i=Ag[s.actionIdSet];super(e,t,{...s,sourceToValue:e=>e?E.fromProto(e):E.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:i.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(e,t)=>{const i=t.value,a=I(),n=["auras","stackable_auras","icd_auras","exclusive_effect_auras"].includes(s.actionIdSet);e.appendChild(f(x,null,f("a",{ref:a,className:"apl-actionid-item-icon",dataset:{whtticon:!1}}),i.name)),i.setBackgroundAndHref(a.value),i.setWowheadDataset(a.value,{useBuffAura:n})},createMissingValue:e=>0==e.anyId()?new Promise((()=>{i.defaultLabel})):e.fill().then((e=>({value:e}))),values:[]});const a=s.getUnitRef,n="self"==s.defaultUnitRef?fe.create({type:ge.Self}):fe.create({type:ge.CurrentTarget}),o=i.getActionIDs,l=async()=>{const e=a(t),s=t.sim.getUnitMetadata(e,t,n);if(s){const e=await o(s);this.setOptions(e)}};l();const r=t.sim.unitMetadataEmitter.on(l),d=t.rotationChangeEmitter.on(l);this.addOnDisposeCallback((()=>{r.dispose(),d.dispose()}))}}class Dg extends ws{constructor(e,t,s){super(e,t,{...s,sourceToValue:e=>"spellId"==e?.rawId.oneofKind?t.sim.db.getRuneById(e.rawId.spellId):vs.create(),valueToSource:e=>Is.create({rawId:{oneofKind:"spellId",spellId:e.id}}),defaultLabel:"Runes",equals:(e,t)=>e==t,setOptionContent:(e,t)=>{const s=E.fromSpellId(t.value.id),i=document.createElement("a");i.classList.add("apl-actionid-item-icon"),i.dataset.whtticon="false",i.classList.add("apl-actionid-item-icon"),s.fillAndSet(i,!0,!0),e.appendChild(i);const a=document.createTextNode(t.value.name);e.appendChild(a)},values:[]});(async()=>{const e=Object.values(D).filter((e=>"string"!=typeof e)).map((e=>t.getRunes(e))).flat().map((e=>({value:e,submenu:[ys.get(e.type)??""]})));this.setOptions(e)})(),t.rotationChangeEmitter.on((()=>this.update))}}const Mg={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map(((e,t)=>fe.create({type:ge.Pet,index:t,owner:fe.create({type:ge.Self})}))),fe.create({type:ge.CurrentTarget}),e.sim.encounter.targetsMetadata.asList().map(((e,t)=>fe.create({type:ge.Target,index:t})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>fe.create({type:ge.Target,index:t}))),fe.create({type:ge.Self}),e.getPetMetadatas().asList().map(((e,t)=>fe.create({type:ge.Pet,index:t,owner:fe.create({type:ge.Self})})))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>fe.create({type:ge.Target,index:t})))].flat()}};class Vg extends bs{constructor(e,t,s){const i=!!Mg[s.unitSet].targetUI;super(e,t,{...s,sourceToValue:e=>Vg.refToValue(e,t,i),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),this.unitSet=s.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues();const a=t.sim.unitMetadataEmitter.on((()=>this.updateValues()));this.addOnDisposeCallback((()=>{a.dispose()}))}static refToValue(e,t,s){if(!e||e.type==ge.Unknown)return{value:e,iconUrl:s?"fa-bullseye":"fa-user",text:s?"Current Target":"Self"};if(e.type==ge.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==ge.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==ge.Player){const s=t.sim.raid.getPlayer(e.index);if(s)return{value:e,iconUrl:s.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==ge.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:xs,text:`Target ${e.index+1}`}}else if(e.type==ge.Pet){const s=t.sim.getUnitMetadata(e,t,fe.create({type:ge.Self}));let i=`Pet ${e.index+1}`,a="fa-paw";if(s){const e=s.getName();if(e){const t=e.indexOf(" - ");i=e.substring(t+3),a=Ps(i)||a}}return{value:e,iconUrl:a,text:i}}return{value:e}}updateValues(){const e=Mg[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map((t=>{const s={value:Vg.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==ge.Pet&&(e.targetUI?s.submenu=[Vg.refToValue(t.owner,this.modObject,e.targetUI)]:s.submenu=[Vg.refToValue(void 0,this.modObject,e.targetUI)]),s})))}}class Ug extends w{constructor(e,t,s){super(e,"apl-picker-builder-root",t,s),this.config=s,this.fieldPickers=s.fields.map((e=>Ug.makeFieldPicker(this,e))),this.init()}static makeFieldPicker(e,t){const s=t.field,i=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,id:He(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const i=e.getSourceValue();return i[s]||(i[s]=t.newValue()),i[s]},setValue:(t,i,a)=>{e.getSourceValue()[s]=a,i.rotationChangeEmitter.emit(t)}},(()=>e.getSourceValue()));return"vals"!==s&&"actions"!==s||i.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:i}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach((t=>{e[t.field]=t.picker.getInputValue()})),e}setInputValue(e){this.fieldPickers.forEach((t=>{t.picker.setInputValue(e[t.field])}))}}function Wg(e,t,s,i,a){return{field:e,newValue:()=>Is.create(),factory:(e,a,n,o)=>new Rg(e,a,{id:He(),...n,actionIdSet:t,getUnitRef:()=>s?o()[s]:fe.create(),defaultUnitRef:i||"self"}),...a||{}}}function Fg(e,t,s){return{field:e,newValue:()=>{},factory:(e,s,i)=>new Vg(e,s,{id:He(),...i,unitSet:t}),...s||{}}}function Og(e,t,s){return{field:e,newValue:()=>!1,factory:(e,t,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new pt(e,t,{id:He(),...s})),...s||{},label:t}}function Hg(e,t,s){return{field:e,newValue:()=>0,factory:(e,s,i)=>{const a=i;return a.float=t,a.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new bh(e,s,a)},...s||{}}}function qg(e,t){return{field:e,newValue:()=>"",factory:(e,t,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new Lg(e,t,{id:He(),...s})),...t||{}}}function Bg(e,t){return(s,i,a)=>new Ug(s,i,{...a,newValue:e,fields:t})}class zg extends w{constructor(e,t,s){super(e,"apl-value-picker-root",t,s);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),a=Object.keys(Kg).filter((e=>Kg[e].includeIf?.(t,i)??!0));this.kindPicker=new Di(this.rootElem,t,{id:He(),defaultLabel:"No Condition",values:[{value:void 0,label:"<None>"}].concat(a.map((e=>{const t=Kg[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}}))),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,s)=>{const i=this.getSourceValue(),a=i?.value.oneofKind;if(a!=s){if(s){const t=Kg[s];let n=this.makeAPLValue(s,t.newValue());i&&a&&this.valuePicker&&("not"==s?n.value.not.val=this.makeAPLValue(a,this.valuePicker.getInputValue()):"not"==i.value.oneofKind&&i.value.not.val?.value.oneofKind==s?n=i.value.not.val:"and"==s?"or"==i.value.oneofKind?n.value.and.vals=i.value.or.vals:n.value.and.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"or"==s?"and"==i.value.oneofKind?n.value.or.vals=i.value.and.vals:n.value.or.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"min"==s?"max"==i.value.oneofKind?n.value.min.vals=i.value.max.vals:n.value.min.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"max"==s?"min"==i.value.oneofKind?n.value.max.vals=i.value.min.vals:n.value.max.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"and"==i.value.oneofKind&&i.value.and.vals?.[0]?.value.oneofKind==s?n=i.value.and.vals[0]:"or"==i.value.oneofKind&&i.value.or.vals?.[0]?.value.oneofKind==s?n=i.value.or.vals[0]:"min"==i.value.oneofKind&&i.value.min.vals?.[0]?.value.oneofKind==s?n=i.value.min.vals[0]:"max"==i.value.oneofKind&&i.value.max.vals?.[0]?.value.oneofKind==s?n=i.value.max.vals[0]:"cmp"==s&&(n.value.cmp.lhs=this.makeAPLValue(a,this.valuePicker.getInputValue()))),i?i.value=n.value:this.setSourceValue(e,n)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?Oi.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t])}makeAPLValue(e,t){if(!e)return Oi.create();const s={oneofKind:e};return s[e]=t,Oi.create({value:s})}updateValuePicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const s=Kg[e];this.valuePicker=s.factory(this.rootElem,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||s.newValue()},setValue:(t,s,i)=>{const a=this.getSourceValue();a&&(a.value[e]=i),s.rotationChangeEmitter.emit(t)}})}}function jg(e,t){return{field:e,newValue:Oi.create,factory:(e,t,s)=>new zg(e,t,s),...t||{}}}function $g(e){return{field:e,newValue:()=>[],factory:(e,t,s)=>new _g(e,t,{...s,setValue:(e,t,i)=>{s.setValue(e,t,i.map((e=>e||Oi.create())))},itemLabel:"Value",newItem:Oi.create,copyItem:e=>e?Oi.clone(e):e,newItemPicker:(e,s,i,a)=>new zg(e,t,a),allowedActions:["create","delete"],actions:{create:{useIcon:!0}}})}}function Gg(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:Bg(e.newValue,e.fields)}}const Kg={const:Gg({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:ks.create,fields:[qg("val")]}),cmp:Gg({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:Cs.create,fields:[jg("lhs"),(Jg="op",{field:Jg,newValue:()=>Ri.OpEq,factory:(e,t,s)=>new Di(e,t,{id:He(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ri.OpEq,label:"=="},{value:Ri.OpNe,label:"!="},{value:Ri.OpGe,label:">="},{value:Ri.OpGt,label:">"},{value:Ri.OpLe,label:"<="},{value:Ri.OpLt,label:"<"}]})}),jg("rhs")]}),math:Gg({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:Ls.create,fields:[jg("lhs"),function(e){return{field:e,newValue:()=>Mi.OpAdd,factory:(e,t,s)=>new Di(e,t,{id:He(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Mi.OpAdd,label:"+"},{value:Mi.OpSub,label:"-"},{value:Mi.OpMul,label:"*"},{value:Mi.OpDiv,label:"/"}]})}}("op"),jg("rhs")]}),max:Gg({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:Ts.create,fields:[$g("vals")]}),min:Gg({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:Ns.create,fields:[$g("vals")]}),and:Gg({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:_s.create,fields:[$g("vals")]}),or:Gg({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:As.create,fields:[$g("vals")]}),not:Gg({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:Rs.create,fields:[jg("val")]}),currentTime:Gg({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:Ds.create,fields:[]}),currentTimePercent:Gg({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:Ms.create,fields:[]}),remainingTime:Gg({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:Vs.create,fields:[]}),remainingTimePercent:Gg({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:Us.create,fields:[]}),isExecutePhase:Gg({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:Ws.create,fields:[function(e){return{field:e,newValue:()=>Wi.E20,factory:(e,t,s)=>new Di(e,t,{id:He(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Wi.E20,label:"20%"},{value:Wi.E25,label:"25%"},{value:Wi.E35,label:"35%"}]})}}("threshold")]}),numberTargets:Gg({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:Fs.create,fields:[]}),frontOfTarget:Gg({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Os.create,fields:[]}),currentHealth:Gg({label:"Health",submenu:["Resources"],shortDescription:"Amount of currently available Health.",newValue:Hs.create,fields:[Fg("sourceUnit","aura_sources")]}),currentHealthPercent:Gg({label:"Health (%)",submenu:["Resources"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:qs.create,fields:[Fg("sourceUnit","aura_sources")]}),currentMana:Gg({label:"Mana",submenu:["Resources"],shortDescription:"Amount of currently available Mana.",newValue:Bs.create,fields:[],includeIf:(e,t)=>e.getClass()!=l.ClassRogue&&e.getClass()!=l.ClassWarrior}),currentManaPercent:Gg({label:"Mana (%)",submenu:["Resources"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:zs.create,fields:[],includeIf:(e,t)=>e.getClass()!=l.ClassRogue&&e.getClass()!=l.ClassWarrior}),currentRage:Gg({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:js.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassWarrior||e.getClass()==l.ClassDruid}),currentEnergy:Gg({label:"Energy",submenu:["Resources"],shortDescription:"Amount of currently available Energy.",newValue:$s.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),timeToEnergyTick:Gg({label:"Time to Next Energy Tick",submenu:["Resources"],shortDescription:"Time until the next energy regen tick will happen",newValue:Gs.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),energyThreshold:Gg({label:"Energy Threshold",submenu:["Resources"],shortDescription:"Compares current energy to a threshold value.",newValue:Ks.create,fields:[Hg("threshold",!1,{label:">=",labelTooltip:"Energy threshold. Subtracted from maximum energy if negative."})],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),currentComboPoints:Gg({label:"Combo Points",submenu:["Resources"],shortDescription:"Amount of currently available Combo Points.",newValue:Js.create,fields:[],includeIf:(e,t)=>e.getClass()==l.ClassRogue||e.getClass()==l.ClassDruid}),gcdIsReady:Gg({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:Zs.create,fields:[]}),gcdTimeToReady:Gg({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:Ys.create,fields:[]}),autoTimeToNext:Gg({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:Qs.create,fields:[function(e){return{field:e,newValue:()=>Vi.Any,factory:(e,t,s)=>new Di(e,t,{id:He(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Vi.Any,label:"Any"},{value:Vi.Melee,label:"Melee"},{value:Vi.MainHand,label:"Main Hand"},{value:Vi.OffHand,label:"Off Hand"},{value:Vi.Ranged,label:"Ranged"}]})}}("autoType")]}),autoSwingTime:Gg({label:"Auto Swing Time",submenu:["Auto"],shortDescription:"Total swing duration including all haste buffs.",newValue:Xs.create,fields:[function(e){return{field:e,newValue:()=>Ui.MainHand,factory:(e,t,s)=>new Di(e,t,{id:He(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ui.MainHand,label:"Main Hand"},{value:Ui.OffHand,label:"Off Hand"},{value:Ui.Ranged,label:"Ranged"}]})}}("autoType")]}),spellIsKnown:Gg({label:"Spell Known",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is currently known, otherwise <b>False</b>.",newValue:ei.create,fields:[Wg("spellId","castable_spells","")]}),spellCurrentCost:Gg({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:ti.create,fields:[Wg("spellId","castable_spells","")]}),spellCanCast:Gg({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:si.create,fields:[Wg("spellId","castable_spells","")]}),spellIsReady:Gg({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:ii.create,fields:[Wg("spellId","castable_spells","")]}),spellTimeToReady:Gg({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:ai.create,fields:[Wg("spellId","castable_spells","")]}),spellCastTime:Gg({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:ni.create,fields:[Wg("spellId","castable_spells","")]}),spellTravelTime:Gg({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:oi.create,fields:[Wg("spellId","castable_spells","")]}),spellCpm:Gg({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:li.create,fields:[Wg("spellId","castable_spells","")]}),spellIsChanneling:Gg({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:ri.create,fields:[Wg("spellId","channel_spells","")]}),spellChanneledTicks:Gg({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:di.create,fields:[Wg("spellId","channel_spells","")]}),channelClipDelay:Gg({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:ci.create,fields:[]}),auraIsKnown:Gg({label:"Aura Known",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently known, otherwise <b>False</b>.",newValue:hi.create,fields:[Fg("sourceUnit","aura_sources"),Wg("auraId","auras","sourceUnit")]}),auraIsActive:Gg({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:mi.create,fields:[Fg("sourceUnit","aura_sources"),Wg("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:Gg({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:ui.create,fields:[Fg("sourceUnit","aura_sources"),Wg("auraId","auras","sourceUnit")]}),auraRemainingTime:Gg({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:pi.create,fields:[Fg("sourceUnit","aura_sources"),Wg("auraId","auras","sourceUnit")]}),auraNumStacks:Gg({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:gi.create,fields:[Fg("sourceUnit","aura_sources"),Wg("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:Gg({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:fi.create,fields:[Fg("sourceUnit","aura_sources"),Wg("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:Gg({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Ii.create,fields:[Fg("sourceUnit","aura_sources"),Wg("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:Gg({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>wi.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Fg("sourceUnit","aura_sources_targets_first"),Wg("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),jg("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),runeIsEquipped:Gg({label:"Rune Equipped",submenu:["Rune"],shortDescription:"<b>True</b> if the rune is currently equipped, otherwise <b>False</b>.",newValue:vi.create,fields:[function(e){return{field:e,newValue:()=>Is.create(),factory:(e,t,s,i)=>new Dg(e,t,{id:He(),...s})}}("runeId")]}),dotIsActive:Gg({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:bi.create,fields:[Fg("targetUnit","targets"),Wg("spellId","dot_spells","")]}),dotRemainingTime:Gg({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:xi.create,fields:[Fg("targetUnit","targets"),Wg("spellId","dot_spells","")]}),sequenceIsComplete:Gg({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:Si.create,fields:[qg("sequenceName")]}),sequenceIsReady:Gg({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:Ei.create,fields:[qg("sequenceName")]}),sequenceTimeToReady:Gg({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:yi.create,fields:[qg("sequenceName")]}),totemRemainingTime:Gg({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:Pi.create,includeIf:(e,t)=>e.getClass()==l.ClassShaman,fields:[function(e){return{field:e,newValue:()=>Fi.Water,factory:(e,t,s)=>new Di(e,t,{id:He(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Fi.Earth,label:"Earth"},{value:Fi.Air,label:"Air"},{value:Fi.Fire,label:"Fire"},{value:Fi.Water,label:"Water"}]})}}("totemType")]}),catExcessEnergy:Gg({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:ki.create,includeIf:(e,s)=>e.spec==t.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:Gg({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:Ci.create,includeIf:(e,s)=>e.spec==t.SpecFeralDruid,fields:[]}),warlockShouldRecastDrainSoul:Gg({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:Li.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:Gg({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:Ti.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[Fg("targetUnit","targets")]}),warlockCurrentPetMana:Gg({label:"Pet Mana",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana.",newValue:Ni.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[]}),warlockCurrentPetManaPercent:Gg({label:"Pet Mana (%)",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana, as a percentage.",newValue:_i.create,includeIf:(e,t)=>e.getClass()==l.ClassWarlock,fields:[]}),currentSealRemainingTime:Gg({label:"Current Seal Remaining Time",submenu:["Paladin"],shortDescription:"Returns the amount of time remaining until the Paladin's current Seal aura will expire.",newValue:Ai.create,includeIf:(e,t)=>e.getClass()==l.ClassPaladin,fields:[]})};var Jg;class Zg extends w{constructor(e,t,s){super(e,"apl-action-picker-root",t,s),this.conditionPicker=new zg(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,s)=>{const i=this.getSourceValue();i?(i.condition=s,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,la.create({condition:s}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),a=Object.keys(Xg).filter((e=>Xg[e].includeIf?.(t,i)??!0));this.kindPicker=new Di(this.actionDiv,t,{id:He(),defaultLabel:"Action",values:a.map((e=>{const t=Xg[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,s)=>{const i=this.getSourceValue(),a=i?.action.oneofKind;if(a!=s){if(s){const t=Xg[s];let n=this.makeAPLAction(s,t.newValue());i&&a&&this.actionPicker&&("sequence"==s?"strictSequence"==i.action.oneofKind?n.action.sequence.actions=i.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"strictSequence"==s?"sequence"==i.action.oneofKind?n.action.strictSequence.actions=i.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"sequence"==i.action.oneofKind&&i.action.sequence.actions?.[0]?.action.oneofKind==s?n=i.action.sequence.actions[0]:"strictSequence"==i.action.oneofKind&&i.action.strictSequence.actions?.[0]?.action.oneofKind==s&&(n=i.action.strictSequence.actions[0])),i?i.action=n.action:this.setSourceValue(e,n)}else i.action={oneofKind:s};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return la.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||Oi.create());const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return la.create();const s={oneofKind:e};return s[e]=t,la.create({action:s})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const s=Xg[e];this.actionPicker=s.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||s.newValue(),setValue:(t,s,i)=>{const a=this.getSourceValue();a&&((a?.action)[e]=i),s.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function Yg(e){return{field:e,newValue:()=>[],factory:(e,t,s)=>new _g(e,t,{...s,setValue:(e,t,i)=>{s.setValue(e,t,i.map((e=>e||la.create())))},itemLabel:"Action",newItem:la.create,copyItem:e=>e?la.clone(e):e,newItemPicker:(e,s,i,a)=>new Zg(e,t,a),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function Qg(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:Bg(e.newValue,e.fields)}}const Xg={castSpell:Qg({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:Hi.create,fields:[Wg("spellId","castable_spells",""),Fg("target","targets")]}),multidot:Qg({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>qi.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Wg("spellId","dot_spells",""),Hg("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),jg("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:Qg({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&Bi(e.spec),newValue:()=>zi.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Wg("spellId","shield_spells",""),Hg("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),jg("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:Qg({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if Instant Interrupt is true OR all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>ji.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[Wg("spellId","channel_spells",""),Fg("target","targets"),jg("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),Og("instantInterrupt","Instant Interrupt",{labelTooltip:"If checked, interrupts of this channel will happen instantly after the cast."}),Og("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),autocastOtherCooldowns:Qg({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:$i.create,fields:[]}),wait:Qg({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>Gi.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[jg("duration")]}),waitUntil:Qg({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>Ki.create(),fields:[jg("condition")]}),schedule:Qg({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>Ji.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[qg("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:Oi.create,factory:(e,t,s)=>new Zg(e,t,s)}}("innerAction")]}),sequence:Qg({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Zi.create,fields:[qg("name"),Yg("actions")]}),resetSequence:Qg({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Yi.create,fields:[qg("sequenceName")]}),strictSequence:Qg({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Qi.create,fields:[Yg("actions")]}),changeTarget:Qg({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>Xi.create(),fields:[Fg("newTarget","targets")]}),activateAura:Qg({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>ea.create(),fields:[Wg("auraId","auras")]}),activateAuraWithStacks:Qg({label:"Activate Aura With Stacks",submenu:["Misc"],shortDescription:"Activates an aura with the specified number of stacks",includeIf:(e,t)=>t,newValue:()=>ta.create({numStacks:"1"}),fields:[Wg("auraId","stackable_auras"),qg("numStacks",{label:"stacks",labelTooltip:"Desired number of initial aura stacks."})]}),addComboPoints:Qg({label:"Add Combo Points",submenu:["Misc"],shortDescription:"Add combo points to target.",includeIf:(e,t)=>t,newValue:()=>sa.create({numPoints:"1"}),fields:[qg("numPoints",{labelTooltip:"Desired number of initial combo points."})]}),cancelAura:Qg({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>ia.create(),fields:[Wg("auraId","auras")]}),triggerIcd:Qg({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>aa.create(),fields:[Wg("auraId","icd_auras")]}),itemSwap:Qg({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>Mf.includes(e.spec),newValue:()=>ra.create(),fields:[function(e){return{field:e,newValue:()=>ha.Swap1,factory:(e,t,s)=>new Di(e,t,{id:He(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:ha.Main,label:"Main"},{value:ha.Swap1,label:"Swapped"}]})}}("swapSet")]}),move:Qg({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>na.create(),fields:[jg("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),customRotation:Qg({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>da.create(),fields:[]}),catOptimalRotationAction:Qg({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded legacy algorithm.",includeIf:(e,s)=>e.spec==t.SpecFeralDruid,newValue:()=>oa.create({minCombosForRip:3,maxWaitTime:2,maintainFaerieFire:!1,useShredTrick:!1}),fields:[Hg("minCombosForRip",!1,{label:"Min Rip CP",labelTooltip:"Combo Point threshold for allowing a Rip cast"}),Hg("maxWaitTime",!0,{label:"Max Wait Time",labelTooltip:"Max seconds to wait for an Energy tick to cast rather than powershifting"}),Og("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"If checked, bundle Faerie Fire refreshes with powershifts. Ignored if an external Faerie Fire debuff is selected in settings."}),Og("useShredTrick","Use Shred Trick",{labelTooltip:'If checked, enable the "Shred trick" micro-optimization. This should only be used on short fight lengths with full powershifting uptime.'})]}),castPaladinPrimarySeal:Qg({label:"Cast Primary Seal",submenu:["Paladin"],shortDescription:"Casts the Paladin's designated primary seal spell.",includeIf:(e,s)=>e.spec==t.SpecRetributionPaladin,newValue:()=>ca.create({}),fields:[]})};class ef extends g{constructor(e,t,s){super(e,"apl-rotation-picker-root"),new _g(this.rootElem,s,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,s)=>{t.aplRotation.prepullActions=s,t.rotationChangeEmitter.emit(e)},newItem:()=>ma.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>ma.clone(e),newItemPicker:(e,t,i,a)=>new tf(e,s,a,i),inlineMenuBar:!0}),new _g(this.rootElem,s,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,s)=>{t.aplRotation.priorityList=s,t.rotationChangeEmitter.emit(e)},newItem:()=>ua.create({action:{}}),copyItem:e=>ua.clone(e),newItemPicker:(e,t,i,a)=>new sf(e,s,a,i),inlineMenuBar:!0})}}class tf extends w{getItem(){return this.getSourceValue()||ma.create({action:{}})}constructor(e,t,s,i){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,s),this.player=t;const a=_g.getItemHeaderElem(this);af(a,t,(e=>e.getCurrentStats().rotationStats?.prepullActions[i]?.warnings||[])),this.hidePicker=new nf(a,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new Lg(this.rootElem,this.player,{id:He(),label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,s)=>{this.getItem().doAtValue=s?Oi.create({value:{oneofKind:"const",const:{val:s}}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new Zg(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return ma.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||la.create()))}}class sf extends w{getItem(){return this.getSourceValue()||ua.create({action:{}})}constructor(e,t,s,i){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,s),this.player=t;const a=_g.getItemHeaderElem(this);af(a,t,(e=>e.getCurrentStats().rotationStats?.priorityList[i]?.warnings||[])),this.hidePicker=new nf(a,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new Zg(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return ua.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||la.create()))}}function af(e,t,s){const i=_g.makeActionElem("apl-warnings","fa-exclamation-triangle");i.classList.add("warning","link-warning"),i.setAttribute("data-bs-html","true");const a=Xa(i,{theme:"dropdown-tooltip",content:"Warnings"});e.appendChild(i);const n=async()=>{if(!pa(i))return a?.destroy(),i?.remove(),void t.currentStatsEmitter.off(n);a.setContent("");const e=s(t);if(e.length){i.style.visibility="visible";const t=await Promise.all(e.map((e=>E.replaceAllInString(e))));a.setContent(`\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\n\t\t\t\t<ul>\n\t\t\t\t\t${t.map((e=>`<li>${e}</li>`)).join("")}\n\t\t\t\t</ul>\n\t\t\t`)}else i.style.visibility="hidden"};n(),t.currentStatsEmitter.on(n)}class nf extends w{constructor(e,t,s){super(e,"hide-picker-root",t,s),this.inputElem=_g.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.rootElem.appendChild(this.inputElem),this.tooltip=Xa(this.inputElem,{content:"Enable/Disable"}),this.init(),this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(a.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent("Enable Action")):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent("Disable Action"))}}class of extends w{constructor(e,t,s){super(e,"number-list-picker-root",t,s),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.placeholder=s.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(e=>{this.inputChanged(a.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter((e=>!isNaN(e))):[]}setInputValue(e){Mt(this.getInputValue(),e)||(this.inputElem.value=e.map((e=>String(e))).join(","))}}class lf extends g{constructor(e,t){super(e,"cooldowns-picker-root"),this.player=t,this.cooldownPickers=[],a.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((e=>{this.update()})),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const s=e[t],i=document.createElement("div");i.classList.add("cooldown-picker"),t==e.length&&i.classList.add("add-cooldown-picker"),this.rootElem.appendChild(i),this.makeActionPicker(i,t);const n=document.createElement("label");n.classList.add("cooldown-picker-label","form-label"),s&&s.id&&E.fromProto(s.id).fill(this.player.getRaidIndex()).then((e=>n.textContent=e.name)),i.appendChild(n),this.makeTimingsPicker(i,t);const o=document.createElement("fragment");o.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="delete-cooldown link-danger"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</a>\n\t\t\t';const l=o.children[0],r=Xa(l,{content:"Delete Cooldown"});l.addEventListener("click",(e=>{const s=this.player.getSimpleCooldowns();s.cooldowns.splice(t,1),this.player.setSimpleCooldowns(a.nextEventID(),s),r.hide()})),i.appendChild(l),this.cooldownPickers.push(i)}}makeActionPicker(e,t){const s=this.player.getMetadata().getSpells().filter((e=>e.data.isMajorCooldown)).map((e=>e.id));return new Zn(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:Is.create()}].concat(s.map((e=>({actionId:()=>e,value:e.toProto()})))),equals:(e,t)=>Is.equals(e,t),zeroValue:Is.create(),backupIconUrl:e=>E.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||Is.create(),setValue:(e,s,i)=>{const a=s.getSimpleCooldowns();for(;a.cooldowns.length<t;)a.cooldowns.push(ga.create());a.cooldowns[t]=ga.create({id:i,timings:[]}),s.setSimpleCooldowns(e,a)}})}makeTimingsPicker(e,t){return new of(e,this.player,{extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,s,i)=>{const a=s.getSimpleCooldowns();a.cooldowns[t].timings=i,s.setSimpleCooldowns(e,a)},enableWhen:e=>{const s=e.getSimpleCooldowns().cooldowns[t];return s&&!Is.equals(s.id,Is.create())}})}}class rf extends wg{constructor(e,t){super(e,t,{identifier:"rotation-tab",title:"Rotation"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("rotation-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("rotation-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto"),this.rootElem.classList.remove("rotation-type-simple"),this.rootElem.classList.remove("rotation-type-apl"),this.rootElem.classList.remove("rotation-type-legacy");const e=this.simUI.player.getRotationType();e==$.TypeAuto?this.rootElem.classList.add("rotation-type-auto"):e==$.TypeSimple?this.rootElem.classList.add("rotation-type-simple"):e==$.TypeAPL?this.rootElem.classList.add("rotation-type-apl"):e==$.TypeLegacy&&this.rootElem.classList.add("rotation-type-legacy")}buildHeader(){const e=document.createElement("div");e.classList.add("rotation-tab-header"),this.leftPanel.appendChild(e),new lh(e,this.simUI.player,{id:"rotation-tab-rotation-type",label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:$.TypeAuto,name:"Auto"},{value:$.TypeSimple,name:"Simple"},{value:$.TypeAPL,name:"APL"}]:[{value:$.TypeAuto,name:"Auto"},{value:$.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,s)=>{t.aplRotation.type=s,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){const e=document.createElement("div");e.classList.add("rotation-tab-auto"),this.leftPanel.appendChild(e)}buildAplContent(){const e=document.createElement("div");e.classList.add("rotation-tab-apl"),this.leftPanel.appendChild(e),new ef(e,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new tg(this.leftPanel,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const s=w.newGroupContainer();s.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(s),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(s,this.simUI.individualConfig.rotationIconInputs.map((e=>fo(s,this.simUI.player,e))),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs),t.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}));const i=new tg(this.leftPanel,"cooldown-settings",{header:{title:"Cooldowns",tooltip:fa}});i.rootElem.classList.add(e),new lf(i.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new bh(e,this.simUI.player,t):"boolean"==t.type?new pt(e,this.simUI.player,{...t}):"enum"==t.type&&new lh(e,this.simUI.player,t)}))}configureIconSection(e,t,s){0==t.length?e.classList.add("hide"):s&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}buildSavedDataPickers(){const e=new kg(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>Ia.create({rotation:T.clone(e.aplRotation)}),setData:(e,t,s)=>{a.freezeAllAndDo((()=>{t.setAplRotation(e,s.rotation||T.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter,this.simUI.player.levelChangeEmitter],equals:(e,t)=>Ia.equals(e,t),toJson:e=>Ia.toJson(e),fromJson:e=>Ia.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((t=>{const s=t.rotation;s.rotation||(s.rotation=T.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:s,enableWhen:t.enableWhen})}))}))}}class df extends g{constructor(e,t,s,i){super(e,"encounter-picker-root"),uf(this.rootElem,t,s.showExecuteProportion),t.sim.waitForInit().then((()=>{const e=t.sim.db.getAllPresetTargets();new lh(this.rootElem,t,{id:"encounter-npc",extraCssClasses:["damage-metrics","npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>gf(t.primaryTarget,e.target))),setValue:(t,s,i)=>{-1!=i&&s.applyPresetTarget(t,e[i],0)}}),i.isIndividualSim()&&Bi(i.player.spec)&&new bh(this.rootElem,i.sim.raid,{id:"encounter-num-allies",label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:e=>e.targetDummiesChangeEmitter,getValue:e=>e.getTargetDummies(),setValue:(e,t,s)=>{t.setTargetDummies(e,s)}}),i.isIndividualSim()&&oe(i.player.spec)&&new bh(this.rootElem,t,{id:"encounter-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,s)=>{t.primaryTarget.minBaseDamage=s,t.targetsChangeEmitter.emit(e)}});const s=e.findIndex((e=>t.primaryTarget.id==e.target?.id)),n=e[s]?.target?.targetInputs||[];(n.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some(((e,t)=>e.label!=n[t].label)))&&(t.primaryTarget.targetInputs=n,t.targetsChangeEmitter.emit(a.nextEventID())),pf(this.rootElem,t,0);const o=new cf(i.rootElem,i,t),l=document.createElement("button");l.classList.add("advanced-button","btn","btn-primary"),l.textContent="Advanced",l.addEventListener("click",(()=>o.open())),this.rootElem.appendChild(l)}))}}class cf extends Vp{constructor(e,t,s){super(e,"advanced-encounter-picker-modal"),this.encounter=s,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const i=this.rootElem.getElementsByClassName("encounter-header")[0],a=this.rootElem.getElementsByClassName("encounter-targets")[0];uf(i,this.encounter,!0),t.isIndividualSim()||new pt(i,s,{id:"encounter-use-health",label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",inline:!0,changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,s)=>{t.setUseHealth(e,s)}}),new _g(a,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,s)=>{t.targets=s,t.targetsChangeEmitter.emit(e)},newItem:()=>Un.getPresetTargetForLevel(t.sim.raid.getPlayer(0)?.getLevel()??ce,t.sim).target,copyItem:e=>he.clone(e),newItemPicker:(e,t,i,a)=>new hf(e,s,i,a),minimumItems:1})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new lh(this.header,this.encounter,{id:"encounter-preset-encouter",label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2","order-first"],values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>t.matchesPreset(e))),setValue:(t,s,i)=>{-1!=i&&s.applyPreset(t,e[i])}})}}class hf extends w{getTarget(){return this.encounter.targets[this.targetIndex]||he.create()}constructor(e,t,s,i){super(e,"target-picker-root",t,i),this.encounter=t,this.targetIndex=s,this.rootElem.innerHTML='\n\t\t\t<div class="target-picker-section target-picker-section1"></div>\n\t\t\t<div class="target-picker-section target-picker-section2"></div>\n\t\t\t<div class="target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const a=this.rootElem.getElementsByClassName("target-picker-section1")[0],n=this.rootElem.getElementsByClassName("target-picker-section2")[0],o=this.rootElem.getElementsByClassName("target-picker-section3")[0],l=t.sim.db.getAllPresetTargets();new lh(a,null,{id:"encounter-npc-picker",extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(l.map(((e,t)=>({name:e.path,value:t})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>l.findIndex((e=>gf(this.getTarget(),e.target))),setValue:(e,s,i)=>{-1!=i&&(t.applyPresetTarget(e,l[i],this.targetIndex),t.targetsChangeEmitter.emit(e))}}),this.aiPicker=new lh(a,null,{id:"encounter-ai-picker",extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(l.map((e=>({name:e.path,value:e.target.id})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,s,i)=>{const a=this.getTarget();a.id=i,a.targetInputs=(l.find((e=>a.id==e.target?.id))?.target?.targetInputs||[]).map((e=>va.clone(e))),t.targetsChangeEmitter.emit(e)}}),this.levelPicker=new lh(a,null,{id:"encounter-level-picker",label:"Level",values:[{name:"63",value:63},{name:"62",value:62},{name:"61",value:61},{name:"60",value:60},{name:"53",value:53},{name:"52",value:52},{name:"51",value:51},{name:"50",value:50},{name:"43",value:43},{name:"42",value:42},{name:"41",value:41},{name:"40",value:40},{name:"28",value:28},{name:"27",value:27},{name:"26",value:26},{name:"25",value:25}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,s,i)=>{this.getTarget().level=i,t.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new lh(a,null,{id:"encounter-mob-type",label:"Mob Type",values:If,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,s,i)=>{this.getTarget().mobType=i,t.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new lh(a,null,{id:"target-picker-tanked-by",extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,s,i)=>{this.getTarget().tankIndex=i,t.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=pf(a,t,this.targetIndex),this.statPickers=ff.map((e=>{const s=e.stat;return new bh(n,null,{id:`target-picker-stats-${e.stat}`,inline:!0,extraCssClasses:e.extraCssClasses,label:ba.get(s),labelTooltip:e.tooltip,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().stats[s],setValue:(e,i,a)=>{this.getTarget().stats[s]=a,t.targetsChangeEmitter.emit(e)}})})),this.swingSpeedPicker=new bh(o,null,{id:"target-picker-swing-speed",label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,s,i)=>{this.getTarget().swingSpeed=i,t.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new bh(o,null,{id:"target-picker-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,s,i)=>{this.getTarget().minBaseDamage=i,t.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new bh(o,null,{id:"target-picker-damage-spread",label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,s,i)=>{this.getTarget().damageSpread=i,t.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new pt(o,null,{id:"target-picker-dual-wield",label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,s,i)=>{this.getTarget().dualWield=i,t.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new pt(o,null,{id:"target-picker-dw-miss-penalty",label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,s,i)=>{this.getTarget().dualWieldPenalty=i,t.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new pt(o,null,{id:"target-picker-parry-haste",label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,s,i)=>{this.getTarget().parryHaste=i,t.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new lh(o,null,{id:"target-picker-spell-school",label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:xa.SpellSchoolPhysical},{name:"Arcane",value:xa.SpellSchoolArcane},{name:"Fire",value:xa.SpellSchoolFire},{name:"Frost",value:xa.SpellSchoolFrost},{name:"Holy",value:xa.SpellSchoolHoly},{name:"Nature",value:xa.SpellSchoolNature},{name:"Shadow",value:xa.SpellSchoolShadow}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,s,i)=>{this.getTarget().spellSchool=i,t.targetsChangeEmitter.emit(e)}}),this.init()}getInputElem(){return null}getInputValue(){return he.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((e=>e.getInputValue())).map(((e,t)=>(new un).withStat(ff[t].stat,e))).reduce(((e,t)=>e.add(t))).asArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),ff.forEach(((t,s)=>this.statPickers[s].setInputValue(e.stats[t.stat]))),this.targetInputPickers.setInputValue(e.targetInputs))}}class mf extends w{getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||va.create()}constructor(e,t,s,i,a){super(e,"target-input-picker-root",t,a),this.encounter=t,this.targetIndex=s,this.targetInputIndex=i,this.boolPicker=null,this.numberPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){return va.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0})}setInputValue(e){e&&(e.inputType!=Sa.Number||this.numberPicker?e.inputType!=Sa.Bool||this.boolPicker||(this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.boolPicker=new pt(this.rootElem,null,{id:He(),label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,s)=>{this.getTargetInput().boolValue=s,this.encounter.targetsChangeEmitter.emit(e)}})):(this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker=new bh(this.rootElem,null,{id:He(),label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,s)=>{this.getTargetInput().numberValue=s,this.encounter.targetsChangeEmitter.emit(e)}})))}}function uf(e,t,s){const i=w.newGroupContainer();if(e.appendChild(i),new bh(i,t,{id:"encounter-duration",label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,s)=>{t.setDuration(e,s)},enableWhen:e=>!t.getUseHealth()}),new bh(i,t,{id:"encounter-duration-variation",label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,s)=>{t.setDurationVariation(e,s)},enableWhen:e=>!t.getUseHealth()}),s){const s=w.newGroupContainer();s.classList.add("execute-group"),e.appendChild(s),new bh(s,t,{id:"encounter-execute-proportion",label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,s)=>{t.setExecuteProportion20(e,s/100)},enableWhen:e=>!t.getUseHealth()}),new bh(s,t,{id:"encounter-execute-proportion-25",label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,s)=>{t.setExecuteProportion25(e,s/100)},enableWhen:e=>!t.getUseHealth()}),new bh(s,t,{id:"encounter-execute-proportion-35",label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,s)=>{t.setExecuteProportion35(e,s/100)},enableWhen:e=>!t.getUseHealth()})}}function pf(e,t,s){return new _g(e,t,{itemLabel:"Target Input",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[s].targetInputs,setValue:(e,t,i)=>{t.targets[s].targetInputs=i,t.targetsChangeEmitter.emit(e)},newItem:()=>va.create(),copyItem:e=>va.clone(e),newItemPicker:(e,i,a,n)=>new mf(e,t,s,a,n),hideUi:!0})}function gf(e,t){if(null==e!=(null==t))return!1;if(null==e)return!0;const s=he.clone(t);return s.targetInputs=e.targetInputs,he.equals(e,s)}const ff=[{stat:c.StatHealth,tooltip:"",extraCssClasses:[]},{stat:c.StatArmor,tooltip:"",extraCssClasses:[]},{stat:c.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]},{stat:c.StatBlockValue,tooltip:"",extraCssClasses:["threat-metrics"]}],If=[{name:"None",value:wa.MobTypeUnknown},{name:"Beast",value:wa.MobTypeBeast},{name:"Demon",value:wa.MobTypeDemon},{name:"Dragonkin",value:wa.MobTypeDragonkin},{name:"Elemental",value:wa.MobTypeElemental},{name:"Giant",value:wa.MobTypeGiant},{name:"Humanoid",value:wa.MobTypeHumanoid},{name:"Mechanical",value:wa.MobTypeMechanical},{name:"Undead",value:wa.MobTypeUndead}];function wf(e,t){return e.filter((e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config)&&(0==e.stats.length||e.stats.some((e=>t.individualConfig.epStats.includes(e)))||t.individualConfig.includeBuffDebuffInputs.includes(e.config))))}class vf extends g{constructor(e,t){super(e,"consumes-picker-root"),this.simUI=t,this.simUI.sim.waitForInit().then((()=>{this.buildPotionsPicker(),this.buildFlaskPicker(),this.buildWeaponImbuePicker(),this.buildFoodPicker(),this.buildPhysicalBuffPickers(),this.buildDefensiveBuffPickers(),this.buildSpellPowerBuffPickers(),this.buildMiscConsumesPickers(),this.buildEngPickers(),this.buildEnchPicker(),this.buildPetPicker()}))}buildPotionsPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Potions</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-potions"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-potions"),i=bc(wf(vc,this.simUI),"Potions"),n=Ir(wf(fr,this.simUI)),o=[fo(s,this.simUI.player,i),fo(s,this.simUI.player,n),fo(s,this.simUI.player,xc)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildFlaskPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Flasks</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-flasks"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-flasks"),i=Vr(wf(Mr,this.simUI)),n=[fo(s,this.simUI.player,i)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildWeaponImbuePicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Weapon Imbues</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-weapon-imbues"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-weapon-imbues"),i=nh(wf(ah,this.simUI),"Main-Hand"),n=oh(wf(ih,this.simUI),"Off-Hand"),o=[fo(s,this.simUI.player,i),fo(s,this.simUI.player,n)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.gearChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildFoodPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Food</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-food"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-food"),i=Jr(wf(Kr,this.simUI)),n=id(wf(sd,this.simUI)),o=[fo(s,this.simUI.player,i),fo(s,this.simUI.player,Zr),fo(s,this.simUI.player,n)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildPhysicalBuffPickers(){const e=this.simUI.individualConfig.epStats.includes(c.StatAgility),t=this.simUI.individualConfig.epStats.includes(c.StatStrength);if(!e&&!t)return;const s=document.createElement("fragment");s.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Physical</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-physical"></div>\n\t\t\t</div>\n\t\t';const i=this.rootElem.appendChild(s.children[0]),n=this.rootElem.querySelector(".consumes-physical"),o=wd(wf(Id,this.simUI),"Attack Power"),l=Pd(wf(yd,this.simUI),"Agility"),r=_d(wf(Nd,this.simUI),"Strength"),d=[fo(n,this.simUI.player,o),fo(n,this.simUI.player,l),fo(n,this.simUI.player,r)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(i,d))),this.updateRow(i,d)}buildDefensiveBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Defensive</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-defensive"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-defensive"),i=pd(wf(ud,this.simUI),"Health"),n=cd(wf(dd,this.simUI),"Armor"),o=[fo(s,this.simUI.player,i),fo(s,this.simUI.player,n)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildSpellPowerBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Spells</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-spells"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-spells"),i=kc(wf(Pc,this.simUI),"Spell Damage"),n=Nc(wf(Tc,this.simUI),"Fire Damage"),o=Ac(wf(_c,this.simUI),"Frost Damage"),l=Dc(wf(Rc,this.simUI),"Shadow Damage"),r=Vc(wf(Mc,this.simUI),"Mana Regen"),d=[fo(s,this.simUI.player,i),fo(s,this.simUI.player,n),fo(s,this.simUI.player,o),fo(s,this.simUI.player,l),fo(s,this.simUI.player,r)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,d))),this.updateRow(t,d)}buildMiscConsumesPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Miscellaneous</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-misc"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-misc"),i=qd(wf(Hd,this.simUI),"Zanza Buffs"),n=tc(ec,"Mage Scrolls"),o=wf(Gd,this.simUI),l=wf(Qd,this.simUI),r=[fo(s,this.simUI.player,i),fo(s,this.simUI.player,n),Kd(s,this.simUI.player,this.simUI,o),Xd(s,this.simUI.player,this.simUI,l)];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,r))),this.updateRow(t,r)}buildEngPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Engineering</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-engi"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-engi"),i=Cr(wf(kr,this.simUI),"Explosives"),n=[fo(s,this.simUI.player,Lr),fo(s,this.simUI.player,i)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildEnchPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Enchanting</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-ench">\n\t\t\t\t\t\t</div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-ench"),i=xr(wf(br,this.simUI),"Enchanted Sigils"),n=[fo(s,this.simUI.player,i)];a.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildPetPicker(){if(!this.simUI.individualConfig.petConsumeInputs?.length)return;const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Pet</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-pet"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-pet");wf(oc,this.simUI);const i=[...this.simUI.individualConfig.petConsumeInputs.map((e=>fo(s,this.simUI.player,e)))];a.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,i))),this.updateRow(t,i)}updateRow(e,t){t.find((e=>e?.showWhen()))?e.classList.remove("hide"):e.classList.add("hide")}}class bf extends g{constructor(e,t,s,i){super(e,"icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.player=s,this.slot=i,this.iconAnchor=document.createElement("a"),this.iconAnchor.classList.add("icon-picker-button"),this.iconAnchor.target="_blank",this.rootElem.prepend(this.iconAnchor);const a=new pg(t.rootElem,t,this.player);s.sim.waitForInit().then((()=>{this.iconAnchor.addEventListener("click",(e=>{e.preventDefault(),a.openTab(this.slot,ug.Items,this.createGearData())}))})),s.itemSwapChangeEmitter.on((()=>{this.update(s.getItemSwapGear().getEquippedItem(i))}))}update(e){this.iconAnchor.style.backgroundImage=`url('${mg(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",e?(this.iconAnchor.classList.add("active"),e.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(e,this.iconAnchor)):this.iconAnchor.classList.remove("active")}createGearData(){return{equipItem:(e,t)=>{this.player.equipItemSwapitem(e,this.slot,t)},getEquippedItem:()=>this.player.getItemSwapItem(this.slot),changeEvent:this.player.itemSwapChangeEmitter}}}class xf extends g{constructor(e,t,s,i){super(e,"item-swap-picker-root"),this.itemSlots=i.itemSlots,this.enableItemSwapPicker=new pt(this.rootElem,s,{id:"enable-item-swap",reverse:!0,label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.getEnableItemSwap(),setValue(e,t,s){t.setEnableItemSwap(e,s)},changedEvent:e=>e.itemSwapChangeEmitter});const n=document.createElement("div");let o;n.classList.add("input-root","input-inline"),this.rootElem.appendChild(n),i.note&&(o=this.rootElem.appendChild(f("p",{className:"form-text"},i.note)));const l=()=>{s.getEnableItemSwap()?(n.classList.remove("hide"),o?.classList.remove("hide")):(n.classList.add("hide"),o?.classList.add("hide"))};s.itemSwapChangeEmitter.on(l),l();const r=document.createElement("label");r.classList.add("form-label"),r.textContent="Item Swap",n.appendChild(r);const d=w.newGroupContainer();d.classList.add("icon-group"),n.appendChild(d);const c=f("a",{href:"javascript:void(0)",className:"gear-swap-icon",attributes:{role:"button"}},f("i",{className:"fas fa-arrows-rotate me-1"}));c.addEventListener("click",(e=>this.swapWithGear(a.nextEventID(),s))),d.appendChild(c),Xa(c,{content:"Swap with equipped items"}),this.itemSlots.forEach((e=>{new bf(d,t,s,e)}))}swapWithGear(e,t){let s=t.getGear(),i=t.getItemSwapGear();this.itemSlots.forEach((e=>{const a=t.getGear().getEquippedItem(e),n=t.getItemSwapGear().getEquippedItem(e);s=s.withEquippedItem(e,n,t.canDualWield2H()),i=i.withEquippedItem(e,a,t.canDualWield2H())})),a.freezeAllAndDo((()=>{t.setGear(e,s),t.setItemSwapGear(e,i)}))}}class Sf extends g{constructor(e,t){if(super(e,"preset-builds-picker-root"),this.simUI=t,this.builds=this.simUI.individualConfig.presets.builds??[],!this.builds.length)return void this.rootElem.classList.add("hide");const s=I(),i=I();this.rootElem.appendChild(f(x,null,f("label",{className:"form-label"},"Preset Builds",f("a",{href:"javascript:void(0)",className:"ms-1",ref:i},f("i",{className:"fa-regular fa-circle-question"}))),f("div",{className:"presets-container",ref:s}))),Xa(i.value,{content:"Preset builds apply an optimal combination of gear, talents, and rotation."}),this.simUI.sim.waitForInit().then((()=>{this.builds.forEach((e=>{const t=I();s.value.appendChild(f("button",{className:"saved-data-set-chip badge rounded-pill",ref:t},f("span",{className:"saved-data-set-name",attributes:{role:"button"},onclick:()=>this.applyBuild(e)},e.name)));const i=()=>{this.isBuildActive(e)?t.value.classList.add("active"):t.value.classList.remove("active")};i(),a.onAny([this.simUI.player.gearChangeEmitter,this.simUI.player.talentsChangeEmitter,this.simUI.player.rotationChangeEmitter]).on(i)}))}))}applyBuild(e){const t=a.nextEventID();a.freezeAllAndDo((()=>{this.simUI.player.setGear(t,this.simUI.sim.db.lookupEquipmentSpec(e.gear.gear)),this.simUI.player.setTalentsString(t,e.talents.data.talentsString),this.simUI.player.setAplRotation(t,e.rotation.rotation.rotation)}))}isBuildActive(e){return _t.equals(e.gear.gear,this.simUI.player.getGear().asSpec())&&e.talents.data.talentsString==this.simUI.player.getTalentsString()&&T.equals(e.rotation.rotation.rotation,this.simUI.player.getResolvedAplRotation())}}class Ef extends wg{constructor(e,t){super(e,t,{identifier:"settings-tab",title:"Settings"}),this.column1=this.buildColumn(1,"settings-left-col"),this.column2=this.buildColumn(2,"settings-left-col"),this.column3=this.buildColumn(3,"settings-left-col"),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.simUI.sim.waitForInit().then((()=>{this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.buildIsbSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildWorldBuffsSettings(),this.buildDebuffsSettings(),this.buildSavedDataPickers())}))}buildEncounterSettings(){const e=new tg(this.column1,"encounter-settings",{header:{title:"Encounter"}});new df(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const e=new tg(this.column1,"player-settings",{header:{title:"Player"}}),t=w.newGroupContainer();t.classList.add("player-icon-group","icon-group"),e.bodyElement.appendChild(t),this.configureIconSection(t,this.simUI.individualConfig.playerIconInputs.map((e=>fo(t,this.simUI.player,e))),!0),new Sf(e.bodyElement,this.simUI),new lh(e.bodyElement,this.simUI.player,{id:"player-level",label:"Level",values:Ea.map((e=>({name:`Level ${e}`,value:e}))),changedEvent:e=>e.levelChangeEmitter,getValue:e=>e.getLevel(),setValue:(e,t,s)=>t.setLevel(e,s)});const s=A[this.simUI.player.spec];new lh(e.bodyElement,this.simUI.player,{id:"player-race",label:"Race",values:s.map((e=>({name:ya.get(e),value:e}))),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,s)=>t.setRace(e,s)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(e.bodyElement,this.simUI.individualConfig.playerInputs);const i=w.newGroupContainer();e.bodyElement.appendChild(i);const a=d(F);new lh(i,this.simUI.player,{id:"player-profession-1",label:"Profession 1",values:a.map((e=>({name:Yt.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,s)=>t.setProfession1(e,s)}),new lh(i,this.simUI.player,{id:"player-profession-2",label:"Profession 2",values:a.map((e=>({name:Yt.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,s)=>t.setProfession2(e,s)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new tg(e,"consumes-settings",{header:{title:"Consumables"}});new vf(t.bodyElement,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter((e=>!e.extraCssClasses||!e.extraCssClasses?.includes("within-raid-sim-hide"))),t=this.simUI.individualConfig.itemSwapConfig;if(e.length||t?.itemSlots.length){const s=new tg(this.column2,"other-settings",{header:{title:"Other"}});e.length&&(this.configureInputSection(s.bodyElement,this.simUI.individualConfig.otherInputs),s.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}))),t?.itemSlots.length&&new xf(s.bodyElement,this.simUI,this.simUI.player,t)}}buildIsbSettings(){if(!this.simUI.isWithinRaidSim){const e=new tg(this.column1,"other-settings",{header:{title:"Improved Shadow Bolt"}});this.configureInputSection(e.bodyElement,mh),a.onAny([this.simUI.player.talentsChangeEmitter,this.simUI.player.getRaid().debuffsChangeEmitter]).on((()=>{const t=this.simUI.player?.getTalents().improvedShadowBolt>0,s=this.simUI.player?.getTalents().improvedShadowBolt>0;1==this.simUI.player.getRaid()?.getDebuffs()?.improvedShadowBolt||t||s?e.rootElem.classList.remove("hide"):e.rootElem.classList.add("hide")}))}}buildBuffsSettings(){const e=wf(Jl,this.simUI),t=wf(Zl,this.simUI),s=new tg(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:Pa}});this.configureIconSection(s.bodyElement,e.map((e=>e.picker&&new e.picker(s.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new No(s.bodyElement,this.simUI.player,{values:t.map((e=>e.config)),label:"Misc Buffs"},this.simUI)}buildWorldBuffsSettings(){const e=new tg(this.column3,"world-buffs-settings",{header:{title:"World Buffs",tooltip:ka}}),t=wf(Ql,this.simUI);new Zn(e.bodyElement,this.simUI.player,cl(t));const s=wf(Yl,this.simUI);this.configureIconSection(e.bodyElement,s.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))))}buildDebuffsSettings(){const e=wf(Xl,this.simUI),t=wf(er,this.simUI);if(!e.length&&!t.length)return;const s=new tg(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:Ca}});this.configureIconSection(s.bodyElement,e.map((e=>e.picker&&new e.picker(s.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new No(s.bodyElement,this.simUI.player,{values:t.map((e=>e.config)),label:"Misc Debuffs"},this.simUI),this.simUI.player.getRaid()?.debuffsChangeEmitter.emit(a.nextEventID())}buildSavedDataPickers(){const e=new kg(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>La.create({encounter:e.toProto()}),setData:(e,t,s)=>t.fromProto(e,s.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>La.equals(e,t),toJson:e=>La.toJson(e),fromJson:e=>La.fromJson(e)}),t=new kg(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:e=>{const t=e.player;return Ta.create({raidBuffs:e.sim.raid.getBuffs(),partyBuffs:t.getParty()?.getBuffs()||i.create(),playerBuffs:t.getBuffs(),debuffs:e.sim.raid.getDebuffs(),consumes:t.getConsumes(),race:t.getRace(),level:t.getLevel(),professions:t.getProfessions(),enableItemSwap:t.getEnableItemSwap(),itemSwap:t.getItemSwapGear().toProto(),reactionTimeMs:t.getReactionTime(),channelClipDelayMs:t.getChannelClipDelay(),inFrontOfTarget:t.getInFrontOfTarget(),distanceFromTarget:t.getDistanceFromTarget(),healingModel:t.getHealingModel()})},setData:(e,t,s)=>{a.freezeAllAndDo((()=>{t.player.setLevel(e,s.level),t.sim.raid.setBuffs(e,s.raidBuffs||ue.create()),t.sim.raid.setDebuffs(e,s.debuffs||pe.create());const a=t.player.getParty();a&&a.setBuffs(e,s.partyBuffs||i.create()),t.player.setBuffs(e,s.playerBuffs||P.create()),t.player.setConsumes(e,s.consumes||k.create()),t.player.setRace(e,s.race),t.player.setProfessions(e,s.professions),t.player.setEnableItemSwap(e,s.enableItemSwap),t.player.setItemSwapGear(e,t.sim.db.lookupItemSwap(s.itemSwap||Na.create())),t.player.setReactionTime(e,s.reactionTimeMs),t.player.setChannelClipDelay(e,s.channelClipDelayMs),t.player.setInFrontOfTarget(e,s.inFrontOfTarget),t.player.setDistanceFromTarget(e,s.distanceFromTarget),t.player.setHealingModel(e,s.healingModel||N.create())}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapChangeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>Ta.equals(e,t),toJson:e=>Ta.toJson(e),fromJson:e=>Ta.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),t.loadUserData()}))}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new bh(e,this.simUI.player,t):"boolean"==t.type?new pt(e,this.simUI.player,{...t,reverse:!0}):"enum"==t.type&&new lh(e,this.simUI.player,t)}))}configureIconSection(e,t,s){0==t.length?e.classList.add("hide"):s&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}class yf extends wg{constructor(e,t){super(e,t,{identifier:"talents-tab",title:"Talents"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("talents-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("talents-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildTalentsPicker(this.leftPanel),this.buildSavedTalentsPicker()}buildTalentsPicker(e){new gn(e,this.simUI.player,{klass:this.simUI.player.getClass(),trees:Tn[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,s)=>{t.setTalentsString(e,s)},pointsPerRow:5})}buildSavedTalentsPicker(){const e=new kg(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>gs.create({talentsString:e.getTalentsString()}),setData:(e,t,s)=>{a.freezeAllAndDo((()=>{t.setTalentsString(e,s.talentsString)}))},changeEmitters:[this.simUI.player.talentsChangeEmitter,this.simUI.player.levelChangeEmitter],equals:(e,t)=>gs.equals(e,t),toJson:e=>gs.toJson(e),fromJson:e=>gs.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,enableWhen:t.enableWhen})}))}))}}const Pf=class e extends Vp{constructor(e,t,s,i){super(e.rootElem,"ep-weights-menu",function(e){const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()&&e.sim.getShowExperimental()?{size:"xl",...t}:t}(e)),this.showAllStats=!1,this.simUI=e,this.statsType="ep",this.epStats=t,this.epPseudoStats=s,this.epReferenceStat=i,this.header?.insertAdjacentHTML("afterbegin",'<h5 class="modal-title">Calculate Stat Weights</h5>'),this.body.innerHTML='\n\t\t\t<div class="ep-weights-options row">\n\t\t\t\t<div class="col col-sm-3">\n\t\t\t\t\t<select class="ep-type-select form-select">\n\t\t\t\t\t\t<option value="ep">EP</option>\n\t\t\t\t\t\t<option value="weight">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="show-all-stats-container col col-sm-3"></div>\n\t\t\t</div>\n\t\t\t<div class="ep-reference-options row experimental">\n\t\t\t\t<div class="col col-sm-4 damage-metrics">\n\t\t\t\t\t<span>DPS/TPS reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select damage-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 healing-metrics">\n\t\t\t\t\t<span>Healing reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select healing-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 threat-metrics">\n\t\t\t\t\t<span>Mitigation reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select threat-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\n\t\t\t</div>\n\t\t\t<p>The \'Current EP\' column displays the values currently used by the item pickers to sort items.</br>\n\t\t\tUse the <a href=\'javascript:void(0)\' class="fa fa-copy"></a> icon above the EPs to use newly calculated EPs.</p>\n\t\t\t<div class="results-ep-table-container modal-scroll-table">\n\t\t\t\t<div class="results-pending-overlay"></div>\n\t\t\t\t<table class="results-ep-table">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>Death EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th style="text-align: center">\n\t\t\t\t\t\t\t\t<span>Current EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-arrows-rotate"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class="ep-ratios">\n\t\t\t\t\t\t\t<td>EP Ratio</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle;">\n\t\t\t\t\t\t\t\t<button class="btn btn-primary compute-ep">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\t\t\t\t\t\t<span class="not-tiny">Update </span>EP\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button class="btn btn-primary calc-weights">\n\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\tCalculate\n\t\t\t</button>\n\t\t',this.container=this.rootElem.querySelector(".results-ep-table-container"),this.table=this.rootElem.querySelector(".results-ep-table"),this.tableBody=this.rootElem.querySelector(".results-ep-table tbody");const n=this.rootElem.querySelector(".results-pending-overlay");this.resultsViewer=new Ig(n);const o=()=>{"ep"==this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},l=this.rootElem.getElementsByClassName("ep-type-select")[0];l.addEventListener("input",(e=>{this.statsType=l.value,o()})),l.value=this.statsType,o();const r=e=>void 0!==e?m(e,this.simUI.player.getClass()):"??",d=e=>{for(const t of this.epStats)if(r(t)==e)return t},c=()=>{this.simUI.player.epRefStatChangeEmitter.emit(a.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()};this.rootElem.querySelectorAll(".ref-stat-select").forEach(((e,t)=>{this.epStats.forEach((t=>{e.options[e.options.length]=new Option(r(t))})),e.classList.contains("damage-metrics")?(e.addEventListener("input",(t=>{this.simUI.dpsRefStat=d(e.value),c()})),e.value=r(this.getDpsEpRefStat())):e.classList.contains("healing-metrics")?(e.addEventListener("input",(t=>{this.simUI.healRefStat=d(e.value),c()})),e.value=r(this.getHealEpRefStat())):e.classList.contains("threat-metrics")&&(e.addEventListener("input",(t=>{this.simUI.tankRefStat=d(e.value),c()})),e.value=r(this.getTankEpRefStat()))}));const h=this.rootElem.getElementsByClassName("calc-weights")[0];h.addEventListener("click",(async e=>{const t=h.innerHTML;h.classList.add("disabled"),h.style.width=`${h.getBoundingClientRect().width.toFixed(3)}px`,h.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running',this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const s=this.simUI.sim.getIterations(),i=await this.simUI.player.computeStatWeights(a.nextEventID(),this.epStats,this.epPseudoStats,this.epReferenceStat,(e=>{this.setSimProgress(e)}));this.container.classList.remove("pending"),this.resultsViewer.hideAll(),h.innerHTML=t,h.classList.remove("disabled"),this.simUI.prevEpIterations=s,this.simUI.prevEpSimResult=this.calculateEp(i),this.updateTable()}));const u=Array.from(this.rootElem.getElementsByClassName("col-action")),p=(e,t,s,i,n)=>{const o=e.previousElementSibling;Xa(o,{content:()=>{if(!n)return t;const e=r(n());return t+` Normalized by ${e}.`}}),Xa(e,{content:s}),e.addEventListener("click",(e=>{this.simUI.player.setEpWeights(a.nextEventID(),un.fromProto(i())),this.updateTable()}))};p(u[0],"Per-point increase in DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.weights)),p(u[1],"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.epValues),(()=>this.getDpsEpRefStat())),p(u[2],"Per-point increase in HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.weights)),p(u[3],"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.epValues),(()=>this.getHealEpRefStat())),p(u[4],"Per-point increase in TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.weights)),p(u[5],"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.epValues),(()=>this.getDpsEpRefStat())),p(u[6],"Per-point increase in DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.weights)),p(u[7],"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.epValues),(()=>this.getTankEpRefStat())),p(u[8],"Per-point decrease in TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.weights)),p(u[9],"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.epValues),(()=>this.getTankEpRefStat())),p(u[10],"Per-point decrease in p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.weights)),p(u[11],"EP (Equivalency Points) for p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.epValues),(()=>this.getTankEpRefStat())),p(u[12],"Current EP Weights. Used to sort the gear selector menus.","Restore Default EP",(()=>this.simUI.individualConfig.defaults.epWeights.toProto()));const g=this.rootElem.getElementsByClassName("show-all-stats-container")[0];new pt(g,this,{id:"ep-show-all-stats",label:"Show All Stats",inline:!0,changedEvent:()=>new a,getValue:()=>this.showAllStats,setValue:(e,t,s)=>{this.showAllStats=s,this.updateTable()}}),this.updateTable();const f=(e,t)=>{new bh(e,this.simUI.player,{id:`ep-ratio-${t}`,float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:e=>this.simUI.player.getEpRatios()[t],setValue:(e,s,i)=>{const a=s.getEpRatios();a[t]=i,s.setEpRatios(e,a)}})};this.body.querySelectorAll(".type-ratio.type-ep").forEach(f),this.simUI.player.epRatiosChangeEmitter.on((e=>this.updateTable()));this.body.querySelectorAll(".type-ratio.type-weight").forEach(f);const I=this.rootElem.getElementsByClassName("compute-ep")[0];Xa(I,{content:"Compute Weighted EP"}),I.addEventListener("click",(e=>{const t=this.getPrevSimResult(),s=this.simUI.player.getEpRatios();if("ep"==this.statsType){const e=un.fromProto(t.dps.epValues).scale(s[0]),i=un.fromProto(t.hps.epValues).scale(s[1]),n=un.fromProto(t.tps.epValues).scale(s[2]),o=un.fromProto(t.dtps.epValues).scale(s[3]),l=un.fromProto(t.tmi.epValues).scale(s[4]),r=un.fromProto(t.pDeath.epValues).scale(s[5]),d=e.add(i).add(n).add(o).add(l).add(r);this.simUI.player.setEpWeights(a.nextEventID(),d)}else{const e=un.fromProto(t.dps.weights).scale(s[0]),i=un.fromProto(t.hps.weights).scale(s[1]),n=un.fromProto(t.tps.weights).scale(s[2]),o=un.fromProto(t.dtps.weights).scale(s[3]),l=un.fromProto(t.tmi.weights).scale(s[4]),r=un.fromProto(t.pDeath.weights).scale(s[5]),d=e.add(i).add(n).add(o).add(l).add(r);this.simUI.player.setEpWeights(a.nextEventID(),d)}this.updateTable()}))}setSimProgress(e){this.resultsViewer.setContent(`\n\t\t\t<div class="results-sim">\n\t\t\t\t<div class=""> ${e.completedSims} / ${e.totalSims}<br>simulations complete</div>\n\t\t\t\t<div class="">\n\t\t\t\t\t${e.completedIterations} / ${e.totalIterations}<br>iterations complete\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}updateTable(){this.tableBody.innerHTML="",e.epUnitStats.forEach((e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const t=this.makeTableRow(e);this.tableBody.appendChild(t)}))}makeTableRow(e){const t=document.createElement("tr"),s=this.simUI.prevEpSimResult,i=this.simUI.player.getEpRatios(),a=function(e,t,s){return s?(s.dps?.epValues?t[0]*e.getProtoValue(s.dps.epValues):0)+(s.hps?.epValues?t[1]*e.getProtoValue(s.hps.epValues):0)+(s.tps?.epValues?t[2]*e.getProtoValue(s.tps.epValues):0)+(s.dtps?.epValues?t[3]*e.getProtoValue(s.dtps.epValues):0)+(s.tmi?.epValues?t[4]*e.getProtoValue(s.tmi.epValues):0)+(s.pDeath?.epValues?t[5]*e.getProtoValue(s.pDeath.epValues):0):0}(e,i,s);t.innerHTML=`\n\t\t\t<td>${e.getName(this.simUI.player.getClass())}</td>\n\t\t\t${this.makeTableRowCells(e,s?.dps,"damage-metrics",a,i[0])}\n\t\t\t${this.makeTableRowCells(e,s?.hps,"healing-metrics",a,i[1])}\n\t\t\t${this.makeTableRowCells(e,s?.tps,"threat-metrics",a,i[2])}\n\t\t\t${this.makeTableRowCells(e,s?.dtps,"threat-metrics",a,i[3])}\n\t\t\t${this.makeTableRowCells(e,s?.tmi,"threat-metrics experimental",a,i[4])}\n\t\t\t${this.makeTableRowCells(e,s?.pDeath,"threat-metrics experimental",a,i[5])}\n\t\t\t<td class="current-ep"></td>\n\t\t`;const n=t.querySelector(".current-ep");return new bh(n,this.simUI.player,{id:`ep-weight-stat-${e}`,float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:t=>this.simUI.player.getEpWeights().getUnitStat(e),setValue:(t,s,i)=>{const a=s.getEpWeights().withUnitStat(e,i);s.setEpWeights(t,a)}}),t}makeTableRowCells(e,t,s,i,a){let n,o;if(t){const s=e.getProtoValue(t.weights),i=e.getProtoValue(t.weightsStdev);n=this.makeTableCellContents(s,i);const a=e.getProtoValue(t.epValues),l=e.getProtoValue(t.epValuesStdev);o=this.makeTableCellContents(a,l)}else n='<span class="results-avg notapplicable">N/A</span>',o=n;const l=document.createElement("template");if(l.innerHTML=`\n\t\t\t<td class="stdev-cell ${s} type-weight">\n\t\t\t\t${n}\n\t\t\t</td>\n\t\t\t<td class="stdev-cell ${s} type-ep">\n\t\t\t\t${o}\n\t\t\t</td>\n\t\t`,!t)return l.innerHTML;if(0==a){return l.content.querySelectorAll(".stdev-cell").forEach((e=>e.classList.add("unused-ep"))),l.innerHTML}const r=i-this.simUI.player.getEpWeights().getUnitStat(e),d=l.content.querySelector(".type-ep .results-avg");return"0.00"==r.toFixed(2)||(r>0?d.classList.add("positive"):r<0&&d.classList.add("negative")),l.innerHTML}makeTableCellContents(e,t){const s=this.simUI.prevEpIterations||1;return`\n\t\t\t<span class="results-avg">${e.toFixed(2)}</span>\n\t\t\t<span class="results-stdev">\n\t\t\t\t(<i class="fas fa-plus-minus fa-xs"></i>${_a(t,s).toFixed(2)})\n\t\t\t</span>\n\t\t`}calculateEp(t){const s=ye.clone(t),i=(t,s)=>{const i=mn.fromStat(t),a=i.getProtoValue(s.weights),n=i.getProtoValue(s.weightsStdev);e.epUnitStats.forEach((e=>{const t=e.getProtoValue(s.weights);e.setProtoValue(s.epValues,0==a?0:t/a);const i=e.getProtoValue(s.weightsStdev);e.setProtoValue(s.epValuesStdev,0==n?0:i/n)}))};return void 0!==this.simUI.dpsRefStat&&(i(this.simUI.dpsRefStat,s.dps),i(this.simUI.dpsRefStat,s.tps)),void 0!==this.simUI.healRefStat&&i(this.simUI.healRefStat,s.hps),void 0!==this.simUI.tankRefStat&&(i(this.simUI.tankRefStat,s.dtps),i(this.simUI.tankRefStat,s.tmi),i(this.simUI.tankRefStat,s.pDeath)),s}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:c.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||ye.create({dps:{weights:(new un).toProto(),weightsStdev:(new un).toProto(),epValues:(new un).toProto(),epValuesStdev:(new un).toProto()},hps:{weights:(new un).toProto(),weightsStdev:(new un).toProto(),epValues:(new un).toProto(),epValuesStdev:(new un).toProto()},tps:{weights:(new un).toProto(),weightsStdev:(new un).toProto(),epValues:(new un).toProto(),epValuesStdev:(new un).toProto()},dtps:{weights:(new un).toProto(),weightsStdev:(new un).toProto(),epValues:(new un).toProto(),epValuesStdev:(new un).toProto()},tmi:{weights:(new un).toProto(),weightsStdev:(new un).toProto(),epValues:(new un).toProto(),epValuesStdev:(new un).toProto()},pDeath:{weights:(new un).toProto(),weightsStdev:(new un).toProto(),epValues:(new un).toProto(),epValuesStdev:(new un).toProto()}})}};Pf.epUnitStats=mn.getAll().filter((e=>!!e.isStat()||[h.PseudoStatMainHandDps,h.PseudoStatOffHandDps,h.PseudoStatRangedDps].includes(e.getPseudoStat())));let kf=Pf;class Cf extends Vp{constructor(e,t){super(e,"settings-menu",{title:"Options",footer:!0}),this.simUI=t;const s=I(),i=I(),n=I(),o=I(),l=I(),r=I(),d=I(),c=f("div",null,f("div",{className:"picker-group"},f("div",{className:"fixed-rng-seed-container"},f("div",{ref:i,className:"fixed-rng-seed"}),f("div",{className:"form-text"},f("span",null,"Last used RNG seed:"),"",f("span",{ref:n,className:"last-used-rng-seed"},"0"))),f("div",{ref:o,className:"language-picker within-raid-sim-hide"})),f("div",{ref:l,className:"show-threat-metrics-picker w-50 pe-2"}),f("div",{ref:r,className:"show-experimental-picker w-50 pe-2"}),f("div",{ref:d,className:"show-quick-swap-picker w-50 pe-2"}));this.body.replaceChildren(c);const h=f("button",{ref:s,className:"restore-defaults-button btn btn-primary"},"Restore Defaults");if(this.footer&&this.footer.replaceChildren(h),s.value&&(Xa(s.value,{content:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),s.value.addEventListener("click",(()=>{this.simUI.applyDefaults(a.nextEventID()),new Up({variant:"success",body:"Restored to default settings."})}))),i.value&&new bh(i.value,this.simUI.sim,{id:"simui-fixed-rng-seed",label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,s)=>{t.setFixedRngSeed(e,s)}}),n.value&&(n.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>{n.value&&(n.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()))}))),o.value){const e=Object.keys(Aa),t=e.indexOf("en");new lh(o.value,this.simUI.sim,{id:"simui-language-picker",label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:e.map(((e,t)=>({name:Aa[e],value:t}))),changedEvent:e=>e.languageChangeEmitter,getValue:s=>{const i=e.indexOf(s.getLanguage());return-1==i?t:i},setValue:(t,s,i)=>{s.setLanguage(t,e[i]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)))}l.value&&new pt(l.value,this.simUI.sim,{id:"simui-show-threat-metrics",label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,s)=>{t.setShowThreatMetrics(e,s)}}),r.value&&new pt(r.value,this.simUI.sim,{id:"simui-show-experimental",label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,s)=>{t.setShowExperimental(e,s)}})}}class Lf extends g{static buildDiscordLink(){const e=f("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank",className:"discord-link link-alt",dataset:{tippyContent:"Join us on Discord"}},f("i",{className:"fab fa-discord fa-lg"}));return Xa(e),e}static buildGitHubLink(){const e=f("a",{href:"https://github.com/wowsims/sod",target:"_blank",className:"github-link link-alt",dataset:{tippyContent:"Contribute on GitHub"}},f("i",{className:"fab fa-github fa-lg"}));return Xa(e),e}static buildPatreonLink(){const e=f("a",{href:"https://patreon.com/wowsims",target:"_blank",className:"patreon-link link-alt",dataset:{tippyContent:"Support us on Patreon"}},f("i",{className:"fab fa-patreon fa-lg"})," Patreon");return Xa(e),e}}class Tf extends g{constructor(e,t){super(e,"sim-header"),this.simUI=t,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=f("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(e,t){const s=0==this.simTabsContainer.children.length,i=f("li",{className:`${t} nav-item`,attributes:{role:"presentation"}},f("a",{className:`nav-link ${s&&"active"}`,dataset:{bsToggle:"tab",bsTarget:`#${t}`},attributes:{role:"tab","aria-selected":s},type:"button"},e));i.setAttribute("aria-controls",t),this.simTabsContainer.appendChild(i)}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,s){this.addImportExportLink(".import-dropdown",e,t,s)}addExportLink(e,t,s){this.addImportExportLink(".export-dropdown",e,t,s)}addImportExportLink(e,t,s,i){const a=this.rootElem.querySelector(e).querySelector(".dropdown-menu"),n=I();a.appendChild(f("li",null,f("a",{ref:n,href:"javascript:void(0)",className:"dropdown-item",attributes:{role:"button"}},t))),n.value?.addEventListener("click",(()=>s.open()))}addToolbarLink(e){const t=I();return e.parent.appendChild(f("div",{className:"sim-toolbar-item"},f("a",{ref:t,href:e.href?e.href:"javascript:void(0)",className:e.classes||"",target:e.href?"_blank":"_self"},e.icon&&f("i",{className:e.icon}),e.text?` ${e.text} `:""))),t.value&&(e.onclick&&t.value.addEventListener("click",e.onclick),e.tooltip&&Xa(t.value,{content:e.tooltip,placement:"bottom"})),t.value}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"})}addKnownIssue(e){const t=f("li",null);t.innerHTML=e,this.knownIssuesContent.appendChild(t),this.knownIssuesLink.classList.remove("hide"),this.knownIssuesLink._tippy?.setContent(this.knownIssuesContent)}addBugReportLink(){this.addToolbarLink({href:"https://github.com/wowsims/sod/issues/new/choose",parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){const e="https://github.com/wowsims/sod/releases",t="fas fa-gauge-high fa-lg",s=this.simToolbar;Ra()?fetch("/version").then((i=>{i.json().then((i=>{2==i.outdated&&this.addToolbarLink({href:e,parent:s,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((e=>{console.warn("No version info found!")}))})):this.addToolbarLink({href:e,parent:s,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){const e=new Cf(this.simUI.rootElem,this.simUI);this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>e.open()})}addSocialLinks(){const e=document.createElement("div");e.classList.add("sim-toolbar-socials"),this.simToolbar.appendChild(e),this.addDiscordLink(e),this.addGitHubLink(e),this.addPatreonLink(e)}addDiscordLink(e){e.appendChild(f("div",{className:"sim-toolbar-item"},Lf.buildDiscordLink()))}addGitHubLink(e){e.appendChild(f("div",{className:"sim-toolbar-item"},Lf.buildGitHubLink()))}addPatreonLink(e){e.appendChild(f("div",{className:"sim-toolbar-item"},Lf.buildPatreonLink()))}customRootElement(){return f("header",{className:"sim-header"},f("div",{className:"sim-header-container"},f("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),f("div",{className:"import-export within-raid-sim-hide"},f("div",{className:"dropdown sim-dropdown-menu import-dropdown"},f("a",{href:"javascript:void(0)",className:"import-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},f("i",{className:"fa fa-download"})," Import "),f("ul",{className:"dropdown-menu"})),f("div",{className:"dropdown sim-dropdown-menu export-dropdown"},f("a",{href:"javascript:void(0)",className:"export-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},f("i",{className:"fa fa-right-from-bracket"})," Export "),f("ul",{className:"dropdown-menu"}))),f("div",{className:"sim-toolbar"})))}}class Nf extends g{constructor(e,s,i={}){super(e,"sim-title-dropdown-root"),this.specLabels={[t.SpecBalanceDruid]:"Balance",[t.SpecFeralDruid]:"Feral DPS",[t.SpecFeralTankDruid]:"Feral Tank",[t.SpecRestorationDruid]:"Restoration",[t.SpecElementalShaman]:"Elemental",[t.SpecEnhancementShaman]:"Enhancement",[t.SpecRestorationShaman]:"Restoration",[t.SpecWardenShaman]:"Warden",[t.SpecHunter]:"Hunter",[t.SpecMage]:"Mage",[t.SpecRogue]:"DPS",[t.SpecTankRogue]:"Tank",[t.SpecHolyPaladin]:"Holy",[t.SpecProtectionPaladin]:"Protection",[t.SpecRetributionPaladin]:"Retribution",[t.SpecHealingPriest]:"Healing",[t.SpecShadowPriest]:"Shadow",[t.SpecWarlock]:"DPS",[t.SpecTankWarlock]:"Tank",[t.SpecWarrior]:"DPS",[t.SpecTankWarrior]:"Tank"};const a=null===s?{type:"Raid"}:{type:"Spec",index:s},n=this.buildRootSimLink(a);i.noDropdown?this.rootElem.innerHTML=n.outerHTML:(this.rootElem.innerHTML=`\n      <div class="dropdown sim-link-dropdown">\n        ${n.outerHTML}\n        <ul class="dropdown-menu"></ul>\n      </div>\n    `,this.dropdownMenu=this.rootElem.getElementsByClassName("dropdown-menu")[0],this.buildDropdown(),this.dropdownMenu.addEventListener("click",(e=>{e.target.closest('a:not([href="javascript:void(0)"]')||(e.stopPropagation(),e.preventDefault())})))}buildDropdown(){Da.forEach((e=>{const t=document.createElement("li"),s=ln(e);1==s.length?(t.appendChild(this.buildClassLink(e)),this.dropdownMenu?.appendChild(t)):s.length>1&&(t.appendChild(this.buildClassDropdown(e)),this.dropdownMenu?.appendChild(t))}))}buildClassDropdown(e){const t=ln(e),s=document.createElement("fragment"),i=document.createElement("ul");i.classList.add("dropdown-menu");const a=this.buildClassLink(e);return t.forEach((e=>{const t=document.createElement("li"),s=this.buildSpecLink(e);t.appendChild(s),i.appendChild(t)})),s.innerHTML=`\n\t\t\t<div class="dropend sim-link-dropdown">\n\t\t\t\t${a.outerHTML}\n\t\t\t\t${i.outerHTML}\n\t\t\t</div>\n    \t`,s.children[0]}buildRootSimLink(e){let t;if("Raid"==e.type)t=qa;else{const i=s[e.index];t=ln(i).length>1?Vt[e.index]:Ua[i]}return f("a",{href:"javascript:void(0)",className:Pt("sim-link",this.getContextualKlass(e)),dataset:{bsToggle:"dropdown",bsTrigger:"click"}},f("div",{className:"sim-link-content"},f("img",{src:this.getSimIconPath(e),className:"sim-link-icon"}),f("div",{className:"d-flex flex-column"},f("span",{className:"sim-link-label text-white"},"WoWSims - Season of Discovery"),f("span",{className:"sim-link-title"},t),this.launchStatusLabel(e))))}buildRaidLink(){const e=this.getContextualKlass({type:"Raid"}),t=this.getSimIconPath({type:"Raid"}),s=qa,i=document.createElement("fragment");return i.innerHTML=`\n      <a href="${Ma}" class="sim-link ${e}">\n        <div class="sim-link-content">\n          <img src="${t}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${s}</span>\n            ${this.launchStatusLabel({type:"Raid"})}\n          </div>\n        </div>\n      </a>\n    `,i.children[0]}buildClassLink(e){const t=ln(e),s=t.length>1,i=s?"javascript:void(0)":Va(t[0]);return f("a",{href:i,className:Pt("sim-link",this.getContextualKlass({type:"Class",index:e})),dataset:s?{bsToggle:"dropdown"}:{}},f("div",{className:"sim-link-content"},f("img",{src:this.getSimIconPath({type:"Class",index:e}),className:"sim-link-icon"}),f("div",{className:"d-flex flex-column"},f("span",{className:"sim-link-title"},Ua[e]),!s&&this.launchStatusLabel({type:"Spec",index:t[0]}))))}buildSpecLink(e){const t=Va(e);return f("a",{href:t,className:Pt("sim-link",this.getContextualKlass({type:"Spec",index:e}))},f("div",{className:"sim-link-content"},f("img",{src:this.getSimIconPath({type:"Spec",index:e}),className:"sim-link-icon"}),f("div",{className:"d-flex flex-column"},f("span",{className:"sim-link-label"},Ua[s[e]]),f("span",{className:"sim-link-title"},this.specLabels[e]),this.launchStatusLabel({type:"Spec",index:e}))))}launchStatusLabel(e){const t="Raid"==e.type?nn.status:on[e.index].status,s="Raid"==e.type?nn.phase:on[e.index].phase;return f("span",{className:"launch-status-label text-brand"},t===an.Unlaunched?f(x,null,"Not Yet Supported"):f(x,null,"Phase ",s,t!=an.Launched&&f(x,null," - ",an[t])))}getSimIconPath(e){let t;return t="Raid"==e.type?Ba:"Class"==e.type?Wa[e.index]:Fa[e.index],t}getContextualKlass(e){return"Raid"==e.type?"text-white":"Class"==e.type?Oa(e.index):Ha(e.index)}}const _f=[];class Af extends g{constructor(e,t,s){super(e,"sim-ui"),this.sim=t,this.cssClass=s.cssClass,this.cssScheme=s.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim");const i=f(x,null,f("div",{className:"sim-root"},f("div",{className:"sim-bg"}),s.noticeText?f("div",{className:"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide"},s.noticeText):null,f("div",{className:"sim-container"},f("aside",{className:"sim-sidebar"},f("div",{className:"sim-title"}),f("div",{className:"sim-sidebar-content"},f("div",{className:"sim-sidebar-actions within-raid-sim-hide"}),f("div",{className:"sim-sidebar-results within-raid-sim-hide"}),f("div",{className:"sim-sidebar-stats"}),f("div",{className:"sim-sidebar-socials"}))),f("div",{className:"sim-content container-fluid"}))),f("div",{className:"sim-toast-container p-3 bottom-0 right-0",id:"toastContainer"}));this.rootElem.appendChild(i),this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new Tf(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=a.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((e,t)=>this.handleCrash(t)));const n=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};n(),this.sim.showDamageMetricsChangeEmitter.on(n);const o=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};o(),this.sim.showThreatMetricsChangeEmitter.on(o);const l=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};l(),this.sim.showHealingMetricsChangeEmitter.on(l);const r=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};r(),this.sim.showDamageMetricsChangeEmitter.on(r),this.sim.showHealingMetricsChangeEmitter.on(r),this.sim.showThreatMetricsChangeEmitter.on(r);const d=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};d(),this.sim.showExperimentalChangeEmitter.on(d),this.addKnownIssues(s);const c=this.rootElem.querySelector(".sim-title");new Nf(c,s.spec,{noDropdown:this.isWithinRaidSim}),this.simActionsContainer=this.rootElem.querySelector(".sim-sidebar-actions"),this.iterationsPicker=new bh(this.simActionsContainer,this.sim,{id:"simui-iterations",label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,s)=>{t.setIterations(e,s)}}).rootElem;const h=this.rootElem.querySelector(".sim-sidebar-results");this.resultsViewer=new Ig(h);const m=this.rootElem.querySelector(".sim-sidebar-socials");m.appendChild(Lf.buildDiscordLink()),m.appendChild(Lf.buildGitHubLink()),m.appendChild(Lf.buildPatreonLink()),this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async e=>{"runOnce"==e.data&&this.runSimOnce()}))}addAction(e,t,s){const i=document.createElement("button");i.classList.add("btn","btn-primary","w-100",t),i.textContent=e,i.addEventListener("click",s),this.simActionsContainer.appendChild(i)}addTab(e,t,s){const i=t.replace(/\s+/g,"-")+"-tab",a=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(e,i);const n=document.createElement("fragment");n.innerHTML=`\n\t\t\t<div\n\t\t\t\tid="${i}"\n\t\t\t\tclass="tab-pane fade ${a?"active show":""}"\n\t\t\t>${s}</div>\n\t\t`,this.simTabContentsContainer.appendChild(n.children[0])}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";t=e.simStatus.status==an.Unlaunched?"This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.":e.simStatus.status==an.Alpha?"This sim is in ALPHA status. New runes and items may not yet be functional and further testing is needed.":"This sim is in BETA status. New runes and items should be mostly functional.",t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues&&e.knownIssues.length&&e.knownIssues.forEach((e=>this.simHeader.addKnownIssue(e))),_f.forEach((e=>this.simHeader.addKnownIssue(e)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.runRaidSim(a.nextEventID(),e)}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(a.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof Gn))return void alert(e);const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await E.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),s=this.toLink(),i=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/sod+"+e).then((a=>{a.json().then((a=>{if(a.total_count>0)window.open(a.items[0].html_url,"_blank");else{const a=`${"https://github.com/wowsims/sod/issues/new?assignees=&labels=&title=Crash%20Report%20"}${e}&body=`,n=2048-a.length;let o=encodeURIComponent(`Link:\n${s}\n\nRNG Seed: ${i}\n\n${t}`);s.includes("/raid/")&&(o=encodeURIComponent(`${t}\nRNG Seed: ${i}\nLink:\n${s}`));let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new Rf(this.rootElem,s)),window.open(a+o,"_blank")}}))})).catch((e=>{alert("Failed to file report... try again another time:"+e)}))}}hashCode(e){let t=0;for(let s=0,i=e.length;s<i;s++){t=(t<<5)-t+e.charCodeAt(s),t|=0}return t}}class Rf extends Vp{constructor(e,t){super(e,"crash",{title:"Extra Crash Information"}),this.body.innerHTML='\n\t\t\t<div class="sim-crash-report">\n\t\t\t\t<h3 class="sim-crash-report-header">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\n\t\t\t\t<textarea class="sim-crash-report-text form-control"></textarea>\n\t\t\t</div>\n\t\t';const s=document.createTextNode(t);this.body.querySelector("textarea")?.appendChild(s)}}function Df(e,t){return function(e,t){Rn[e]=t}(e,t),t}const Mf=[];class Vf extends Af{constructor(e,t,s){super(e,t.sim,{cssClass:s.cssClass,cssScheme:s.cssScheme,spec:t.spec,knownIssues:s.knownIssues,simStatus:on[t.spec],noticeText:"Phase 5 items have been added but set bonuses, procs, and on-use effects are not yet functional."}),this.rootElem.classList.add("individual-sim-ui"),this.player=t,this.individualConfig=s,this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,(s.itemSwapConfig?.itemSlots||[]).length>0&&!Mf.includes(t.spec)&&Mf.push(t.spec),this.addWarning({updateOn:a.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map((e=>`${e.name} requires ${Yt.get(e.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:a.onAny([this.player.talentsChangeEmitter,this.player.levelChangeEmitter]),getContent:()=>{const e=za(this.player.getTalentsString());return 0==e?"":e<this.player.getLevel()-9?ja:e>this.player.getLevel()-9?$a:""}}),this.addWarning({updateOn:a.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(D.ItemSlotMainHand)?.item.handType!=re.HandTypeTwoHand||null==this.player.getEquippedItem(D.ItemSlotOffHand))&&this.player.getEquippedItem(D.ItemSlotOffHand)?.item.handType!=re.HandTypeTwoHand?"":Ga}),(s.warnings||[]).forEach((e=>this.addWarning(e(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{this.loadSettings(),Bi(this.player.spec)&&alert(Ka)})),this.addSidebarComponents(),this.addGearTab(),this.bt=this.addBulkTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()}loadSettings(){const e=a.nextEventID();a.freezeAllAndDo((()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const s=kt.fromJsonString(t);this.fromProto(e,s)}catch(s){console.warn("Failed to parse saved settings: "+s)}try{const t=Op.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(s){console.warn("Failed to parse link settings: "+s)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on((e=>{const t=kt.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)}))}))}addSidebarComponents(){var e,t,s,i;this.raidSimResultsManager=Ja(this),e=this,t=this.individualConfig.epStats,s=this.individualConfig.epPseudoStats,i=this.individualConfig.epReferenceStat,e.addAction("Stat Weights","ep-weights-action",(()=>{new kf(e,t,s||[],i).open()})),new xh(this.rootElem.getElementsByClassName("sim-sidebar-stats")[0],this.player,this.individualConfig.displayStats,this.individualConfig.modifyDisplayStats)}addGearTab(){new Cg(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){const e=new Pg(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{e.navLink.hidden=!this.sim.getShowExperimental()})),e}addSettingsTab(){new Ef(this.simTabContentsContainer,this)}addTalentsTab(){new yf(this.simTabContentsContainer,this)}addRotationTab(){new rf(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new Za(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",new Hp(this.rootElem,this),!0),this.simHeader.addImportLink("60U SoD",new qp(this.rootElem,this),!0),this.simHeader.addImportLink("Addon",new zp(this.rootElem,this),!0),this.simHeader.addExportLink("Link",new Gp(this.rootElem,this),!1),this.simHeader.addExportLink("JSON",new Kp(this.rootElem,this),!0),this.simHeader.addExportLink("60U SoD EP",new Zp(this.rootElem,this),!1),this.simHeader.addExportLink("Pawn EP",new Qp(this.rootElem,this),!1)}applyDefaults(e){a.freezeAllAndDo((()=>{const t=oe(this.player.spec),s=Bi(this.player.spec);this.player.applySharedDefaults(e),this.player.setRace(e,this.individualConfig.defaults.race??A[this.player.spec][0]),this.player.setLevel(e,R[on[this.player.spec].phase]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setItemSwapGear(e,new L({})),this.player.setConsumes(e,this.individualConfig.defaults.consumes),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const i=this.player.getDefaultEpRatios(t,s);this.player.setEpRatios(e,i),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||F.Engineering),this.player.setProfession2(e,this.individualConfig.defaults.other?.profession2||F.ProfessionUnknown),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,s?9:0),this.sim.encounter.applyDefaults(e),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,s),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[]))}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return Ya[this.player.spec]+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),s=kt.create({player:this.player.toProto(!0,!1,e)});return t(zn.Miscellaneous)&&kt.mergePartial(s,{tanks:this.sim.raid.getTanks()}),t(zn.Encounter)&&kt.mergePartial(s,{encounter:this.sim.encounter.toProto()}),t(zn.External)&&kt.mergePartial(s,{partyBuffs:this.player.getParty()?.getBuffs()||i.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(zn.UISettings)&&kt.mergePartial(s,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),s}toLink(){return Gp.createLink(this)}fromProto(e,t,s){const n=e=>!s||0==s.length||s.includes(e),o=oe(this.player.spec),l=Bi(this.player.spec);a.freezeAllAndDo((()=>{if(t.player){if(this.player.fromProto(e,t.player,s),n(zn.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),n(zn.External)){this.sim.raid.setBuffs(e,t.raidBuffs||ue.create()),this.sim.raid.setDebuffs(e,t.debuffs||pe.create());const s=this.player.getParty();s&&s.setBuffs(e,t.partyBuffs||i.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(n(zn.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||me.create()),n(zn.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,un.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const s=this.player.getDefaultEpRatios(o,l);if(t.epRatios){const i=new Array(s.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(i))}else this.player.setEpRatios(e,s);t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,o,l)}}}))}}function Uf(e,t,s){return function(e,t,s){const i=[];null!=s.talentTree&&i.push((e=>e.getTalentTree()==s.talentTree));null!=s.talentTrees&&i.push((e=>(s.talentTrees||[]).includes(e.getTalentTree())));null!=s.faction&&i.push((e=>e.getFaction()==s.faction));null!=s.customCondition&&i.push(s.customCondition);return{name:e,tooltip:s.tooltip||Qa,gear:t,enableWhen:i.length>0?e=>i.every((t=>t(e))):void 0}}(e,_t.fromJson(t),s||{})}function Wf(e,t,s){const i=[];return s&&s.customCondition&&i.push(s.customCondition),{name:e,data:t,enableWhen:i.length>0?e=>i.every((t=>t(e))):void 0}}function Ff(e,t,s){return Hf(e,Ia.create({rotation:T.fromJson(t)}),s)}function Of(e,t,s,i){return Hf(e,Ia.create({rotation:{type:$.TypeSimple,simple:{specRotationJson:JSON.stringify(y[t].rotationToJson(s))}}}),i)}function Hf(e,t,s){const i=[];return null!=s?.talentTree&&i.push((e=>e.getTalentTree()==s.talentTree)),null!=s?.customCondition&&i.push(s.customCondition),{name:e,rotation:t,enableWhen:i.length>0?e=>i.every((t=>t(e))):void 0}}function qf(e,t,s,i){return{name:e,gear:t,talents:s,rotation:i}}export{Ih as $,yd as A,Vp as B,tg as C,hh as D,jp as E,Tc as F,$o as G,Go as H,Wp as I,Bo as J,ch as K,so as L,Wn as M,Xn as N,io as O,Vn as P,eo as Q,rh as R,$n as S,uh as T,Of as U,qo as V,Fl as W,Zo as X,ph as Y,gh as Z,fh as _,Un as a,vh as a0,wh as a1,co as a2,go as a3,oo as a4,qf as a5,sc as a6,ic as a7,ac as a8,Zr as a9,Uo as aa,Ml as ab,Dl as ac,ql as ad,il as ae,dh as af,Vo as ag,El as ah,yl as ai,Pl as aj,Fo as ak,Oo as al,zo as am,Jo as an,jl as ao,$l as ap,Gl as aq,Kl as ar,lh as b,rn as c,wg as d,kg as e,Zn as f,Dn as g,df as h,Jn as i,Af as j,Ff as k,Wf as l,Uf as m,Df as n,un as o,Dp as p,_l as q,nn as r,Al as s,Rl as t,Nd as u,_c as v,Rc as w,Vf as x,Ll as y,no as z};
